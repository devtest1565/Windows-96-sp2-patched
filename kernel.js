/*****************************************
 *                                       *
 * Windows 96                            *
 * Copyright (c) Windows 96 Team 2021.   *
 *                                       *
 * All external licenses apply           *
 *                                       *
 *****************************************/
Object.defineProperty(window,'$buildId',{get:a=>'12516.7b9a893a.220612-2344.da14666c6d6372fa1a6e',set:a=>console.warn('User is not in the sudoers file. This incident will be reported.')});(()=>{var __webpack_modules__={8516:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});const s={mkShortcut:n(4973).R.mkShortcut}},2110:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var s=n(5784);async function i(e){const t=`C:/system/local/lib/modules/${e}.json`;return!!s.FS.exists(t)&&JSON.parse(await s.FS.readstr(t))}function o(e){return async function(t){let n,a=t;try{n=await i(a)}catch(e){console.error(`Failed to read module JSON ${a}. Please rectify this mistake.`),n=!1}if(!n&&"<anonymous>"!==e.modulePath){const t=s.FSUtil.deconstructFullPath(e.modulePath),n=t.prefix,i=""==t.path?"/":t.path,o=n+s.FSUtil.resolvePath(i,a);s.FS.exists(o)&&(a=o)}if(a.endsWith(".js")||n){n&&(a=n.libPath);let t=s.FSUtil.getParentPath(a);if(2==t.length&&(t+="/"),e.cachedModules[a])return e.cachedModules[a];const i={...e,modulePath:t,include:null};i.include=o(i);const l=await r(`\n            const module = {};\n\n            ${await s.FS.readstr(a)}\n\n            return module.exports;`).call(i);return e.cachedModules[a]=l,l}return a.endsWith(".json")?JSON.parse(await s.FS.readstr(a)):await s.FS.readstr(a)}}function r(e){return new Function(`\n    return (async function() {\n        const current = this;\n        const env = this.boxedEnv;\n\n        \nconst FS = w96.FS;\nconst FSUtil = w96.FSUtil;\nconst WApplication = w96.WApplication;\nconst StandardWindow = w96.StandardWindow;\nconst include = this.include;\nconst registerApp = w96.sys.reg.registerApp;\nconst deregisterApp = w96.sys.reg.deregisterApp;\n\n\n        ${e}\n    });`)()}const a={run:function(e,t){const n={include:null,cwd:"c:/user",scriptDir:"<anonymous>",modulePath:"<anonymous>",envType:"normal",boxedEnv:null,cachedModules:{},...t};return n.include=o(n),r(e).call(n)},runFile:async function(e,t){let n=s.FSUtil.getParentPath(e);return 2==n.length&&(n+="/"),await a.run(await s.FS.readstr(e),{cwd:n,scriptDir:n,modulePath:n,envType:"normal",boxedEnv:null,...t})},resolveModule:i}},2666:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DOSBOXApplication:()=>h});var s=n(4186),i=n(5784),o=n(7366),r=n(4420),a=n(9338),l=n(6999),c=n(6841),d=n(5905),p=n(2110),u=n(8041);class h extends s.WApplication{constructor(){super()}async main(e){super.main(e),await this._createWindow(null!=e[0]?e[0]:window.location.origin+"/system/apps/dosbox/zips/msd-essentials.zip")}showOpenZipDialog(){new a.MT("w:/system/apps/dosbox/zips",["zip","ZIP"],(async e=>{this._fnUrl&&URL.revokeObjectURL(this._fnUrl),this._fnUrl=URL.createObjectURL(await i.FS.toBlob(e)),this.appFrame.onload=()=>{this.appFrame.contentWindow.app.init(this,this.mainwnd,this._fnUrl)},this.appFrame.contentDocument.location.reload()})).show()}async _createWindow(e){var t;let n={args:[],ui:{showMenuBar:!0,width:640,height:441},scripts:{init:null}};if(e.endsWith(".json"))try{n={...n,...JSON.parse(await i.FS.readstr(e))},n.zip&&(t=await i.FS.toBlob(n.zip)),n.icon&&(n.icon=URL.createObjectURL(await i.FS.toBlob(n.icon)))}catch(e){a.jC.error("DOSBox","Error reading configuration.","OK"),this.terminate()}else try{if((0,c.PX)(e)){const n=await fetch(e,{method:"GET",cache:"no-cache"});t=await n.blob()}else t=(0,c.b2)(e)?(0,d.O)(e):await i.FS.toBlob(e)}catch(e){a.jC.error("DOSBox","Cannot mount ZIP file!","OK"),this.terminate()}const s=new o.Lw;s.title="DOSBox",s.initialWidth=n.ui.width,s.initialHeight=n.ui.height;const p=this.createWindow(s,!0);p.registerWindow(),p.registerAppBar(),p.setHtml('<div class="appbar"></div><iframe src="/system/apps/dosbox"></iframe>');const u=p.wndObject.querySelector(".window-html-content");u.classList.add("dosbox-app"),p.setWindowIcon(r.Q.getIconUrl("small/apps/dosbox"));const h=new l.j;h.addRoot("File",[{type:"normal",label:"Open ZIP",onclick:()=>{this.showOpenZipDialog()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]),h.addRoot("Scale",[{type:"normal",label:"Aspect",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("aspect")}},{type:"normal",label:"Stretch",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("stretch")}},{type:"separator"},{type:"normal",label:"Fullscreen",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("fullscreen")}}]),h.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{w96.ui.MsgBoxSimple.info("About NES",'<span class="bold-noaa">JSDOSBox Emulator</span><br>Version 1.0<br><br>Powered by <a href="https://js-dos.com/">jsdos</a>',"OK").dlg.setSize(320,140)}}]),u.querySelector(".appbar").replaceWith(h.getMenuDiv()),n.icon&&p.setWindowIcon(n.icon),n.title&&p.setTitle(n.title),n.ui.showMenuBar||(h.getMenuDiv().style.display="none");const m=p.wndObject.querySelector("iframe"),_=URL.createObjectURL(t);this._fnUrl=_,m.onload=()=>{m.contentWindow.app.init(this,p,_,this.gameCfg.args,(()=>{this.gameCfg.ui.aspect&&this.appFrame.contentWindow.app.setScaleMode(this.gameCfg.ui.aspect)}))},this.appFrame=m,this.mainwnd=p,p.show(),this.gameCfg=n}async procScript(e,t){const n=this.gameCfg.scripts[e];if(!n)return;const s=a.jC.idleProgress("DOSBox","Running scripts, please wait...");try{await p.D.runFile(n,{boxedEnv:{instance:this,...t}})}catch(e){u.O.create({icon:"error",title:"DOSBox",body:`Failed to execute script ${n}:\n`+new String(e)})}s.closeDialog()}ontermination(){super.ontermination(),URL.revokeObjectURL(this._fnUrl),this.gameCfg.icon&&URL.revokeObjectURL(this.gameCfg.icon)}}},5567:(e,t,n)=>{"use strict";n.r(t),n.d(t,{JSLinuxApplication:()=>r});var s=n(4186),i=(n(9338),n(5784),n(7366)),o=n(4420);n(5544),n(9110);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}async _createWindow(e){var t=new i.Lw;t.title="JSLinux",t.initialWidth=735,t.initialHeight=561,t.resizable=!1;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml("<iframe></iframe>"),n.setControlBoxStyle("WS_CBX_MINCLOSE"),n.setWindowIcon(o.Q.getIconUrl("small/apps/linux"));const s=n.wndObject.querySelector(".window-html-content");s.classList.add("jslinux-app");const r=s.querySelector("iframe");r.onload=()=>{r.contentWindow.app.init(this,n)},r.src="/system/apps/jslinux",n.show()}}},5235:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NESEmulatorApplication:()=>c});var s=n(4186),i=(n(8223),n(5784)),o=n(7366),r=n(4420),a=n(9338),l=n(6999);class c extends s.WApplication{constructor(){super()}async main(e){super.main(e),null!=e[0]?await this._createWindow(e[0]):new a.MT("c:/",["nes","NES"],(e=>{e?this._createWindow(e):this.terminate()})).show()}showOpenRomDialog(){new a.MT("c:/",["nes","NES"],(async e=>{this._fnUrl&&URL.revokeObjectURL(this._fnUrl),this._fnUrl=URL.createObjectURL(await i.FS.toBlob(e)),this.appFrame.onload=()=>{this.appFrame.contentWindow.app.init(this,this.mainwnd,this._fnUrl)},this.appFrame.contentDocument.location.reload()})).show()}async _createWindow(e){var t=new o.Lw;t.title=i.FSUtil.fname(e)+" - NES",t.initialWidth=256,t.initialHeight=281;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml('<div class="appbar"></div><iframe src="/system/apps/nes"></iframe>');const s=n.wndObject.querySelector(".window-html-content");s.classList.add("nes-app"),n.setWindowIcon(r.Q.getIconUrl("small/apps/nes"));const c=new l.j;c.addRoot("File",[{type:"normal",label:"Open ROM",onclick:()=>{this.showOpenRomDialog()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]),c.addRoot("Scale",[{type:"normal",label:"Stretch",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("")}},{type:"normal",label:"Zoom",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("zoom-scale")}},{type:"normal",label:"Pixel Perfect",onclick:()=>{this.appFrame.contentWindow.app.setScaleMode("pixel-perfect")}}]),c.addRoot("Debug",[{type:"normal",label:"Dump Memory",onclick:()=>{const e=Array.from(this.appFrame.contentWindow.app.nes.cpu.mem),t=new a.pp("c:/",["mem"],(t=>{t&&i.FS.writebin(t,e)}));t.show(),t.fileBox.value="Dump_"+(new Number(new Date)+0).toString()+".mem"}},{type:"normal",label:"Load Dump",onclick:()=>{new a.MT("c:/",["mem"],(async e=>{e&&(this.appFrame.contentWindow.app.nes.cpu.mem=Array.from(await i.FS.readbin(e)))})).show()}}]),c.addRoot("Help",[{type:"normal",label:"Controls",onclick:()=>{w96.ui.MsgBoxSimple.info("Controls",'<span class="bold-noaa">Controls</span><br>a =&gt; A<br>s =&gt; B<br>Arrow Keys =&gt; DPAD<br>Enter =&gt; START<br>Tab =&gt; SELECT',"OK").dlg.setSize(320,170)}},{type:"separator"},{type:"normal",label:"About",onclick:()=>{w96.ui.MsgBoxSimple.info("About NES",'<span class="bold-noaa">NES Emulator</span><br>Version 1.0<br><br>Powered by <a href="https://github.com/bfirsh/jsnes">JSNES</a>',"OK").dlg.setSize(320,140)}}]),s.querySelector(".appbar").replaceWith(c.getMenuDiv());const d=n.wndObject.querySelector("iframe"),p=URL.createObjectURL(await i.FS.toBlob(e));this._fnUrl=p,d.onload=()=>{d.contentWindow.app.init(this,n,p)},this.appFrame=d,this.mainwnd=n,n.show()}ontermination(){super.ontermination(),URL.revokeObjectURL(this._fnUrl)}}},1722:(e,t,n)=>{"use strict";n(9338),n(8041),n(4420),n(6999),n(5784),n(4186)},7477:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Multiplayer96Application:()=>l});var s=n(4186),i=n(7366),o=(n(5784),n(4420)),r=(n(4367),n(9338)),a=n(6841);class l extends s.WApplication{constructor(){super()}async main(e){super.main(e),window._mpactive||(window._mpactive=!0,this._createWindow())}async _createWindow(){this.players={},window._mpactive=!0;var e=new i.Lw;e.title="Windows 96 Multiplayer",e.initialWidth=320,e.initialHeight=270,e.resizable=!0;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<div>\n        Welcome to Windows 96 Multiplayer. Please enter your server details below (keep this default if you\'re hosting and running the server software locally).\n        <br>\n        <br>\n        <a href="/dl/96mp-v1.0-bin.zip">Download server software</a>\n        </div>\n        <br>\n\n        <span class="bold-noaa">Server IP/Host</span>\n        <input class="w96-textbox ip" type="text" value="ws://127.0.0.1:2020" style="margin-bottom: 2em;">\n\n        <span class="bold-noaa">Nickname (16 chars max)</span>\n        <input class="w96-textbox nick" type="text" value="Anonymouse">\n\n        <span class="status">Status: <span class="bold-noaa">Disconnected</span></span>\n        <div class="bgrp">\n            <button role="host-connect" class="w96-button">Connect as Host</button>\n            <button role="usr-connect" class="w96-button">Connect as User</button>\n            <button role="disconnect" class="w96-button" disabled>Disconnect</button>\n        </div>');const n=t.wndObject.querySelector(".window-html-content");n.classList.add("winmp-app"),this.statusLabel=n.querySelector(".status>.bold-noaa");const s=n.querySelector("input.ip"),r=n.querySelector("input.nick"),a=n.querySelector('button[role="host-connect"]'),l=n.querySelector('button[role="usr-connect"]'),c=n.querySelector('button[role="disconnect"]');this.hostConnectBtn=a,this.userConnectBtn=l,this.disconnectBtn=c,this.nickBox=r,this.hostBox=s,a.onclick=()=>{if(this._nickCheck(r.value)){l.disabled=!0,a.disabled=!0,c.disabled=!0,r.disabled=!0,s.disabled=!0,this.status("Connecting as host...");try{this._createSocket(s.value),this.connectAsHost()}catch(e){this.status(e,"error")}}},l.onclick=()=>{if(this._nickCheck(r.value)){a.disabled=!0,l.disabled=!0,c.disabled=!0,r.disabled=!0,s.disabled=!0,this.status("Connecting...");try{this._createSocket(s.value),this.connectAsUser()}catch(e){this.status(e,"error")}}},c.onclick=()=>this.revertState(),t.onclose=()=>{this.revertState(),this.io&&(this.io.removeAllListeners(),this.io.close(),this.io=null),window._mpactive=!1,this.logArea&&(this.logArea.remove(),this.logArea=null)};const d=document.createElement("div");d.classList.add("wmp-notif"),document.body.appendChild(d),this.logArea=d,t.setWindowIcon(o.Q.getIconUrl("small/apps/winmp")),t.show(),t.center()}status(e,t="idle"){this.statusLabel.innerText=e,this.statusLabel.className="bold-noaa "+t}awaitPing(){return new Promise((e=>{const t=setTimeout((()=>e(!1)),1500);this.io.once("_pong",(()=>{e(!0),clearTimeout(t)})),this.io.emit("_ping")}))}connectAsHost(){if(!this.awaitPing())return this.status("Cannot reach server","error"),void this.revertState();this.status("Authenticating..."),this.io.emit("logon",{nick:this.nickBox.value,isHost:!0})}connectAsUser(){if(!this.awaitPing())return this.status("Cannot reach server","error"),void this.revertState();this.status("Authenticating..."),this.io.emit("logon",{nick:this.nickBox.value,isHost:!1})}revertState(){this.hostConnectBtn.disabled=!1,this.userConnectBtn.disabled=!1,this.disconnectBtn.disabled=!0,this.nickBox.disabled=!1,this.hostBox.disabled=!1,this.io&&(this.io.removeAllListeners(),this.io.close(),this.io=null),this.players={},this._usrWindow&&(this._usrWindow.close(),this._usrWindow=null),this.status("Disconnected",""),document.querySelectorAll(".wmp-cursor").forEach((e=>e.remove()))}_createUserWindow(){const e=new i.Lw;e.initialHeight=350,e.initialWidth=400,e.title="96 Multiplayer Control Window",e.resizable=!0,e.draggable=!0,this._usrWindow=this.createWindow(e,!1),this._usrWindow.registerWindow(),this._usrWindow.onclose=()=>this.revertState(),this._usrWindow.setHtml(`<span class="bold-noaa">Server:</span> ${this.hostBox.value}<br><span class="bold-noaa">Nickname:</span> ${this.nickBox.value}<br><br><button class="w96-button" onclick="this.parentElement.requestPointerLock()">Recapture cursor</button>`);const t=this._usrWindow.wndObject.querySelector(".window-html-content");t.classList.add("winmp-usr-window"),t.onclick=()=>{document.pointerLockElement||t.requestPointerLock(),this.io.emit("mouse click")},t.ondblclick=e=>{this.io.emit("mouse dblclick")},t.onmousedown=e=>{this.io.emit("mouse down",e.button)},t.onclick=e=>{this.io.emit("mouse click",e.button)},t.onmouseup=e=>{this.io.emit("mouse up",e.button)},t.onmousemove=e=>{this.io.emit("mouse move",e.movementX,e.movementY,e.button)},this._usrWindow.onshown=()=>{t.requestPointerLock()},this._usrWindow.center(),this._usrWindow.show()}_createSocket(e){this.io&&(this.io.removeAllListeners(),this.io.close(),this.io=null),this.io=io(e),this.io.on("no host",(()=>{r.jC.warning("No Host","Please wait for a desktop host to connect first.","OK"),this.status("no host desktop to use as arena.","error"),this.revertState()})),this.io.on("host defined",(()=>{r.jC.warning("Already hosted","Somebody is already hosting their desktop.","OK"),this.status("host is already present.","error"),this.revertState()})),this.io.on("welcome user",(e=>{this.disconnectBtn.disabled=!1,this.io.on("disconnect",(()=>{this.status("server closed","error"),this.revertState()})),this.status("Active on "+e.host.nick+"'s desktop.","success"),this._createUserWindow()})),this.io.on("welcome host",(()=>{this.disconnectBtn.disabled=!1,this.io.on("disconnect",(()=>{this.status("server closed","error"),this.revertState()})),this.io.on("player join",(e=>{let t=document.createElement("div");t.classList.add("join-msg"),t.innerText=e.nick+" joined the desktop.",this.logArea.appendChild(t),setTimeout((()=>t.remove()),3e3);const n=document.createElement("div");n.classList.add("wmp-cursor");const s=document.createElement("div");s.classList.add("image"),n.appendChild(s);const i=document.createElement("div");i.classList.add("nick"),i.innerText=e.nick,i.style.backgroundColor="#"+Math.floor(16777215*Math.random()).toString(16),n.appendChild(i),document.body.appendChild(n),this.players[e.id]={id:e.id,nick:e.nick,cursor:n}})),this.io.on("player leave",(e=>{let t=document.createElement("div");t.classList.add("leave-msg"),t.innerText=e.nick+" left the desktop.",this.logArea.appendChild(t),setTimeout((()=>t.remove()),3e3),this.players[e.id].cursor.remove(),this.players[e.id]=null}));let e=document.body;this.io.on("mouse move",((t,n,s,i)=>{const o=(0,a.N5)(0,window.innerWidth,this.players[i].cursor.offsetLeft+t),r=(0,a.N5)(0,window.innerHeight,this.players[i].cursor.offsetTop+n);this.players[i].cursor.style.left=o+"px",this.players[i].cursor.style.top=r+"px";const l=document.elementFromPoint(o,r);if(e!=l){let t=new MouseEvent("mouseleave",{view:window,bubbles:!0,cancelable:!0,button:s,x:o,y:r,clientX:o,clientY:r});e&&e.dispatchEvent(t),e=l;let n=new MouseEvent("mouseenter",{view:window,bubbles:!0,cancelable:!0,x:o,y:r,clientX:o,clientY:r});l&&l.dispatchEvent(n)}})),this.io.on("mouse dblclick",(e=>{const t=this.players[e].cursor.offsetLeft,n=this.players[e].cursor.offsetTop;var s=new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0,x:t,y:n,clientX:t,clientY:n});const i=document.elementFromPoint(t,n);i&&i.dispatchEvent(s)})),this.io.on("mouse down",((e,t)=>{const n=this.players[e].cursor.offsetLeft,s=this.players[e].cursor.offsetTop,i=document.elementFromPoint(n,s);var o=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!0,button:t,x:n,y:s,clientX:n,clientY:s});i&&i.dispatchEvent(o),document.activeElement!=i&&i.focus()})),this.io.on("mouse up",((e,t)=>{const n=this.players[e].cursor.offsetLeft,s=this.players[e].cursor.offsetTop,i=document.elementFromPoint(n,s);var o=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!0,button:t,x:n,y:s,clientX:n,clientY:s});i&&i.dispatchEvent(o)})),this.io.on("mouse click",((e,t)=>{const n=this.players[e].cursor.offsetLeft,s=this.players[e].cursor.offsetTop,i=document.elementFromPoint(n,s);var o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,button:t,x:n,y:s,clientX:n,clientY:s});i&&i.dispatchEvent(o)})),this.status("Server active - you are hosting","success")}))}_nickCheck(e){return e.length>16?(r.jC.warning("Nickname Error","Your nickname must not be longer than 16 characters!","OK"),!1):e.length<1?(r.jC.warning("Nickname Error","Please enter a nickname.","OK"),!1):""!=e.trim()||(r.jC.warning("Nickname Error","Your nickname must not be empty!","OK"),!1)}}},1066:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BassoonTrackerApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="BassoonTracker",e.initialWidth=680,e.initialHeight=730;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/bassoon"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("bassoon-app"),t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},t.setWindowIcon(o.Q.getIconUrl("small/apps/bassoon"));const n=t.wndObject.querySelector("iframe");this.appFrame=n,this.mainwnd=t,t.show()}}},8754:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BlocksApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Blocks",e.initialWidth=540,e.initialHeight=361;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/blocks"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("blocks-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/blocks"));const n=t.wndObject.querySelector("iframe");t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},3837:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DesktopDestroyerApplication:()=>r});var s=n(9338),i=n(5516),o=n(4186);class r extends o.WApplication{constructor(){super()}main(e){super.main(e),i.x.wmem.dd_open?s.jC.error("Error","Only one instance may be running!","OK"):(i.x.wmem.dd_open=!0,this.init())}init(){const e=document.createElement("div");e.classList.add("deskdestroyer"),document.body.appendChild(e)}ontermination(){i.x.wmem.dd_open=!1}}},9041:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DYKApplication:()=>c});var s=n(4186),i=n(5784),o=(n(7366),n(4420)),r=n(6841),a=(n(9951),n(9338));const l=["Your internet connection is working fine; No one replies to your e-mails because there is no one left.","You can keep your Facebook memes on Facebook.","You can use Find to locate your real father.\n\nBut I will save you the trouble, Windows 96 is your real father.","You can use Windows Explorer to explore ideas too disturbing for normal humans to fathom.\nIf you start to go mad, run ScanDisk.","You can delete c:/system to force Windows 96 to update.","Windows 96 comes bundled with 4 default wallpapers.","The magic number for JPEG is 0xff 0xd8 0xff.","Your tweets do not have to be political.","Memes on most social medias originate from r/memes.","You can wipe your entire hard drive by clearing the application data.","You do not need to use JQuery in your web projects.","You can upload pictures of cats using the Uploader tool.","You can delete the trash.","Margaret Thatcher is still dead.","You should seek help from the Windows 96 wiki so we can stop dealing with your stupid questions.","Bill Gates full name is William Henry Gates III.","Upgrading your internet speed will increase the download speed of Windows 96 updates.","You can use common sense to figure out most of Windows 96.","You can turn off your computer to reduce your electricity bill.","We have a Discord server where you can report bugs and make suggestions (link on desktop).","This copy of Windows is not genuine.","GET OUT OF MY HEAD GET OUT OF MY HEAD GET OUT OF MY HEAD GET OUT OF MY HEAD GET OUT OF MY HEAD GET OUT OF MY HEAD GET OUT OF MY HEAD","Internet Exploder can only show pages which allow themselves to be iframed and/or loaded by other webpages.","You can store real files on Windows 96.","Make regular backups of your data, we are not responsible if we destroy your important things with a crappy update!","Do not install malicious javascripts, your browser may likely crash and you'll go mad.","You cannot write any data to W:/, trust me.","Do not delete c:/system, it will cause your system to perform a blue screen.","We have no tip for today. Go outside and play ball, maybe watch a movie, or just sit there and do nothing.","Unlike some other operating systems, we will never force you to update. Of course there might be negative implications for doing so, but that choice and responsibility rests in your hands.","You can create a theme by creating a CSS file in c:/system/boot, which will override any loaded CSS in your current environment.","You can change your current theme in Settings > Look and feel > Theme","Ensure your applications use a consistent UI. Some operating systems don't do this, but this is what lets your users use your application without direct prior knowledge of it.","The Wiki has some history about Windows 96 itself, check it out if you're interested!"];class c extends s.WApplication{constructor(){super()}async main(e){super.main(e),e.includes("--export")?new a.pp("c:/user",[".json"],(e=>{e&&""!=e.trim()&&i.FS.writestr(e,JSON.stringify(l))})).show():this._init()}async _init(){this.wnd=a.jC.info("Tip",'<span class="bold-noaa">Did you know...</span><br><br><span class="fact"></span>',"OK"),this.wnd.dlg.setSize(405,155);const e=this.wnd.dlg.wndObject.querySelector(".icon");e.className="icon",e.style.backgroundImage="url("+o.Q.getIconUrl("tips")+")";const t=document.createElement("button");t.classList.add("w96-button"),t.innerText="?",t.onclick=()=>this.generateTip(),this.wnd.dlg.wndObject.querySelector(".buttons").prepend(t),this.wnd.dlg.onshown=()=>{this.wnd.dlg.center(),this.generateTip()}}generateTip(){i.FS.exists("c:/user/appdata/Tips/tips.json")?i.FS.readstr("c:/user/appdata/Tips/tips.json").then((e=>{const t=JSON.parse(e);this.wnd.dlg.wndObject.querySelector(".fact").innerText=t[(0,r.TN)(0,t.length)]})):this.wnd.dlg.wndObject.querySelector(".fact").innerText=l[(0,r.TN)(0,l.length)]}ontermination(){super.ontermination()}}},2290:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GameingApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Gameing",e.initialWidth=640,e.initialHeight=441;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/gameing"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("gameing-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/gameing"));const n=t.wndObject.querySelector("iframe");n.onload=()=>{},t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},335:(e,t,n)=>{"use strict";n.r(t),n.d(t,{HealthCheckApp:()=>a});var s=n(8041),i=n(4420),o=n(5516),r=n(4186);class a extends r.WApplication{constructor(){super()}async main(e){super.main(e);const t=this.createWindow({title:"PC Health Check",initialHeight:672,initialWidth:672,icon:i.Q.getIconUrl("small/apps/pchc"),center:!0,taskbar:!0,bodyClass:"health-app",body:'\n                <div class="top">\n                    <div class="title">\n                        PC health at a glance\n                    </div>\n                </div>\n                <div class="mid">\n                    <div class="left">\n                        <div class="device"></div>\n                        <div class="device-title">DESKTOP-MCRO96</div>\n                        <div class="specs">\n                            <div class="spec">32 MB RAM</div>\n                            <div class="spec">512 MB HDD</div>\n                            <div class="spec">25 years old</div>\n                        </div>\n                    </div>\n                    <div class="content">\n                        <div class="upgrade-notify-box">\n                            <div>\n                                <span class="bold-noaa">INTRODUCING WINDOWS 97</span>\n                            </div>\n                            <div class="ex">\n                                Let\'s check if this PC meets the system requirements.<br>\n                                If it does, you can get the free upgrade when it\'s available.\n                            </div>\n                            <button class="w96-button check-now">Check now</button>\n                        </div>\n\n                        <div class="check-items">\n                            <div class="item account">\n                                <div class="top">\n                                    <div class="icon"></div>\n                                    <div class="title"><span class="bold-noaa">Backup and Sync</span></div>\n                                    <div class="action alert">Attention required</div>\n                                </div>\n\n                                <div class="explanation">\n                                    <span class="title">Sign in with a Mikesoft account to get started</span>\n                                    <div>\n                                        <div style="display: inline-block;width: calc(100% - 75px);">\n                                            Keep your preferences in sync across devices, and set up MikeDrive to sync your files too. It will only cost you your precious soul and data.\n                                        </div>\n                                        <button class="w96-button sign-in" style="display: inline-block; vertical-align: top; width: 68px; margin-left: 2px;">Sign in</button>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="item update">\n                                <div class="top">\n                                    <div class="icon"></div>\n                                    <div class="title"><span class="bold-noaa">Windows Update</span></div>\n                                    <div class="action">You are up to date</div>\n                                </div>\n                            </div>\n\n                            <div class="item storage">\n                                <div class="top">\n                                    <div class="icon"></div>\n                                    <div class="title"><span class="bold-noaa">Storage Capacity</span></div>\n                                    <div class="action">50% full</div>\n                                </div>\n                            </div>\n\n                            <div class="item startup">\n                                <div class="top">\n                                    <div class="icon"></div>\n                                    <div class="title"><span class="bold-noaa">Startup Time</span></div>\n                                    <div class="action">Ok</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="bottom">\n                    <span class="text">Related Links</span>\n\n                    <div class="right">\n                        <button class="w96-button tips" disabled>Tips on PC health</button>\n                        <button class="w96-button more-w97">More on Windows 97</button>\n                    </div>\n                </div>\n            '},!0),n=t.getBodyContainer();n.querySelector(".w96-button.check-now").addEventListener("click",(()=>{s.O.create({title:"This PC can't run Windows 97",icon:"error",body:"The processor isn't supported for Windows 97. <br>While this PC doesn't meet the system requirements to run Windows 97,<br> you'll keep getting Windows 96 updates."})})),n.querySelector(".w96-button.sign-in").addEventListener("click",(()=>{s.O.create({title:"Sign in error",icon:"error",body:"Unable to contact the Mikesoft Cloud servers. This is probably your fault."})})),n.querySelector(".w96-button.more-w97").addEventListener("click",(()=>{o.x.execCmd("iexploder",["https://super-player.pro/"])})),t.show()}}},1872:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HTermApplication:()=>HTermApplication});var _gui_commdlg__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9338),_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4420),_gui_wndsystem__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7366),_shell_taskbar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8423),_sys_kernel_loader__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(8223),_sys_os_release__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4247),_sys_system__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5516),_sys_util_dom__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9471);const{WApplication}=__webpack_require__(4186);class HTermApplication extends WApplication{constructor(){super()}async main(e){super.main(e),_sys_system__WEBPACK_IMPORTED_MODULE_6__.x.wmem._htermOpen?_gui_commdlg__WEBPACK_IMPORTED_MODULE_0__.jC.error("HTerm","Only one instance may be ran!","OK"):(_sys_system__WEBPACK_IMPORTED_MODULE_6__.x.wmem._htermOpen=!0,await _sys_kernel_loader__WEBPACK_IMPORTED_MODULE_4__.a.loadStyleAsync("/system/resource/app/hterm/main.css"),await this._createUI())}async _createUI(){_shell_taskbar__WEBPACK_IMPORTED_MODULE_3__.e.setVisibility(!1);const e=new _gui_wndsystem__WEBPACK_IMPORTED_MODULE_2__.Lw;e.title="HackerTerm",e.resizable=!1;const t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setWindowIcon(_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_1__.Q.getIconUrl("small/apps/hterm")),t.wndObject.classList.add("wnd-hterm","nodrag"),t.setHtml(`\n        <div class="top-bar">\n            <div class="title">Windows 96</div>\n            <div class="stat">\n                <b>LOCAL TIME</b>\n                <span>9:33 PM</span>\n            </div>\n            \n            <div class="stat">\n                <b>IP ADDRESS</b>\n                <span>0.0.0.0</span>\n            </div>\n            \n            <div class="stat" style="border-right: none;">\n                <b>ORIGIN</b>\n                <span>${window.location.host}</span>\n            </div>\n\n            <button class="close">x</button>\n        </div>\n        \n        <div class="content">\n            <div class="p1">\n                <div class="tab-control">\n                    <div class="pages">\n                        <div ident="terminal" class="btn active">TERMINAL</div>\n                        <div ident="filemgr" class="btn">FILE MGR</div>\n                        <div ident="syslog" class="btn">SYSLOG</div>\n                    </div>\n                    \n                    <div class="page active" ident="terminal">\n                        <div class="output"></div>\n                        <div class="pset">\n                            <span class="prompt">#&nbsp;</span>\n                            <input class="input" type="text">\n                        </div>\n                    </div>\n\n                    <div class="page" ident="filemgr">\n                        some dummy text (we did not fully develop this)\n                    </div>\n\n                    <div class="page" ident="syslog">\n                        some more dummy text here pls\n                    </div>\n                </div>\n\n                <div class="stats">\n\n                </div>\n            </div>\n        </div>`);const n=t.getBodyContainer();n.querySelector(".top-bar>.close").addEventListener("click",(()=>t.close())),n.querySelector('.tab-control>.pages>.btn[ident="terminal"]').addEventListener("click",(()=>this.switchTab("terminal"))),n.querySelector('.tab-control>.pages>.btn[ident="filemgr"]').addEventListener("click",(()=>this.switchTab("filemgr"))),n.querySelector('.tab-control>.pages>.btn[ident="syslog"]').addEventListener("click",(()=>this.switchTab("syslog"))),this.appWnd=t,this.setupTerminal(),t.show(),this.tprintln(escapeHTML(`\n           &@@@@@@@%            \n      %@@@%         &@@@#              GREETINGS, USER.\n    %&                  #&%     \n #@%                       &&          ---------------------------\n #%#    #@@@&    #@@@&     %%#         Windows 96 v${_sys_os_release__WEBPACK_IMPORTED_MODULE_5__.d.getVersion()}\n@%       %%%#     %%%#       %@@       \n@%                           %@@       Enter some JavaScript below.\n@%    %@#             %@#    %@@       For REPL help, enter .help\n###   %@&%          #%&@#  #####\n #@%   #%@@&%%%%%%%&@@%    &&   \n   #%%                   %%     \n      %&&&#         %&&&#       \n          #&&@&@&@&%                    \n`))}procJSTerminal(js){try{if(".help"==js)return void this.tprintln("REPL cmds:\n .help - This page.\n .quit - Quit Hterm.");".quit"==js&&this.terminate();const result=eval(js);switch(typeof result){default:this.tprintln(escapeHTML(result.toString()));break;case"number":case"bigint":this.tprintln(`<span style="color: yellow;">${escapeHTML(result.toString())}</span>`);break;case"object":this.tprintln(`${JSON.stringify(result,null,4)}`);break;case"function":this.tprintln(`<span style="color: green;">'${escapeHTML(result.toString())}'</span>`);break;case"string":this.tprintln(`<span style="color: green;">'${escapeHTML(result)}'</span>`);break;case"boolean":this.tprintln(`<span style="color: magenta;">${escapeHTML(result.toString().toLowerCase())}</span>`);break;case"undefined":this.tprintln(`<span style="color: lightgray;">${escapeHTML("<undefined>")}</span>`)}}catch(e){e&&this.tprintln(`<span style="color: red;">${escapeHTML(e.toString())}</span>`)}}tprint(e){const t=this.appWnd.getBodyContainer(),n=t.querySelector('.tab-control>.page[ident="terminal"]'),s=t.querySelector('.tab-control>.page[ident="terminal"] .output'),i=_sys_util_dom__WEBPACK_IMPORTED_MODULE_7__.K.mkElement("span",[]);i.innerHTML=e,s.appendChild(i),n.scrollTop=n.scrollHeight}tprintln(e){this.tprint(e+"\n")}setupTerminal(){const e=this.appWnd.getBodyContainer().querySelector('.tab-control>.page[ident="terminal"]'),t=e.querySelector(".input");t.onkeydown=n=>{if("Enter"==n.key){const n=t.value;this.tprintln("#&nbsp;"+escapeHTML(t.value)),""!=t.value.trim()&&this.procJSTerminal(n),t.value="",e.scrollTop=e.scrollHeight}}}switchTab(e){const t=this.appWnd.getBodyContainer();t.querySelectorAll(".tab-control>.page").forEach((e=>e.classList.remove("active"))),t.querySelectorAll(".tab-control>.pages>.btn").forEach((e=>e.classList.remove("active"))),t.querySelector(`.tab-control>.page[ident="${e}"]`).classList.add("active"),t.querySelector(`.tab-control>.pages>.btn[ident="${e}"]`).classList.add("active")}ontermination(){_sys_system__WEBPACK_IMPORTED_MODULE_6__.x.wmem._htermOpen=null,_shell_taskbar__WEBPACK_IMPORTED_MODULE_3__.e.setVisibility(!0)}}},2062:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MatrixApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Matrix",e.initialWidth=540,e.initialHeight=361;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/matrix2"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("matrix-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/matrix"));const n=t.wndObject.querySelector("iframe");t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},3017:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MemeManApplication:()=>r});var s=n(4186),i=(n(5784),n(7366),n(4420),n(6841)),o=n(9951);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._init()}async _init(){this.meme_man=document.createElement("div"),this.meme_man.classList.add("meme-man");const e=window.innerHeight,t=window.innerWidth,n=(0,i.TN)(0,t-180),s=(0,i.TN)(0,e-180);this.meme_man.style.top=s+"px",this.meme_man.style.left=n+"px",this.meme_man.ondblclick=()=>{(0,o.s)(this.meme_man,"flipOutY",(()=>{this.meme_man.style.top=(0,i.TN)(0,t-180)+"px",this.meme_man.style.left=(0,i.TN)(0,e-180)+"px",(0,o.s)(this.meme_man,"flipInX")}))},$(this.meme_man).draggable(),document.querySelector("#maingfx").appendChild(this.meme_man)}ontermination(){super.ontermination(),this.meme_man.remove()}}},3903:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PumkinGameApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Pumkin World",e.initialWidth=485,e.initialHeight=400;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/pumkin"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("eyeframe-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/pumkin"));const n=t.wndObject.querySelector("iframe");t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},4465:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BoardApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="ShareBoard",e.initialWidth=640,e.initialHeight=441;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="https://sb.windows96.net/"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("win96chat-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/shareboard"));const n=t.wndObject.querySelector("iframe");t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},9593:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TrollApplication:()=>a});var s=n(9338),i=n(8041),o=(n(4420),n(6841)),r=n(4186);class a extends r.WApplication{constructor(){super()}async main(e){super.main(e);const t=s.jC.idleProgress("Important","Generating troll juice...");await(0,o.Dc)(2e3),i.O.create({title:"Error",icon:"error",body:"Failed to generate troll juice.<br><br>This might be an issue with your computer.",buttons:[{id:"ok",text:"OK",action:e=>{e.dlg.close(),t.closeDialog()}}]})}}},612:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TutorialApplication:()=>l});var s=n(9338),i=n(8423),o=n(8223),r=n(5516),a=n(4186);class l extends a.WApplication{constructor(){super()}async main(e){super.main(e),r.x.wmem._htermOpen?s.jC.error("HTerm","Only one instance may be ran!","OK"):(r.x.wmem._htermOpen=!0,await o.a.loadStyleAsync("/system/resource/app/tutorial/main.css"),await this._createUI())}async _createUI(){i.e.setVisibility(!1),this.mainwnd=this.createWindow({windowClass:"tutorial-wnd",bodyClass:"tutorial-app",controlBoxStyle:"WS_CBX_NONE",body:await o.a.loadTextAsync("/system/resource/app/tutorial/ui.html"),resizable:!1,draggable:!1},!0),this.mainwnd.show()}ontermination(){i.e.setVisibility(!0)}}},1969:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Win96ChatApplication:()=>u});var s=n(4186),i=(n(7366),n(4420)),o=n(6999),r=n(9338),a=n(5784),l=n(9182),c=n(8041),d=n(5516);const p="c:/user/appdata/MsgRoom/themes";class u extends s.WApplication{constructor(){super()}async main(e){if(super.main(e),this.config={currentTheme:null,disableWin96Detection:!1},a.FS.exists("C:/user/appdata/MsgRoom")||a.FS.mkdir("C:/user/appdata/MsgRoom"),a.FS.exists("C:/user/appdata/MsgRoom/config.json")||await a.FS.writestr("C:/user/appdata/MsgRoom/config.json",JSON.stringify(this.config,null,4)),this.config={...this.config,...JSON.parse(await a.FS.readstr("C:/user/appdata/MsgRoom/config.json"))},!a.FS.exists("C:/user/appdata/MsgRoom/themes")){a.FS.mkdir("C:/user/appdata/MsgRoom/themes");const e=r.jC.idleProgress("MsgRoom","Loading default themes...");try{await(0,l.N)("/system/data/msgroom/themes_default.zip")}catch(e){c.O.create({icon:"warning",body:"Error fetching default themes!<br><br>Please check your internet connection or contact the developers."})}e.closeDialog()}this._createWindow(e)}async applyTheme(e){const t=p+"/"+e+".css";if(!a.FS.exists(t))return void c.O.create({icon:"warning",body:"Theme does not exist."});const n=await a.FS.readstr(t);this.appFrame.contentWindow.postMessage({op:"wui-css-set",css:n},this.CHAT_URL),this.config.currentTheme!=e&&(this.config.currentTheme=e,await a.FS.writestr("C:/user/appdata/MsgRoom/config.json",JSON.stringify(this.config,null,4)))}readThemesMenu(){const e=[];return a.FS.readdir(p).forEach((t=>{if(!t.endsWith(".css"))return;const n=a.FSUtil.fname(t),s=n.substring(0,n.length-4);e.push({type:"normal",label:s,onclick:()=>this.applyTheme(s)})})),[...e,{type:"separator"},{type:"normal",label:"Open themes directory",onclick:()=>{d.x.execCmd("explorer",[p])}}]}_createWindow(e){let t="https://devel.windows96.net:4096/";e.includes("--devel-local")?t="http://127.0.0.1:4096/":e.includes("--devel-local")&&(t="https://devel.windows96.net:4096/"),e.forEach(((e,n,s)=>{"--server"!=e||n+1>=s.length||(t=s[n+1])})),this.CHAT_URL=t;const n=this.createWindow({title:"MsgRoom",initialWidth:640,initialHeight:441,taskbar:!0,body:`<div class="appbar"></div><iframe src="${t}"></iframe>`,bodyClass:"win96chat-app",icon:i.Q.getIconUrl("small/apps/chat"),iframeFix:!0},!0),s=n.getBodyContainer(),a=s.querySelector("iframe"),l=new o.j;l.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>this.mainwnd.close()}]),l.addRoot("Session",[{type:"submenu",label:"Themes",removeIconPrespace:!0,items:this.readThemesMenu()},{type:"normal",label:"Change Nick",onclick:()=>r.jC.prompt("Set Nickname","Enter a new nickname","anonymoose",(e=>{null!=e&&""!=e.trim()&&a.contentWindow.postMessage({op:"wui-nick-change",args:{value:e}},t)}))}]),l.addRoot("Help",[{type:"normal",label:"View Help",onclick:()=>{a.contentWindow.postMessage({op:"wui-print-help",args:{}},t)}},{type:"separator"},{type:"normal",label:"About",onclick:()=>{const e=this.createWindow({title:"About MsgRoom",controlBoxStyle:"WS_CBX_CLOSE",initialHeight:165,initialWidth:276,taskbar:!1,bodyClass:"msgroom-about-dlg",body:'<div class="icon"></div>\n                        <div class="p2">\n                            <div class="title">MsgRoom</div>\n                            <div class="subtext">Social messaging chatroom<br>\n                            Version 1.0<br>\n                            <br>\n                            Copyright (C) windows96.net 2021.\n                            </div>\n                            <div class="buttons">\n                                <button class="w96-button close">OK</button>\n                            </div>\n                        </div>',center:!0,resizable:!1},!1);e.show(),e.getBodyContainer().querySelector(".close").addEventListener("click",(()=>e.close()))}}]),s.querySelector(".appbar").replaceWith(l.getMenuDiv()),a.onload=()=>{this.config.currentTheme&&this.applyTheme(this.config.currentTheme),a.contentWindow.postMessage({op:"w96-app-init",args:{pid:this.appId,disableWin96Detection:this.config.disableWin96Detection}},t)},this.appFrame=a,this.mainwnd=n,n.show()}}},112:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WPA_Application:()=>r});var s=n(9338),i=n(7362);const{WApplication:o}=n(4186);class r extends o{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){window.notGenuine?s.jC.error("License Expired","Your Windows license is expired, please purchase a new license from our store.","OK").setSize(350,110).dlg.center():s.jC.confirm("For the low low price of FREE, you can activate Windows 96 today!\n\nWant to proceed?",(e=>{if(e){this.terminate(),s.jC.error("Activation Error","This copy of Windows is not genuine.","OK"),document.querySelector(".user-desktop").style.background="black";const t=document.createElement("div");t.classList.add("troll-not-genuine"),t.innerHTML='<span class="left">This copy of Windows is not genuine</span>\n                <span class="right">This copy of Windows is not genuine</span>\n                <span class="bleft">This copy of Windows is not genuine</span>\n                <span class="bright">This copy of Windows is not genuine</span>',document.body.appendChild(t);const n=document.createElement("div");n.innerText="This copy of Windows is not genuine",n.classList.add("troll-not-genuine");let o=1,r=1;function a(){const e=n.getBoundingClientRect();n.style.top=`${e.top+r}px`,n.style.left=`${e.top+o}px`,e.y>window.innerHeight?r=-1:r<0&&(r=1),e.x>window.innerWidth?o=-1:o<0&&(o=1),requestAnimationFrame(a)}a(),document.body.appendChild(n),(0,i.N9)("explorer"),(0,i.N9)("textpad"),(0,i.N9)("dyk"),(0,i.VG)("explorer",[],(e=>{s.jC.error("Error","This app is disabled because you didn't register your copy.","Damn")})),(0,i.VG)("textpad",[],(e=>{s.jC.error("Error","This app is disabled because you didn't register your copy.","Damn")})),(0,i.VG)("dyk",[],(e=>{s.jC.info("Pro Tip","You can end this hell of unregistered windows if you restart via start menu.",":O")})),document.body.oncontextmenu=e=>{e.preventDefault(),s.jC.error("Error","Please register your copy of Windows to continue using Windows 96 uninterrupted.","Damn").dlg.setPosition(e.x,e.y)};const l=document.createElement("style");l.innerText=".w96_sm_logo .container .text::after {\n                    content: 'Windows 96 (UNREGISTERED)';\n                }\n                \n                .shell-icon .icon-image {\n                    background: url(system/resource/themes/default/icons/error.png) !important;\n                }",document.body.appendChild(l),setTimeout((()=>{s.jC.error("Error","Color display is only available for genuine Windows 96.",":("),document.body.style.filter="grayscale(1)"}),2e3),setInterval((()=>{s.jC.error("Error","Failed to load DLL - You didn't register your copy of Windows.","Damn").dlg.randomizePosition()}),1e4),window.notGenuine=!0}}))}}},9704:(e,t,n)=>{"use strict";n.r(t),n.d(t,{YouAreApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Trojan.JS.YouAreAnIdiot",e.initialWidth=640,e.initialHeight=500;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<video style="height: 100%; width: 100%;" autoplay loop><source src="/system/apps/youare/vid.mp4" type="video/mp4"></video>');t.wndObject.querySelector(".window-html-content").classList.add("gameing-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/youare")),this.mainwnd=t,t.show()}}},1729:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GLTestApplication:()=>r});var s=n(4186),i=n(7366),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="OpenGL Test Window",e.initialWidth=540,e.initialHeight=361;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('</div><iframe src="/system/apps/gltest"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("if-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/gltest"));const n=t.wndObject.querySelector("iframe");t.ondarkenelements=()=>{n.style.pointerEvents="none"},t.onlightenelements=()=>{n.style.pointerEvents=""},this.appFrame=n,this.mainwnd=t,t.show()}}},1984:(e,t,n)=>{"use strict";n.d(t,{X:()=>a});var s=n(4420),i=n(5784);const o={pony:"apps/poney.gif"},r="/system/resource/icons/3rdparty/w93-v2";const a={exec:async function(e){const t=await i.FS.readstr(e),n=JSON.parse(t);n.exe&&window.open("https://www.windows93.net/#!"+encodeURIComponent(n.exe))},getIconURL:async function(e){const t=await i.FS.readstr(e),n=JSON.parse(t);return n.icon?r+"/"+n.icon:o[n.exe]?r+"/"+o[n.exe]:s.Q.getIconUrl("lnk42")}}},7883:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VMApplication:()=>a});var s=n(4186),i=n(7366),o=n(4420);const r=[{label:"Version 1.0",thumb:"/system/resource/app/vm/screenshots/v1.png",url:"https://rel1.windows96.net/"},{label:"Version 0.5",thumb:"/system/resource/app/vm/screenshots/v05.png",url:"https://rel05.windows96.net/"},{label:"Version 0.4",thumb:"/system/resource/app/vm/screenshots/v04.png",url:"https://rel04.windows96.net/"},{label:"Version 0.3",thumb:"/system/resource/app/vm/screenshots/v03.png",url:"https://rel03.windows96.net/"},{label:"Version 0.2",thumb:"/system/resource/app/vm/screenshots/v02.png",url:"https://rel02.windows96.net/"},{label:"Version 0.1",thumb:"/system/resource/app/vm/screenshots/v01.png",url:"https://rel01.windows96.net/"}];class a extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){var e=new i.Lw;e.title="Virtual Machine",e.initialWidth=540,e.initialHeight=361,e.resizable=!0;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<div class="main">\n            <p style="margin-top: 0;">\n                <span class="bold-noaa">Official Releases</span>\n            </p>\n        </div>');const n=t.wndObject.querySelector(".window-html-content");n.classList.add("vm-app"),t.setWindowIcon(o.Q.getIconUrl("small/apps/vm"));const s=n.querySelector(".main");for(let e of r){const t=document.createElement("button");t.classList.add("w96-button","vm");const n=document.createElement("img");n.src=e.thumb,t.appendChild(n),t.appendChild(document.createElement("br")),t.appendChild(new Text(e.label)),t.addEventListener("click",(()=>{const t=new i.Lw;t.initialHeight=380,t.initialWidth=540,t.title="["+e.label+"] - VM",t.resizable=!0;const n=this.createWindow(t,!1);n.registerWindow(),n.registerAppBar(),n.setWindowIcon(o.Q.getIconUrl("small/apps/vm"));const s=n.getBodyContainer();s.classList.add("subvm-app");const r=document.createElement("iframe");r.src=e.url,s.appendChild(r),n.ondarkenelements=()=>{r.style.pointerEvents="none"},n.onlightenelements=()=>{r.style.pointerEvents=""},n.show()})),s.appendChild(t)}this.mainwnd=t,t.show()}}},3356:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Wiki96Application:()=>r});var s=n(4186),i=(n(5784),n(7366)),o=n(4420);class r extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}async _createWindow(){var e=new i.Lw;e.title="Wiki96",e.initialWidth=800,e.initialHeight=600;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setHtml('<iframe src="/system/apps/wiki96"></iframe>');t.wndObject.querySelector(".window-html-content").classList.add("wiki96-app"),t.setWindowIcon(o.Q.getIconUrl("small/help-book"));const n=t.wndObject.querySelector("iframe");n.onload=()=>{n.contentWindow.winit(t)},this.mainwnd=t,t.show()}}},6552:(e,t,n)=>{"use strict";n.d(t,{f:()=>c});var s=n(4420),i=n(7366),o=n(254),r=n(5784),a=n(5516),l=n(4186);class c extends l.WApplication{constructor(){super()}async main(e){super.main(e),a.x.wmem.mobStart=this;const t=new i.Lw;t.resizable=!1,t.draggable=!1,t.initialHeight=100,t.initialWidth=100,t.initialX=0,t.initialY=0,t.title="Programs",this.wnd=this.createWindow(t,!0),this.wnd.registerWindow(),this.wnd.setControlBoxStyle("WS_CBX_CLOSE");const n=this.wnd.getBodyContainer();n.classList.add("app-mbprograms"),n.innerHTML='\n            <div class="title">Programs</div>\n            <div class="icons"></div>\n            <div class="title">Utilities</div>\n            <div class="icons-aux"></div>\n        ',r.FS.exists("c:/system/etc/mobsupport/programs")||await r.FS.mkdir("c:/system/etc/mobsupport/programs"),await this.populateView("c:/system/programs"),await this.populateView("c:/system/etc/mobsupport/programs",!1,".icons-aux"),this.wnd.show(),this.wnd.toggleMaximize()}async populateView(e,t=!0,n=".icons"){const i=this.wnd.getBodyContainer().querySelector(n);for(;i.firstChild&&t;)i.removeChild(i.firstChild);for(let t of r.FS.walk(e)){if(!r.FS.isFile(t)||!t.endsWith(".link"))continue;const e=document.createElement("div");e.classList.add("item");const n=document.createElement("button");n.classList.add("w96-button"),n.style.backgroundImage=`url(${s.Q.getFileIconUrl(t)})`,n.addEventListener("click",(()=>o.l.execFile(t))),e.appendChild(n);const a=document.createElement("div");a.classList.add("text");let l=r.FSUtil.fname(t);a.innerText=l.substring(0,l.lastIndexOf(".")),e.appendChild(a);try{const o=await r.FS.readstr(t),a=JSON.parse(o);if(a.icon){let e=s.Q.getIconUrl(a.icon);(a.icon.startsWith("http:")||a.icon.startsWith("https:")||a.icon.startsWith("data:"))&&(e=a.icon),n.style.backgroundImage=`url(${e})`}i.appendChild(e)}catch(e){console.warn(e)}}}}},386:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AboutUIApplication:()=>u});var s=n(4186),i=n(7366),o=n(4247),r=n(254),a=n(5784),l=(n(3978),n(9338)),c=n(7362),d=n(9703),p={main:`<div style="overflow: auto;display: flex;flex-direction:column;width: 100%;height:100%;box-sizing: border-box;padding: 15px;overflow:hidden">\n    <div class="aboutbox-logo"></div>\n    <hr style="width: 100%;">\n    <div class="aboutbox-description-text">\n        MIKESOFT Windows 96 <br>\n        Version <span class="winver"></span> (${o.d.getReleaseChannel()})<br>\n        Copyright (C) Windows 96 Team 2021.<br><br>\n        <div class="registration">\n            Registered to:<br>\n            <span class="username">user name</span><br>\n            <span class="domain-wrap"><span class="domain">user domain</span><br></span>\n            <span class="license">license type</span><br><br>\n        </div>\n        <div class="buttons-etc" style="display: inline"><button style="min-width: 115px;" role="software-credits" class="w96-button">OSS Licenses</button> <button style="min-width: 114px;" role="credits" class="w96-button">Credits</button> <button style="min-width: 114px;" role="support" class="w96-button">Support Us</button><br><br></div>\n        Windows 95 &amp; 98 icons (C) Microsoft Corporation.<br>\n        Windows(tm) is a registered trademark of Microsoft Corporation.<br>\n        Other trademarks and logos are property of their respective owners.<br><br><br>\n        If we forgot about you, we are sorry, please send us an <a href="mailto:ctm@windows96.net">email</a>\n    </div>\n    <div style="height:100%;flex:1;" class="aboutbox-button-grp">\n        <button class="w96-button" onclick="this.parentElement.parentElement.parentElement.parentElement.parentElement.associatedWindow.close()" style="top: calc(100% - 15px);position: relative;float: right;">OK</button>\n    </div>\n</div>`};class u extends s.WApplication{constructor(){super()}async main(e){super.main(e);let t=await(0,d._M)(),n=new i.Lw;n.resizable=!1,n.title="About WINDOWS 96",n.initialWidth=500,n.initialHeight=420,n.mobResize=!0;let s=this.createWindow(n,!0);s.registerWindow(),s.setControlBoxStyle(i.KZ.WS_CBX_CLOSE),s.setHtml(p.main);let u=s.wndObject;t?(u.querySelector(".username").textContent=t.data.owner,t.data.domain?u.querySelector(".domain").textContent=t.data.domain+".vip":u.querySelector(".domain-wrap").remove(),u.querySelector(".license").textContent=`${t.data.type[0].toUpperCase()}${t.data.type.slice(1)} License`):u.querySelector(".registration").remove(),u.querySelector('button[role="software-credits"]').onclick=()=>{a.FS.exists("c:/system/credits.txt")?r.l.execFile("c:/system/credits.txt"):l.jC.error("Error","Cannot display credits - c:/system/credits.txt is missing.","OK")},u.querySelector('button[role="credits"]').onclick=()=>{(0,c.lw)("credits",[])},u.querySelector('button[role="support"]').onclick=e=>{e.shiftKey?(0,c.lw)("keymgr",[]):(0,c.lw)("__support-us",[])},({}.credits||{}.__support_us)&&u.querySelector(".buttons-etc").remove(),u.querySelector(".winver").innerText=o.d.getVersionString(),s.show(),s.center()}}},9690:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CreditsUIApplication:()=>r});var s=n(4186),i=n(7366);const o=[{avatar:"url(https://cdn.windows96.net/credits/woozer.gif)",name:"ctrlz",position:"PROJECT CREATOR + LEAD DEVELOPER",background:"linear-gradient(-45deg, #ff5b5b, #13689a)",socials:[{type:"twitter",url:"https://twitter.com/ctrlz40961"}]},{avatar:"url(https://cdn.ziad87.net/s2.gif)",name:"ziad87",position:"LEAD DEVELOPER",background:"linear-gradient(-45deg, #0a0, #00a)",socials:[{type:"github",url:"https://github.com/ziad8727"},{type:"reddit",url:"https://www.reddit.com/user/ziad8712"}]},{avatar:"url(https://cdn.windows96.net/credits/h.gif)",name:"utf-4096",position:"DEVELOPPER & REAL NOOB",background:"url(https://cdn.windows96.net/credits/utf_bg.png), #005",backgroundSize:"cover",socials:[{type:"gitlab",url:"https://gitlab.com/utf-4096"},{type:"twitter",url:"https://twitter.com/WFzmOaLgRrYUH3g"}]}];class r extends s.WApplication{constructor(){super()}main(e){super.main(e);const t=new i.Lw;t.resizable=!1,t.title="WINDOWS 96 CREDITS",t.initialWidth=500,t.initialHeight=420,t.mobResize=!0;const n=this.createWindow(t,!0);n.registerWindow(),n.setControlBoxStyle(i.KZ.WS_CBX_CLOSE),n.setHtml('\n            <div class="bg">\n                <div class="avatar"></div>\n                <div class="name"></div>\n                <div class="position"></div>\n                <div class="socials">\n                    \n                </div>\n                <div class="buttons">\n                    <button class="previous">Previous</button>\n                    <button class="next">Next</button>\n                </div>\n            </div>\n        ');const s=n.getBodyContainer();s.classList.add("credits-ui"),n.show(),n.center(),this.mainwnd=n,this.currentIndex=0;const o=s.querySelector(".previous"),r=s.querySelector(".next");o.addEventListener("click",(()=>{this.showProfile(--this.currentIndex)})),r.addEventListener("click",(()=>{this.showProfile(++this.currentIndex)})),this.showProfile()}showProfile(e=0){const t=this.mainwnd.getBodyContainer(),n=t.querySelector(".socials"),s=t.querySelector(".previous"),i=t.querySelector(".next");s.style.display="",i.style.display="",n.innerHTML="",t.querySelector(".avatar").style.backgroundImage=o[e].avatar,t.querySelector(".bg").style.background=o[e].background,t.querySelector(".bg").style.backgroundSize=o[e].backgroundSize,t.querySelector(".name").innerText=o[e].name,t.querySelector(".position").innerText=o[e].position;for(let t of o[e].socials){const e=document.createElement("a");e.classList.add(t.type),e.href=t.url,n.appendChild(e)}e<1&&(s.style.display="none"),e+1>=o.length&&(i.style.display="none")}}},6355:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DonationUIApplication:()=>l});var s=n(4420),i=n(5544),o=n(7366),r=n(4186);const a={btc:{title:"Bitcoin",address:"bc1qscpuz64p38lt30yngpdq3x9felrsgr6kuyh350",qr:"/system/resource/app/support/crypto-qr/btc.png"},eth:{title:"Ethereum",address:"0x3304D1f06E078DD7da99B2df7c2FE6044b071f42",qr:"/system/resource/app/support/crypto-qr/eth.png"},ltc:{title:"Litecoin",address:"ltc1qz0ymkdrvmp7quapptmungxa0hwfnxr9zq578cg",qr:"/system/resource/app/support/crypto-qr/ltc.png"},doge:{title:"Dogecoin",address:"DPbAeBA3uLyKqmWeRitgcukFFryUvcNbbq",qr:"/system/resource/app/support/crypto-qr/doge.png"},dgb:{title:"DigiByte",address:"dgb1qhz9sp9hxgp8hplfsttq4hxgp9scejmpna40zav",qr:"/system/resource/app/support/crypto-qr/dgb.png"}};class l extends r.WApplication{constructor(){super()}main(e){const t=new o.Lw;t.resizable=!1,t.title="Support Us",t.initialWidth=502,t.initialHeight=420,t.mobResize=!0;const n=this.createWindow(t,!0);n.registerWindow(),n.setWindowIcon(s.Q.getIconUrl("small/misc/coin")),n.setControlBoxStyle(o.KZ.WS_CBX_CLOSE),n.setHtml("\n            \n        ");const r=new i.a,a=r.addPage("Donate",(e=>{e.innerHTML='<div class="container">\n                <div class="w96-panel p1">\n                Windows 96 is an artistic and technological web project being developed by a pair of programmers and artists.<br><br>\n                We really want to keep everything free for you to use, forever. But to keep all of this running, there is a cost involved. If you like what you see and you want to support us, we have some donation methods listed below. Even something as small as 1 EUR is appreciated!<br><br>\n                In return, you will get a special role on our Discord server and your name displayed in the supporters tab of this page. Fiat payments (Patreon) will have more rewards because we did not find a subscription system suiting our needs for crypto yet, sorry about that :(<br><br>\n                When your payment is complete, send us a proof of purchase on Discord and we will give you the rewards (crypto only).\n                </div>\n                <div class="e"></div>\n            </div>';const t=new i.a;t.openPage(t.addPage("Crypto (BTC, etc.)",(e=>{e.innerHTML='<div class="currency btc">\n    <button class="w96-button"></button>\n    <div class="title">Bitcoin</div>\n</div>\n<div class="currency eth">\n    <button class="w96-button"></button>\n    <div class="title">Ethereum</div>\n</div>\n<div class="currency ltc">\n    <button class="w96-button"></button>\n    <div class="title">Litecoin</div>\n</div>\n<div class="currency doge">\n    <button class="w96-button"></button>\n    <div class="title">Dogecoin</div>\n</div>\n<div class="currency dgb">\n    <button class="w96-button"></button>\n    <div class="title">DigiByte</div>\n</div>',e.querySelector(".currency.btc").onclick=()=>this.showCryptoInfo("btc"),e.querySelector(".currency.eth").onclick=()=>this.showCryptoInfo("eth"),e.querySelector(".currency.ltc").onclick=()=>this.showCryptoInfo("ltc"),e.querySelector(".currency.doge").onclick=()=>this.showCryptoInfo("doge"),e.querySelector(".currency.dgb").onclick=()=>this.showCryptoInfo("dgb"),e.classList.add("cryptos")}))),t.addPage("Fiat (PayPal, etc.)",(e=>{e.innerHTML='<span class="bold-noaa">Patreon: </span><a href="https://www.patreon.com/win96" target="_blank">https://www.patreon.com/win96</a>'}));const n=t.getElement();n.classList.add("p2"),e.querySelector(".e").replaceWith(n)}));r.addPage("Supporters",(e=>{e.innerHTML='<iframe src="https://etc.windows96.net/supporters/supporters.html" target="_blank"></iframe>';e.querySelector("iframe").onload=()=>{}}));const l=n.getBodyContainer();l.classList.add("support-us-ui"),l.appendChild(r.getElement()),n.show(),n.center(),r.openPage(a)}showCryptoInfo(e){const t=a[e];if(null==t)return;const n=new o.Lw;n.title="Send "+t.title,n.resizable=!1,n.initialHeight=390,n.initialWidth=290;const s=this.createWindow(n,!1);s.registerWindow(),s.setControlBoxStyle(o.KZ.WS_CBX_CLOSE);const i=s.getBodyContainer();i.classList.add("crypto-info-dlg"),i.innerHTML=`<div class="qr" style="background-image: url(${t.qr})"></div><div class="address">${t.address}</div>`,s.show(),s.center()}}},5545:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CtrlApplication:()=>S});var s=n(8041),i=n(4420),o=n(6999),r=n(5516),a=n(4186),l=n(2589),c=n(5544),d=n(5784);class p extends a.WApplication{constructor(){super()}async main(e){if(super.main(e),document.querySelector(".stormgr-applet"))return;const t=this.createWindow({taskbar:!1,icon:i.Q.getIconUrl("small/apps/stormgr"),center:!0,bodyClass:"stormgr-applet",initialWidth:370,initialHeight:443,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",title:"Storage Manager",body:'<div class="tabc"></div>\n            <div class="buttons">\n                <button class="w96-button apply" disabled>Apply</button>\n                <button class="w96-button cancel">Cancel</button>\n                <button class="w96-button ok">OK</button>\n            </div>'},!0),n=t.getBodyContainer();n.classList.add("applet-base");const s=new c.a;s.openPage(s.addPage("Usage",(async e=>{e.style.padding="10px",e.style.boxSizing="border-box",e.innerHTML=`<div class="icon-box">\n                <div class="icon stormgr" style="background-image: url(${i.Q.getIconUrl("apps/stormgr")});"></div>\n                <div class="text">\n                    Your installation uses disk space to store data. Please note that the size figures below are estimated from all mounted file systems combined. \n                </div>\n            </div>\n            <div class="groupbox"></div>\n            <hr>\n            <div class="icon-box">\n                <div class="icon reinstall" style="background-image: url(${i.Q.getIconUrl("apps/reinstall")});"></div>\n                <div class="text">\n                    If you wish to clear all data within your installation, you can reinstall your copy of Windows 96.\n                    <br><br>\n                    <span class="bold-noaa">WARNING: </span>All of your data will be removed and will not be recoverable!    \n                </div>\n            </div>\n            <div class="info">\n                To reinstall your copy of Windows 96, click the button below.<br>\n                <br><button class="w96-button reinstall">Reinstall</button>\n            </div>`;const t=await async function(){try{return await navigator.storage.estimate()}catch(e){return{quota:-1,usage:0}}}(),n=new l.E({body:`<span><span class="bold-noaa">Main Storage Backend: </span> ${d.FS.get("c:").driverName}</span><br>\n                <span><span class="bold-noaa">Cumulative Used: </span> ${(t.usage/1024/1024).toFixed(0)} MB</span><br>\n                <span><span class="bold-noaa">Cumulative Free Space: </span> ${((t.quota-t.usage)/1024/1024).toFixed(0)} MB</span><br>\n                <span><span class="bold-noaa">Disks Mounted: </span> ${d.FS.list().length}</span>`,title:"Statistics"});e.querySelector(".groupbox").replaceWith(n.getElement())}))),n.querySelector(".tabc").replaceWith(s.getElement()),n.querySelector("button.cancel").addEventListener("click",(()=>t.close())),n.querySelector("button.ok").addEventListener("click",(()=>t.close())),n.querySelector("button.reinstall").addEventListener("click",(()=>r.x.execCmd("reinstall"))),t.show()}}var u=n(9338),h=n(8362);class m extends a.WApplication{constructor(){super()}async main(e){if(super.main(e),document.querySelector(".uam-applet"))return;const t=JSON.parse(d.FS.exists("c:/system/config/SAM.json")?await d.FS.readstr("c:/system/config/SAM.json"):JSON.stringify({name:"user",pwd:null})),n=this.createWindow({taskbar:!1,icon:i.Q.getIconUrl("small/apps/uam"),center:!0,bodyClass:"uam-applet",initialWidth:280,initialHeight:180,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",title:"User Account Security",body:`\n            <div>\n                If you wish to prevent others from logging into your installation, you can enter a password below.\n                <br>\n                <br>\n            </div>\n            <div>\n                <span>Current status: ${null==t.pwd?'<span class="status fail">Not secure</span></span>':'<span class="status success">Password protected</span></span>'}\n            </div>\n            <div class="pwd-input">\n                <div>Password:</div>\n                <input class="w96-textbox passwd" type="password">\n            </div>\n            <div class="buttons">\n                <button class="w96-button remove-pwd" disabled>Remove Pwd...</button>\n                <button class="w96-button apply">Apply</button>\n                <button class="w96-button cancel">Cancel</button>\n            </div>`},!0),s=n.getBodyContainer(),o=s.querySelector(".status");s.querySelector("button.cancel").addEventListener("click",(()=>n.close()));const r=s.querySelector("button.remove-pwd");r.addEventListener("click",(()=>{d.FS.exists("c:/system/config/SAM.json")&&d.FS.rm("c:/system/config/SAM.json"),u.jC.info("Security","Your logon password was removed.","OK"),r.disabled=!0,o.className="status fail",o.innerText="Not secure"})),null!=t.pwd&&(r.disabled=!1);s.querySelector("button.apply").addEventListener("click",(async()=>{const e=s.querySelector(".passwd");""!=e.value.trim()&&(await d.FS.writestr("c:/system/config/SAM.json",JSON.stringify({name:"user",pwd:(0,h.P)(e.value)})),u.jC.info("Security","Your logon password has now been set.","OK"),o.className="status success",o.innerText="Password protected",s.querySelector("button.remove-pwd").disabled=!1)})),s.querySelector("input").focus(),n.show()}}var _=n(9182);class w extends a.WApplication{constructor(){super()}async main(e){if(super.main(e),document.querySelector(".devcfg-applet"))return;const t=[{title:"iOS",icon:i.Q.getIconUrl("objects/iphone"),sourceUrl:"/system/images/mobsupport-ios.zip",devId:"ios"},{title:"Android",icon:i.Q.getIconUrl("objects/android"),sourceUrl:"/system/images/mobsupport-generic.zip",devId:"android"},{title:"PC/Other",icon:i.Q.getIconUrl("objects/computer"),sourceUrl:null,devId:null}],n=this.createWindow({taskbar:!1,icon:i.Q.getIconUrl("small/apps/devcfg"),center:!0,bodyClass:"devcfg-applet",initialWidth:320,initialHeight:340,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",title:"Device Configuration",body:'<div class="info" style="margin-bottom: 3em;">Below you can choose a device profile to match the configuration of your device.<br><br>This may improve item navigation, useability, and UI sizing.</div>\n            <div class="groupbox"></div>\n            <br>\n            <div class="info" style="margin-bottom: 2em;">\n                PC/Other is the default profile used for Windows 96. If your device type is not listed here, your experience may suffer.\n            </div>\n            <br>\n            <div class="buttons" style="margin-top: 1em;">\n                <button class="w96-button ok">OK</button>\n            </div>'},!0),o=n.getBodyContainer(),r=new l.E({body:"",title:"Device Profiles"}).getElement();for(let e of t){const t=document.createElement("button");t.className="w96-button dp",t.style.backgroundImage=`url(${e.icon})`,t.innerText=e.title,t.addEventListener("click",(()=>{u.jC.confirm("Load this profile? Unsaved changes in your session will be lost!",(async t=>{if(t){try{if(d.FS.exists("c:/system/etc/devprofiles/current.json")&&await d.FS.rm("c:/system/etc/devprofiles/current.json"),!e.devId)return localStorage.removeItem("mobile-mode"),localStorage.removeItem("mobile-mode-devtype"),void document.location.reload();let t=u.jC.idleProgress("DevCfg","Loading additional data...");await(0,_.N)(e.sourceUrl),t.closeDialog(),localStorage["mobile-mode"]="true",localStorage["mobile-mode-devtype"]=e.devId,document.location.reload()}catch(e){s.O.create({body:"An error occured whilst applying the profile.",icon:"error",title:"Profile Error"})}n.close()}}))})),r.appendChild(t)}o.querySelector(".groupbox").replaceWith(r),o.querySelector("button.ok").addEventListener("click",(()=>n.close())),n.show()}}var y=n(2110),b=n(4779),g=n(6167),f=n(6841);function v(e){var t=e.split("*/")[0].substring(3).split("\n").map((e=>{let t=e.substring(3).split(" ");return{property:t.shift().substring(1),val:t.join(" ")}}));t.pop();let n={};for(var s of t)s.val.startsWith('"')&&s.val.endsWith('"')&&(s.val=s.val.substring(1,s.val.length-1)),n[s.property]=s.val;return n}class E extends a.WApplication{constructor(){super(),this._blobs=[],this.cachedWp={},this.themes=[],this.applyStatus={wallpaper:null,wallpaperType:null,theme:null}}getWallpapers(){return d.FS.readdir("c:/system/wallpapers").filter((e=>d.FS.isFile(e)))}async main(e){if(super.main(e),document.querySelector(".laf-applet"))return;const t=this.createWindow({taskbar:!1,icon:i.Q.getIconUrl("small/apps/laf"),center:!0,bodyClass:"laf-applet",initialWidth:404,initialHeight:455,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",title:"Display Properties",body:'<div class="tabc"></div>\n            <div class="buttons">\n                <button class="w96-button apply" disabled>Apply</button>\n                <button class="w96-button cancel">Cancel</button>\n                <button class="w96-button ok">OK</button>\n            </div>'},!0),n=t.getBodyContainer();n.classList.add("applet-base");const s=new c.a;s.openPage(s.addPage("Theme",(async e=>{e.style.padding="10px",e.style.boxSizing="border-box",e.classList.add("th"),e.innerHTML='<div class="info" style="margin-bottom: 2em;">\n                A theme is a set of icons, visual styles, and sounds to alter the core experience of the user interface.\n            </div>\n            <div style="margin-bottom: 1em;">Selected Theme:</div>\n            <select class="w96-textbox">\n                <option value="current">Current</option>\n            </select>\n            <div style="margin-bottom: 1em;margin-top: 1em;">Sample:</div>\n            <div class="theme-preview">\n\n            </div>';let t=[],s=await d.FS.readdir("W:/system/resource/themes").map((e=>e.substring(26))).filter((e=>".meta"!=e));for(var i of s)t.push({id:i,file:await d.FS.readstr(`W:/system/resource/themes/${i}/theme.js`)});t=t.map((e=>Object.assign({data:v(e.file)},e))),t=[t.find((e=>"default"==e.id))].concat(t.filter((e=>"default"!=e.id)));let o=[...new Set(t.map((e=>e.id)))];t=o.map((e=>t.find((t=>t.id==e))));const r=e.querySelector("select"),a=e.querySelector(".theme-preview");for(var i of t){const e=document.createElement("option");e.value=i.id,e.innerText=i.data["theme-name"],r.appendChild(e)}let l=e=>{if("current"!==e){const s=t.find((t=>t.id==e));a.style.backgroundImage=`url(/system/resource/themes/${s.id}/theme.png)`,this.applyStatus.theme=e,n.querySelector("button.apply").disabled=!1}else this.applyStatus.theme=null},c=null!=this.applyStatus.theme?this.applyStatus.theme:"current";l(c),r.value=c,r.onchange=e=>{l(e.target.value)},0==this.themes.length&&(this.themes=t)}))),s.addPage("Wallpaper",(async e=>{e.style.padding="10px",e.style.boxSizing="border-box",e.classList.add("wp"),e.innerHTML='<div class="wp-box">\n                <div class="preview"></div>\n            </div>\n            <div>Background:</div>\n            <div class="aside">\n                <div class="lbox"></div>\n                <div class="actions">\n                    <button class="w96-button browse">Browse</button>\n                    \n                    <div>Color:</div>\n                    <button style="margin: 0; padding-right: 3px; padding-left: 3px; width: 100%;" class="w96-button choosecolor">\n                        <div style="background: #000000; width: 100%; height: 15px;"></div>\n                    </button>\n                </div>\n            </div>';const t=new b.w,s=e.querySelector(".preview"),o=e.querySelector(".choosecolor");this.applyStatus.wallpaper&&("FS"==this.applyStatus.wallpaperType?s.style.backgroundImage=`url(${this.applyStatus.wallpaperBlob})`:"css"==this.applyStatus.wallpaperType&&(s.style.background=`${this.applyStatus.wallpaper}`));for(let e of this.getWallpapers()){const n=t.addItem(d.FSUtil.fname(e),e),s=document.createElement("div");s.classList.add("icon"),s.style.backgroundImage=`url(${i.Q.getFileIconUrl(e,"small")})`,n.prepend(s),n.addEventListener("click",(async()=>{this.setWp(e)}))}o.addEventListener("click",(()=>{let e=document.createElement("input");e.type="color",e.style.opacity="0%";let t=o.getBoundingClientRect();e.style.display="inline-block",e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px",document.body.appendChild(e),setTimeout((()=>{e.click(),setTimeout((()=>{e.style.left="-100px",e.style.top="-100px"}),100)}),100),e.onchange=()=>{document.body.removeChild(e),this.applyStatus.wallpaperBlob=null,this.applyStatus.wallpaper=e.value,this.applyStatus.wallpaperType="css",o.querySelector("div").style.background=e.value,s.style.backgroundColor=e.value,s.style.backgroundImage="",n.querySelector("button.apply").disabled=!1}})),e.querySelector(".lbox").replaceWith(t.getElement()),e.querySelector("button.browse").addEventListener("click",(()=>{new u.MT("c:/system/wallpapers",[".jpg",".JPG",".png",".PNG",".gif",".GIF",".webp",".WEBP"],(e=>{e&&this.setWp(e)})).show()}))})),n.querySelector(".tabc").replaceWith(s.getElement()),n.querySelector("button.cancel").addEventListener("click",(()=>t.close())),n.querySelector("button.ok").addEventListener("click",(async()=>{n.querySelector("button.ok").disabled=!0,n.querySelector("button.apply").disabled=!0,n.querySelector("button.cancel").disabled=!0,await this.applySettings(),t.close()})),n.querySelector("button.apply").addEventListener("click",(()=>this.applySettings())),t.show(),this.mainwnd=t}async setWp(e){const t=this.mainwnd.getBodyContainer(),n=t.querySelector("div.preview"),s=URL.createObjectURL(await d.FS.toBlob(e));n.style.backgroundImage=`url(${s})`,this._blobs.push(s),this.cachedWp[e]=s,this.applyStatus.wallpaperBlob=s,this.applyStatus.wallpaper=e,this.applyStatus.wallpaperType="FS",t.querySelector("button.apply").disabled=!1}ontermination(){for(let e of this._blobs)URL.revokeObjectURL(e);this._blobs=null,this.cachedWp=null,this.mainwnd=null,this.themes=null}async applySettings(){if(this.mainwnd.getBodyContainer().querySelector("button.apply").disabled=!0,this.applyStatus.wallpaper){const e=JSON.parse(await d.FS.readstr("c:/system/config/desktop.json")),t=document.querySelector(".user-desktop"),n=this.applyStatus.wallpaper;"FS"==this.applyStatus.wallpaperType?(n.endsWith(".cbg")?(e.background.type="css",e.background.bg=await d.FS.readstr(n),t.style.background=e.background.bg):(e.background.type="local",e.background.bg=n,t.style.background="",t.style.backgroundRepeat="no-repeat",t.style.backgroundSize="cover",t.style.backgroundImage="url("+URL.createObjectURL(await d.FS.toBlob(n))+")"),await d.FS.writestr("c:/system/config/desktop.json",JSON.stringify(e))):"css"==this.applyStatus.wallpaperType&&(e.background.type="css",e.background.bg=n,t.style.background=n,await d.FS.writestr("c:/system/config/desktop.json",JSON.stringify(e)))}if(this.applyStatus.theme){let t=!1;if(t)return;if("current"==this.applyStatus.theme)return;t=!0;var e=document.createElement("div");e.style.background="#000",e.style.opacity="0%",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.zIndex="15000000000",e.style.transition=".4s opacity",document.body.appendChild(e),await(0,f.Dc)(20),e.style.opacity="100%",await(0,f.Dc)(400),g.p.ui.emit("theme-unload"),i.Q.unloadTheme(!1);const n=this.themes.find((e=>e.id==this.applyStatus.theme));await d.FS.writestr("c:/system/boot/theme.js","// System reserved!!\n// Do not touch this file! It will get overwritten by the theme selector.\n\n"+n.file),await y.D.runFile("c:/system/boot/theme.js"),await i.Q.reloadDesktop(),await(0,f.Dc)(160),e.style.opacity="0%",await(0,f.Dc)(400),t=!1,await(0,f.Dc)(10),document.body.removeChild(e)}this.applyStatus={wallpaper:null,wallpaperType:null,wallpaperBlob:null,theme:null}}}class k extends a.WApplication{constructor(){super()}async main(e){super.main(e),document.querySelector(".pkmgr-applet")}}class S extends a.WApplication{constructor(){super(),this.panelApplets={uam:m,stormgr:p,devcfg:w,laf:E,pkmgr:k}}async main(e){super.main(e);let t=!1;e.forEach((async(n,s,i)=>{if("--cpl"==n&&null!=i[s+1]){const n=i[s+1];if(console.log("Launching applet "+n),null==this.panelApplets[n])return;return t=!0,await a.WApplication.execAsync(new this.panelApplets[n],e),void console.log("Applet finished.")}})),t||(this._blobsToDeregister=[],this._createWindow())}_createWindow(){if(document.querySelector(".ctrl-app"))return void this.terminate();const e=[{caption:"System Tasks",items:[{label:"About Windows 96",onclick:()=>r.x.execCmd("about-ui")},{label:"OS Flags",onclick:()=>r.x.execCmd("flags")}]}],t=[{category:"Appearance"},{caption:"Dynamic Wallpaper",icon:i.Q.getIconUrl("apps/dynwp"),onclick:()=>r.x.execCmd("dynwp-prefs")},{caption:"Look and Feel",icon:i.Q.getIconUrl("apps/laf"),onclick:()=>r.x.execCmd("ctrl",["--cpl","laf"])},{caption:"Window Manager",icon:i.Q.getIconUrl("misc/wm"),onclick:()=>r.x.execCmd("wmsm",[])},{category:"Network"},{caption:"P3 Configuration",icon:i.Q.getIconUrl("p3"),onclick:()=>r.x.execCmd("p3",["--notray"])},{category:"Security"},{caption:"User Login",icon:i.Q.getIconUrl("apps/uam"),onclick:()=>r.x.execCmd("ctrl",["--cpl","uam"])},{category:"File systems"},{caption:"Backup Wizard",icon:i.Q.getIconUrl("apps/backupmgr"),onclick:()=>r.x.execCmd("backupmgr",[])},{caption:"Boot Folder",icon:i.Q.getIconUrl("folder"),onclick:()=>r.x.execCmd("explorer",["c:/system/boot"])},{caption:"Storage",icon:i.Q.getIconUrl("apps/stormgr"),onclick:()=>r.x.execCmd("ctrl",["--cpl","stormgr"])},{category:"System"},{caption:"Device Configuration",icon:i.Q.getIconUrl("objects/iphone"),onclick:()=>r.x.execCmd("ctrl",["--cpl","devcfg"])},{caption:"Device Manager",icon:i.Q.getIconUrl("apps/devmgr"),onclick:()=>r.x.execCmd("devmgr",[])},null,{caption:"System Flags",icon:i.Q.getIconUrl("objects/tools"),onclick:()=>r.x.execCmd("flags")}],n=this.createWindow({title:"Control Panel",initialHeight:420,initialWidth:580,taskbar:!0,icon:i.Q.getIconUrl("small/apps/settings"),bodyClass:"ctrl-app",body:'\n                <div class="appbar"></div>\n                <div class="view">\n                    <div class="p1"></div>\n                    <div class="p2"></div>\n                </div>\n                <footer class="w96-footer">\n                    Windows 96 \n                </footer>\n            '},!0),s=n.getBodyContainer();s.querySelector("footer").innerText="Windows 96 v"+localStorage.getItem("w96ver");const a=s.querySelector(".view>.p1");e.forEach((e=>{const t=document.createElement("div");t.classList.add("box");const n=document.createElement("div");n.classList.add("title"),n.innerText=e.caption,t.appendChild(n);const s=document.createElement("div");s.classList.add("items"),t.appendChild(s),e.items.forEach((e=>{const t=document.createElement("span");t.classList.add("item"),t.innerText=e.label,t.addEventListener("click",(()=>e.onclick())),s.appendChild(t)})),a.appendChild(t)}));const l=s.querySelector(".view>.p2");t.forEach((e=>{if(!e)return;if(e.category){const t=document.createElement("div");return t.innerText=e.category,t.classList.add("cat-marker"),void l.appendChild(t)}const t=document.createElement("div");t.classList.add("item");const n=document.createElement("div");n.style.backgroundImage=`url(${e.icon})`,n.classList.add("icon"),t.appendChild(n);const s=document.createElement("div");s.classList.add("title"),s.innerText=e.caption,t.appendChild(s),t.addEventListener("click",(()=>e.onclick())),l.appendChild(t)}));const c=new o.j;c.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>n.close()}]),c.addRoot("Tools",[{type:"normal",label:"Force Update",onclick:()=>{u.jC.confirm("Are you sure you'd like to update? All unsaved data will be lost.",(async e=>{e&&(localStorage.removeItem("w96ver"),await w96.FS.rm("c:/system/sys_dl.lock"),r.x.reboot())}))}},{type:"normal",label:"Legacy settings",onclick:()=>r.x.execCmd("settings")},{type:"normal",label:"Reboot",onclick:()=>r.x.reboot()},{type:"normal",label:"Reinstall",onclick:()=>r.x.execCmd("reinstall")}]),c.addRoot("Help",[{type:"normal",label:"About",onclick:()=>r.x.execCmd("about-ui")}]),s.querySelector(".appbar").replaceWith(c.getMenuDiv()),n.show()}}},5559:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DevMgrApplication:()=>d});var s=n(9338),i=n(8041),o=n(4420),r=n(6999),a=n(5582),l=n(5784),c=n(4186);class d extends c.WApplication{constructor(){super()}async main(e){if(super.main(e),document.querySelector(".devmgr-app"))return;const t=this.createWindow({title:"Device Manager",icon:o.Q.getIconUrl("small/apps/devmgr"),taskbar:!0,initialWidth:530,initialHeight:400,bodyClass:"devmgr-app",body:'\n            <div class="appbar"></div>\n            <div class="tree w96-tree" style="height: 100%;"></div>\n            <footer class="w96-footer">\n                No errors found\n            </footer>\n            '},!0),n=t.getBodyContainer(),c=new r.j;c.addRoot("File",[{type:"normal",label:"Save Report",onclick:()=>new s.pp("c:/user/documents",[],(async e=>{null!=e&&""!=e.trim()&&(await l.FS.writestr(e,`\nDevice Manager Report\nGenerated at ${new Date}\n=====================\nMonitor: ${this.getMonitor()[0].label}\nCPU: ${this.getCPU()[0].label}\nGPU: ${this.getGPU()}\nMounted Disks:\n${l.FS.list().join("\n")}`),i.O.create({body:"Report has been generated.",title:"Information",icon:"info"}))})).show()},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>t.close()}]),c.addRoot("Help",[{type:"normal",label:"About",onclick:()=>i.O.alert('<span class="bold-noaa">Device Manager</span><br>Version 1.0<br>',{title:"About Device Manager",icon:"info"})}]),n.querySelector(".appbar").replaceWith(c.getMenuDiv());const d=s.jC.status("Device Manager","Computing resources...");d.show(),n.querySelector(".tree").replaceWith(new a.L([{label:"Computer",icon:o.Q.getIconUrl("small/computer"),items:[{label:"File System Interfaces",icon:o.Q.getIconUrl("small/exec"),opened:!1,items:this.computeAvailableFSDrivers()},{label:"GPU",icon:o.Q.getIconUrl("small/gpu_card"),opened:!1,items:[{label:this.getGPU(),icon:o.Q.getIconUrl("small/gpu_card")}]},{label:"Monitors",icon:o.Q.getIconUrl("small/devices/monitor"),opened:!1,items:this.getMonitor()},{label:"Processors",icon:o.Q.getIconUrl("small/devices/cpu"),opened:!1,items:this.getCPU()},{label:"Volumes",icon:o.Q.getIconUrl("small/hdd"),opened:!1,items:l.FS.list().map((e=>({icon:o.Q.getIconUrl("small/hdd"),label:e})))}],opened:!0}]).getElement()),d.close(),t.show()}computeAvailableFSDrivers(){const e=[];return void 0!==window.indexedDB&&e.push({label:"Indexed Storage",icon:o.Q.getIconUrl("small/hdd")}),void 0!==window.localStorage&&e.push({label:"Local Storage",icon:o.Q.getIconUrl("small/floppy")}),e.push({label:"Ram Storage",icon:o.Q.getIconUrl("small/ram")}),e}getGPU(){const e=document.createElement("canvas").getContext("webgl"),t=e.getExtension("WEBGL_debug_renderer_info");return t&&t.UNMASKED_RENDERER_WEBGL?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"Unknown GPU"}getCPU(){return[{label:"Generic Processor with "+navigator.hardwareConcurrency+" logical processors",icon:o.Q.getIconUrl("small/devices/cpu")}]}getMonitor(){return screen&&screen.width&&screen.height?[{label:`Monitor (${screen.width}x${screen.height})`,icon:o.Q.getIconUrl("small/devices/monitor")}]:[{label:"Unknown Monitor",icon:o.Q.getIconUrl("small/devices/monitor")}]}}},6314:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ExplorerApplication:()=>b});var s=n(4186),i=n(7366),o=n(6770),r=n(5784),a=n(9338),l=n(254),c=n(8576),d=n(6999),p=n(3177),u=n(6841),h=n(4420),m=n(8279),_=n(2763),w=n(5516),y=(n(8516),{main:""});class b extends s.WApplication{constructor(){super()}async main(e){super.main(e);var t=null!=e[0]?e[0]:"computer://";"computer://"!==t&&(t=t[0].toUpperCase()+t.substring(1)),r.FS.exists(t)||(t="computer://");const n=new i.Lw;n.resizable=!1,n.title="computer://"==t?"Computer":3==t.length?t:r.FSUtil.fname(t),n.initialWidth=450,n.initialHeight=390,n.resizable=!0;const s=this.createWindow(n,!0);s.useIcon=!0,s.registerWindow(),s.registerAppBar(),s.setWindowIcon("./system/resource/themes/default/icons/small/folder.png"),s.setControlBoxStyle(i.KZ.WS_CBX_MINMAXCLOSE),s.setHtml(y.main),this.mainwnd=s;const p=new d.j;p.addRoot("File",[{type:"normal",label:"Create Directory",onclick:()=>{this._ui_newDir()}},{type:"normal",label:"Create File",onclick:()=>{this._ui_newFile()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]),p.addRoot("View",[{type:"normal",label:"Refresh",onclick:()=>{this.navigate(this.currentPath,!0)}}]),p.addRoot("Go",[{type:"normal",icon:h.Q.getIconUrl("small/computer"),label:"Computer",onclick:()=>{this.navigate("computer://",!0)}},{type:"separator"},{type:"normal",icon:h.Q.getIconUrl("small/folder"),label:"Home",onclick:()=>{this.navigate("c:/user",!0)}},{type:"normal",icon:h.Q.getIconUrl("small/desktop"),label:"Desktop",onclick:()=>{this.navigate("c:/user/desktop",!0)}},{type:"normal",icon:h.Q.getIconUrl("small/documents"),label:"Documents",onclick:()=>{this.navigate("c:/user/documents",!0)}},{type:"separator"},{type:"normal",icon:h.Q.getIconUrl("small/folder"),label:"Boot Folder",onclick:()=>{this.navigate("c:/system/boot",!0)}},{type:"normal",icon:h.Q.getIconUrl("small/hdd"),label:"System Drive",onclick:()=>{this.navigate("c:/",!0)}},{type:"normal",icon:h.Q.getIconUrl("small/trash"),label:"Trash",onclick:()=>{this.navigate("c:/trash",!0)}}]),p.addRoot("Tools",[{type:"normal",label:"Upload",onclick:()=>{if("computer://"==this.currentPath)return;const e=new i.Lw;e.initialHeight=150,e.initialWidth=300,e.title="Upload File",e.resizable=!1;const t=this.createWindow(e,!1);t.registerWindow(),t.setControlBoxStyle("WS_CBX_CLOSE");const n=t.getBodyContainer();n.classList.add("uploader-app"),n.innerHTML='Choose files below and press "Start" to upload them.<br><br>The uploaded files will be saved to this folder.\n                <br><br>\n                <input type="file" class="w96-textbox" multiple=""><br>\n                <button class="w96-button start">Start</button>';const s=n.querySelector(".start"),o=n.querySelector("input");s.onclick=async()=>{s.disabled=!0;const e=a.jC.idleProgress("Upload in progress","The selected files are being saved, please wait...");e.show();for(let e=0;e<o.files.length;e++){const t=o.files.item(e),n=(3==this.currentPath.length?this.currentPath:this.currentPath+"/")+t.name;console.log("Writing "+n);const s=new Uint8Array(await t.arrayBuffer());await r.FS.writebin(n,s)}setTimeout((()=>{s.disabled=!1,e.closeDialog(),this.navigate(this.currentPath,!0)}),250)},t.show(),t.center()}},{type:"normal",label:"Mount read-only FS",onclick:()=>{a.jC.prompt("Mount Read-only File System","Enter the ROFS URL below.","",(async e=>{if(e&&""!=e.trim())try{const t=new r.RemoteReadOnlyFileSystem(r.FS.nextLetter(),e);await r.FS.mount(t)}catch(e){a.jC.error("Mount Failure","Failed to mount specified image.","OK")}}))}}]),p.addRoot("Help",[{type:"normal",label:"About File Explorer",onclick:()=>{a.jC.info("About File Explorer",'<span class="bold-noaa">File Explorer</span><br>Version 1.2<br>',"OK")}}]),this.appBar=p;const u=document.createElement("div");u.classList.add("nav-bar"),u.innerHTML='<button class="w96-button up"></button>\n        <input type="text" class="nav">\n        <button class="w96-button go"></button>';const _=u.querySelector(".go"),w=u.querySelector(".up");var b,g;this.pathBar=u.querySelector(".nav"),this.pathBar.value=t,_.onclick=()=>{this.navigate(this.pathBar.value)},w.onclick=()=>{if("computer://"==this.pathBar.value)return;const e=r.FSUtil.deconstructFullPath(this.pathBar.value);"/"==e.path?this.navigate("computer://"):this.navigate(e.prefix+r.FSUtil.getParentPath(e.path))},this.pathBar.onkeydown=e=>{"Enter"==e.key&&this.navigate(this.pathBar.value)},this.infoFooter=document.createElement("footer"),this.infoFooter.innerText="0 items",this.infoFooter.classList.add("w96-footer"),this.fsv=new o.n("c:/",!0),this.fsv.init(),this.fsv.uiComponent.style.width=n.initialWidth+"px",this.fsv.uiComponent.style.height=n.initialHeight+"px",this.fsv.setSize("100%","100%"),b=this.fsv,g=this,s.ondarkenelements=function(){b.uiComponent.querySelectorAll(".shell-icon.selected").forEach((e=>{e.classList.add("inactive")}))},s.onlightenelements=function(){b.uiComponent.querySelectorAll(".shell-icon.inactive").forEach((e=>{e.classList.remove("inactive")}))},b.uiComponent.oncontextmenu=function(e){for(var t=e.target;!t.classList.contains("exp-file-view");)if((t=t.parentNode).classList.contains("shell-icon"))return;if(e.preventDefault(),"computer://"==b.fsPath)return;b.deselectAllIcons();const n=new c.ContextMenu([{type:"normal",label:"Create Directory",onclick:function(){g._ui_newDir()}},{type:"normal",label:"Create File",onclick:function(){g._ui_newFile()}},{type:"separator"},{type:"normal",label:"Refresh",onclick:function(){"computer://"!=b.fsPath&&g.navigate(g.currentPath)}}]);document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()));const s=n.renderMenu(e.x,e.y),i=r.FSUtil.deconstructFullPath(b.fsPath);r.FS.get(i.prefix).features.includes(m.f.readOnly)&&(s.children[0].classList.add("disabled"),s.children[0].onclick=e=>e.stopPropagation(),s.children[1].classList.add("disabled"),s.children[1].onclick=e=>e.stopPropagation())};const f=s.wndObject.querySelector(".window-html-content");f.classList.add("wexplorer-app"),f.appendChild(p.getMenuDiv()),f.appendChild(u),this.options={showSidebar:!0,showHiddenFiles:!1,metaLookup:!0,specialPaths:["c:/system/temp"]};try{r.FS.exists("c:/system/config/explorer.json")?this.options=JSON.parse(await r.FS.readstr("c:/system/config/explorer.json")):await r.FS.writestr("c:/system/config/explorer.json",JSON.stringify(this.options,null,4))}catch(e){a.jC.warning("Oops","There was an error loading the configuration file. Please rectify it.","OK")}if(this.fsv.options.showHiddenFiles=this.options.showHiddenFiles,this.fsv.options.metaLookup=this.options.metaLookup,this.options.showSidebar){const e=document.createElement("div");e.classList.add("view-box");const t=document.createElement("div");t.classList.add("file-box");const n=document.createElement("div");n.classList.add("sidebar");const s=document.createElement("div");s.classList.add("icon");const i=document.createElement("div");i.classList.add("name");const o=document.createElement("div");o.classList.add("line");const r=document.createElement("div");r.classList.add("desc"),t.appendChild(s),t.appendChild(i),t.appendChild(o),t.appendChild(r),n.appendChild(t),e.appendChild(n),e.appendChild(this.fsv.getElement()),f.appendChild(e)}else f.appendChild(this.fsv.getElement());f.appendChild(this.infoFooter),this.fsv.onitemdblclick=e=>{switch(e.getAttribute("ent")){case"0":l.l.execFile(e.getAttribute("path")).catch((e=>{a.jC.error("Error",e,"OK")}));break;case"1":case"2":this.fsv.deselectAllIcons(),this.navigate(e.getAttribute("path"))}},this.fsv.ondropfinish=()=>{this.navigate(this.currentPath,!0),this.mainwnd.activate()},s.onshown=()=>{this.navigate(t)},this._ui_wc=f,s.show(),w96.evt.ui.on("reload-desktop",(()=>this.navigate(this.currentPath,!0)))}_navComplete(e){this.infoFooter.innerText=1==e.length?"1 item":`${e.length} items`,this.fsv.uiComponent.querySelectorAll(".shell-icon").forEach((e=>{this.options.specialPaths.includes(this.currentPath.toLowerCase())&&e.classList.add("special"),e.oncontextmenu=t=>{document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove())),this.mainwnd.activate();const n=e.getAttribute("ent"),s=e.getAttribute("path"),i=new c.ContextMenu([{type:"normal",label:"Open",onclick:()=>{e.ondblclick(t)}},{type:"normal",label:"Open with...",class:"openwith",onclick:()=>{w.x.execCmd("openwith",[s])}},{type:"separator"},{type:"normal",label:"Download",class:"download",onclick:()=>{"1"!=n?r.FSUtil.downloadFile(s):a.jC.error("Error","Not implemented","OK")}},{type:"normal",label:"Rename",onclick:async()=>{a.jC.prompt("Rename","Enter the new name of the entry.",r.FSUtil.fname(s),(e=>{null!=e&&(r.FS.rename(s,e),this.navigate(this.currentPath,!0))}))}},{type:"normal",label:"Delete",onclick:async()=>{"1"==n?(r.FS.rmdir(s),"c:/system"!=s&&"C:/system"!=s||(await(0,u.Dc)(2e3),(0,p.A)("Cannot find system folder c:/system!"))):r.FS.rm(s),this.navigate(this.currentPath,!0)}},{type:"separator"},{type:"normal",label:"Properties",onclick:()=>{this._ui_properties(s)}}]);"1"==n&&(i.items=i.items.filter((e=>"openwith"!=e.class&&"download"!=e.class)));i.renderMenu(t.x,t.y);const o=r.FSUtil.deconstructFullPath(this.fsv.fsPath);r.FS.get(o.prefix).features.includes(m.f.readOnly)}}))}_ui_properties(e){if(!r.FS.exists(e))return void a.jC.error("Error","Unable to display properties.","OK");const t=r.FS.stat(e),n=[{name:"Name",value:r.FSUtil.fname(e)},{name:"Type",value:1==r.FS.filetype(e)?"Directory":"Regular File"},{name:"Path",value:e},{name:"Size",value:t.length+" ("+(t.length/1024/1024).toFixed(1).toString()+" MB)"},{name:"FS Record",value:null!=t.recordId?t.recordId:"null"}],s=new i.Lw;s.draggable=!0,s.initialHeight=230,s.initialWidth=340,s.resizable=!1,s.title="Properties for "+e;const o=this.createWindow(s,!1);o.setControlBoxStyle("WS_CBX_CLOSE"),o.registerWindow();const l=o.wndObject.querySelector(".window-html-content");l.classList.add("wexplorer-app-propdlg");const c=document.createElement("div");c.classList.add("p1");const d=document.createElement("div");d.classList.add("icon"),d.style.backgroundImage="url("+h.Q.getFileIconUrl(e)+")",c.appendChild(d);const p=document.createElement("div");p.classList.add("p2"),n.forEach((e=>{let t=document.createElement("div");t.classList.add("field"),t.innerHTML=`<span>${e.name}</span><input class="w96-textbox" readonly>`,t.querySelector("input").value=e.value,p.appendChild(t)}));const u=document.createElement("button");u.innerText="OK",u.classList.add("w96-button","dlg-ok-btn"),u.onclick=()=>o.close(),p.appendChild(u),l.appendChild(c),l.appendChild(p),o.show()}_ui_newDir(){if("computer://"==this.currentPath)return;const e=r.FSUtil.deconstructFullPath(this.currentPath);r.FS.get(e.prefix).features.includes(m.f.readOnly)?a.jC.error("FS Error","Read-only file system.","Damn..."):a.jC.prompt("Create Directory","Enter the name of the directory to create.","New Folder",(e=>{if(null==e)return;const t=r.FSUtil.deconstructFullPath(this.currentPath),n=t.prefix+("/"==t.path?"":t.path)+"/"+e;r.FS.exists(n)?a.jC.warning("Directory Creation Failure","The path specified already exists.","OK"):(r.FS.mkdir(n),this.navigate(this.currentPath,!0))}))}async _ui_sidebar_update(e,t,n){if(this.options.showSidebar){const s=this._ui_wc.querySelector(".sidebar>.file-box");s.querySelector(".name").innerText=t,s.querySelector(".icon").style.backgroundImage=`url(${e})`,s.querySelector(".desc").innerText="",n&&(await n.read(),n.properties.description&&(s.querySelector(".desc").innerText=n.properties.description))}}_ui_newFile(){if("computer://"==this.currentPath)return;const e=r.FSUtil.deconstructFullPath(this.currentPath);r.FS.get(e.prefix).features.includes(m.f.readOnly)?a.jC.error("FS Error","Read-only file system.","Damn..."):a.jC.prompt("Create File","Enter the name of the file to create.","New File.txt",(e=>{if(null==e)return;const t=r.FSUtil.deconstructFullPath(this.currentPath),n=t.prefix+("/"==t.path?"":t.path)+"/"+e;r.FS.exists(n)?a.jC.warning("File Creation Failure","The path specified already exists.","OK"):(r.FS.touch(n),this.navigate(this.currentPath,!0))}))}navigate(e,t){"computer://"==e||r.FS.exists(e)||a.jC.error("Error","Directory does not exist.","OK"),this.currentPath=e,this.pathBar.value=this.currentPath;let n=null;switch(this.options.metaLookup&&(n=new _.p(e)),this.currentPath){case"computer://":this.mainwnd.setTitle("Computer"),this.mainwnd.setWindowIcon(h.Q.getIconUrl("small/computer")),this._ui_sidebar_update(h.Q.getIconUrl("computer"),"My Computer",n);break;case"c:/trash":this.mainwnd.setTitle("Trash"),this.mainwnd.setWindowIcon(h.Q.getIconUrl("small/trash")),this._ui_sidebar_update(h.Q.getIconUrl("trash"),"Trash",n);break;default:if(3==this.currentPath.length){const e=this.currentPath.substring(0,2),t=r.FS.get(e);let s="hdd";switch(t.driverName){default:case"idbfs":break;case"localfs":s="floppy";break;case"ramfs":s="ram";break;case"rofs":s="hdd-ro"}this.mainwnd.setTitle(this.currentPath),this._ui_sidebar_update(h.Q.getIconUrl(s),t.volumeLabel+" ("+e+")",n),this.mainwnd.setWindowIcon(h.Q.getIconUrl("small/"+s))}else this.mainwnd.setTitle(r.FSUtil.fname(this.currentPath)),this._ui_sidebar_update(h.Q.getIconUrl("folder"),r.FSUtil.fname(this.currentPath),n),this.mainwnd.setWindowIcon(h.Q.getIconUrl("small/folder"))}this.fsv.navigate(e,(e=>this._navComplete(e)),t)}setViewMode(e){return this.fsv.setViewMode(e)}}},6770:(e,t,n)=>{"use strict";n.d(t,{n:()=>u});var s=n(6993),i=n(5784),o=n(4420),r=n(1984),a=n(9338),l=n(8279),c=n(1124),d=(n(5516),n(8041)),p=n(9807);class u extends s.UIComponent{constructor(e,t=!1){if(super(),this.initialNav=!0,""==e.trim()||null==e)throw new Error("Cannot navigate to null path.");e=e[0].toUpperCase()+e.substring(1),this.fsPath=e;var n,s=document.createElement("div");s.classList.add("exp-file-view"),this.uiComponent=s,this.options={showHiddenFiles:!1,enableNavigation:!0,metaLookup:!0,iconPreviews:!0,singleClick:p.a.getProfile().preferences.single_click,previewMaxSize:5242880,viewMode:"icons"},(n=this).uiComponent.onclick=function(e){for(var t=e.srcElement;!t.classList.contains("exp-file-view");)if((t=t.parentNode).classList.contains("shell-icon"))return;n.deselectAllIcons()},this.onitemdblclick=function(e){},this.onitemselected=function(e){},this.ondropfinish=function(){},this.readdirFunc=function(e){const t=i.FS.readdir(e),n=[];return t.forEach((e=>{if(this.options.showHiddenFiles)n.push(e);else{i.FSUtil.fname(e).startsWith(".")||n.push(e)}})),n},this.uiComponent.ondragenter=()=>{this.uiComponent.classList.add("fdrag-box")},this.uiComponent.ondragleave=()=>{this.uiComponent.classList.remove("fdrag-box")},this.uiComponent.ondrop=async e=>{if(e.preventDefault(),e.stopPropagation(),this.uiComponent.classList.remove("fdrag-box"),"computer://"==this.fsPath)return void a.jC.warning("File Upload Error","You cannot upload files in this system folder!","Damn...");const t=i.FSUtil.deconstructFullPath(this.fsPath);if(i.FS.get(t.prefix).features.includes(l.f.readOnly))a.jC.error("File Upload Error","Read-only file system.","Damn...");else if(console.log("Processing file upload..."),console.log(e.dataTransfer.files),e.dataTransfer.files){let t=[];for(let n=0;n<e.dataTransfer.files.length;n++)t.push(e.dataTransfer.files[n]);for(var n of t)console.log("Uploading "+n.name+"..."),await i.FS.writebin(this.fsPath+(this.fsPath.endsWith(":/")&&3==this.fsPath.length?"":"/")+n.name,new Uint8Array(await n.arrayBuffer()));t=[],this.ondropfinish&&this.ondropfinish()}},this.uiComponent.ondragover=e=>{e.preventDefault()},c.r.create(this.uiComponent,this.fsPath);const o=c.r.get(this.uiComponent);o.accepts.push("shell-icon"),o.ondrop=e=>this._ondzdropFn(e),t||w96.evt.ui.on("reload-desktop",(()=>this.refreshView()))}setViewMode(e){switch(e){default:throw new Error("View mode not found.");case"icons":this.options.iconSize="normal";case"tile":this.options.iconSize="jumbo";case"details":this.options.iconSize="small"}this.options.viewMode=e,this.uiComponent.classList.forEach((e=>{e.startsWith("view-")&&this.uiComponent.classList.remove(e)})),"icons"!=e&&this.uiComponent.classList.add(`view-${e}`)}async _ondzdropFn(e){const t=e.getAttribute("path");if(null==t)return!1;if(e.parentElement==this.uiComponent)return!1;if("computer://"==this.fsPath)return!1;const n=i.FS.filetype(t),s=(3==this.fsPath.length?this.fsPath:this.fsPath+"/")+i.FSUtil.fname(t);if(t===this.fsPath||t===s)return!1;try{switch(n){case 0:await i.FS.mvfile(t,s);break;case 1:await i.FS.mvdir(t,s)}this.ondropfinish&&this.ondropfinish()}catch(e){a.jC.error("Error",new String(e),"OK")}return e.remove(),!0}init(){}navigate(e,t,n=!1){this.initialNav?this.initialNav=!1:n||o.Q.playSound("navigate"),this.fsPath=e,this.refreshView(t)}mkIcon(e,t){const n=document.createElement("div");n.classList.add("shell-icon"),n.style.top="10px",n.style.left="10px",n.style.display="inline-flex",n.style.position="absolute",n.style.flexDirection="column";const s=document.createElement("div");s.classList.add("icon-image"),s.style.background=`url(${t})`,n.appendChild(s);const i=document.createElement("span");return i.classList.add("icon-text"),i.innerText=e,n.appendChild(i),n}deselectAllIcons(){this.uiComponent.querySelectorAll(".shell-icon").forEach((e=>{e.classList.remove("selected")}))}selectIcon(e){this.deselectAllIcons(),e.classList.add("selected"),this.onitemselected&&this.onitemselected(e)}sortIcons(){var e=0,t=10;const n=this.uiComponent.getBoundingClientRect(),s=Array.prototype.slice.call(this.uiComponent.querySelectorAll('.shell-icon[ent="1"]')),i=Array.prototype.slice.call(this.uiComponent.querySelectorAll('.shell-icon[ent="0"]')),o=Array.prototype.slice.call(this.uiComponent.querySelectorAll('.shell-icon[ent="2"]')),r=function(e,t){return e.getAttribute("name").toLowerCase()<t.getAttribute("name").toLowerCase()?-1:e.getAttribute("name").toLowerCase()>t.getAttribute("name").toLowerCase()?1:0};s.sort(r),i.sort(r),o.sort(r);const a=s=>{s.style.left=`${e}px`,s.style.top=`${t}px`,e+125>n.width?(e=0,t+=70):e+=65};o.forEach(a),s.forEach(a),i.forEach(a)}refreshView(e){for(;this.uiComponent.firstChild;)this.uiComponent.removeChild(this.uiComponent.firstChild);if(c.r.get(this.uiComponent).data=this.fsPath,"computer://"==this.fsPath)return i.FS.list().forEach((e=>{const t=i.FS.get(e);if(t.features.includes(l.f.hidden))return;var n="hdd";switch(t.driverName){default:case"idbfs":break;case"localfs":n="floppy";break;case"ramfs":n="ram";break;case"rofs":n="hdd-ro"}const s=this.mkIcon(t.volumeLabel+" ("+e+")",o.Q.getIconUrl(n,this.options.iconSize?this.options.iconSize:"normal"));s.setAttribute("path",e+"/"),s.setAttribute("ent","2"),s.setAttribute("name",e),s.ondblclick=()=>{this.selectIcon(s),this.onitemdblclick(s)},this.options.singleClick&&s.addEventListener("click",(()=>s.ondblclick())),"details"==this.options.viewMode?(s.onclick=()=>this.selectIcon(s),s.querySelector(".icon-text").onclick=()=>this.selectIcon(s)):s.onmousedown=e=>{0!=e.button&&2!=e.button||this.selectIcon(s)},"details"==this.options.viewMode&&(s.onclick=()=>this.selectIcon(s)),this.uiComponent.appendChild(s)})),void this.sortIcons();const t=this.readdirFunc(this.fsPath);var n;n=this,t.forEach((async e=>{const t=i.FSUtil.fname(e);let s;if("c:/trash"==e)s=0==i.FS.readdir("c:/trash").length?n.mkIcon(t,o.Q.getIconUrl("trash",n.options.iconSize?n.options.iconSize:"normal")):n.mkIcon(t,o.Q.getIconUrl("trash-full",n.options.iconSize?n.options.iconSize:"normal"));else if(e.endsWith(".lnk42"))s=n.mkIcon(t,""),r.X.getIconURL(e).then((e=>s.querySelector(".icon-image").style.background="url("+e+")"));else if(e.endsWith(".link")&&i.FS.isFile(e))s=n.mkIcon(t.substring(0,t.lastIndexOf(".")),""),i.FS.readstr(e).then((e=>{const t=JSON.parse(e),i=s.querySelector(".icon-image");null!=t.icon&&t.icon.startsWith("data:")?i.style.background=`url(${t.icon})`:i.style.background=`url(${o.Q.getIconUrl(t.icon,n.options.iconSize?n.options.iconSize:"normal",null!=t.iconFmt?t.iconFmt:"png")})`;const r=document.createElement("div");r.classList.add("icon-shortcut-emblem"),i.appendChild(r)}));else if(e.endsWith(".png")&&i.FS.stat(e).length<n.options.previewMaxSize&&n.options.iconPreviews){const r=i.FSUtil.deconstructFullPath(e),a=i.FS.get(r.prefix);if(a.features.includes(l.f.readOnly)&&a.origin){const e=a.origin+"/"+r.path;s=n.mkIcon(t,e)}else s=n.mkIcon(t,o.Q.getFileIconUrl(e,n.options.iconSize?n.options.iconSize:"normal"))}else s=n.mkIcon(t,o.Q.getFileIconUrl(e,n.options.iconSize?n.options.iconSize:"normal"));if(n.makeDraggable(s,e),s.setAttribute("path",e),s.setAttribute("ent",i.FS.filetype(e)),s.setAttribute("name",t),s.style.left="10px",s.style.top="10px",s.ondblclick=function(){n.onitemdblclick(s)},n.options.singleClick&&s.addEventListener("click",(()=>s.ondblclick())),"details"==n.options.viewMode?(s.onclick=e=>{n.selectIcon(s)},s.querySelector(".icon-text").onclick=()=>n.selectIcon(s)):s.onmousedown=function(e){0!=e.button&&2!=e.button||n.selectIcon(s)},i.FS.stat(e).length<10485760){const t=i.FSUtil.deconstructFullPath(e),r=i.FS.get(t.prefix);r.features.includes(l.f.remote)||r.remote||i.FS.readStrChunk(e,0,6).then((e=>{"//!wrt"==e&&(s.querySelector(".icon-image").style.background=`url(${o.Q.getIconUrl("exec",n.options.iconSize?n.options.iconSize:"normal")})`)}))}n.uiComponent.appendChild(s)})),n.sortIcons(),e&&e(t)}destroy(){this.uiComponent.remove()}getElement(){return this.uiComponent}getSize(){return{h:this.uiComponent.style.width,w:this.uiComponent.style.height}}setSize(e,t){this.uiComponent.style.width=e,this.uiComponent.style.height=t}_createIconFolderDropzone(e,t){c.r.create(e);const n=c.r.get(e);n.accepts.push("shell-icon"),n.data=t,n.ondrop=e=>this._ondzdropFn(e)}makeDraggable(e,t){let n=null;$(e).draggable({helper:()=>{const t=e.querySelector(".icon-image"),n=document.createElement("div");return n.classList.add("shell-clone-icon"),n.style.backgroundImage=t.style.backgroundImage,document.querySelector("#maingfx").appendChild(n),n},start:(t,n)=>{e.style.display="none",document.querySelector(".user-desktop>.build-info").style.pointerEvents="none"},drag:(e,t)=>{const s=document.elementFromPoint(e.clientX,e.clientY);if(e.clientX>document.body.clientWidth||e.clientY+2>document.body.clientHeight)return e.preventDefault();s&&s.classList&&s!=this.uiComponent&&(s.classList.contains("dropzone")&&null==n?(n=s,s.classList.add("hlight")):n!=s&&null!==n&&(n.classList.remove("hlight"),n=null))},stop:(s,o)=>{n&&(n.classList.remove("hlight"),n=null),e.style.display="inline-flex";const r=s.clientX,l=s.clientY,p=document.elementFromPoint(r,l);if(document.querySelector(".user-desktop>.build-info").style.pointerEvents="auto",p&&p.classList.contains("dropzone")){const n=c.r.get(p);if(!n.accepts.includes("shell-icon"))return;const s=i.FSUtil.deconstructFullPath(n.data);if("computer://"==n.data)return void d.O.create({body:"Invalid path.",icon:"error",title:"Error during transfer"});if(i.FS.get(s.prefix).readOnly)d.O.create({body:"Read-only filesystem.",icon:"error",title:"Error during transfer"});else{if(n.data==this.fsPath)return;if(n.data==t)return;if(n.data.startsWith(t+"/"))return;{if("C:/system"==t)return void a.jC.confirm("This is a terrible idea. Continue?",(t=>{t&&n.ondrop(e,{x:o.position.left,y:o.position.top})&&this.refreshView()}),"warning");const s=e.getAttribute("path"),r=i.FSUtil.fname(s),l=n.data+("3"==n.data.length?"":"/")+r;if(t[0].toLowerCase()+t.slice(1)===n.data||t[0].toLowerCase()+t.slice(1)===l)return;i.FS.exists(l)?a.jC.confirm("This item already exists. Replace?",(t=>{t&&n.ondrop(e,{x:o.position.left,y:o.position.top})&&this.refreshView()}),"question"):n.ondrop(e,{x:o.position.left,y:o.position.top})&&this.refreshView()}}}}})}}},4600:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FlagsApplication:()=>d});var s=n(8041),i=n(4420),o=n(4779),r=n(6999),a=n(4186),l=n(6226);const c=[{displayName:"Disable analytics and tracking",name:"disable_analytics",description:"Disables the analytics script ran on startup.",args:[]},{displayName:"Simulate missing IndexedDB",name:"simulate_missing_idb",description:"Removes indexedDb from the session to simulate a missing storage backend.",args:[]},{displayName:"Disable WebAssembly",name:"simulate_no_wasm",description:"Removes WebAssembly from the current session.",args:[]},{displayName:"Do not mount W:/",name:"sys_ignore_mount",description:"Does not mount the W:/ system drive upon boot.",args:[]},{displayName:"Disable update notifications",name:"no_update_notifs",description:"Disables the system update notification.",args:[]},{displayName:"Disable boot scripts",name:"no_boot_scripts",description:"Disables the processing of scripts in c:/system/boot during startup.",args:[]},{displayName:"Disable desktop icons",name:"no_desktop_icons",description:"Stops desktop icons from appearing.",args:[]},{displayName:"Hide build info",name:"no_build_info",description:"Hides the build info from the desktop.",args:[]},{displayName:"Force pixelated image rendering",name:"force_pixel_render",description:"Forces the browser to render all images pixelated.",args:[]},{displayName:"Disable fast booting",name:"no_fastboot",description:"Enables kernel debug timers. These are disabled by default.",args:[]},{displayName:"Display exceptions",name:"exclaim_exceptions",description:"Shows error dialogs for exceptions that occur during your session.",args:[]},{displayName:"Do not load previous desktop icon positions",name:"no_icon_positioning",description:"Prevents desktop icons from loading in their last placed positions.",args:[]},{displayName:"Disable new bootscreen",name:"disable_new_bootscreen",description:"Disables the beta version of the startup screen",args:[]},{displayName:"Disable window compositing",name:"disable_wcomp",description:"Disables window compositing (may break some themes).",args:[]},{displayName:"Disable eastereggs",name:"disable_easter_eggs",description:"Disables eastereggs and other jokes.",args:[]}];class d extends a.WApplication{constructor(){super()}async main(e){super.main(e),"undefined"!=typeof BatteryManager&&c.push({displayName:"Disable battery monitoring",name:"disable_battery_api",description:"Disables the battery monitoring service.",args:[]});const t=this.createWindow({title:"System Flags",icon:i.Q.getIconUrl("objects/tools"),body:`\n            <div class="appbar"></div>\n            <div class="container">\n                <div class="list-box"></div>\n                <div class="buttons">\n                    <button class="w96-button toggle" disabled>Enable</button>\n                    <button class="w96-button clear">Clear All</button>\n                    <button class="w96-button reboot">Reboot</button>\n                </div>\n            </div>\n            <footer class="w96-footer">\n                ${c.length} available flags\n            </footer>`,bodyClass:"wflags-app",center:!0,initialWidth:471,height:340,taskbar:!0},!0),n=new r.j;n.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>this.terminate()}]),n.addRoot("Help",[{type:"normal",label:"About",onclick:()=>s.O.create({title:"About",icon:"info",body:'<span class="bold-noaa">System Flags 1.0.</span><br><br>Copyright (C) windows96.net 2021.'})}]);const a=t.getBodyContainer();a.querySelector(".appbar").replaceWith(n.getMenuDiv());const d=new o.w;for(let e of c){const t=d.addItem(e.displayName,e.name);(0,l.yE)(e.name)&&t.classList.add("enabled"),t.innerHTML=`\n                <span class="bold-noaa">${e.displayName}</span><br>\n                ${e.description}\n            `,t.addEventListener("dblclick",(()=>{a.querySelector("button.toggle").click()})),t.addEventListener("click",(()=>{const n=a.querySelector("button.toggle");n.disabled=!1;let s=()=>{t.classList.remove("enabled"),n.innerText="Enable",(0,l.yE)(e.name)&&(0,l.mB)(e.name,!1),n.onclick=i},i=()=>{t.classList.add("enabled"),n.innerText="Disable",(0,l.yE)(e.name)||(0,l.mB)(e.name),n.onclick=s};t.classList.contains("enabled")?(n.innerText="Disable",n.onclick=s):(n.innerText="Enable",n.onclick=i)}))}const p=d.getElement();a.querySelector(".list-box").replaceWith(p),a.querySelector("button.reboot").addEventListener("click",(()=>document.location.reload())),a.querySelector("button.clear").addEventListener("click",(()=>{p.querySelectorAll(".item").forEach((e=>e.classList.remove("enabled"))),(0,l.RI)()})),t.show(),"true"!==localStorage.getItem("flags_first_time_done")&&(s.O.create({title:"WARNING",icon:"warning",body:'This tool is intended for people who know what they are doing.<br><br>Setting any of these flags may cause instability or a loss of data.<br><br>We will not provide any support for systems with flags enabled.<br><br><span class="bold-noaa">You have been warned.</span>'}),localStorage.setItem("flags_first_time_done","true"))}}},2446:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FXApplication:()=>d});var s=n(4186),i=(n(7366),n(4420)),o=n(9338),r=n(7362);function a(e){document.querySelector("body").classList.add(e)}function l(e){document.querySelector("body").classList.remove(e)}const c={hue:{start:function(){a("fx-hue")},stop:function(){l("fx-hue")}},spinner:{start:function(){a("fx-spin")},stop:function(){l("fx-spin")}},"upside-down":{start:function(){a("fx-upside-down")},stop:function(){l("fx-upside-down")}},zoom:{start:function(){a("fx-zoom")},stop:function(){l("fx-zoom")}},deepfryer:{start:function(){a("fx-deepfryer")},stop:function(){l("fx-deepfryer")}},grayscale:{start:function(){a("fx-grayscale")},stop:function(){l("fx-grayscale")}},invert:{start:function(){a("fx-invert")},stop:function(){l("fx-invert")}},blur:{start:function(){a("fx-blur")},stop:function(){l("fx-blur")}},disco:{start:function(){var e=document.querySelector(".fx-desk-overlay");e||((e=document.createElement("div")).classList.add("fx-desk-overlay","fx-hue"),document.querySelector(".user-desktop").appendChild(e))},stop:function(){var e=document.querySelector(".fx-desk-overlay");e&&e.remove()}},neon:{start:function(){var e=document.querySelector(".fx-neon-css");e||((e=document.createElement("style")).classList.add("fx-neon-css"),document.body.appendChild(e)),e.innerHTML="\n            .window-dlg:not(.ui-sortable-helper) {\n                box-shadow: 0 0 12px 6px #c725d4 !important;\n            }\n            \n            .start-menu {\n                box-shadow: 0px 0px 20px 4px lime !important;\n            }\n            \n            .wcontext-menu {\n                box-shadow: 0 0 11px 0px cyan !important;\n            }"},stop:function(){var e=document.querySelector(".fx-neon-css");e&&e.remove()}}};class d extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow(),this.fxQueue=[],r.nP.setEnv("fxQueue",this.fxQueue)}getFxNames(){var e="";return Object.keys(c).sort((function(e,t){return e>t?1:e<t?-1:0})).forEach((t=>{e+='<option name="'+t+'">'+t+"</option>\n"})),e}_resetFx(){this.fxQueue.forEach((e=>{c[e].stop()})),this.fxQueue=[]}_createWindow(){this.appDlg=new o._p("Effects",`Select an effect below:<br><br>\n<select class="w96-select" style="width: 100%">\n    ${this.getFxNames()}\n</select>`,"effects","OK",(()=>{})),this.appDlg.dlg.registerAppBar(),this.appDlg.dlg.setWindowIcon(i.Q.getIconUrl("apps/effects","small"));const e=this.appDlg.dlg.wndObject.querySelector(".buttons");e.innerHTML='<button class="w96-button btnappend">Append</button>\n        <button class="w96-button btnapply">Apply</button>\n        <button class="w96-button btnreset">Reset</button>';const t=this.appDlg.dlg.wndObject.querySelector("select"),n=e.querySelector(".btnapply"),s=e.querySelector(".btnreset"),a=e.querySelector(".btnappend");n.onclick=()=>{this._resetFx(),this.fxQueue=[t.value],r.nP.setEnv("fxQueue",this.fxQueue),c[t.value].start()},s.onclick=()=>{this._resetFx()},a.onclick=()=>{this.fxQueue.includes(t.value)||(this.fxQueue.push(t.value),r.nP.setEnv("fxQueue",this.fxQueue),c[t.value].start())},this.appDlg.setSize(320,130),this.appDlg.show(),this.appDlg.dlg.center()}}},7960:(e,t,n)=>{"use strict";n.r(t),n.d(t,{IntExploderApplication:()=>d});var s=n(4186),i=n(7366),o=n(4420),r=n(6999),a=n(8041),l=n(5784);const c=[{url:"exploder://start",title:"Start Page",redir:"/system/data/iexploder/syspages/start",import_sys:!0}];class d extends s.WApplication{constructor(){super()}async main(e){super.main(e),l.FS.exists("c:/user/appdata/Internet Exploder")||await l.FS.mkdir("c:/user/appdata/Internet Exploder"),l.FS.exists("c:/user/appdata/Internet Exploder/Bookmarks.json")||await l.FS.writestr("c:/user/appdata/Internet Exploder/Bookmarks.json",JSON.stringify({"Windows 96":[{name:"Old release v1",url:"https://rel1.windows96.net/"},{name:"OS-ception",url:"https://windows96.net/"},{name:"Gameing Standalone",url:"https://windows96.net/dl/gameing"},{name:"ShareBoard",url:"https://sb.windows96.net/"},{name:"Wiki",url:"https://wiki.windows96.net"},{name:"MsgRoom",url:"https://msgroom.windows96.net"}],Developer:[{name:"API documentation",url:"https://apidocs.windows96.net"},{name:"Developer Documentation",url:"https://devdocs.windows96.net"}],Cool:[{name:"WebGL Aquarium Sample",url:"https://webglsamples.org/aquarium/aquarium.html"},{name:"HTML5Test",url:"https://html5test.com/"},{name:"Octane JS Benchmark",url:"https://chromium.github.io/octane/"},{name:"Acid3 Test",url:"http://acid3.acidtests.org/"}]},null,4)),await this._createWindow(e)}async _createWindow(e){const t=new i.Lw;t.title="about:blank - Internet Exploder",t.initialWidth=800,t.initialHeight=650;const n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml('<div class="appbar"></div>\n        <div class="header">\n            <div class="toolbar w96-toolbar">\n                <button class="w96-button nav back"></button>\n                <button class="w96-button nav forward"></button>\n                <button class="w96-button nav reload"></button>\n                <div class="vseparator" style="margin-right: 0px;"></div>\n                <div class="w96-menubar bookmarks-bar"></div>\n            </div>\n            <div class="navbar">\n                <span class="text">\n                Address: \n                </span>\n                <input class="w96-textbox navbox">\n                <button class="w96-button go">Go</button>\n            </div>\n        </div>\n        <iframe src="about:blank"></iframe>\n        <footer class="w96-footer">Internet Exploder 1.0</footer>');const s=n.getBodyContainer();s.classList.add("iexploder-app"),n.setWindowIcon(o.Q.getIconUrl("small/apps/iexploder"));const c=n.wndObject.querySelector("iframe");this.navBox=s.querySelector(".navbox"),this.footer=s.querySelector("footer"),s.querySelector(".nav.back").onclick=()=>{c.contentWindow.history.back()},s.querySelector(".nav.forward").onclick=()=>{c.contentWindow.history.forward()},s.querySelector(".nav.reload").onclick=()=>{this.navigate(this.navBox.value)},this.navBox.onkeydown=e=>{"Enter"==e.key&&this.navigate(this.navBox.value)},s.querySelector(".w96-button.go").onclick=()=>this.navigate(this.navBox.value);const d=new r.j;d.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]),d.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{a.O.alert('<span class="bold-noaa">Internet Exploder</span><br>Version 1.0<br>',{title:"About Internet Exploder",icon:"info"})}}]),s.querySelector(".appbar").replaceWith(d.getMenuDiv());const p=new r.j;this.bookmarksBar=p;try{const e=JSON.parse(await l.FS.readstr("c:/user/appdata/Internet Exploder/Bookmarks.json"));Object.keys(e).forEach((t=>this.createBookmarksFolder(t,e[t])))}catch(e){a.O.alert(e.toString(),{title:"Error",icon:"error"})}const u=p.getMenuDiv();u.classList.add("bookmarks-bar"),s.querySelector(".bookmarks-bar").replaceWith(u),n.ondarkenelements=()=>{c.style.pointerEvents="none"},n.onlightenelements=()=>{c.style.pointerEvents=""},this.appFrame=c,this.mainwnd=n,n.show(),null!=e[0]?this.navigate(e[0]):this.navigate("exploder://start")}navigate(e){const t=c.find((t=>t.url==e));if(this.appFrame.onload=()=>{},t)return t.title?this.mainwnd.setTitle(t.title+" - Internet Exploder"):this.mainwnd.setTitle(e+" - Internet Exploder"),this.navBox.value=e,t.import_sys&&(this.appFrame.onload=()=>{this.appFrame.contentWindow.w96=w96}),t.body?this.appFrame.src="data:text/html;base64,"+btoa(t.body):this.appFrame.src=t.redir,void(this.footer.innerText="Internet Exploder 1.0");const n=function(e){let t=e;return e.startsWith("about:")||e.startsWith("/")||t.startsWith("https://")||t.startsWith("http://")||(t="https://"+t),t}(e);this.mainwnd.setTitle(n+" - Internet Exploder"),this.navBox.value=n,this.appFrame.src=n,this.footer.innerText="Internet Exploder 1.0"}createBookmarksFolder(e,t){const n=document.createElement("span");n.classList.add("image");const s=[];for(let e of t)s.push({type:"normal",label:e.name,onclick:()=>this.navigate(e.url)});const i=this.bookmarksBar.addRoot(e,s);return i.prepend(n),i}}},5515:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ImgViewerApplication:()=>d});var s=n(4186),i=n(7366),o=n(4876),r=n(9338),a=n(5784),l=n(4420),c=n(5685);class d extends s.WApplication{constructor(){super(),this.scale=1}async main(e){super.main(e),null!=e[0]?await this._createWindow(e[0]):new r.MT("c:/",["png","jpg","svg","ass"],(e=>{e?this._createWindow(e):this.terminate()})).show()}async _createWindow(e){const t=new Blob([await a.FS.readbin(e)],{type:(0,c.i)(e)}),n=URL.createObjectURL(t),s=new i.Lw;s.title=o.R.fname(e)+" - Image Viewer",s.initialWidth=540,s.initialHeight=460;const r=this.createWindow(s,!0);r.registerWindow(),r.registerAppBar(),r.setHtml(`<div class="image-container" style="background-image: url(${n})"></div>\n        <div class="controls">\n            <button class="w96-button zoom"></button>\n            <button class="w96-button center"></button>\n            <button class="w96-button view-pixelated"></button>\n            <button class="w96-button view-quality"></button>\n            <button class="w96-button bg">BG</button>\n        </div>`);const d=r.wndObject.querySelector(".window-html-content");d.classList.add("imgviewer-app");const p=d.querySelector(".image-container"),u=d.querySelector(".w96-button.zoom"),h=d.querySelector(".w96-button.center"),m=d.querySelector(".w96-button.bg");u.onclick=()=>{p.classList.remove("centered"),this.resetScale()},h.onclick=()=>{p.classList.add("centered"),this.resetScale()},m.onclick=async function(){const t=JSON.parse(await a.FS.readstr("c:/system/config/desktop.json"));t.background.type="local",t.background.bg=e;const s=document.querySelector(".user-desktop");s.style.background="",s.style.backgroundRepeat="no-repeat",s.style.backgroundSize="cover",s.style.backgroundImage="url("+n+")",await a.FS.writestr("c:/system/config/desktop.json",JSON.stringify(t))},d.querySelector(".w96-button.view-pixelated").addEventListener("click",(()=>{p.classList.add("pixelated")})),d.querySelector(".w96-button.view-quality").addEventListener("click",(()=>{p.classList.remove("pixelated")})),p.addEventListener("wheel",(e=>{if(!p.classList.contains("centered"))return;const t=e.deltaY/100*-1;this.scale+t>10||this.scale+t<1||(this.scale+=t),p.style.transform=`scale(${this.scale})`})),r.setWindowIcon(l.Q.getIconUrl("small/image2")),r.show(),this.imageContainer=p}resetScale(){this.scale=1,this.imageContainer.style.transform=""}}},3872:(e,t,n)=>{"use strict";n.r(t),n.d(t,{KeyManagementApplication:()=>a});var s=n(4186),i=(n(9338),n(4420)),o=n(8041),r=(n(3978),n(9703));n(6999);class a extends s.WApplication{constructor(){super()}async main(e){let t;if(e.includes("-m"))new Audio("/system/resource/sounds/xd.mp3").play(),o.O.alert("This option is not available in production builds.",{icon:"/system/resource/themes/default/icons/misc/woozy.png",title:"Sorry"});else{t=this.createWindow({initialWidth:260,initialHeight:310,resizable:!1,title:"Product registration",taskbar:!0,center:!0,bodyClass:"keymgr",icon:i.Q.getIconUrl("apps/keymgr","small"),controlBoxStyle:"WS_CBX_MINCLOSE"},!0);const e=t.getBodyContainer();e.innerHTML='\n\t\t\t\t<div>\n\t\t\t\t\t<span class="line">Enter the product key you have received on Patreon below to activate Windows 96.</span>\n\t\t\t\t\t<textarea spellcheck="false" class="km-keyinput" placeholder="AAAAA-BBBBB-CCCCC-DDDDD-EEEEE\nFFFFF-GGGGG-HHHHH-IIIII-JJJJJ\n..."></textarea>\n\t\t\t\t\t<button class="w96-button km-register">Register</button>\n\t\t\t\t</div>\n\t\t\t',e.classList.add("keymgr-register");let n=e.querySelector(".km-keyinput");e.querySelector(".km-register").onclick=async()=>{(await(0,r.Tn)(n.value)).valid?(localStorage.setItem("product-key",n.value),new Audio("/system/resource/sounds/tada.mp3").play(),o.O.alert("Thanks for your support!",{icon:i.Q.getIconUrl("check"),title:"Product registration"}),t.close()):o.O.alert("Your product key is invalid.",{icon:"error"})},t.show()}}}},7398:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MDViewApplication:()=>c});var s=n(4186),i=n(7366),o=n(4876),r=n(9338),a=n(5784),l=n(4420);n(6999);class c extends s.WApplication{constructor(){super()}async main(e){super.main(e),null!=e[0]?this._createWindow(e[0]):new r.MT("c:/",["md","MD"],(e=>{e?this._createWindow(e):this.terminate()})).show()}_createWindow(e){var t=new i.Lw;t.title=o.R.fname(e)+" - MD Viewer",t.initialWidth=470,t.initialHeight=400;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar();var s=new showdown.Converter;n.setHtml('<div class="mdview-container"></div>'),n.setWindowIcon(l.Q.getIconUrl("small/apps/mdview"));const r=n.wndObject.querySelector(".mdview-container");a.FS.readstr(e).then((e=>{r.innerHTML=s.makeHtml(e)})),n.show()}}},2434:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NoTronApplication:()=>d});var s=n(9338),i=n(4420),o=n(6999),r=n(7366),a=n(5784),l=n(8223);const{WApplication:c}=n(4186);class d extends c{constructor(){super()}main(e){super.main(e);const t=new r.Lw;t.initialHeight=410,t.initialWidth=505,t.title="noTRON Anti-Virus: Professional Deluxe Edition";const n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setWindowIcon(i.Q.getIconUrl("small/apps/notron")),n.setHtml('<div class="appbar"></div>\n<div class="container">\n    <div class="progress-box">\n        <span>Operation in progress, please wait...</span>\n    </div>\n    <span class="htext">How may we help you today?</span> \n    <div class="nav-options">\n        <div class="option close-active">\n            <div class="icon" style="background-image: url(/system/resource/themes/default/icons/ram.png);"></div>\n            <div class="text">\n                <span class="title">Close all active apps</span>\n                <span class="desc">Free up computer memory by closing everything</span>\n            </div>\n        </div>\n        <div class="option clear-boot">\n            <div class="icon" style="background-image: url(/system/resource/themes/default/icons/trash-full.png);"></div>\n            <div class="text">\n                <span class="title">Clear boot items</span>\n                <span class="desc">Permanently remove all boot scripts/themes, etc.</span>\n            </div>\n        </div>\n        <div class="option del-malicious">\n            <div class="icon" style="background-image: url(/system/resource/themes/default/icons/misc/troll.png);"></div>\n            <div class="text">\n                <span class="title">Find and destroy malicious scripts (BETA)</span>\n                <span class="desc">Exactly what the title says.</span>\n            </div>\n        </div>\n        <div class="option del-win96">\n            <div class="icon" style="background-image: url(/system/resource/themes/default/icons/misc/skull.png);"></div>\n            <div class="text">\n                <span class="title">Delete Windows 96</span>\n                <span class="desc">Completely wipe your installation.</span>\n            </div>\n        </div>\n    </div>\n</div>');const c=n.getBodyContainer();c.classList.add("notron-app");const d=new o.j;d.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]),d.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{s.jC.info("About noTRON AV PRO",'<span class="bold-noaa">noTRON AV Pro Deluxe Edition</span><br>Version 1.0<br>',"OK")}}]),c.querySelector(".appbar").replaceWith(d.getMenuDiv()),c.querySelector(".close-active").addEventListener("click",(()=>{this.setBusy(!0),r.C$.closeAllWindows(!1),this.setBusy(!1)})),c.querySelector(".clear-boot").addEventListener("click",(()=>{this.setBusy(!0),s.jC.confirm("Are you sure you want to do this?",(async e=>{if(!e)return this.setBusy(!1);try{await a.FS.rmdir("c:/system/boot"),await a.FS.mkdir("c:/system/boot"),await a.FS.mkdir("c:/system/boot/apps"),s.jC.info("Done","/system/boot has successfully been cleared.","Thanks")}catch(e){s.jC.error("Error",e.toString(),"OK")}this.setBusy(!1)}))})),c.querySelector(".del-malicious").addEventListener("click",(()=>{this.setBusy(!0),s.jC.confirm("We will have to DL a script for the latest JSMRT program.<br><br>NOTE: THIS IS BETA SOFTWARE! You may LOSE your data! Continue at your own risk.",(async e=>{try{await l.a.loadlibAsync("https://cdn.windows96.net/beta/jsmrt.js")}catch(e){}this.setBusy(!1)}),"info").setSize(333,156).dlg.center()})),c.querySelector(".del-win96").addEventListener("click",(()=>{this.setBusy(!0),s.jC.confirm("Are you sure? YOU WILL LOSE EVERYTHING WITHOUT RECOVERY.",(async e=>{if(!e)return this.setBusy(!1);try{for(let e of a.FS.readdir("C:/"))try{0==a.FS.filetype(e)?await a.FS.rm(e):await a.FS.rmdir(e)}catch(t){console.error("Failed to delete: "+e)}s.jC.info("Done","System has been wiped, reboot will occur in 5 seconds.","Thanks"),setTimeout((()=>document.location.reload()),5e3)}catch(e){s.jC.error("Error",e.toString(),"OK")}this.setBusy(!1)}))})),n.show(),this.appWnd=n}setBusy(e){e?this.appWnd.getBodyContainer().querySelector(".container").classList.add("busy"):this.appWnd.getBodyContainer().querySelector(".container").classList.remove("busy")}}},4016:(e,t,n)=>{"use strict";n.r(t),n.d(t,{OpenWithApplication:()=>u});var s=n(9338),i=(n(4779),n(7366)),o=n(5784),r=n(3978),a=n(7362),l=n(5516),c=n(120),d=n(4186);const p=["openwith","about-ui","__exe","wasmrt","devtools","__lnk","__support-us","dd","hterm","dynwp-prefs","mpmenu","wpa","credits","runlnk42","effects","dyk","uploader","jslinux","terminal","settings","wiki96","blocks","win96-chat","gltest","gameing","vm","server-stat","shareboard","notron","youare","pumkin","avabot","winspector","bsod","meme-man","matrix","winmp96","base64"];class u extends d.WApplication{constructor(){super()}main(e){if(super.main(e),null==e[0])return void s.jC.error("Error","You are doing this wrong.","wat");if(!o.FS.exists(e[0]))return void s.jC.error("Error","Cannot find the file to open!","OK");const t=new i.Lw;t.initialHeight=340,t.initialWidth=430,t.title="Open With",t.resizable=!1;const n=this.createWindow(t,!0);n.registerWindow(),n.setControlBoxStyle("WS_CBX_CLOSE");const l=n.getBodyContainer();l.classList.add("openwith-app"),l.innerHTML=`<div class="top">\n            <div class="icon"></div>\n            <div class="text">\n                Choose the program you want to use to open this file:<br>\n                <br>\n                File: ${r.V.escapeHtml(o.FSUtil.fname(e[0]))}\n            </div>\n        </div>\n        \n        <div class="box">\n            <div class="appbox"></div>\n        </div>\n\n        <div class="bottom">\n            <div class="cmd-box">\n                <span class="bold-noaa">Custom command</span>\n                <input class="w96-textbox custom-cmd">\n            </div>\n            <div class="dlg-buttons">\n                <button class="w96-button ok">OK</button>\n                <button class="w96-button cancel">Cancel</button>\n            </div>\n        </div>`,l.querySelector(".dlg-buttons>.cancel").addEventListener("click",(()=>this.terminate())),l.querySelector(".dlg-buttons>.ok").addEventListener("click",(()=>{if(""!=l.querySelector(".custom-cmd").value.trim())this.procCustomCmd(e);else if(null!=this.selectedItem){try{(0,a.lw)(this.selectedItem,e)}catch(e){console.error(e)}this.terminate()}})),l.querySelector(".custom-cmd").addEventListener("keydown",(t=>{"Enter"==t.key&&this.procCustomCmd(e)}));const c=l.querySelector(".appbox");for(let t of(0,a.V7)()){if(p.includes(t))continue;const n=document.createElement("div");n.classList.add("item");const s=document.createElement("div");s.classList.add("icon"),n.appendChild(s);const i=document.createElement("div");i.classList.add("text"),i.innerText=t,n.appendChild(i),n.addEventListener("click",(()=>{l.querySelectorAll(".appbox>.item").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),this.selectedItem=t})),n.addEventListener("dblclick",(()=>{try{(0,a.lw)(this.selectedItem,e)}catch(e){console.error(e)}this.terminate()}));const o=(0,a.nt)(t);o&&(i.innerText=o.friendlyName,s.style.backgroundImage=`url(${o.icon})`,c.appendChild(n))}n.show(),n.center(),this.mainwnd=n}procCustomCmd(e){const t=this.mainwnd.getBodyContainer().querySelector(".custom-cmd"),n=c.A.parse(t.value);try{l.x.execCmd(n[0],e)}catch(e){s.jC.error("Error",String(e),"OK")}this.terminate()}}},4821:(e,t,n)=>{"use strict";n.d(t,{h:()=>S,p:()=>h});var s=n(4186),i=(n(7366),n(5784)),o=n(4420),r=n(4871),a=n(5544),l=n(7839),c=n(8423),d=n(5516),p=n(8041),u=n(3978);const h="C:/system/config/p3.json",m=o.Q.getIconUrl("apps/p3/online","small"),_=o.Q.getIconUrl("apps/p3/connecting","small","gif"),w=(o.Q.getIconUrl("apps/p3/offline","small"),o.Q.getIconUrl("apps/p3/error","small")),y=o.Q.getIconUrl("apps/p3/online-send","small"),b=o.Q.getIconUrl("apps/p3/online-receive","small"),g="p3_latency_test";let f,v,E=!1,k=null;class S extends s.WApplication{constructor(){super()}async main(e){if(super.main(e),this._p3=w96.net.p3,e.includes("--notray")||this._createTray(),e.includes("--tray")||this._createWindow(),!E){E=!0;const e=async e=>{e.data===g&&await this._p3.send(`${e.source}:119`,g+" ok"),e.data===g+" ok"&&k&&k(e)};this._p3.listen(119,e)}}_createTray(){f||(setInterval((()=>this._updateTray()),500),f=new r.K("p3_status",m),f.onclick=()=>{v?(v.close(),v=null):d.x.execCmd("p3",["--notray"])},this._p3.on("_send",(()=>{this._p3.connected&&f.setIcon(y)})),this._p3.on("_receive",(()=>{this._p3.connected&&f.setIcon(b)})),this._p3.on("connecting",(()=>{this._updateTray()})),c.e.registerNotifyIcon(f)),this._trayMode=!0}_createWindow(){if(v)return;const e=this._p3,t=this.createWindow({resizable:!1,center:!0,initialHeight:290,initialWidth:300,title:"P3 Settings",taskbar:!0,bodyClass:"p3-app",icon:m,controlBoxStyle:"WS_CBX_CLOSE"},!0);this._wnd=t,v=t;const n=t.getBodyContainer(),s=new a.a;let o,r,c,d,_,w,y,b,f,E={relayServer:l.d8.RELAY_SERVER,secret:w96.net.P3Connection.randomSecret(),autoconnect:!1};const S=s.addPage("Auth",(async t=>{t.innerHTML='\n                <span>P3 (Pseudo Peer-to-Peer or PPP) allows Windows 96 programs to communicate using a relay server.</span>\n                <div class="p3-status-div">\n                    <span class="bold-noaa">Status:</span>\n                    <div class="p3-status"></div>\n                    <span class="p3-status-text">N/A</span>\n                </div>\n                <div style="display: flex; margin-top: 4px">Connect on startup<div class="w96-chkbox p3-autoconnect" style="margin-left: auto"><div class="box"></div></div></div>\n                <p class="bold-noaa">Relay URL</p>\n                <input type="text" class="p3-relay w96-textbox" placeholder="ws://host:11096">\n                <p class="bold-noaa">Parameters</p>\n                <input type="password" class="p3-secret w96-textbox" placeholder="Enter a long password...">\n                <p class="bold-noaa">Address</p>\n                <input type="text" class="p3-address w96-textbox" placeholder="Click Connect to resolve..." readonly disabled>\n\n                <div style="margin-top: 10px; float: right">\n                    <button class="w96-button p3-connect">Connect</button>\n                    <button class="w96-button p3-save" disabled>Apply</button>\n                    <button class="w96-button p3-save-exit">OK</button>\n                </div>',i.FS.exists(h)&&(E=JSON.parse(await i.FS.readstr(h))),f=t.querySelector(".p3-autoconnect>.box"),E.autoconnect&&f.classList.add("checked"),f.onclick=()=>{E.autoconnect?f.classList.remove("checked"):f.classList.add("checked"),E.autoconnect=!E.autoconnect,o.removeAttribute("disabled")},b=t.querySelector(".p3-status"),b.style.color=e.connected?"#0a0":"#a00",y=t.querySelector(".p3-status-text"),y.textContent=e.connected?"Online":"Offline",_=t.querySelector(".p3-relay"),_.value=E.relayServer,_.onkeyup=()=>{E.relayServer!=_.value&&o.removeAttribute("disabled"),E.relayServer=_.value},w=t.querySelector(".p3-address"),d=t.querySelector(".p3-secret"),d.value=E.secret,d.onkeyup=e=>{E.secret!=d.value&&o.removeAttribute("disabled"),E.secret=d.value,w.value=""},d.onfocus=()=>{d.setAttribute("type","text")},d.onblur=()=>{d.setAttribute("type","password")},c=t.querySelector(".p3-connect"),c.onclick=()=>{e.server=E.relayServer,e.secret=E.secret,e.connected?w96.net.p3.disconnect():w96.net.p3.connect(),this._updateStatus()},o=t.querySelector(".p3-save"),o.onclick=async()=>{await i.FS.writestr(h,JSON.stringify(E)),o.setAttribute("disabled","")},r=t.querySelector(".p3-save-exit"),r.onclick=async()=>{await o.onclick(),this.ontermination()},this._el={btnSave:o,btnConnect:c,inputSecret:d,inputRelay:_,inputAddress:w,statusText:y,statusDot:b,checkAutoconnect:f},this._updateStatus()}));this._onConnect=e=>{w.value=e.address,c.removeAttribute("disabled"),this._updateStatus()},this._onError=e=>{c.removeAttribute("disabled"),p.O.alert(u.V.escapeHtml(e.message),{title:"P3 Connection Failed",icon:"error"}).wnd.wndObject.classList.add("p3-message"),this._updateStatus()},this._onDisconnect=()=>{c.removeAttribute("disabled"),this._updateStatus()},e.on("connect",this._onConnect),e.on("error",this._onError),e.on("disconnect",this._onDisconnect),s.addPage("Diagnostics",(async t=>{t.innerHTML='<span class="bold-noaa" style="display: block">Latency</span>\n            <span style="display: block">Enter a P3 client address below to test latency.</span>\n            <div class="p3-combo-btn-wrap">\n                <input type="text" class="p3-latency w96-textbox" placeholder="example.ppp">\n                <button class="p3-latency-btn w96-button">Test</button>\n            </div>\n            <span class="bold-noaa" style="display: block">Ports</span>\n            <span style="display: block">This a list of ports currently in use.</span>\n            <div class="p3-port-list">\n                <div class="legend">\n                    <span class="port">Port</span>\n                    <span class="flags">Flags</span>\n                    <span class="type">Type</span>\n                </div>\n            </div>';let n=t.querySelector(".p3-latency"),s=t.querySelector(".p3-latency-btn");n.onkeydown=e=>{13===e.keyCode&&s.onclick()},s.onclick=async()=>{let t,i,o=n.value.trim();if(o){if(!e.connected)return p.O.alert("You must be connected to test latency.");s.setAttribute("disabled",""),k=e=>{e.source===o&&(alert(`Client-Server time: ${i-t}ms<br>Client-Target time: ${Date.now()-t}ms`),k=null,s.removeAttribute("disabled"))},t=Date.now();try{await e.send(`${o}:119`,g)}catch(e){p.O.alert(u.V.escapeHtml(e),{title:"P3 Error",icon:"error"}),s.removeAttribute("disabled")}i=Date.now()}};let i=t.querySelector(".p3-port-list");for(const t in e.ports){const n=e.ports[t];let s=document.createElement("div");s.innerHTML=`<span class="port">${u.V.escapeHtml(t)}</span>\n                <span class="flags">${u.V.escapeHtml(n.flags?n.flags.join(","):"none")}</span>\n                <span class="type">${n.public?"public":"private"}</span>`,s.classList.add("port-row",n.public?"public":"private"),i.appendChild(s)}})),s.addPage("Peers",(async t=>{t.innerHTML='<span class="bold-noaa" style="display: block">Discover</span>\n            <span style="display: block">Enter one or more flags (comma-separated) below to search for online peers.</span>\n            <div class="p3-combo-btn-wrap">\n                <input type="text" class="p3-flags w96-textbox" placeholder="Enter flags here...">\n                <button class="p3-find-btn w96-button">Find</button>\n            </div>\n            <div class="p3-port-list p3-peers">\n                <div class="legend">\n                    <span class="address">Address</span>\n                    <span class="port">Port</span>\n                    <span class="flags">Flags</span>\n                </div>\n            </div>';let n=t.querySelector(".p3-port-list"),s=t.querySelector(".p3-flags"),i=t.querySelector(".p3-find-btn");s.onkeydown=e=>{13===e.keyCode&&i.onclick()},i.onclick=async()=>{let{value:t}=s,i=t.trim().split(",").map((e=>e.trim())).filter((e=>""!==e));if(0!=i.length){let t;n.querySelectorAll(".port-row").forEach((e=>e.remove()));try{t=await e.discover(i,10)}catch(e){return p.O.alert("P3 Discover Error:\n"+u.V.escapeHtml(e),{title:"P3 Discover",icon:"error"})}if(0===t.length)return p.O.alert("No peers found!",{title:"P3 Discover"});t.forEach((e=>{let t=document.createElement("div");t.innerHTML=`<span class="address">${u.V.escapeHtml(e.address)}</span>\n                        <span class="port">${u.V.escapeHtml(e.port)}</span>\n                        <span class="flags">${u.V.escapeHtml(e.flags.join(","))}</span>`,t.classList.add("port-row"),n.appendChild(t)}))}}})),s.setSize("100%","100%"),n.appendChild(s.getElement()),t.show(),s.openPage(S)}_updateTray(){if(f){if(!this._p3.connected&&!this._p3.connecting)return f.notifyElement.style.display="none";f.notifyElement.style.display="",this._p3.connecting?f.setIcon(_):this._p3.connected?f.setIcon(m):this._p3.error&&f.setIcon(w)}}_updateStatus(){this._p3.connecting?(this._el.btnConnect.setAttribute("disabled",""),this._disableInputs(),this._el.statusDot.style.color="#a50",this._el.statusText.textContent="Connecting...",this._el.btnConnect.textContent="Disconnect"):this._p3.connected?(this._disableInputs(),this._el.btnConnect.removeAttribute("disabled"),this._el.statusDot.style.color="#0a0",this._el.statusText.textContent="Online",this._el.btnConnect.textContent="Disconnect",this._el.inputAddress.value=this._p3.address,f||(this._createTray(),this._updateTray())):(this._disableInputs(!1),this._el.btnConnect.removeAttribute("disabled"),this._el.statusDot.style.color="#a00",this._el.statusText.textContent=this._p3.error?"Error":"Offline",this._el.btnConnect.textContent="Connect"),this._updateTray()}_disableInputs(e=!0){e?(this._el.inputRelay.setAttribute("disabled",""),this._el.inputSecret.setAttribute("disabled","")):(this._el.inputRelay.removeAttribute("disabled"),this._el.inputSecret.removeAttribute("disabled"))}ontermination(){this._p3.removeEventListener("connect",this._onConnect),this._p3.removeEventListener("error",this._onError),this._p3.removeEventListener("disconnect",this._onDisconnect),this._el=null,v=null,super.ontermination()}}},2430:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SuperTermApplication:()=>d});var s=n(4186),i=n(4420),o=n(6999),r=n(8041),a=n(3078),l=n(8516),c=n(4367);class d extends s.WApplication{constructor(){super()}async main(e){super.main(e),this.p3=w96.net.p3,this.connection={address:null,name:null,socket:null};const t=e=>!!this.connection.socket,n=this.createWindow({initialWidth:520,initialHeight:350,title:"SuperTerm",taskbar:!0,bodyClass:"superterm",icon:i.Q.getIconUrl("apps/superterm","small"),controlBoxStyle:"WS_CBX_MINMAXCLOSE"},!0),s=new o.j;s.addRoot("File",[{type:"normal",label:"Create shortcut",onopened:t,onclick:()=>{l.b.mkShortcut(`c:/user/desktop/${this.connection.name}.link`,"apps/superterm",`superterm --connection ${this.connection.name}\n${this.connection.address}\n${this.el.term.style.color}\n${this.el.term.style.backgroundColor}`),c.C.updateDesktop(),r.O.alert("Shortcut created on your desktop.",{title:"Create shortcut",icon:"info"})}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.ontermination()}}]),s.addRoot("Connection",[{type:"normal",label:"New connection...",onclick:()=>{this._newConnectionDialog()}},{type:"separator"},{type:"normal",label:"Connect",onopened:e=>(e.textContent=this.connection.socket&&this.connection.socket.connected?"Disconnect":"Connect",t()),onclick:()=>{this.connection.socket.connected?this.disconnect(!0):this.reconnect()}},{type:"normal",label:"End",onopened:t,onclick:()=>{this.disconnect()}}]),s.addRoot("View",[{type:"normal",label:"Clear history",onclick:()=>{this.el.term.innerHTML=""}},{type:"separator"},{type:"submenu",label:"Color scheme...",items:[{type:"normal",label:"Green on black",onclick:()=>this.setTheme("#0f0","#000")},{type:"normal",label:"Black on white",onclick:()=>this.setTheme("#000","#fff")},{type:"normal",label:"Light blue on gray",onclick:()=>this.setTheme("#dff","#222")}]}],!1),s.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{r.O.alert('\n\t\t\t\t\t\t<span class="bold-noaa">SuperTerm</span><br>\n\t\t\t\t\t\t<span>Version 1.0</span>',{title:"About",icon:"info"})}}]);const a=n.getBodyContainer();a.innerHTML='\n\t\t\t<div class="appbar"></div>\n\t\t\t<div class="term w96-inset"></div>\n\t\t\t<input type="text" class="input w96-textbox" disabled>\n\t\t';let d=s.getMenuDiv();a.querySelector(".appbar").replaceWith(d);let p=document.createElement("div");if(p.classList.add("superterm-activity"),p.title="Input/Output",d.appendChild(p),this.wnd=n,this.el={term:a.querySelector(".term"),input:a.querySelector(".input"),activity:p},this.el.input.onkeydown=e=>{"Enter"==e.key&&this.connection.socket.connected&&(this.setActivityLight("input"),this.connection.socket.send(["input",this.el.input.value.trim()]),e.shiftKey||(this.el.input.value=""))},"--connection"===e[0]){let t=e.slice(1).join(" ").split("\n");this.connect(t[0],t[1]),this.setTheme(t[2],t[3])}this._updateTitle(),n.show()}setActivityLight(e){let t="#000";"input"==e&&(t="#0a0"),"output"==e&&(t="#a00");for(let e=0;e<2;e++)setTimeout((()=>{this.el.activity.style.background=t,setTimeout((()=>{this.el.activity.style.background=""}),150)}),200*e)}_newConnectionDialog(){const e=this.createWindow({initialWidth:260,initialHeight:202,title:"New Connection",taskbar:!1,center:!0,bodyClass:"superterm",controlBoxStyle:"WS_CBX_CLOSE",resizable:!1},!1),t=e.getBodyContainer();t.innerHTML=`\n\t\t\t<div class="mbox">\n\t\t\t<div class="content">\n\t\t\t\t<div class="icon" style="background-image:url(${i.Q.getIconUrl("apps/superterm","normal")}"></div>\n\t\t\t\t<div class="text">Enter an RToP address and a name for the connection:</div>\n\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="inputs">\n\t\t\t\t<span>Name:</span>\n\t\t\t\t<input type="text" class="input-name w96-textbox" value="New connection">\n\t\t\t\t<span>RToP address:</span>\n\t\t\t\t<input type="text" class="input-url w96-textbox" placeholder="address.ppp">\n\t\t\t\t\n\t\t\t\t<div class="separator w96-inset"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="buttons">\n\t\t\t\t<button class="w96-button btn-confirm" disabled>OK</button>\n\t\t\t\t<button class="w96-button btn-cancel">Cancel</button>\n\t\t\t</div>\n\t\t`;let n=e=>{s.value.trim()&&o.value.trim()?(a.removeAttribute("disabled"),"Enter"===e.key&&a.click()):a.setAttribute("disabled","true")},s=t.querySelector(".input-name"),o=t.querySelector(".input-url");s.onkeyup=n,o.onkeyup=n;let a=t.querySelector(".btn-confirm");a.onclick=()=>{let t=s.value.trim(),n=o.value.trim();this.connection.socket?r.O.alert("Are you sure you want to create a new connection? Your current session will be terminated.",{buttons:[{id:"ok",text:"OK",action:({dlg:s})=>{s.close(),e.close(),this.connect(t,n)}},{id:"cancel",text:"Cancel",action:({dlg:e})=>{e.close()}}],title:"Confirm",icon:"question"}):(e.close(),this.connect(t,n))},t.querySelector(".btn-cancel").onclick=()=>{e.close()},e.show(),o.focus()}_updateTitle(){const{socket:e}=this.connection;this.appWindow&&(this.connection.name?e?this.wnd.setTitle(`${this.connection.name} (${e.connected?"connected":"disconnected"}) - SuperTerm`):this.wnd.setTitle(`${this.connection.name} (dialing) - SuperTerm`):this.wnd.setTitle("SuperTerm"))}_onmessage([e,t]){if(this.setActivityLight("output"),"text"===e){if(t instanceof Array&&t.forEach((e=>{let t=document.createElement("span");"object"==typeof e&&(t.style.color=e.color,t.style.backgroundColor=e.background,t.textContent=e.text??"","string"==typeof e.onclick&&(t.onclick=()=>{this.connection.socket.connected&&(this.setActivityLight("input"),this.connection.socket.send(["click",e.onclick]))},t.classList.add("clickable"))),"string"==typeof e&&(t.textContent=e),this.el.term.appendChild(t)})),"string"==typeof t){let e=document.createElement("span");e.textContent=t,this.el.term.appendChild(e)}return this.el.term.scrollTop=this.el.term.scrollHeight}if("resize"==e){const{clientWidth:e,clientHeight:n}=document.body;let[s,i]=t;if(isNaN(s)||isNaN(i))return;return s>e&&(s=e),i>n&&(i=n),this.wnd.setSize(parseInt(s,10),parseInt(i,10))}return"clear"==e?this.el.term.innerHTML="":"focus"==e?this.el.input.focus():void 0}async connect(e,t){let n;this.connection.socket&&this.connection.socket.disconnect();let s=new URL(`http://${t}`);if(s.port||(s.port=121,t=s.host),this.connection={name:e,address:t,socket:null},this.el.term.innerHTML="",this._updateTitle(),!this.p3.connected&&!await a.e.p3Connect())return this.connection.name=null,void(this.connection.address=null);n=this.p3.createConnection(t),this.connection.socket=n,n.on("message",(e=>this._onmessage(e))),n.on("disconnect",(()=>{this._updateTitle(),this.el.input.setAttribute("disabled","true")}));try{await n.connect(),this.el.input.removeAttribute("disabled"),this._updateTitle()}catch(e){r.O.alert(`Error while connecting to ${this.connection.address}:\n${e.toString()}`,{title:"Error",icon:"error"}),this._updateTitle()}}disconnect(e=!1,t=!0){this.connection.socket&&this.connection.socket.connected&&this.connection.socket.disconnect(),e||(this.connection.name=null,this.connection.address=null,this.connection.socket=null),t&&this._updateTitle()}setTheme(e,t){this.el.term.style.color=e,this.el.term.style.backgroundColor=t}async reconnect(){if(this.connection.socket)return await this.connect(this.connection.name,this.connection.address)}ontermination(){super.ontermination(),this.disconnect(!0,!1)}}},9266:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});n(8041);var s=n(5784),i=n(3978);class o{constructor(){this.name="NULL",this.friendlyName="NULL",this.description="NULL",this.author="NULL",this.category="NULL",this.version=1,this.feature_requirements=[],this.min_os_version=2,this.max_os_version=9999,this.depends=[],this.iconFiles={"32x32":"/system/resource/themes/default/icons/exec.png","16x16":"/system/resource/themes/default/icons/small/exec.png"},this.repo="NULL",this.repoIndex=-1,this.repoId="",this.packageRoot=null}getSpecificName(){return`${this.name}:${this.repoId}`}}class r{constructor(){this.logger=console,this.srcConfig=null,this.packageCache=[],this.repoCache=[],this.unpackPathMappings=[{source:"unpack/root",dest:"c:"},{source:"unpack/app-boot",dest:"c:/system/boot/apps"},{source:"unpack/package_dir",dest:"c:/local/$pkname"},{source:"unpack/user_folder",dest:"c:/user"},{source:"unpack/appdata",dest:"c:/user/appdata/$pkname"}],this.onfailure=()=>{}}async checkFS(){this.logger.log("Package manager FS init...");const e=["c:/system/temp/pkg-dl","c:/system/packages","c:/system/packages/configs","c:/system/packages/installed","c:/system/packages/indexes","c:/system/log","c:/local"],t=[{path:"c:/system/packages/configs/sources.json",data:JSON.stringify({sources:["https://packages.windows96.net/main"],updateFrequency:2},null,4)}];for(let t of e)s.FS.exists(t)||await s.FS.mkdir(t);for(let e of t)s.FS.exists(e.path)||await s.FS.writestr(e.path,e.data);this.logger.log("Package manager FS init complete.")}async readSources(){try{return this.srcConfig=JSON.parse(await s.FS.readstr("c:/system/packages/configs/sources.json")),!0}catch(e){return!1}}resolveSourceFromIndex(e){return this.repoCache.find((t=>t.index==e))}getSourceIndexFromId(e){return this.repoCache.find((t=>t.id==e)).index}getPackage(e){let t=null;if(e.includes(":")){let n=e.split(":");t=n[1],e=n[0]}return(null!=t?this.packageCache.filter((e=>e.repoId==t)):this.packageCache).find((t=>t.name==e))}async getPackageInstallState(e){try{let t="@null";if(e.includes(":")){let n=e.split(":");t=n[1],e=n[0]}const n=`c:/system/packages/installed/${t}/${e}.json`;if(!s.FS.exists(n))return"NOT_INSTALLED";const i=await s.FS.readstr(n),r=Object.assign(new o,JSON.parse(i));return this.getPackage(r.getSpecificName()).version>r.version?"UPGRADEABLE":"INSTALLED"}catch(e){return"BROKEN"}}walkDependencies(e){const t=this.getPackage(e),n=[];for(let e of t.depends){let s=e.includes(":")?e:`${e}:${t.repoId}`;if(s==t.getSpecificName())throw new Error("Circular dependency error.");let i=this.getPackage(s);if(null!=i&&null!=i.name){for(let e of this.walkDependencies(i.getSpecificName()))n.push(e);n.push(i)}else n.push({unresolved:!0,item:e})}return n}async reloadPackageCache(){const e=[];let t=0;for(let n of this.srcConfig.sources){try{const r=await fetch(`${n}/Release.json`),a=await r.json();if(a.repo=n,a.index=t,null==a.id)throw new Error("Invalid 'id' in Release.json for source "+n);s.FS.exists("c:/system/packages/installed/"+a.id)||await s.FS.mkdir("c:/system/packages/installed/"+a.id);const l=await fetch(`${n}/Packages.json`),c=await l.json();await s.FS.writestr(`c:/system/packages/indexes/${t}.rel`,JSON.stringify(a)),await s.FS.writestr(`c:/system/packages/indexes/${t}.pack`,JSON.stringify(c)),this.repoCache.push(a);for(let s of c){if(!s.packageRoot)continue;s.repo=n,s.repoId=a.id,s.repoIndex=t,e.push(s.name);const r=Object.keys(s);for(let e of r)"string"==typeof s[e]&&(s[e]=i.V.escapeHtml(s[e]));let l=Object.assign(new o,s);l.iconFiles["16x16"]&&(l.iconFiles["16x16"]=l.iconFiles["16x16"].replace("$REPO_PATH$",n)),l.iconFiles["32x32"]&&(l.iconFiles["32x32"]=l.iconFiles["32x32"].replace("$REPO_PATH$",n)),l.packageRoot=l.packageRoot.replace("$REPO_PATH$",n),this.packageCache.push(l)}this.logger.log("Updating indexes for source "+n)}catch(e){this.onfailure({code:"cache_reload_failure",e})}t++}}async unpackContentZip(e,t,n=(()=>{})){const i=new JSZip;await i.loadAsync(e);const o=Object.keys(i.files);n({message:"Mapping paths..."});const r=[];for(let e of o)for(let n of this.unpackPathMappings)if(e.startsWith(n.source)){let s=e;s.startsWith("/")&&(s=s.substring(1)),s.endsWith("/")&&(s=s.substring(0,s.length-1));let o=s.replace(n.source,n.dest).replace("$pkname",t.name);if(2==o.length)continue;r.push({target:o,zipEntry:e,dir:i.files[e].dir})}for(let e of r){if(e.dir){n({message:`Create Dir ${e.target}`});continue}let t=s.FSUtil.getParentPath(e.target);2==t.length&&(t+="/"),s.FS.exists(t)||s.FS.mkdir(t),n({message:`Writing ${e.zipEntry} => ${e.target}`}),await s.FS.writebin(e.target,await i.files[e.zipEntry].async("uint8array"))}n({message:"Saving package meta and scripts..."}),await s.FS.writestr(`c:/system/packages/installed/${t.repoId}/${t.name}.json`,JSON.stringify(Object.assign(t,{zKeys:o}))),await s.FS.writebin(`c:/system/packages/installed/${t.repoId}/${t.name}_inst.js`,null!=i.files["scripts/install.js"]?await i.files["scripts/install.js"].async("uint8array"):[]),await s.FS.writebin(`c:/system/packages/installed/${t.repoId}/${t.name}_repair.js`,null!=i.files["scripts/repair.js"]?await i.files["scripts/repair.js"].async("uint8array"):[]),await s.FS.writebin(`c:/system/packages/installed/${t.repoId}/${t.name}_uninst.js`,null!=i.files["scripts/uninstall.js"]?await i.files["scripts/uninstall.js"].async("uint8array"):[])}async removePackage(e,t=(()=>{})){try{if(t({message:"Removing package `"+e.name+"`",type:"info"}),s.FS.exists(`c:/system/packages/installed/${e.repoId}/${e.name}_uninst.js`)){const t=await s.FS.readstr(`c:/system/packages/installed/${e.repoId}/${e.name}_uninst.js`);new Function(`const pm = this.pm; ${t}`).call({pm:this})}const n=JSON.parse(await s.FS.readstr(`c:/system/packages/installed/${e.repoId}/${e.name}.json`)).zKeys;t({message:"Remapping paths..."});const i=[];for(let t of n)for(let n of this.unpackPathMappings)if(t.startsWith(n.source)){let s=t;s.startsWith("/")&&(s=s.substring(1)),s.endsWith("/")&&(s=s.substring(0,s.length-1));let o=s.replace(n.source,n.dest).replace("$pkname",e.name);if(2==o.length)continue;i.push({target:o,zipEntry:t})}for(let e of i)try{s.FS.exists(e.target)&&s.FS.isFile(e.target)&&(t({message:`Deleting ${e.target}...`}),await s.FS.rm(e.target))}catch(n){t({message:`Failed to delete ${e.target}...`,type:"error"})}await s.FS.rm(`c:/system/packages/installed/${e.repoId}/${e.name}.json`),await s.FS.rm(`c:/system/packages/installed/${e.repoId}/${e.name}_inst.js`),await s.FS.rm(`c:/system/packages/installed/${e.repoId}/${e.name}_repair.js`),await s.FS.rm(`c:/system/packages/installed/${e.repoId}/${e.name}_uninst.js`)}catch(n){return t({message:"Error removing package `"+e.name+"`",type:"error"}),void this.onfailure({code:"pkg_remove_failure",e:n,pkg:e})}}async installPackage(e,t=(()=>{})){const n=[e,...this.walkDependencies(e.getSpecificName())];for(let e of n)try{t({message:"Fetching package `"+e.name+"`",type:"info"});let n=`${e.packageRoot}/content@${e.version.toFixed(1)}.zip`;t({message:`Getting content zip at ${n}`});const i=await fetch(n),o=await i.arrayBuffer();if(t({message:"Unpacking content zip...",type:"info"}),await this.unpackContentZip(o,e,t),t({message:"Executing install script...",type:"info"}),s.FS.exists(`c:/system/packages/installed/${e.repoId}/${e.name}_inst.js`)){const t=await s.FS.readstr(`c:/system/packages/installed/${e.repoId}/${e.name}_inst.js`);new Function(`const pm = this.pm; ${t}`).call({pm:this})}}catch(n){return t({message:"Error installing package `"+e.name+"`",type:"error"}),void this.onfailure({code:"pkg_install_failure",e:n,pkg:e})}}getPackagesByCategory(e){return"all"==e?this.packageCache:this.packageCache.filter((t=>t.category==e))}async performChecks(){await this.checkFS()}}},3361:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PackageManagerApplication:()=>m});var s=n(9338),i=n(8041),o=n(4420),r=n(4779),a=n(6999),l=n(254),c=n(5784),d=n(5516),p=n(4186),u=n(9266);const h=[{displayName:"(All)",id:"all",icon:o.Q.getIconUrl("misc/pkmgr/all","small")},{displayName:"Accessories",id:"accessories",icon:o.Q.getIconUrl("misc/pkmgr/accessories","small")},{displayName:"CLI",id:"cli",icon:o.Q.getIconUrl("misc/pkmgr/cli","small")},{displayName:"Development",id:"development",icon:o.Q.getIconUrl("misc/pkmgr/development","small")},{displayName:"Entertainment",id:"entertainment",icon:o.Q.getIconUrl("misc/pkmgr/entertainment","small")},{displayName:"Libraries",id:"libraries",icon:o.Q.getIconUrl("misc/pkmgr/libraries","small")},{displayName:"Productivity",id:"productivity",icon:o.Q.getIconUrl("misc/pkmgr/produc","small")},{displayName:"Social",id:"social",icon:o.Q.getIconUrl("misc/pkmgr/social","small")},{displayName:"System",id:"system",icon:o.Q.getIconUrl("misc/pkmgr/system","small")},{displayName:"Utilities",id:"utilities",icon:o.Q.getIconUrl("objects/tools","small")},{displayName:"Other",id:"other",icon:o.Q.getIconUrl("misc/pkmgr/other","small")}];class m extends p.WApplication{constructor(){super(),this.pm=new u.j,this.pm.onfailure=e=>{this.failureOccured=!0,this.lastFailureData=e,console.log(e)}}async setupFS(){await this.pm.checkFS()}async openCategory(e){const t=this.mainwnd.getBodyContainer();this.ui_currentCategory=e,this.catListBox.selectItem(e);const n=this.pm.getPackagesByCategory(e);this.pkgListBox.clear(),n.sort((function(e,t){if(!e||!t)return;let n=e.friendlyName.toLowerCase(),s=t.friendlyName.toLowerCase();return n>s?1:n<s?-1:0}));for(let e of n){const t=this.pkgListBox.addItem("",e.name);t.innerHTML='<div class="icon"></div><div class="content"><span class="name"></span><span class="desc"></span></div>',t.querySelector(".name").innerText=e.friendlyName+" ("+e.name+")",t.querySelector(".desc").innerText=e.description,t.querySelector(".icon").style.backgroundImage=`url(${e.iconFiles["32x32"]})`;const n=await this.pm.getPackageInstallState(e.getSpecificName());switch(n){case"INSTALLED":t.classList.add("installed");break;case"BROKEN":t.classList.add("broken");break;case"UPGRADEABLE":t.classList.add("upgradeable")}t.addEventListener("click",(()=>{this.displayPackageInfo(e,{installState:n})}))}const s=this.mainwnd.getBodyContainer().querySelector(".content>.view>.info");for(;s.firstChild;)s.removeChild(s.firstChild);t.querySelector(".w96-footer").innerText=1==n.length?"1 package listed":`${n.length} packages listed`}displayPackageInfo(e,t){const n=this.mainwnd.getBodyContainer(),s=n.querySelector(".content>.view>.info");for(;s.firstChild;)s.removeChild(s.firstChild);switch(s.innerHTML=`<span class="bold-noaa hdr">Actions</span>\n                              ${"INSTALLED"==t.installState?'<button class="w96-button remove">Remove</button>':"UPGRADEABLE"==t.installState?'<button class="w96-button upgrade">Upgrade</button><button class="w96-button remove">Remove</button>':"BROKEN"==t.installState?'<button class="w96-button force-remove">Force Remove</button>':'<button class="w96-button install">Install</button>'}\n                              <span class="bold-noaa hdr">Package Information</span>\n                              <span class="field"><span class="key">Name: </span>${e.name} (${e.friendlyName})</span>\n                              <span class="field"><span class="key">Description: </span>${e.description.replace("\n","<br>")}</span>\n                              <span class="field"><span class="key">Author: </span>${e.author}</span>\n                              <span class="field"><span class="key">Version: </span>${e.version.toFixed(1)}</span>\n                              <span class="field"><span class="key">Depends: </span>${e.depends}</span>`,t.installState){case"BROKEN":n.querySelector(".info>.w96-button.force-remove").addEventListener("click",(t=>{t.target.setAttribute("disabled",""),this.ui_forceRemove(e)}));break;case"NOT_INSTALLED":n.querySelector(".info>.w96-button.install").addEventListener("click",(t=>{t.target.setAttribute("disabled",""),this.ui_install(e)}));break;case"INSTALLED":n.querySelector(".info>.w96-button.remove").addEventListener("click",(t=>{t.target.setAttribute("disabled",""),this.ui_remove(e)}));break;case"UPGRADEABLE":n.querySelector(".info>.w96-button.remove").addEventListener("click",(t=>{t.target.setAttribute("disabled",""),this.ui_remove(e)})),n.querySelector(".info>.w96-button.upgrade").addEventListener("click",(t=>{t.target.setAttribute("disabled",""),this.ui_install(e)}))}}async ui_install(e){this.setBusy(!0);try{const t=this.pm.walkDependencies(e.getSpecificName()),n=[];for(let e of t)!e.unresolved&&e||n.push(e.item);if(n.length>0)return i.O.create({title:"Unresolved Dependencies",body:`Unable to install package due to unresolved dependencies.<br>\n                    <br>\n                    <span class="bold-noaa">Missing Packages</span>: ${n}<br>\n                    <br>\n                    You may have to add an additional source or otherwise reload your package indexes to resolve this problem.`,icon:"error",maxWidth:300,maxHeight:-1}),void this.setBusy(!1);i.O.create({title:"Package Manager",icon:"question",body:`Are you sure you want to install the following package?<br>\n                <br>\n                Please check the details below before continuing.<br>\n                <br>\n                <span class="bold-noaa">Package Name</span>: ${e.name}<br>\n                <span class="bold-noaa">Computed Dependencies</span>: ${t.map((e=>e.name))}`,buttons:[{id:"yes",text:"Yes",action:t=>{t.dlg.close(),this.ui_installing(e)}},{id:"no",text:"No",action:e=>{this.setBusy(!1),e.dlg.close()}}],maxWidth:460})}catch(e){s.jC.error("Error Installing Package",String(e),"OK")}}async ui_remove(e){this.setBusy(!0);try{s.jC.confirm(`Are you sure you want to remove the following package?<br>\n            <br>\n            Please check the details below before continuing.<br>\n            <br>\n            <span class="bold-noaa">Package Name</span>: ${e.name}<br>`,(t=>{t?this.ui_removing(e):this.setBusy(!1)}),"warning").setSize(422,155).dlg.center()}catch(e){s.jC.error("Error Removing Package",String(e),"OK")}}createStatusWindow(e,t="installer"){return this.createWindow({body:`\n                <div class="icon" style="background-image: url(${o.Q.getIconUrl(t)})"></div>\n                <div class="content">\n                    <div class="status-text">\n                        ${e}\n                    </div>\n\n                    <div class="w96-textbox log"></div>\n                </div>\n            `,bodyClass:"pmdlg-status",title:"Package Manager Status",center:!0,controlBoxStyle:"WS_CBX_NONE",initialHeight:240,initialWidth:340,resizable:!1},!1)}async ui_removing(e){this.resetFail();const t=this.createStatusWindow("Removing package, please wait...","trash-full");t.show();const n=t.getBodyContainer().querySelector(".log");function s(e,t){const s=document.createElement("div");s.classList.add("line"),t&&s.setAttribute("style",t),s.innerHTML=e,n.appendChild(s),n.scrollTop=n.scrollHeight}if(s("Package Manager started at "+(new Date).toString()+"\n\n"),await this.pm.removePackage(e,(e=>{s(e.message)})),this.failureOccured)i.O.create({icon:"error",body:"Error removing package. Please check the logs for more information."});else{let e=i.O.create({title:"Complete",body:"The package(s) were successfully removed.",buttons:[{id:"ok",text:"OK",action:()=>{t.close(),e.close(),this.openCategory(this.ui_currentCategory)}}],icon:"info"})}this.setBusy(!1)}async ui_installing(e){this.resetFail();const t=this.createStatusWindow("Installing package, please wait...");t.show();const n=t.getBodyContainer().querySelector(".log");function s(e,t){const s=document.createElement("div");s.classList.add("line"),t&&s.setAttribute("style",t),s.innerHTML=e,n.appendChild(s),n.scrollTop=n.scrollHeight}if(s("Package Manager started at "+(new Date).toString()+"\n\n"),s("Recalculating dependencies before installation..."),await this.pm.installPackage(e,(e=>{s(e.message)})),this.failureOccured)i.O.create({icon:"error",body:"Error installing package. Please check the logs for more information."});else{let e=i.O.create({title:"Complete",body:"The package(s) were successfully installed.",buttons:[{id:"ok",text:"OK",action:()=>{t.close(),e.close(),this.openCategory(this.ui_currentCategory)}}],icon:"info"})}this.setBusy(!1)}ui_forceRemove(e){this.setBusy(!0),s.jC.confirm("Are you sure you want to continue?<br><br>If you force remove this package, only the meta files will be deleted.",(t=>{t&&c.FS.rm(`c:/system/packages/installed/${e.repoId}/${e.name}.json`),this.setBusy(!1),this.openCategory(this.ui_currentCategory)})).setSize(322,135).dlg.center()}async initUI(){if(!await this.pm.readSources())return void s.jC.error("Error","Could not read package sources, press OK to exit.","OK");const e=this.createWindow({title:"Package Manager",center:!0,body:'<div class="appbar"></div>\n            <div class="content">\n                <div class="aside">\n                    <span class="bold-noaa">Categories</span>\n                    <div class="w96-listbox">\n                        <div class="item">\n                            Yes\n                        </div>\n                    </div>\n                </div>\n                <div class="view">\n                    <span class="bold-noaa">Packages</span>\n                    <div class="packages"></div>\n                    <div class="info"></div>\n                </div>\n            </div>\n            <footer class="w96-footer">\n                0 packages listed\n            </footer>',bodyClass:"pkmgr-app",taskbar:!0,icon:o.Q.getIconUrl("apps/pkmgr","small"),initialWidth:572,initialHeight:397},!0),t=e.getBodyContainer(),n=new a.j;n.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>this.terminate()}]),n.addRoot("View",[{type:"normal",label:"Refresh",onclick:()=>this.openCategory(this.ui_currentCategory)}]),n.addRoot("Tools",[{type:"normal",label:"Open Package Stores",onclick:()=>l.l.execFile("c:/system/packages")},{type:"normal",label:"Edit Sources",onclick:()=>l.l.execFile("c:/system/packages/configs/sources.json")}]),n.addRoot("Help",[{type:"normal",label:"About",onclick:()=>i.O.create({body:'<span class="bold-noaa">Package Manager 1.0</span><br><br>Copyright (C) Windows 96 Team 2021.',icon:"info",title:"About"})}]),t.querySelector(".appbar").replaceWith(n.getMenuDiv());const c=new r.w;for(let e of h){const t=c.addItem(e.displayName,e.id),n=document.createElement("div");n.style.backgroundImage=`url(${e.icon})`,n.classList.add("icon"),t.insertAdjacentElement("afterbegin",n),t.addEventListener("click",(()=>this.openCategory(e.id)))}t.querySelector(".aside>.w96-listbox").replaceWith(c.getElement()),this.catListBox=c;const p=new r.w,u=p.getElement();u.classList.add("packages"),t.querySelector(".view>.packages").replaceWith(u),this.pkgListBox=p,e.onclose=e=>{if(this.busy)return e.canceled=!0;d.x.wmem.pkRunning=!1},e.show(),this.mainwnd=e}async reloadPackages(){if(this.packages=[],this.failureOccured=!1,this.setBusy(!0),null==this.pm.srcConfig.sources||this.pm.srcConfig.sources.length<0)return s.jC.error("Error","No sources are available.","OK"),this.terminate();await this.pm.reloadPackageCache(),this.failureOccured&&(s.jC.error("Error","One or more sources failed to refresh.<br><br>Old indexes will be used instead, but you may encounter errors installing packages.","OK").setSize(322,135),this.resetFail()),this.setBusy(!1)}setBusy(e){const t=this.mainwnd.getBodyContainer();this.busy=e,this.busy?this.mainwnd.getBodyContainer().classList.add("busy"):(this.mainwnd.getBodyContainer().classList.remove("busy"),t.querySelectorAll(".info>.w96-button").forEach((e=>e.removeAttribute("disabled"))))}resetFail(){this.failureOccured=!1,this.lastFailureData=null}async main(e){if(super.main(e),d.x.wmem.pkRunning)return void s.jC.error("Error","Only 1 instance may be running!","OK");d.x.wmem.pkRunning=!0,this.packages=[],await this.setupFS(),await this.initUI();const t=s.jC.idleProgress("Package Manager","Reloading sources, please wait...");try{this.progress=t,await this.reloadPackages()}catch(e){console.log(e),s.jC.error("Error","Failed reloading packages. Please check your internet connection.","OK")}t.closeDialog(),this.progress=null,this.openCategory("all"),this.mainwnd.activate(),"true"!=localStorage.getItem("pkmgrui_wdone")&&(i.O.create({title:"Welcome",body:'<span class="bold-noaa">Welcome to the package manager!</span><br><br>\n                Software on your disk is organized in packages, which are usually software/addons, but can be anything really.<br><br>\n                It is recommended to only install what you need, it is easy to fill up your disk space with too much installed.<br><br>\n                <span style="color: darkred">\n                Packages served outside the official repository could be malicious! As with any software, use it at your own risk!\n                </span>',maxWidth:320,icon:"info"}),localStorage.setItem("pkmgrui_wdone","true"))}ontermination(){super.ontermination(),this.pm=null}}},8239:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SettingsApplication:()=>SettingsApplication});var _wapp__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4186),_gui_wndsystem__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7366),_sys_fs_util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4876),_gui_commdlg__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9338),_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5784),_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4420),_gui_ui_components_menubar__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6999),_gui_ui_components_tabcontrol__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5544),_sys_util_crypto__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(8362),_gui_ui_components_listbox__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4779),_sys_os_tweaks__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4827),_sys_registry__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(7362),_gui_ui_components_groupbox__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2589),_sys_dev_mobile_mobcfg__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(4078),_sys_util_zip__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9182);const isDevBuild=!1;class SettingsApplication extends _wapp__WEBPACK_IMPORTED_MODULE_0__.WApplication{constructor(){super()}async main(e){super.main(e),this._blobsToDeregister=[],this._createWindow()}_createWindow(){const params=new _gui_wndsystem__WEBPACK_IMPORTED_MODULE_1__.Lw;params.draggable=!0,params.resizable=!0,params.initialHeight=420,params.initialWidth=610,params.minHeight=350,params.minWidth=410,params.title="Settings";const mainwnd=this.createWindow(params,!0);mainwnd.registerAppBar(),mainwnd.registerWindow(),mainwnd.setWindowIcon(_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_5__.Q.getIconUrl("small/apps/settings"));const htmlContainer=mainwnd.wndObject.querySelector(".window-html-content");htmlContainer.classList.add("settings-app");const tabc=new _gui_ui_components_tabcontrol__WEBPACK_IMPORTED_MODULE_7__.a,pageIdMain=tabc.addPage("Security",(async e=>{const t=JSON.parse(_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.exists("c:/system/config/SAM.json")?await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr("c:/system/config/SAM.json"):JSON.stringify({name:"user",pwd:null}));e.innerHTML=`\n            You can lock your current installation of Windows 96 with a password. This will prevent anyone from accessing the operating system unless they enter the correct password.\n            <br>\n            <br>When the system restarts, you will be asked to enter the password. Unless you are skilled, you will be forced to reset your installation if you forget your password!\n            <br><br>\n            Security status: ${null==t.pwd?'<span style="color: red;" class="bold-noaa">No password set.</span><br>':'<span style="color: green;" class="bold-noaa">Password protected.</span><br>'}\n            <br>\n            <span class="bold-noaa">What would you like to do?</span><br>\n            <div style="padding-left: 20px">\n                <br>\n                <span role="modify-pwd" class="w96-link-hv bold-noaa">&gt; Modify account password</span><br>\n            </div>`,e.style.padding="10px",e.querySelector('span[role="modify-pwd"]').onclick=()=>{_gui_commdlg__WEBPACK_IMPORTED_MODULE_3__.jC.prompt("Set password","Enter your new password below (keep empty to remove current password).","",(async e=>{if(null!=e){if(""==e.trim())return _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.exists("c:/system/config/SAM.json")&&_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.rm("c:/system/config/SAM.json"),_gui_commdlg__WEBPACK_IMPORTED_MODULE_3__.jC.info("Security","Your logon password was removed.","OK"),void tabc.openPage(pageIdMain);await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.writestr("c:/system/config/SAM.json",JSON.stringify({name:"user",pwd:(0,_sys_util_crypto__WEBPACK_IMPORTED_MODULE_14__.P)(e)})),_gui_commdlg__WEBPACK_IMPORTED_MODULE_3__.jC.info("Security","Your logon password has now been set.","OK"),tabc.openPage(pageIdMain)}})).wndObject.querySelector("input").type="password"}}));tabc.addPage("Wallpaper",(async e=>{e.innerHTML='\n            <div class="spanel-wp">\n                <div class="w96-panel bg"></div>\n                <div class="controls">\n                    <div class="field1 field">\n                        <span class="bold-noaa">Built-in wallpapers</span>\n                        <div>\n                            <select class="w96-textbox defaultwp-select-box"></select>\n                            <button class="w96-button builtin-reset-btn">Reset</button>  \n                            <button class="w96-button builtin-apply-btn">Apply</button>  \n                        </div>\n                    </div>\n                    <div class="field2 field">\n                        <span class="bold-noaa">Custom wallpaper</span>\n                        <div>\n                            <input class="w96-textbox custom-wp-pathbox" type="text" readonly>\n                            <button class="w96-button custom-browse-btn">Browse</button>  \n                        </div>\n                    </div>\n                    <div class="field3 field">\n                        <span class="bold-noaa">Dynamic wallpaper</span>\n                        <div>\n                            <button style="margin: 0" class="w96-button browse">Configure...</button>  \n                        </div>\n                    </div>\n                    <div class="field4 field">\n                        <span class="bold-noaa">Solid color wallpaper</span>\n                        <div>\n                            <button style="margin: 0; padding-right: 3px; padding-left: 3px" class="w96-button choosecolor">\n                                <div style="background: #000000; width: 35px; height: 15px;"></div>\n                            </button>\n                            <button class="w96-button builtin-apply-btn">Apply</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            ';const t=e.querySelector(".defaultwp-select-box"),n=e.querySelector(".w96-panel.bg");_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readdir("c:/system/wallpapers").forEach((e=>{const n=_sys_fs_util__WEBPACK_IMPORTED_MODULE_2__.R.fname(e),s=document.createElement("option");s.value=e,s.innerText=n,t.appendChild(s)})),t.onchange=async()=>{const e=t.options[t.selectedIndex].value;if(n.style.background="",e.endsWith(".cbg"))n.style.background=await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr(e);else{const t=await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.toBlob(e),s=URL.createObjectURL(t);this._blobsToDeregister.push(s),n.style.backgroundImage=`url(${s})`}},t.selectedIndex=0,t.onchange();e.querySelector(".builtin-apply-btn").onclick=()=>{this._setWallpaper(t.options[t.selectedIndex].value);const e=document.querySelector(".ui-bg-iframe");e&&e.remove()};e.querySelector(".builtin-reset-btn").onclick=()=>{document.querySelector(".user-desktop").style.background="";const e=document.querySelector(".ui-bg-iframe");e&&e.remove(),_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.writestr("c:/system/config/desktop.json",JSON.stringify({background:{type:"css",bg:""},misc:{hookMetaKeys:!1}}))};const s=e.querySelector(".custom-wp-pathbox");e.querySelector(".custom-browse-btn").onclick=()=>{new _gui_commdlg__WEBPACK_IMPORTED_MODULE_3__.MT("c:/system/wallpapers",[".jpg",".JPG",".png",".PNG",".gif",".GIF",".webp",".WEBP"],(e=>{e&&(s.value=e,this._setWallpaper(e))})).show()},e.querySelector(".field3 .browse").addEventListener("click",(()=>{(0,_sys_registry__WEBPACK_IMPORTED_MODULE_10__.lw)("dynwp-prefs",[])}));const i=e.querySelector(".field4 .choosecolor"),o=e.querySelector(".field4 .builtin-apply-btn"),r=i.querySelector("div"),a=JSON.parse(await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr("c:/system/config/desktop.json"));i.addEventListener("click",(()=>{let e=document.createElement("input");e.type="color",e.style.opacity="0%",e.value=r.style.background;let t=i.getBoundingClientRect();e.style.display="inline-block",e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px",document.body.appendChild(e),setTimeout((()=>{e.click(),setTimeout((()=>{e.style.left="-100px",e.style.top="-100px"}),100)}),100),e.onchange=()=>{document.body.removeChild(e),r.style.background=e.value}})),a.background.color&&(r.style.background=a.background.bg),o.onclick=()=>{const e=document.querySelector(".ui-bg-iframe");e&&e.remove(),_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.writestr("c:/system/config/desktop.json",JSON.stringify({background:{type:"css",bg:r.style.background,color:!0},misc:{hookMetaKeys:a.misc.hookMetaKeys}})),document.querySelector(".user-desktop").style.background=r.style.background}}));var themesLoading=!1;tabc.addPage("Themes",(async container=>{function parseTheme(e){var t=e.split("*/")[0].substring(3).split("\n").map((e=>{let t=e.substring(3).split(" ");return{property:t.shift().substring(1),val:t.join(" ")}}));t.pop();let n={};for(var s of t)s.val.startsWith('"')&&s.val.endsWith('"')&&(s.val=s.val.substring(1,s.val.length-1)),n[s.property]=s.val;return n}container.innerHTML='\n                <div class="spanel-wp">\n                    <div class="w96-panel bg" style="height: 175px; width: 254px;"></div>\n                    <div class="controls">\n                        <div class="field1 field">\n                            <span class="bold-noaa">Theme</span>\n                            <div>\n                                <select class="w96-textbox defaulttheme-select-box"></select>\n                                <button class="w96-button builtin-apply-btn">Apply</button>  \n                            </div><br/>\n                            <div class="w96-groupbox"></div>\n                        </div>\n                    </div>\n                </div>\n            ';let themes=[],dirs=await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readdir("W:/system/resource/themes").map((e=>e.substring(26))).filter((e=>".meta"!=e));for(var theme of dirs)themes.push({id:theme,file:await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr(`W:/system/resource/themes/${theme}/theme.js`)});themes=themes.map((e=>Object.assign({data:parseTheme(e.file)},e))),themes=[themes.find((e=>"default"==e.id))].concat(themes.filter((e=>"default"!=e.id)));let themeids=[...new Set(themes.map((e=>e.id)))];themes=themeids.map((e=>themes.find((t=>t.id==e))));const defaultWpSelectBox=container.querySelector(".defaulttheme-select-box"),currentEl=document.createElement("option");for(var theme of(currentEl.value="current",currentEl.innerText="Current",defaultWpSelectBox.appendChild(currentEl),themes)){const e=document.createElement("option");e.value=theme.id,e.innerText=theme.data["theme-name"],defaultWpSelectBox.appendChild(e)}function onOptionChange(e){if("current"==e){const e=new _gui_ui_components_groupbox__WEBPACK_IMPORTED_MODULE_11__.E({body:"It is just the current theme.",title:"Selected Theme"});return void container.querySelector(".w96-groupbox").replaceWith(e.getElement())}const t=themes.find((t=>t.id==e)),n=new _gui_ui_components_groupbox__WEBPACK_IMPORTED_MODULE_11__.E({body:`<span><span class="bold-noaa">Theme name: </span> ${t.data["theme-name"]}</span><br>\n                    <span><span class="bold-noaa">Theme Website: </span> <a href="${t.data["theme-website"]}" target=_blank>${t.data["theme-website"]}</a></span><br>\n                    <span><span class="bold-noaa">Theme Author: </span> ${t.data["theme-author"]}</span><br>\n                    <span><span class="bold-noaa">Theme ID: </span> ${t.id}</span>`,title:"Selected Theme"});container.querySelector(".w96-groupbox").replaceWith(n.getElement()),container.querySelector(".w96-panel.bg").style.backgroundImage=`url(/system/resource/themes/${t.id}/theme.png)`}onOptionChange("current"),defaultWpSelectBox.onchange=e=>{onOptionChange(e.target.value)};const applyBtn=container.querySelector(".builtin-apply-btn");let themeLoading=!1;applyBtn.onclick=async()=>{if(!themeLoading&&"current"!=defaultWpSelectBox.value){themeLoading=!0;var coverElem=document.createElement("div");coverElem.style.background="#000",coverElem.style.opacity="0%",coverElem.style.position="absolute",coverElem.style.top="0px",coverElem.style.left="0px",coverElem.style.width="100%",coverElem.style.height="100%",coverElem.style.zIndex="15000000000",coverElem.style.transition=".4s opacity",document.body.appendChild(coverElem);var sleep=e=>new Promise((t=>setTimeout(t,e)));await sleep(20),coverElem.style.opacity="100%",await sleep(400),w96.ui.Theme.unloadTheme(!1);var newTheme=themes.find((e=>e.id==defaultWpSelectBox.value));await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.writestr("c:/system/boot/theme.js","// System reserved!!\n// Do not touch this file! It will get overwritten by the theme selector.\n\n"+newTheme.file),eval(newTheme.file),await w96.ui.Theme.reloadDesktop(),await sleep(160),coverElem.style.opacity="0%",await sleep(400),themeLoading=!1,await sleep(10),document.body.removeChild(coverElem)}}})),tabc.addPage("Storage",(async e=>{const t=await async function(){try{return await navigator.storage.estimate()}catch(e){return{quota:-1,usage:0}}}();e.innerHTML='\n                <div class="groupbox"></div>\n            ';const n=new _gui_ui_components_groupbox__WEBPACK_IMPORTED_MODULE_11__.E({body:`<span><span class="bold-noaa">Main Storage Backend: </span> ${_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.get("c:").driverName}</span><br>\n                <span><span class="bold-noaa">Cumulative Used: </span> ${(t.usage/1024/1024).toFixed(0)} MB</span><br>\n                <span><span class="bold-noaa">Cumulative Free Space: </span> ${((t.quota-t.usage)/1024/1024).toFixed(0)} MB</span><br>\n                <span><span class="bold-noaa">Disks Mounted: </span> ${_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.list().length}</span>`,title:"Statistics"});e.querySelector(".groupbox").replaceWith(n.getElement())})),isDevBuild&&tabc.addPage("Tweaks",(e=>{e.innerHTML='Available Tweaks:\n            <div class="view">\n                <div class="listbox">\n                </div>\n                <div class="actions">\n                    <button class="w96-button toggle">Toggle</button>\n                    <button class="w96-button clear-all">Clear All</button>\n\n                    <button class="w96-button">Apply & Reboot</button>\n                </div>\n            </div>',e.classList.add("tweaks-tab");const t=new _gui_ui_components_listbox__WEBPACK_IMPORTED_MODULE_8__.w;for(let e of _sys_os_tweaks__WEBPACK_IMPORTED_MODULE_9__.X.availableTweaks){const n=t.addItem("Loading...");n.innerHTML=`<span class="bold-noaa">${e.name}</span><br>${e.description}`,n.addEventListener("dblclick",(()=>{n.classList.contains("enabled")?n.classList.remove("enabled"):n.classList.add("enabled")}))}e.querySelector(".listbox").replaceWith(t.getElement())})),tabc.addPage("Device Cfg.",(e=>{e.innerHTML='<div class="dev-cfg-panel">\n                To optimize your experience for mobile devices, press the button below.<br>\n                NOTE: Any unsaved data will be lost after reboot!\n                <br>\n                <br>\n                <button class="w96-button mobmode">Enable Mobile mode</button>\n            </div>';const t=e.querySelector("button.mobmode");_sys_dev_mobile_mobcfg__WEBPACK_IMPORTED_MODULE_12__.f.isMobileModeEnabled()?(t.innerText="Disable Mobile mode",t.addEventListener("click",(()=>{localStorage["mobile-mode"]="false",document.location.reload()}))):(t.innerText="Enable Mobile mode",t.addEventListener("click",(async()=>{let e=_gui_commdlg__WEBPACK_IMPORTED_MODULE_3__.jC.idleProgress("DevCfg","Loading additional data...");await(0,_sys_util_zip__WEBPACK_IMPORTED_MODULE_13__.N)("/system/images/mobsupport.zip"),e.closeDialog(),localStorage["mobile-mode"]="true",document.location.reload()})))})),tabc.setSize("100%","100%"),htmlContainer.appendChild(tabc.getElement());const footer=document.createElement("footer");footer.classList.add("w96-footer"),footer.innerText="Windows 96 v"+localStorage.getItem("w96ver"),htmlContainer.appendChild(footer),mainwnd.show(),tabc.openPage(pageIdMain)}async _setWallpaper(e){const t=JSON.parse(await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr("c:/system/config/desktop.json")),n=document.querySelector(".user-desktop");e.endsWith(".cbg")?(t.background.type="css",t.background.bg=await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.readstr(e),n.style.background=t.background.bg):(t.background.type="local",t.background.bg=e,n.style.background="",n.style.backgroundRepeat="no-repeat",n.style.backgroundSize="cover",n.style.backgroundImage="url("+URL.createObjectURL(await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.toBlob(e))+")"),await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_4__.FS.writestr("c:/system/config/desktop.json",JSON.stringify(t))}ontermination(){super.ontermination(),this._blobsToDeregister.forEach((e=>{URL.revokeObjectURL(e)}))}}},4019:(e,t,n)=>{"use strict";n.d(t,{T:()=>c});var s=n(9338),i=n(4420),o=n(7366),r=n(254),a=n(5784),l=n(4186);class c extends l.WApplication{constructor(){super()}async main(e){super.main(e),a.FS.exists("c:/system/wallpapers/dynamic")||await a.FS.mkdir("c:/system/wallpapers/dynamic");const t=new o.Lw;t.initialHeight=340,t.initialWidth=292,t.title="Dynamic Wallpaper Settings",t.resizable=!1,this.wnd=this.createWindow(t,!0),this.wnd.registerWindow(),this.wnd.registerAppBar(),this.wnd.setControlBoxStyle("WS_CBX_CLOSE"),this.wnd.setWindowIcon(i.Q.getIconUrl("small/apps/dynwp"));const n=this.wnd.getBodyContainer();n.classList.add("dynwp-app"),n.innerHTML='<span class="bold-noaa">\n            Preview\n        </span>\n        \n        <iframe class="preview" src="data:text/html;base64,PHN0eWxlPmJvZHkge2JhY2tncm91bmQ6YmxhY2s7fTwvc3R5bGU+"></iframe>\n        <div class="field">\n            <span class="bold-noaa">\n                Built-in dynwallpapers\n            </span>\n            <select class="w96-textbox dwp-default-box">\n                \x3c!--<option value="C:/system/wallpapers/dynamic/classic.dwp">classic.dwp</option>--\x3e\n            </select>\n        </div>\n        <div class="field custom">\n            <span class="bold-noaa">Custom dynwallpaper</span>\n            <div>\n                <input class="w96-textbox custom" type="text" readonly>\n                <button class="w96-button browse">Browse</button>  \n            </div>\n        </div>\n        <div class="buttons">\n            <button class="w96-button left inspect">Inspect...</button>\n            <button class="w96-button cancel">Cancel</button>\n            <button class="w96-button apply">Apply</button>\n        </div>';const l=n.querySelector(".dwp-default-box");for(let e of a.FS.readdir("c:/system/wallpapers/dynamic")){let t=a.FSUtil.fname(e);const n=document.createElement("option");n.value=e,n.innerText=t,l.appendChild(n)}if(l.addEventListener("change",(e=>{const t=l.options[l.selectedIndex].value;this.loadWpPreview(t)})),null!=l.options[l.selectedIndex]){const e=l.options[l.selectedIndex].value;this.loadWpPreview(e)}n.querySelector("button.inspect").addEventListener("click",(()=>{this.selectedWpPath&&r.l.execFile(this.selectedWpPath)})),n.querySelector("button.cancel").addEventListener("click",(()=>this.terminate())),n.querySelector("button.browse").addEventListener("click",(()=>{new s.MT("c:/system/wallpapers/dynamic",[".dwp",".DWP"],(e=>{e&&(this.loadWpPreview(e),n.querySelector("input.custom").value=e)})).show()})),n.querySelector("button.apply").addEventListener("click",(async()=>{if(!this.selectedWpPath)return;const e=JSON.parse(await a.FS.readstr("c:/system/config/desktop.json"));e.background.type="iframe",e.background.bg=this.selectedWp.url;const t=document.querySelector(".ui-bg-iframe");await a.FS.writestr("c:/system/config/desktop.json",JSON.stringify(e)),t?t.src=e.background.bg:w96.ui.Theme.reloadDesktop()})),this.wnd.show(),this.wnd.center()}async loadWpPreview(e){try{const t=await a.FS.readstr(e),n=JSON.parse(t);this.selectedWp=n,this.selectedWpPath=e,n.properties||(n.properties={}),this.wnd.getBodyContainer().querySelector("iframe").src=n.url+"?opts="+encodeURIComponent(btoa(JSON.stringify(n.properties)))}catch(e){s.jC.error("Error","Failed to load wallpaper.","OK")}}}},3349:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TextpadApplication:()=>d});var s=n(4186),i=n(7366),o=n(4876),r=n(9338),a=n(5784),l=n(4420),c=n(6999);class d extends s.WApplication{constructor(){super()}async main(e){super.main(e),null==e[0]?this.currentFile=null:this.currentFile=e[0];var t=new i.Lw;t.title=(null==e[0]?"Untitled":o.R.fname(e[0]))+" - Textpad",t.initialWidth=470,t.initialHeight=400;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml(""),n.setWindowIcon(l.Q.getIconUrl("small/apps/textpad"));const s=n.wndObject.querySelector(".window-html-content");s.classList.add("textpad-app");const a=new c.j;this.lastDir="c:/",a.addRoot("File",[{type:"normal",label:"New",onclick:()=>{this.currentFile=null,this.loadDocument(null)}},{type:"separator"},{type:"normal",label:"Open",onclick:()=>{new r.MT(this.lastDir,["txt","log","json"],(e=>{e&&(this.currentFile=e,this.loadDocument(e),this.appWindow.activate(),this.lastDir=o.R.getParentPath(e))})).show()}},{type:"normal",label:"Save",onclick:()=>{this._saveAuto()}},{type:"normal",label:"Save As",onclick:()=>{this._saveAs()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.terminate()}}]);const d=document.createElement("textarea");d.classList.add("main-editor"),d.onkeydown=e=>{if("Tab"==e.key){e.preventDefault();const t=d.selectionStart,n=d.selectionEnd;d.value=d.value.substring(0,t)+"\t"+d.value.substring(n),d.selectionStart=d.selectionEnd=t+1}if("s"==e.key&&e.ctrlKey)return e.preventDefault(),void this._saveAuto()},d.onkeyup=()=>{this._setWinTitle(this.currentFile)};const p=document.createElement("footer");p.classList.add("w96-footer"),s.appendChild(a.getMenuDiv()),s.appendChild(d),s.appendChild(p),n.show(),this.mainwnd=n,this.textArea=d,this.footer=p,this.loadDocument(this.currentFile)}loadDocument(e){if(null==e)return this.fileData="",this.textArea.value="",this._setWinTitle(null),void(this.footer.innerText="Untitled");a.FS.readstr(e).then((t=>{this.fileData=t,this.textArea.value=t,this.footer.innerText=e,this._setWinTitle(e)}))}_setWinTitle(e){this.mainwnd.setTitle((null==e?"Untitled":o.R.fname(e))+(this.fileData!=this.textArea.value?"*":"")+" - Textpad")}_saveAs(){new r.pp(this.lastDir,["txt","log","json"],(e=>{e&&a.FS.writestr(e,this.textArea.value).then((()=>{this.currentFile=e,this._setWinTitle(e),this.footer.innerText=e,this.lastDir=o.R.getParentPath(e)})).catch((t=>{r.jC.error("File Save Error","Failed to write to ["+e+"]!\nReason: "+t,"OK")}))})).show()}_saveAuto(){null!=this.currentFile?a.FS.writestr(this.currentFile,this.textArea.value).catch((e=>{r.jC.error("File Save Error","Failed to write to ["+this.currentFile+"]!\nReason: "+e,"OK")})):this._saveAs(),this.fileData=this.textArea.value,this._setWinTitle(this.currentFile)}}},4082:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VideoPlayerApplication:()=>d});var s=n(4186),i=(n(7366),n(4876)),o=n(9338),r=n(5784),a=n(4420),l=n(6999),c=(n(5685),n(8041));class d extends s.WApplication{constructor(){super()}async main(e){super.main(e),null!=e[0]?await this._createWindow(e[0]):new o.MT("c:/",["mp4","MP4"],(e=>{e?this._createWindow(e):this.terminate()})).show()}async openFile(e){this.blurl&&URL.revokeObjectURL(this.blurl),this.videoBlob=await r.FS.toBlob(e),this.blurl=URL.createObjectURL(this.videoBlob),console.log(this.blurl);this.mainwnd.getBodyContainer().querySelector("video").src=this.blurl}async _createWindow(e){const t=this.createWindow({title:i.R.fname(e)+" - Video Player",initialWidth:640,initialHeight:480,body:'<div class="appbar"></div>\n            <video style="height: 100%; width: 100%;" controls>\n                <source type="video/mp4">\n            </video>',bodyClass:"app-vplayer",taskbar:!0,icon:a.Q.getIconUrl("small/video")},!0),n=new l.j;n.addRoot("File",[{type:"normal",label:"Open File",onclick:()=>{new o.MT("c:/user/desktop",["mp4","webm"],(e=>{e&&""!=e.trim()&&this.openFile(e)})).show()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>t.close()}]),n.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{c.O.alert('<span class="bold-noaa">Video Player</span><br>Version 1.1<br>',{title:"About Video Player",icon:"info"})}}]);t.getBodyContainer().querySelector(".appbar").replaceWith(n.getMenuDiv()),t.show(),this.mainwnd=t,await this.openFile(e)}ontermination(){console.log("revoking video url..."),URL.revokeObjectURL(this.blurl),this.videoBlob=null}}},8735:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BackupManagerApp:()=>p});var s=n(9338),i=n(8041),o=n(4420),r=n(1717),a=n(5784),l=(n(7366),n(9471)),c=n(4186);class d extends c.WApplication{constructor(){super(),this.mainwnd=this.createWindow({bodyClass:"wizard-app",initialWidth:482,initialHeight:371,controlBoxStyle:"WS_CBX_CLOSE",taskbar:!0,icon:o.Q.getIconUrl("small/exec"),resizable:!1,title:"Untitled Wizard"}),this.wizardInfo={name:"Untitled Wizard"},this.pages=[{id:"intro",type:"intro",body:"This wizard will help you install program XYZ",graphic:"/system/resource/ui/wizard/graphic-unknown.png",titleText:"Welcome to the installation wizard lol xD",buttons:[{class:"back",onclick:()=>{},enabled:!1,text:"Back"},{class:"next",onclick:()=>{},enabled:!0,text:"Next"},{class:"cancel",onclick:()=>this.quit(),enabled:!0,text:"Cancel"}],onopen:(e,t)=>{}},{id:"page",type:"page",body:"bla",graphic:"/system/resource/ui/wizard/graphic-top.png",titleText:"Sample text",description:"Sample text lolololol",buttons:[{class:"back",onclick:()=>this.openPage("intro",[]),enabled:!0,text:"Back"},{class:"next",onclick:()=>{},enabled:!0,text:"Next"},{class:"cancel",onclick:()=>this.quit(),enabled:!0,text:"Cancel"}],onopen:(e,t)=>{}}]}quit(){s.jC.confirm("Are you sure you want to quit?",(e=>{e&&this.mainwnd.close()}))}clearPage(){const e=this.mainwnd.getBodyContainer();for(;e.firstChild;)e.removeChild(e.firstChild)}findPage(e){return this.pages.find((t=>t.id==e))}openPage(e,t){this.clearPage();const n=this.mainwnd.getBodyContainer(),s=this.findPage(e);if(s){"intro"==s.type?(this.mainwnd.setHtml('\n            <div class="container intro">\n                <div class="box">\n                    <div class="graphic"></div>\n                    <div class="content">\n                        <div class="title"></div>\n                        <div class="description">TODO</div>\n                        <span class="explain bold-noaa">Click Next to continue.</span>\n                    </div>\n                </div>\n                <div class="buttons"></div>\n            </div>\n            '),n.querySelector(".box>.graphic").style.backgroundImage=`url(${s.graphic})`,n.querySelector(".content>.title").innerText=s.titleText,n.querySelector(".content>.description").innerHTML=s.body):"page"==s.type?(this.mainwnd.setHtml('\n            <div class="container page">\n                <div class="box">\n                    <div class="top">\n                        <div class="title bold-noaa">TODO</div>\n                        <div class="description">TODO</div>\n                    </div>\n                    <div class="content">\n                        TODO\n                    </div>\n                </div>\n                <div class="buttons"></div>\n            </div>\n            '),n.querySelector(".top").style.backgroundImage=`url(${s.graphic})`,n.querySelector(".top>.title").innerText=s.titleText,n.querySelector(".top>.description").innerHTML=s.description,n.querySelector(".content").innerHTML=s.body):this.mainwnd.setHtml(s.body);for(let e of[...s.buttons]){const t=l.K.mkElement("button",["w96-button",e.class]);t.innerText=e.text,t.addEventListener("click",e.onclick),t.disabled=!e.enabled,n.querySelector(".container>.buttons").appendChild(t)}s.onopen(n.querySelector(".container"),t)}else i.O.alert("The specified wizard page "+e+" was not found.")}async main(){this.mainwnd.show()}}class p extends d{constructor(){super()}async main(e){super.main(e);const t=this.findPage("intro");t.titleText="Welcome to the Backup Wizard",t.graphic="/system/resource/app/backup/graphic.png",t.body="This wizard will help you create or restore a Windows 96 backup.<br><br>Please note that all applications must be closed for the best results.<br><br>The OS may freeze during the backup (do not panic, it is normal).",t.buttons[1].onclick=()=>this.openPage("backup-select",[]);let n="backup";this.pages.push({id:"backup-select",type:"page",body:'Select an action:\n                <div class="w96-radiobox">\n                    <div class="option">\n                        <input type="radio" name="bopt" value="opt1">\n                        <label for="opt1" class="text">Create system backup.</label>\n                    </div>\n                    <div class="option">\n                        <input type="radio" name="bopt" value="opt2">\n                        <label for="opt2" class="text">Restore from backup ZIP.</label>\n                    </div>\n                </div>',graphic:"/system/resource/app/backup/graphic-top.png",titleText:"What would you like to do?",description:"You can backup your system or restore from one.",buttons:[{class:"back",onclick:()=>this.openPage("intro",[]),enabled:!0,text:"Back"},{class:"next",onclick:()=>{"backup"==n?this.openPage("backup",[]):this.openPage("restore",[])},enabled:!0,text:"Next"},{class:"cancel",onclick:()=>this.quit(),enabled:!0,text:"Cancel"}],onopen:(e,t)=>{const s=new r.X([{label:"Create system backup.",id:"backup",onselect:()=>{n="backup"},selected:!0},{label:"Restore from ZIP archive.",id:"restore",onselect:()=>{n="restore"},selected:!1}]);e.querySelector(".w96-radiobox").replaceWith(s.getElement())}}),this.pages.push({id:"backup",type:"page",body:"\n                <div>\n                    To begin the backup, press the next button. When the backup is complete, you will receive a locally generated download button with your data as a ZIP file.<br><br>\n                    Please note that your OS may lag/freeze/slow down because of heavy file system activity.<br><br>\n                    It is recommended to close all applications to avoid data corruption.<br><br>Please save your work, you will not be able to close the backup process once its running!\n                </div>\n            ",graphic:"/system/resource/app/backup/graphic-top.png",titleText:"Begin the backup",description:"Read the information below carefully.",buttons:[{class:"back",onclick:()=>this.openPage("backup-select",[]),enabled:!0,text:"Back"},{class:"next",onclick:()=>{localStorage.setItem("backup_mode_reboot","true"),document.location.reload()},enabled:!0,text:"Next"},{class:"cancel",onclick:()=>this.quit(),enabled:!0,text:"Cancel"}],onopen:(e,t)=>{}}),this.pages.push({id:"restore",type:"page",body:'\n                <div>\n                    To restore your system, please select a ZIP file below.<br><br>\n                    When this is done, click Next to restore your system.<br><br>\n                    Do not interrupt the restore process, you may likely make your installation unusable or corrupt.<br><br>\n                </div>\n                <div class="path-box">\n                    <input class="w96-textbox path">\n                    <button class="w96-button browse">Browse...</button>\n                </div>\n            ',graphic:"/system/resource/aPP/backup/graphic-top.png",titleText:"Restore from a backup",description:"Upload your ZIP file to begin the restore process",buttons:[{class:"back",onclick:()=>this.openPage("backup-select",[]),enabled:!0,text:"Back"},{class:"next",onclick:()=>{const e=this.mainwnd.getBodyContainer().querySelector("input").value;a.FS.exists(e)?(localStorage.setItem("restore_image",e),document.location.reload()):i.O.alert("The specified ZIP file does not exist.")},enabled:!0,text:"Next"},{class:"cancel",onclick:()=>this.quit(),enabled:!0,text:"Cancel"}],onopen:(e,t)=>{e.querySelector("input").setAttribute("style","width: 100%; box-sizing: border-box; margin-bottom: 10px;"),e.querySelector("button.browse").addEventListener("click",(()=>{new s.MT("c:/",[".zip",".ZIP"],(t=>{null!=t&&""!=t.trim()&&(e.querySelector("input").value=t)})).show()}))}}),this.openPage("intro",[]),this.mainwnd.setTitle("Backup Wizard"),this.mainwnd.setWindowIcon(o.Q.getIconUrl("small/apps/backupmgr"))}}},3761:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Base64Application:()=>o});var s=n(4186),i=(n(7366),n(4420),n(9338));class o extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){i.jC.prompt("Base64","Enter a string to convert to Base64","",(e=>{e&&""!=e.trim()&&i.jC.info("Base64",btoa(e),"OK")}))}}},849:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DToolApp:()=>o});var s=n(51),i=n(4186);class o extends i.WApplication{constructor(){super()}async main(e){super.main(e),e.includes("--perf")&&s.z.showDOMFps()}}},2758:(e,t,n)=>{"use strict";n.r(t),n.d(t,{iFrameApplication:()=>c});var s=n(9338),i=n(4420),o=n(7366),r=n(5784),a=n(4186);const l=["data:","http:","https:"];class c extends a.WApplication{constructor(){super(),this.blobUrls=[]}async main(e){super.main(e);const t=await(async()=>{const t=e[0];if(null==t)return"about:blank";for(let e of l)if(t.startsWith(e))return t;if(r.FS.exists(t)&&r.FS.isFile(t)){const e=URL.createObjectURL(await r.FS.toBlob(t));return this.blobUrls.push(e),e}return null})();if(!t)return void s.jC.error("Invalid URL","The URL that was specified is not valid.","OK");const n=new o.Lw;n.title="Eyeframe",n.initialWidth=430,n.initialHeight=380;const a=this.createWindow(n,!0);a.registerWindow(),a.registerAppBar(),a.setHtml(`<iframe src="${t}"></iframe>`);a.wndObject.querySelector(".window-html-content").classList.add("eyeframe-app"),a.setWindowIcon(i.Q.getIconUrl("small/apps/eyeframe"));const c=a.wndObject.querySelector("iframe");c.onload=()=>{try{const e=c.contentWindow.document.querySelector("title"),t=c.contentWindow.document.querySelector('link[rel="icon"]');e&&this.mainwnd.setTitle(e.innerText),t&&this.mainwnd.setWindowIcon(t.getAttribute("href"));if(null!=c.contentWindow.document.querySelector('meta[content="win96-css-imports"]')){const e=["/system/resource/stylesheets/normalize.css","/system/resource/stylesheets/ui.css","/system/resource/stylesheets/app-base.css"];for(let t of e){console.log("Importing stylesheet "+t);const e=c.contentWindow.document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,c.contentWindow.document.head.appendChild(e)}}c.contentWindow.w96=w96,c.contentWindow.u96=u96}catch(e){console.warn("Unable to read document/export symbols. It's likely this origin is not local.")}},a.ondarkenelements=()=>{c.style.pointerEvents="none"},a.onlightenelements=()=>{c.style.pointerEvents=""},this.appFrame=c,this.mainwnd=a,a.show()}ontermination(){for(let e of this.blobUrls)URL.revokeObjectURL(e)}}},9005:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{JSGUIRepl:()=>JSGUIRepl});var _gui_dlgcreator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8041),_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4420),_gui_ui_components_menubar__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6999),_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9471),_wapp__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4186);class JSGUIRepl extends _wapp__WEBPACK_IMPORTED_MODULE_4__.WApplication{constructor(){super(),this.stats={errors:0}}async main(e){super.main(e);const t=this.createWindow({title:"JS REPL (Gui)",icon:_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_1__.Q.getIconUrl("small/misc/js"),taskbar:!0,bodyClass:"jsguirepl-app",initialHeight:400,initialWidth:520,body:'<div class="appbar"></div>\n            <div class="view w96-inset">\n                <div class="history"></div>\n                <div class="input">\n                    <input class="w96-textbox" type="text">\n                </div>\n            </div>\n            <footer class="w96-footer">\n                0 errors\n            </footer>'},!0),n=t.getBodyContainer(),s=new _gui_ui_components_menubar__WEBPACK_IMPORTED_MODULE_2__.j;s.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>t.close()}]),s.addRoot("View",[{type:"normal",label:"Clear History (CTRL + L)",onclick:()=>this.clearConsole()}]),s.addRoot("Help",[{type:"normal",label:"About",onclick:()=>_gui_dlgcreator__WEBPACK_IMPORTED_MODULE_0__.O.alert('<span class="bold-noaa">JS REPL (Gui)</span><br>Version 1.0<br>',{title:"About JS REPL (Gui)",icon:"info"})}]),this.mainwnd=t,n.querySelector(".appbar").replaceWith(s.getMenuDiv()),this.setupInputBox(),t.show()}clearConsole(){const e=this.mainwnd.getBodyContainer().querySelector(".history");for(;e.firstChild;)e.removeChild(e.firstChild)}pushConsoleMessage(e,t){const n={type:"text",severity:"none",caller:"code",...e},s=_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__.K.mkElement("div",["line",`caller-${n.caller}`]);if("none"===n.severity);else s.classList.add(n.severity);"text"==n.type&&void 0!==t&&(s.innerText=t);const i=this.mainwnd.getBodyContainer().querySelector(".history");return i.appendChild(s),i.scrollTop=i.scrollHeight,s}setupInputBox(){const e=this.mainwnd.getBodyContainer(),t=e.querySelector("input"),n=e.querySelector(".history");t.addEventListener("keydown",(e=>{if(e.ctrlKey&&"l"==e.key)e.preventDefault(),this.clearConsole();else if("Enter"==e.key){if(""==t.value.trim())return;return this.pushConsoleMessage({caller:"user"},t.value),this.evaluate(t.value),n.scrollTop=n.scrollHeight,void(t.value="")}}))}formatObject(e,t){switch(typeof t){case"bigint":case"number":return void e.classList.add("js-number");case"string":return e.classList.add("js-string"),void(e.innerText=`"${e.innerText}"`);case"undefined":return e.classList.add("js-undefined"),void(e.innerText="undefined");case"symbol":return e.classList.add("js-symbol"),void(e.innerText="Symbol");case"boolean":return void e.classList.add("js-bool")}if(null===t)return e.classList.add("js-undefined"),void(e.innerText="null");if(t instanceof Array){let n="";if(t.length>200)n=`... large array (${t.length} items) ...`;else if(0==t.length)n="";else for(let e of t){let t=_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__.K.mkElement("span",[]);t.innerText="symbol"==typeof e?"Symbol":"function"==typeof e?"ƒ":"object"==typeof e?"{ . obj . }":e,this.formatObject(t,e),n+=t.outerHTML+", ",t=null}e.innerHTML=`[ ${n.substring(0,n.length-2)} ]`}}updateErrorCount(){const e=this.mainwnd.getBodyContainer();this.stats.errors++,e.querySelector(".w96-footer").innerText=`${this.stats.errors} error${1===this.stats.errors?"":"s"}`}evaluate(text){try{const result=eval(text),msg=this.pushConsoleMessage({caller:"code"},"symbol"!=typeof result?result:"");this.formatObject(msg,result)}catch(e){const t=this.pushConsoleMessage({severity:"error",caller:"code"});if(t.classList.add("exception"),e instanceof Error){const n=_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__.K.mkElement("span",["name"]);n.innerText=`${e.name}: `;const s=_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__.K.mkElement("span",["message"]);s.innerText=`${e.message}`,t.appendChild(n),t.appendChild(s)}else{const n=_sys_util_dom__WEBPACK_IMPORTED_MODULE_3__.K.mkElement("span",["message"]);n.innerText=`${e.message}`,t.appendChild(n)}this.updateErrorCount()}}}},8966:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MonacoApplication:()=>u});var s=n(4186),i=n(7366),o=n(4420),r=n(6999),a=n(9338),l=n(5784),c=n(6841),d=n(7362),p=n(8279);class u extends s.WApplication{constructor(){super(),this.libs=[]}async main(e){super.main(e),await this.initData(),this._createWindow(e)}async initData(){const e="C:/system/local/share/monaco/types";l.FS.exists(e)||l.FS.mkdir(e);const t=a.jC.idleProgress("Loading libraries","Importing typings...");for(let t of l.FS.readdir(e))t.toLowerCase().endsWith(".ts")&&this.libs.push({name:`ts:int/${l.FSUtil.fname(t)}`,content:await l.FS.readstr(t)});t.closeDialog()}_createWindow(e){var t=new i.Lw;t.title="Monaco",t.initialWidth=620,t.initialHeight=440;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml('\n        <div class="appbar"></div>\n        <iframe src="/system/apps/monaco"></iframe>\n        ');const s=n.wndObject.querySelector(".window-html-content");s.classList.add("monaco-app"),n.setWindowIcon(o.Q.getIconUrl("small/apps/monaco"));const p=new r.j;p.addRoot("File",[{type:"normal",label:"New",onclick:()=>{this.newDocumentUI()}},{type:"separator"},{type:"normal",label:"Open",onclick:()=>{this.openDocumentDialog()}},{type:"normal",label:"Save",onclick:()=>{this.saveDocumentDialog()}},{type:"normal",label:"Save As",onclick:()=>{this.saveDocumentDialog(!0)}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.documentModified?a.jC.confirm("Are you sure? The current document is not saved yet!",(e=>{e&&this.mainwnd.close()}),"warning"):this.mainwnd.close()}}]),p.addRoot("Document",[{type:"submenu",label:"Language",items:[{type:"normal",label:"CSS",onclick:()=>this.switchLang("css")},{type:"normal",label:"HTML",onclick:()=>this.switchLang("html")},{type:"normal",label:"JavaScript",onclick:()=>this.switchLang("js")},{type:"normal",label:"JSON",onclick:()=>this.switchLang("json")},{type:"normal",label:"Plain Text",onclick:()=>this.switchLang("plain")}]}]),p.addRoot("Tools",[{type:"normal",label:"Preview in EyeFrame",onclick:async()=>{const e="c:/system/temp/"+((0,c.TN)(0,1e6)+".html");await l.FS.writestr(e,this.appFrame.contentWindow.editor.getValue()),(0,d.lw)("eyeframe",[e])}},{type:"separator"},{type:"normal",label:"Edit Monaco Config",onclick:()=>{a.jC.confirm("Are you sure? Please save any changes first.",(e=>{e&&this.loadDocument("c:/user/appdata/Monaco/config.json")}),"warning")}}]),p.addRoot("Help",[{type:"normal",label:"About",onclick:()=>{a.jC.info("About Monaco",'<span class="bold-noaa">Monaco Editor</span><br>Version 1.0<br><br>Powered by <a href="https://github.com/microsoft/monaco-editor">Microsoft Monaco Editor</a>',"OK").dlg.setSize(320,140)}}]);const u=n.wndObject.querySelector("iframe");u.onload=()=>{u.contentWindow.app(w96,u96,this,(t=>{u.contentDocument.addEventListener("click",(()=>document.body.onclick({target:this.appWindow.wndObject}))),s.querySelector(".appbar").replaceWith(p.getMenuDiv()),null==e[0]?this.newDocument():this.loadDocument(e[0])}))},n.ondarkenelements=()=>{u.style.pointerEvents="none"},n.onlightenelements=()=>{u.style.pointerEvents=""},this.currentDocument=null,this.lastPath="c:/",this.documentModified=!1,this.appFrame=u,this.mainwnd=n,n.onclose=e=>{this.documentModified&&(e.canceled=!0,a.jC.confirm("Are you sure? The current document is not saved yet!",(e=>{e&&(this.documentModified=!1,n.close())}),"warning"))},n.show()}newDocument(){this.mainwnd.setTitle("Untitled - Monaco"),this.appFrame.contentWindow.editor.setValue(""),this.appFrame.contentWindow.switchLang("plain"),this.currentDocument=null,this.setDocumentModified(!1)}updateTitle(){let e=null==this.currentDocument?"Untitled":l.FSUtil.fname(this.currentDocument);this.mainwnd.setTitle((this.documentModified?"*":"")+e+" - Monaco")}setDocumentModified(e){this.documentModified!==e&&(this.documentModified=e,this.updateTitle())}checkReadOnly(e){if(!e)return!1;const t=l.FSUtil.deconstructFullPath(e);return l.FS.get(t.prefix).features.includes(p.f.readOnly)}switchLang(e){this.appFrame.contentWindow.switchLang(e)}async loadDocument(e){if(!l.FS.exists(e)||!l.FS.isFile(e))return a.jC.error("Error","Cannot load file.","OK"),void this.newDocument();const t=await l.FS.readstr(e);this.appFrame.contentWindow.editor.setValue(t),this.appFrame.contentWindow.assumeLangFromExt(e),this.mainwnd.setTitle(l.FSUtil.fname(e)+" - Monaco"),this.currentDocument=e,this.lastPath=l.FSUtil.getParentPath(e),2==this.lastPath.length&&(this.lastPath+="/"),this.setDocumentModified(!1)}saveDocumentDialog(e){this.checkReadOnly(this.currentDocument)?a.jC.error("Error saving document","This document is stored in a read-only location.","OK"):null==this.currentDocument||e?new a.pp(this.lastPath,[/.*/],(e=>{e&&""!=e.trim()&&(this.currentDocument=e,l.FS.writestr(this.currentDocument,this.appFrame.contentWindow.editor.getValue()),this.lastPath=l.FSUtil.getParentPath(e),this.appFrame.contentWindow.assumeLangFromExt(e),this.mainwnd.setTitle(l.FSUtil.fname(e)+" - Monaco"),this.setDocumentModified(!1),2==this.lastPath.length&&(this.lastPath+="/"))})).show():(l.FS.writestr(this.currentDocument,this.appFrame.contentWindow.editor.getValue()),this.setDocumentModified(!1))}openDocumentDialog(){new a.MT(this.lastPath,[/.*/],(e=>{e&&""!=e.trim()&&(l.FS.stat(e).length>1048576?a.jC.confirm("The file is larger than 1 MB. Continue loading? (you may suffer)",(t=>{t&&(this.documentModified?a.jC.confirm("Are you sure? The current document is not saved yet!",(t=>{t&&this.loadDocument(e)}),"warning"):this.loadDocument(e))}),"warning"):this.documentModified?a.jC.confirm("Are you sure? The current document is not saved yet!",(t=>{t&&this.loadDocument(e)}),"warning"):this.loadDocument(e))})).show()}newDocumentUI(){this.documentModified?a.jC.confirm("Are you sure? The current document is not saved yet!",(e=>{e&&this.newDocument()}),"warning"):this.newDocument()}ontermination(){}}},382:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ServerStatApplication:()=>a});var s=n(4420),i=n(7366),o=n(4186);const r=[{name:"MsgRoom",url:"https://devel.windows96.net:4096/"},{name:"Shared Drives",url:"https://devel.windows96.net:4097/"}];class a extends o.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}_createWindow(){const e=new i.Lw;e.draggable=!0,e.resizable=!0,e.initialHeight=300,e.initialWidth=360,e.title="Server Status";const t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setWindowIcon(s.Q.getIconUrl("small/apps/server-stat"));const n=t.getBodyContainer();n.classList.add("server-stat-app"),n.insertAdjacentHTML("afterbegin",'\n            <span class="bold-noaa">Windows 96 Server Status</span>\n            <div class="table-container">\n                <table>\n                    <tr>\n                        <th style="width: 100%">Service</th>\n                        <th>Status</th>\n                    </tr>\n                </table>\n            </div>\n\n            <div class="buttons">\n                <button class="w96-button">\n                    Check Now\n                </button>\n            </div>\n        ');const o=n.querySelector("table>tbody");for(let e of r){const t=document.createElement("tr"),n=document.createElement("td");n.innerText=e.name;const s=document.createElement("td");s.innerText="UNKNOWN",t.appendChild(n),t.appendChild(s),o.appendChild(t)}const a=n.querySelector(".buttons>button");a.addEventListener("click",(()=>this._checkServices())),this._ui_btn=a,this._ui_list=o,t.show()}_ping(e){return new Promise((async t=>{try{200==(await fetch(e,{mode:"no-cors"})).status?t(!0):t(!1)}catch(e){t(!1)}}))}async _checkServices(){let e=1;this._ui_btn.disabled=!0;for(let e=0;e<this._ui_list.children.length;e++)this._ui_list.children.item(e).className="";for(let t of r){const n=await this._ping(t.url),s=this._ui_list.children.item(e);n?(s.className="success",s.children.item(1).innerText="SUCCESS"):(s.className="fail",s.children.item(1).innerText="FAIL"),e++}this._ui_btn.disabled=!1}}},969:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SuperPlayerApplication:()=>c});var s=n(4186),i=n(7366),o=n(4420),r=n(6999),a=n(5784),l=n(9338);class c extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow(e),this.loadedBlobs=[]}async loadSwf(e){if(!a.FS.exists(e))return void l.jC.error("Error","SWF file does not exist.","OK");const t=URL.createObjectURL(await a.FS.toBlob(e));this.loadedBlobs.push(t),this.appWindow.setTitle(a.FSUtil.fname(e)+" - Super Player"),this.appFrame.contentWindow.load(t)}_createWindow(e){var t=new i.Lw;t.title="Super Player",t.initialWidth=500,t.initialHeight=420;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml('<div class="appbar"></div><iframe src="/system/apps/super-player"></iframe>');const s=n.wndObject.querySelector(".window-html-content");s.classList.add("super-player-app"),n.setWindowIcon(o.Q.getIconUrl("small/apps/super-player"));const a=new r.j;a.addRoot("File",[{type:"normal",label:"Open SWF",onclick:()=>{new l.MT("c:/user/desktop",["swf","SWF"],(e=>{e&&""!=e.trim()&&this.loadSwf(e)})).show()}},{type:"separator"},{type:"normal",label:"Exit",onclick:()=>{this.mainwnd.close()}}]),a.addRoot("Help",[{type:"normal",label:"Read me please",onclick:()=>{l.jC.warning("Read me","Please note: not all games work in Ruffle.","OK")}},{type:"separator"},{type:"normal",label:"About",onclick:()=>{l.jC.info("About Super Player",'<span class="bold-noaa">Super Player</span><br>Version 1.0<br><br>Powered by <a href="https://ruffle.rs/">Ruffle</a>',"OK").dlg.setSize(320,140)}}]),s.querySelector(".appbar").replaceWith(a.getMenuDiv());const c=n.wndObject.querySelector("iframe");n.ondarkenelements=()=>{c.style.pointerEvents="none"},n.onlightenelements=()=>{c.style.pointerEvents=""},c.onload=()=>{null!=e[0]&&this.loadSwf(e[0])},this.appFrame=c,this.mainwnd=n,n.show()}ontermination(){for(let e in this.loadedBlobs)URL.revokeObjectURL(e)}}},1384:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TerminalApplication:()=>W});var s=n(4186),i=n(7366),o=n(4876),r=(n(9338),n(5784)),a=n(4420),l=(n(5685),n(4367),n(4247)),c=n(7362),d=n(120),p=n(3978);const u={name:"bins",register:function(e){return(t,n)=>{const s=c.nP.getEnv("path").split(";");for(let t of s){if(r.FS.isFile(t))continue;if(!r.FS.exists(t))continue;e.println(`<span style="color: cyan">${t}</span>`);const n=r.FS.readdir(t);n.forEach(((e,t,n)=>{!e.includes(".txt")&&r.FS.isFile(e)||n.splice(t,1)}));const s=n.map((e=>r.FSUtil.fname(e))).join(", ");e.println(`${s}`)}}}},h={name:"mkdir",aliases:["md"],register:function(e){return async(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.printlnEscaped(`usage: ${s} <path>\nCreates a new directory.`),0;const i=[...n];if(i.splice(0,1),0==i.length)return e.printError("Error: no directory name was specified."),1;let o=0;for(let t of i)try{let n=t;if(/^([a-zA-Z]:)/.test(n)||(n=e.resolvePath(e.currentPath,n)),r.FS.exists(n)){e.printError(`Error: '${p.V.escapeHtml(n)}': path exists.`),o=1;continue}await r.FS.mkdir(n)}catch(t){e.printError("Could not create directory:"),e.printError(p.V.escapeHtml(new String(t)))}return o}}},m={name:"cd",aliases:["chdir"],register:function(e){return(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.println(`usage: ${s} &lt;path&gt;\nChanges the current directory.`),0;let i=n.join(" ").substring(3);if(""==i)return e.printError(`Error: '${s}' requires a directory argument (none specified).`),1;/^([a-zA-Z]:)/.test(i)||(i=e.resolvePath(e.currentPath,i));const o=p.V.escapeHtml(i);return r.FS.exists(i)?r.FS.isFile(i)?(e.printError("Error: cannot cd to a file."),1):void(e.currentPath=i):(e.printError(`Error: unable to access '${o}': No such file or directory.`),1)}}},_={name:"clear",aliases:["cls"],register:function(e){return(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return void e.println(`usage: ${s}\nClears the current terminal window.`);const i=e.term.querySelector(".content");for(;i.firstChild;)i.removeChild(i.firstChild)}}},w={name:"ls",aliases:["dir"],register:function(e){return(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.println(`usage: ${s} [path]\nLists the contents of a directory.\n\nIf [path] is specified, it will list the contents of that directory instead of the current working directory.`),0;const i=n.join(" ").substring(3);let a=e.currentPath;""!=i&&(a=i),/^([a-zA-Z]:)/.test(a)||(a=e.resolvePath(e.currentPath,a));const l=p.V.escapeHtml(a);if(!r.FS.exists(a))return e.printError(`Error: unable to access '${l}': No such file or directory.`),1;if(r.FS.isFile(a))return e.println(`${l}`),0;const c=r.FS.readdir(a),d=[],u=[];for(let e of c)r.FS.isFile(e)?u.push(`${p.V.escapeHtml(o.R.fname(e))}`):d.push(`<span style="color: royalblue;">${p.V.escapeHtml(o.R.fname(e))}/<span>`);d.length>0&&e.println(d.join("<br>")),u.length>0&&e.println(u.join("<br>"))}}},y={name:"touch",register:function(e){return async(t,n)=>{if(n.includes("--help"))return e.println("usage: touch &lt;path&gt;\nCreates an empty file."),0;let s=n[1];if(""==s||null==s)return e.printError("Error: 'touch' requires a file path argument (none specified)."),1;/^([a-zA-Z]:)/.test(s)||(s=e.resolvePath(e.currentPath,s));const i=p.V.escapeHtml(s);if(r.FS.exists(s))return r.FS.isFile(s)?(e.printError(`Error: file '${i}' exists.`),1):(e.printError("Error: invalid argument."),1);await r.FS.writebin(s,[])}}};var b=n(3940);const g={name:"fetch",register:function(e){return async(t,n)=>{if(n.includes("--help"))return void e.println("usage: fetch &lt;url&gt; [-o OUTPUT_PATH]\nFetches contents from URL.\n\nIf option -o is specified, an output path must be specified to save the file.");const s=n[1];if(null==s||""==s.trim())return void e.printError("No URL has been specified.");let i=null;for(var o=0;o<n.length;o++)if("-o"==n[o]){if(null==n[o+1]||""==n[o+1].trim())return void e.printError("No output path specified.");const t=n[o+1].trim(),s=e.resolvePath(e.currentPath,t);if(r.FS.exists(s)&&!r.FS.isFile(s))return void e.printError("A directory already exists with this output name.");i=s}const a=await fetch(s,{cache:"no-cache",method:"GET",mode:"no-cors"});if(null!=i)await r.FS.writebin(i,new Uint8Array(await a.arrayBuffer())),e.println("Fetch complete");else{const t=await a.text();e.println("&nbsp;").innerText=t+"\n"}}}},f=["__exe","__lnk","about-ui","devtools","runlnk42","__support-us","hterm","dd"],v={name:"help",register:function(e){return async(t,n)=>{if(n.includes("--help"))return void e.println("usage: help\nDisplays command line help.");e.println('<span style="color: cyan">Built-ins</span>');const s=Object.values(C).map((e=>e.aliases?`(${e.name}, ${e.aliases.join(", ")})`:e.name));s.sort((function(e,t){return e>t?1:e<t?-1:0}));let i="";for(let e of s)i+=e+", ";e.println(i.substring(0,i.length-2)),e.println('\n<span style="color: cyan">Installed Applications</span>');const o=(0,c.V7)();o.sort((function(e,t){return e>t?1:e<t?-1:0}));let r="";for(let e of o){if(f.includes(e))continue;r+=e+", "}e.println(r.substring(0,r.length-2)),e.println("\n<span style=\"color: yellow\">Run 'bins' to list all available sysbins/userbins (they are not shown here)</span>")}}},E={name:"rm",aliases:["del","delete"],register:function(e){return async(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.printlnEscaped(`usage: ${s} <path> [-R, --no-preserve-root]\nRemoves a file.\n\nIf -R is specified, it will remove a directory and its contents recursively.\nIf --no-preserve-root is specified, it will allow the root of the drive to be deleted.`),0;let i=!n.includes("--no-preserve-root"),o=!!n.includes("-R");d.A.stripOptions(1,n,["-R","--no-preserve-root"]);let a=n[1];if(""==a||null==a)return e.printError(`Error: '${s}' requires a file path argument (none specified).`),1;/^([a-zA-Z]:)/.test(a)||(a=e.resolvePath(e.currentPath,a));const l=p.V.escapeHtml(a);if(!r.FS.exists(a))return e.printError(`Error: unable to access '${l}': No such file or directory.`),1;if(r.FS.isFile(a))await r.FS.rm(a);else{if(!o)return e.printError(`Error: cannot remove '${l}': Is a directory.`),1;const t=r.FSUtil.deconstructFullPath(a);if("/"==t.path&&i)return e.printError(`Error: refusing to remove "${l}" - it is potentially dangerous.\nYou may specify --no-preserve-root to bypass this message.`),1;if("/"==t.path){const e=r.FS.readdir(a);for(let t of e)r.FS.isFile(t)?await r.FS.rm(t):await r.FS.rmdir(t)}else await r.FS.rmdir(a)}return 0}}},k={name:"cp",aliases:["copy"],register:function(e){return async(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.printlnEscaped(`usage: ${s} <src> <dest> [-R, --overwrite]\nCopies a file.\n\nIf -R is specified, the specified directory will be recursively copied.\nIf --overwrite is specified, it will overwrite the target path.`),0;let i=n.includes("-R"),o=n.includes("--overwrite");d.A.stripOptions(1,n,["-R","--overwrite"]);let a=n[1],l=n[2];if(""==a||null==a)return e.printError(`Error: '${s}' requires a source path argument (none specified).`),1;if(""==l||null==l)return e.printError(`Error: '${s}' requires a dest path argument (none specified).`),1;/^([a-zA-Z]:)/.test(a)||(a=e.resolvePath(e.currentPath,a)),/^([a-zA-Z]:)/.test(l)||(l=e.resolvePath(e.currentPath,l));const c=p.V.escapeHtml(a),u=p.V.escapeHtml(l);if(!r.FS.exists(a))return e.printError(`Error: unable to access '${c}': No such file or directory.`),1;if(r.FS.isFile(a)){if(r.FS.exists(l)){if(!r.FS.isFile(l))return e.printError(`Error: refusing to overwrite '${u}': Target is not a file.`),1;if(!o)return e.printError(`Error: refusing to overwrite '${u}': File exists. Use option --overwrite to overwrite this file.`),1}await r.FS.cpfile(a,l)}else{if(!i)return e.printError(`Error: cannot copy '${c}': Is a directory. Specify -R to copy this directory.`),1;if(r.FS.exists(l)){if(r.FS.isFile(l))return e.printError(`Error: refusing to overwrite '${u}': Target is not a directory.`),1;if(!o)return e.printError(`Error: refusing to overwrite '${u}': Directory exists. Use option --overwrite to overwrite this directory.`),1}await r.FS.cpdir(a,l)}return 0}}},S={name:"mv",aliases:["move"],register:function(e){return async(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.printlnEscaped(`usage: ${s} <src> <dest> [--overwrite]\n       ${s} <srcdir> <destdir> [--merge]\n\nMoves a file or directory.\n\nIf --overwrite is specified, it will overwrite the target path if it exists.\nIf --merge is specified, the target directory will be merged with the source. Merging may overwrite contents that exist in the directory.`),0;let i=n.includes("--overwrite"),o=n.includes("--merge");d.A.stripOptions(1,n,["--overwrite","--merge"]);let a=n[1],l=n[2];if(""==a||null==a)return e.printError(`Error: '${s}' requires a source path argument (none specified).`),1;if(""==l||null==l)return e.printError(`Error: '${s}' requires a dest path argument (none specified).`),1;/^([a-zA-Z]:)/.test(a)||(a=e.resolvePath(e.currentPath,a)),/^([a-zA-Z]:)/.test(l)||(l=e.resolvePath(e.currentPath,l));const c=p.V.escapeHtml(a),u=p.V.escapeHtml(l);if(!r.FS.exists(a))return e.printError(`Error: unable to access '${c}': No such file or directory.`),1;if(r.FS.isFile(a)){if(r.FS.exists(l)){if(!r.FS.isFile(l))return e.printError(`Error: refusing to overwrite '${u}': Target is not a file.`),1;if(!i)return e.printError(`Error: refusing to overwrite '${u}': File exists. Use option --overwrite to overwrite this file.`),1}await r.FS.mvfile(a,l)}else{if(r.FS.exists(l)){if(r.FS.isFile(l))return e.printError(`Error: refusing to overwrite '${u}': Target is not a directory.`),1;if(!o)return e.printError(`Error: refusing to overwrite '${u}': Directory exists. Use option --merge to merge this directory instead.`),1}const t=r.FSUtil.deconstructFullPath(l);if("/"==r.FSUtil.deconstructFullPath(a).path)return e.printError("Error: function not supported."),1;if("/"==t.path)return e.printError("Error: cannot move files directly to root."),0;await r.FS.mvdir(a,l)}return 0}}},x={name:"env",register:function(e){return(t,n)=>{if(n.includes("--help"))return e.printlnEscaped("usage: env [filter]\nPrints all environment variables.\n\nIf [filter] is specified, all variable names containing [filter] will be returned."),0;let s=null==n[1]?"":n[1];let i=c.nP.envKeys().filter((e=>e.includes(s))).map((e=>`${p.V.escapeHtml(e)}<span style="color: cyan;"> = </span>${p.V.escapeHtml(new String(c.nP.getEnv(e))).replace(/\n/g,'<span style="color: red;">\\n</span>').replace(/\t/g,'<span style="color: red;">\\t</span>')}`)).join("\n");e.println(i)}}},C=[w,_,m,{name:"cat",aliases:["type"],register:function(e){return async(t,n)=>{const s=p.V.escapeHtml(t.split(" ")[0]);if(n.includes("--help"))return e.println(`usage: ${s} &lt;path&gt;\nViews the contents of a file.\n\nIf --html is passed, the contents will be parsed as html.`),0;let i=n[1];if(""==i||null==i)return e.printError(`Error: '${s}' requires a file path argument (none specified).`),1;/^([a-zA-Z]:)/.test(i)||(i=e.resolvePath(e.currentPath,i));const o=p.V.escapeHtml(i);return r.FS.exists(i)?r.FS.isFile(i)?void(n.includes("--html")?e.println(await r.FS.readstr(i)):e.println(`${p.V.escapeHtml(await r.FS.readstr(i))}`)):(e.printError("Error: invalid argument."),1):(e.printError(`Error: unable to access '${o}': No such file or directory.`),1)}}},b.g,y,u,h,{name:"exit",register:function(e){return async(t,n)=>e.terminate()}},{name:"title",register:function(e){return(t,n)=>{if(n.includes("--help"))return void e.println("usage: title &lt;text&gt;\nSets the current session title.");const s=t.substring(5).trim();""!=s?e.mainwnd.setTitle(s):e.printError("No title has been specified.")}}},{name:"icon",register:function(e){return(t,n)=>{if(n.includes("--help"))return void e.println("usage: icon &lt;url&gt;\nSets the current window icon.");const s=t.substring(4).trim();""!=s?e.mainwnd.setWindowIcon(s):e.printError("No URL has been specified.")}}},{name:"echo",register:function(e){return async(t,n)=>{if(n.includes("--help"))return void e.println("usage: echo &lt;text&gt;\nOutputs text to the terminal.");const s=t.substring(4).trim();""!=s&&(e.println("").innerText=s+"\n")}}},g,v,E,k,S,x];var O=n(5516),P=n(254);class W extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}async _createWindow(){let e="Windows 96 Terminal";r.FS.exists("c:/system/etc/motd")&&(e=await r.FS.readstr("c:/system/etc/motd"));const t={WINVER:l.d.getVersionString(),ORIGIN:window.location.href,KERNSTATUS:null==localStorage.getItem("kernel-image")?"OFFICIAL":"MODIFIED",APPCOUNT:(0,c.V7)().length.toString(),WEBAPIS:function(){const e=[];"undefined"!=typeof WebGLProgram&&e.push("WebGL"),"undefined"!=typeof indexedDB&&e.push("IndexedDB"),"undefined"!=typeof WebAssembly&&e.push("WebAssembly");let t="";for(let n=0;n<e.length;n++)t+=e[n]+", ";return t.substring(0,t.length-2)}()},n=Object.keys(t);for(let s of n)e=e.replace(new RegExp("%"+s+"%","g"),t[s]);var s=new i.Lw;s.title="Terminal",s.initialWidth=785,s.initialHeight=495,s.resizable=!0;var o=this.createWindow(s,!0);o.registerWindow(),o.registerAppBar(),o.setHtml(`<div class="term">\n            <code class="content">${e}</code>\n            <div class="prompt">\n                <div class="prefix"><span class="path">c:/</span> # </div>\n                <input type="text" spellcheck="false">\n            </div>\n        </div>`);const d=o.wndObject.querySelector(".window-html-content");d.classList.add("terminal-app"),o.setWindowIcon(a.Q.getIconUrl("small/apps/terminal")),o.onlightenelements=()=>{d.querySelector("input").focus()},o.show(),this.mainwnd=o,this.currentPath="c:/",this.commands={},this.history=[],this.registerCommands(),this.initTerm()}registerCommands(){!function(e){for(let t of C){let n=t.register(e);e.commands[t.name]=n;for(let s of t.aliases||[])e.commands[s]=function(){n.call(this,...arguments)}}}(this)}resolvePath(e,t){if(/^([a-zA-Z]:)/.test(t))return t;let n=o.R.resolvePath(e,t);2==n.length&&(n+="/");const s=o.R.deconstructFullPath(this.currentPath).prefix;return n.includes("/")?n:s+n}hidePrompt(){this.promptContainer.style.display="none"}showPrompt(){this.promptContainer.style.display="",this.promptContainer.querySelector("input").focus()}print(e){const t=document.createElement("span");return t.innerHTML=e,this.term.querySelector(".content").appendChild(t),this.term.scrollTop=this.term.scrollHeight,t}println(e){return this.print(e+"\n")}printError(e){this.println(e).style.color="red"}printEscaped(e){return this.print(p.V.escapeHtml(e))}printlnEscaped(e){return this.println(p.V.escapeHtml(e))}async processCommand(e){let t=e;const n=c.nP.envKeys();for(let e in n)t=t.replace(new RegExp("%"+e+"%","gi"));const s=d.A.parse(t);if(s.length<1)return;if((0,c.K2)(s[0])){const e=[...s];return e.splice(0,1),void await(0,c.lw)(s[0],e)}if(/^([a-zA-Z]:)/.test(t)&&2==t.length){const e=t[0]+":";return void(null!=r.FS.get(e)?(this.currentPath=e+"/",this.promptContainer.querySelector(".path").innerText=this.currentPath):this.printError("Device does not exist."))}const i=this.resolvePath(this.currentPath,s[0]);if(r.FS.exists(i))return void P.l.execFile(i);let o=null;for(let e of c.nP.getEnv("path").split(";")){const t=e+"/"+s[0];if(r.FS.exists(t)){o=t;break}}if(null!=o){let e=[...s];return e.splice(0,1),await O.x.execCmd(s[0],e,{term:this}),void(this.promptContainer.querySelector(".path").textContent=this.currentPath)}switch(s[0]){default:if(null==this.commands[s[0]]){this.println(s[0]+": bad command or file name.");break}await this.commands[s[0]](t,s);case"":}this.promptContainer.querySelector(".path").textContent=this.currentPath}async initTerm(){const e=this.mainwnd.getBodyContainer().querySelector(".term"),t=e.querySelector(".prefix"),n=e.querySelector("input"),s=t.querySelector(".path");this.promptContainer=e.querySelector(".prompt"),this.term=e,n.onkeydown=async e=>{if("Enter"==e.key){this.hidePrompt();const t=n.value.toString();n.value="",this.print(`<span style="color: yellow">${s.innerText}</span><span style="color: cyan"> #</span> <span style="color: greenyellow">${p.V.escapeHtml(t)}</span>\n`);try{await this.processCommand(t),""!=t.trim()&&this.println(""),this.history.push(t)}catch(e){this.printError(e)}this.showPrompt(),this.term.scrollTop=this.term.scrollHeight}}}}},3940:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{g:()=>CliCommandWJS});var _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2110),_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5784),_sys_util_html__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3978),_terminal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1384);const CliCommandWJS={name:"wjs",register:function(term){return async(cmdLine,args)=>{if(args.includes("--help"))return term.println("usage: wjs &lt;path&gt; [--no-term] [--no-wrt]\nRuns a JS file in WRT (the Windows 96 JavaScript runtime).\n\nIf --no-wrt is specified, the file will be evaluated in normal JS instead.\nIf --no-term is specified, the WRT application will not know that it is running in a terminal."),0;let pathArg=args[1];if(""==pathArg||null==pathArg)return term.printError("Error: 'wjs' requires a file path argument (none specified)."),1;/^([a-zA-Z]:)/.test(pathArg)||(pathArg=term.resolvePath(term.currentPath,pathArg));const htmlSafePath=_sys_util_html__WEBPACK_IMPORTED_MODULE_2__.V.escapeHtml(pathArg);if(!_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_1__.FS.exists(pathArg))return term.printError(`Error: unable to access '${htmlSafePath}': No such file or directory.`),1;if(!_sys_fs_webfs__WEBPACK_IMPORTED_MODULE_1__.FS.isFile(pathArg))return term.printError("Error: invalid argument."),1;try{args.includes("--no-wrt")?eval(await _sys_fs_webfs__WEBPACK_IMPORTED_MODULE_1__.FS.readstr(pathArg)):await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_0__.D.runFile(pathArg,{boxedEnv:args.includes("--no-term")?null:{term,cwd:term.currentPath},envType:"terminal"})}catch(e){term.printError(`${_sys_util_html__WEBPACK_IMPORTED_MODULE_2__.V.escapeHtml(e)}`)}}}}},619:(e,t,n)=>{"use strict";n.r(t),n.d(t,{UploaderApplication:()=>c});var s=n(4186),i=n(7366),o=(n(4876),n(9338)),r=n(5784),a=n(4420),l=(n(5685),n(4367));class c extends s.WApplication{constructor(){super()}async main(e){super.main(e),this._createWindow()}async _createWindow(){var e=new i.Lw;e.title="Uploader",e.initialWidth=300,e.initialHeight=150,e.resizable=!1;var t=this.createWindow(e,!0);t.registerWindow(),t.registerAppBar(),t.setControlBoxStyle("WS_CBX_CLOSE"),t.setHtml('Choose files below and press "Start" to upload them.<br><br>The uploaded files will be saved to the desktop.\n        <br><br>\n        <input type="file" class="w96-textbox" multiple=""><br>\n        <button class="w96-button start">Start</button>');const n=t.wndObject.querySelector(".window-html-content");n.classList.add("uploader-app"),t.setWindowIcon(a.Q.getIconUrl("small/uploader"));const s=n.querySelector(".start"),c=n.querySelector("input");s.onclick=async()=>{s.disabled=!0;const e=o.jC.idleProgress("Upload in progress","The selected files are being saved, please wait...");e.show();for(let e=0;e<c.files.length;e++){const t=c.files.item(e);console.log("Writing c:/user/desktop/"+t.name);const n=new Uint8Array(await t.arrayBuffer());await r.FS.writebin("c:/user/desktop/"+t.name,n)}setTimeout((()=>{s.disabled=!1,e.closeDialog(),l.C.updateDesktop()}),250)},t.show(),t.center()}}},3327:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WASMToolsApplication:()=>p});var s=n(4186),i=n(9338),o=(n(5784),n(7366)),r=n(4420),a=n(5544),l=n(9110);function c(e){return null==e?-1:e}function d(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}class p extends s.WApplication{constructor(){super()}async main(e){super.main(e),"undefined"!=typeof WebAssembly?null!=e[0]?this._createWindow(e[0]):new i.MT("c:/",["wasm","WASM"],(e=>{e?this._createWindow(e):this.terminate()})).show():i.jC.error("Unsupported Platform",'<span class="bold-noaa">Critical Error:</span> This browser does not support WebAssembly.',"OK")}async _createWindow(e){var t=new o.Lw;t.title="WASM Tools",t.initialWidth=410,t.initialHeight=365,t.resizable=!0;var n=this.createWindow(t,!0);n.registerWindow(),n.registerAppBar(),n.setHtml(""),n.setWindowIcon(r.Q.getIconUrl("small/apps/wasm-tools"));const s=n.wndObject.querySelector(".window-html-content");s.classList.add("wasmtools-app");const l=new a.a;try{await this.loadFile(e)}catch(e){console.log(e),i.jC.error("Error","Cannot load WebAssembly file!","OK"),this.terminate()}const c=l.addPage("Exported Functions",(e=>this._page_exportedFunctions(e)));l.setSize("100%","100%"),s.appendChild(l.getElement());const d=document.createElement("footer");d.classList.add("w96-footer"),d.innerText=e,s.appendChild(d),n.show(),l.openPage(c)}async _page_exportedFunctions(e){const t=document.createElement("div");t.classList.add("readonly-tbox"),this.exports.forEach((e=>{const n=document.createElement("span");n.classList.add("line"),n.innerHTML='<span style="color: royalblue">ƒ</span> '+e,t.appendChild(n)})),e.appendChild(t)}readImports(e){const t=[0,1,3],n=[];for(let s=6;s<e.length&&!d([c(e[s]),c(e[s+1]),c(e[s+2])],t);s++)n.push(e[s]);const s=[];n.forEach((e=>s.push(String.fromCharCode(e))));return s.join("").replace(/\W/gi," ").split(" ").filter((e=>""!=e&&("imports"!=e&&!/^[0-9]/.test(e))))}async loadFile(e){const t=await l.K.loadLocal(e,!0);this.exports=Object.keys(t.instance.exports)}}},6005:(e,t,n)=>{"use strict";n.d(t,{K:()=>i});var s=n(4186);class i extends s.WApplication{constructor(){super()}main(e){super.main(e)}}},8662:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WMSMApp:()=>p});var s=n(8041),i=n(4420),o=n(3970),r=n(2589),a=n(5544),l=n(7366),c=n(5784),d=n(4186);class p extends d.WApplication{constructor(){super(),this.wmConfig=l.C$.getConfig()}async syncConfig(){await c.FS.writestr("c:/system/config/wm.json",JSON.stringify(this.wmConfig,null,4))}async main(e){super.main(e),this.wmConfig={...l.C$.getConfig()};const t=this.createWindow({title:"96WM Settings Manager",initialWidth:370,initialHeight:443,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",bodyClass:"wmsm-app",icon:i.Q.getIconUrl("small/misc/wm"),body:'<div class="tabc"></div>\n            <div class="buttons">\n                <button class="w96-button apply" disabled>Apply</button>\n                <button class="w96-button cancel">Cancel</button>\n                <button class="w96-button ok">OK</button>\n            </div>',center:!0,taskbar:!0,mobResize:!0}),n=t.getBodyContainer();n.classList.add("applet-base");const c=new a.a;c.openPage(c.addPage("Basic",(async e=>{e.style.padding="10px",e.style.boxSizing="border-box",e.innerHTML=`\n                <div class="icon-box">\n                    <div class="icon" style="background-image: url(${i.Q.getIconUrl("misc/wm")});"></div>\n                    <div class="text">\n                        Windows 96 includes a reasonable Window Manager (WM) which can be customized with this utility.<br><br>\n                        <span class="bold-noaa">Important! </span>Themes can override some of these settings!\n                    </div>\n                </div>\n                <div class="grpbx1"></div>\n                <div class="grpbx2"></div>\n            `;const t=new r.E({title:"Window Dragging",body:""}),n=new r.E({title:"Appearence",body:""}),s=t.getElement().querySelector(".content"),a=n.getElement().querySelector(".content");s.appendChild(new o.J({label:"Hide window contents on drag",checked:this.wmConfig.dragging.hideWindow,onchange:e=>this.wmConfig.dragging.hideWindow=e.checked,displayAsBlock:!0}).getElement()),s.appendChild(new o.J({label:"Allow window snapping on edge drag",checked:this.wmConfig.features.windowSnap,onchange:e=>this.wmConfig.features.windowSnap=e.checked,displayAsBlock:!0}).getElement()),a.appendChild(new o.J({label:"Enable ClearFix for sharper pixel fonts on the titlebar (experimental)",checked:this.wmConfig.features.enableClearFix,onchange:async e=>{for(var t in this.wmConfig.features.enableClearFix=e.checked,w96.WindowSystem.windows)(t=w96.WindowSystem.windows[t])&&(t.setWindowIcon(t.windowIcon),t.setTitle(t.title))},displayAsBlock:!0}).getElement()),a.appendChild(new o.J({label:"Use 12 hour time instead of 24 hour time in the clock",checked:this.wmConfig.features.use12hTime,onchange:async e=>{this.wmConfig.features.use12hTime=e.checked,w96.wmem.clockUpdate()},displayAsBlock:!0}).getElement()),e.querySelector(".grpbx1").replaceWith(t.getElement()),e.querySelector(".grpbx2").replaceWith(n.getElement())}))),c.addPage("Performance",(async e=>{e.style.padding="10px",e.style.boxSizing="border-box",e.innerHTML=`\n                <div class="icon-box">\n                    <div class="icon" style="background-image: url(${i.Q.getIconUrl("gpu_card")});"></div>\n                    <div class="text">\n                        You can modify the Window Manager to match your system performance below.\n                    </div>\n                </div>\n                <div class="grpbx1"></div>\n            `;const t=new r.E({title:"Graphical Tweaks",body:""}),n=t.getElement().querySelector(".content");n.appendChild(new o.J({label:"Disable animations",checked:this.wmConfig.features.disableAllAnimations,onchange:e=>this.wmConfig.features.disableAllAnimations=e.checked,displayAsBlock:!0}).getElement()),n.appendChild(new o.J({label:"Use simple window dragging outline",checked:this.wmConfig.dragging.simpleDragBox,onchange:e=>this.wmConfig.dragging.simpleDragBox=e.checked,displayAsBlock:!0}).getElement()),e.querySelector(".grpbx1").replaceWith(t.getElement())})),n.querySelector(".tabc").replaceWith(c.getElement()),n.querySelector("button.cancel").addEventListener("click",(()=>t.close())),n.querySelector("button.ok").addEventListener("click",(()=>{this.applySettings(),t.close()})),t.show(),"true"!=localStorage.getItem("wmsm_started")&&(s.O.create({title:"WMSM",icon:"info",body:"This tool allows you to configure the window manager to your liking.<br><br>Please note that you can revert to the default settings by removing c:/system/config/wm.json"}),localStorage.setItem("wmsm_started","true"))}async applySettings(){await this.syncConfig(),l.C$.setConfig(this.wmConfig)}}},4186:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WApplication:()=>r,processes:()=>o});var s=n(7366),i=0,o=new Array(8192);class r{constructor(){if(this.appId=i++,this.appId>o.length)throw new Error("Maximum number of processes reached, id >= "+o.length);o[this.appId]=this,this.appWindow=null,this.windows=[],this.onterminated=null,this._running=!1,this._terminating=!1,this._appResult=null}static kill(e,t){var n=o[e];if(null==n)throw new Error("Application not found.");t?console.error("TODO force kill proc"):(n.ontermination(),delete o[e])}static execAsync(e,t){return new Promise((async(n,s)=>{try{e.onterminated=function(e){n(e)};let s=await e.main(null==t?[]:t);e.windows.length<1&&n(s)}catch(e){s(e)}}))}setAppResult(e){this._appResult=e}terminate(){this.ontermination()}createWindow(e,t){var n=new s.DI(e);if(t&&null!=this.appWindow)throw new Error("An application window has already been defined.");if(t){this.appWindow=n;var i=this;this.appWindow.onfinalclose=function(){i.ontermination()},this.windows.push(this.appWindow)}else this.windows.push(n);return n}main(e){if(!(e instanceof Array))throw new Error("Invalid argument.");if(this._running)throw new Error("The application has already started. Please create a new instance using the `new` operator.");this._running=!0}ontermination(){if(!this._terminating){this._terminating=!0;for(var e=0;e<this.windows.length;e++){var t=this.windows[e];if(null==this.appWindow||this.appWindow.id!=t.id){try{t.close()}catch(e){console.error("Failed to close window for application `"+this.appId+"`.")}this.windows[e]=null}}null!=this.appWindow&&this.appWindow.close(),this.appWindow=null,o.splice(this.appId,1),null!=this.onterminated&&this.onterminated(this._appResult)}}}},2677:(e,t,n)=>{"use strict";var s=n(4420),i=n(7366),o=n(3177);class r{constructor(e){this.cursorPath="system/resource/cursors/default.png",this.width=12,this.height=21,this.x=0,this.y=0,this.container="string"==typeof e?document.querySelector(e):e,this.element=null}_updatePosition(){this.element.style.left=`${this.x}px`,this.element.style.top=`${this.y}px`}init(){this.element||(this.element=document.createElement("div"),this.element.style.background=`url(${this.cursorPath})`,this.element.style.backgroundRepeat="no-repeat",this.element.style.position="absolute",this.element.style.zIndex="100000000",this.element.style.width=`${this.width}px`,this.element.style.height=`${this.height}px`,this.element.setAttribute("role","fake-cursor"),this._updatePosition(),this.container.appendChild(this.element))}setPosition(e,t){this.x=e,this.y=t,this._updatePosition()}performClick(e){var t=new MouseEvent("click",{clientX:this.x,clientY:this.y,button:e}),n=null;for(var s of document.elementsFromPoint(this.x,this.y))if("fake-cursor"!=s.getAttribute("role")){n=s;break}n.dispatchEvent(t)}}n(5544);var a=n(1194),l=(n(9338),n(5784)),c=(n(5516),n(254)),d=n(4779);window.wndev={applyZoom125x:function(){var e=document.createElement("style");e.innerText=".window-dlg {\n            transform: scale(1.25);\n        }",document.body.appendChild(e)},bsod:function(){(0,o.A)("Test blue screen from Dev Tools.")},wipeStorage:function(){localStorage.clear(),sessionStorage.clear(),window.indexedDB&&indexedDB.deleteDatabase("W96FS")},performanceMode:function(){var e=document.createElement("style");e.innerText=".window-dlg {\n            box-shadow: none !important;\n        }\n        \n        .user-desktop {\n            background: none !important;\n        }",document.body.appendChild(e)},kbdFakeCursor:function(){var e=new r("#maingfx");e.init(),document.body.onkeydown=t=>{switch(t.key){case"ArrowUp":e.setPosition(e.x,e.y-10);break;case"ArrowDown":e.setPosition(e.x,e.y+10);break;case"ArrowLeft":e.setPosition(e.x-10,e.y);break;case"ArrowRight":e.setPosition(e.x+10,e.y);break;case"Enter":e.performClick(0)}}},css3_3dtest:function(){const e=new i.Lw;e.title="CSS 3D test";const t=new i.DI(e);t.registerWindow(),t.registerAppBar(),t.setWindowIcon(s.Q.getIconUrl("small/apps/gltest")),t.setHtml("");const n=t.getBodyContainer();n.classList.add("css3d-test-app");const o=new a.k;n.appendChild(o.getElement()),t.show(),t.center()},fs_dumpInfo:async function(){let e="Win96 Dev Tools Dump - FileSystem dump.\nPrefix | Driver Name | Features\n\n",t="c:/system/debug/fs_dump.txt";for(let t of l.FS.mounts())e+=`${t.prefix}, ${t.driverName}, [${t.features.join(" ")}]\n`;await l.FS.writestr(t,e),c.l.execFile(t)},fs_dumpFts:async function(){let e="Win96 Dev Tools Dump - File System Tables dump.\nPath | Ref ID | Length\n\n",t="c:/system/debug/ftbls.txt";for(let t of l.FS.mounts()){const n=t._fileTable;if(e+=`-- Begin File Table for ${t.prefix} ("${t.volumeLabel}", ${t.driverName}, [${t.features.join(" ")}]) --\n`,null==n){e+="** [ No File Table is present ] **\n-- End File Table --\n\n";continue}const s=Object.keys(n);for(let t of s)try{e+=`${t}, ${null!=n[t].recordId?n[t].recordId:"NULL"}, ${n[t].length}\n`}catch(n){e+=` ** Failed to read entry for ${t} **\n`}e+="-- End File Table --\n\n"}await l.FS.writestr(t,e),c.l.execFile(t)},ui_createEmptyWindow:function(){const e=new i.Lw;e.title="Untitled";const t=new i.DI(e);t.registerWindow(),t.registerAppBar(),t.setHtml(""),t.show()},fs_walkRoot:function(){const e=l.FS.get("c:");if(!e._fileTable)return;const t=Object.keys(e._fileTable),n=new i.Lw;n.title="FS root walk",n.initialWidth=250,n.initialHeight=160;const s=new i.DI(n);s.registerWindow(),s.registerAppBar();const o=s.getBodyContainer(),r=new d.w;for(let e of t)r.addItem(e,e);o.appendChild(r.getElement()),s.show()}}},51:(e,t,n)=>{"use strict";n.d(t,{z:()=>s});const s={showDOMFps:function(){const e=document.createElement("div");e.classList.add("dbg-fps-counter"),e.textContent="0 fps",document.body.appendChild(e);let t=0,n=()=>{t++,requestAnimationFrame(n)};setInterval((()=>{e.textContent=`${t} fps`,t=0}),1e3),n()}}},9951:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,s:()=>o});const s={simpleAnimation:!1};function i(e){s.simpleAnimation=e}function o(e,t,n){s.simpleAnimation&&"function"==typeof n&&n();var i=null;function o(){i.classList.remove("animated",t),i.removeEventListener("animationend",o),"function"==typeof n&&n()}"string"!=typeof e?i=e:document.querySelector(e),i.classList.add("animated",t),t?i.addEventListener("animationend",o):o()}},9338:(e,t,n)=>{"use strict";n.d(t,{MT:()=>p,_5:()=>m,_p:()=>h,jC:()=>_,pp:()=>u});var s=n(7366),i=n(4876),o=n(5784),r=n(3978),a=n(6770),l=n(4420);function c(e,t,n){var s=new h(e,t,"info",n);return s.show(),s}function d(e,t,n){var s=new h(e,t,"warning",n);return l.Q.playSound("asterisk"),s.show(),s}class p{constructor(e,t,n){this.currentPath=e[0].toUpperCase()+e.substring(1),this.completed=!1,this.callback=n,this.filter=t,this.title="Select a file",this._createWindow()}_createWindow(){var e={x:window.innerWidth/2-207.5|0,y:window.innerHeight/2-190|0},t=new s.Lw;t.title=this.title,t.initialX=e.x,t.initialY=e.y,t.initialHeight=380,t.initialWidth=415,t.animations.windowOpen="heartBeat",this.dlg=new s.DI(t),this.dlg.setControlBoxStyle(s.KZ.WS_CBX_CLOSE),this.dlg.setHtml(""),this.dlg.registerWindow(),this.dlg.onclose=()=>{this.completed||this.callback&&this.callback(null)},this._pos=e;const n=this.dlg.wndObject.querySelector(".window-html-content");n.classList.add("wexplorer-app","cdlg-ofd");const r=document.createElement("div");r.classList.add("nav-bar"),r.innerHTML='<button class="w96-button up"></button>\n        <input type="text" class="nav">\n        <button class="w96-button go"></button>';const l=r.querySelector(".go"),c=r.querySelector(".up");this.pathBar=r.querySelector(".nav"),l.onclick=()=>{this._navigate(this.pathBar.value)},c.onclick=()=>{if("computer://"==this.pathBar.value)return;const e=i.R.deconstructFullPath(this.pathBar.value);"/"==e.path?this._navigate("computer://"):this._navigate(e.prefix+i.R.getParentPath(e.path))},this.pathBar.onkeydown=e=>{"Enter"==e.key&&this._navigate(this.pathBar.value)},this.fsv=new a.n(this.currentPath),this.fsv.init(),this.fsv.uiComponent.style.width=t.initialWidth+"px",this.fsv.uiComponent.style.height=t.initialHeight+"px",this.fsv.setSize("100%","100%"),this.fsv.readdirFunc=e=>o.FS.readdir(e).filter((e=>{if(!o.FS.isFile(e))return!0;for(var t of this.filter)if(t instanceof RegExp){if(t.test(e))return!0}else if(e.toLowerCase().endsWith(t.toString()))return!0;return!1})),this.fsv.onitemdblclick=e=>{switch(e.getAttribute("ent")){case"0":this.completed=!0,this.callback(e.getAttribute("path")),this.dlg.close();break;case"1":case"2":this.fsv.deselectAllIcons(),this._navigate(e.getAttribute("path"))}},this.dlg.ondarkenelements=()=>{this.fsv.uiComponent.querySelectorAll(".shell-icon.selected").forEach((e=>{e.classList.add("inactive")}))},this.dlg.onlightenelements=()=>{this.fsv.uiComponent.querySelectorAll(".shell-icon.inactive").forEach((e=>{e.classList.remove("inactive")}))};const d=document.createElement("div");d.classList.add("bp"),d.innerHTML='\n            <div class="input-area">\n                <span>File Name: </span><input class="w96-textbox" type="text">\n            </div>\n            <div class="buttons">\n                <button class="w96-button open">Open</button>\n                <button class="w96-button cancel">Cancel</button>\n            </div>\n        ';const p=d.querySelector("input");this.fsv.onitemselected=e=>{"0"==e.getAttribute("ent")&&(p.value=i.R.fname(e.getAttribute("path")))};d.querySelector("button.cancel").onclick=()=>{this.dlg.close()};d.querySelector("button.open").onclick=()=>{this._conclude()},p.onkeypress=e=>{"Enter"==e.key&&this._conclude()},this.fileBox=p,n.appendChild(r),n.appendChild(this.fsv.getElement()),n.appendChild(d)}_conclude(){const e=this.fileBox.value.includes("/")?this.fileBox.value:3==this.currentPath.length?this.currentPath+this.fileBox.value:this.currentPath+"/"+this.fileBox.value;if(null!=e&&""!=e.trim())if(o.FS.exists(e)){if(!o.FS.isFile(e))return this.fileBox.value="",void this._navigate(e);this.completed=!0,this.callback(e),this.dlg.close()}else d("Error","The specified file does not exist.","OK");else d("Error","No valid item was selected!","OK")}_navigate(e){"computer://"==e||o.FS.exists(e)||_.error("Error","Directory does not exist.","OK"),this.currentPath=e,this.pathBar.value=this.currentPath,this.fsv.navigate(e,(e=>{}))}show(){this.dlg.show(),this.dlg.wndObject.style.left=this._pos.x+"px",this.dlg.wndObject.style.top=this._pos.y+"px",this._navigate(this.currentPath)}}class u extends p{constructor(e,t,n){super(e,t,n),this.title="Save File",this.dlg.setTitle(this.title);this.dlg.wndObject.querySelector("button.open").innerText="Save"}_conclude(){const e=this.fileBox.value.includes("/")?this.fileBox.value:3==this.currentPath.length?this.currentPath+this.fileBox.value:this.currentPath+"/"+this.fileBox.value;!o.FS.exists(e)||o.FS.isFile(e)?(this.completed=!0,this.callback(e),this.dlg.close()):d("Error","Unable to save file.","OK")}}class h{constructor(e,t,n,i,o){var r={x:window.innerWidth/2-l.Q.uiVars.defaults.mbox.w/2|0,y:window.innerHeight/2-l.Q.uiVars.defaults.mbox.h/2|0};this.onclose=o,this.icon=n;var a=new s.Lw;a.title=e,a.initialX=r.x,a.initialY=r.y,a.initialHeight=l.Q.uiVars.defaults.mbox.h,a.initialWidth=l.Q.uiVars.defaults.mbox.w,a.resizable=!1,a.animations.windowOpen="anim-null",a.animations.windowClose="anim-null",this.dlg=new s.DI(a),this.dlg.setControlBoxStyle(s.KZ.WS_CBX_CLOSE),this.dlg.registerWindow(),this.dlg.onclose=o,this.dlg.setHtml(`\n            <div class="mbox">\n                <div class="content">\n                    <div class="icon ${n}"></div>\n                    <div class="text">${t}</div>\n                </div>\n                <div class="buttons">\n                    <button autofocus onclick="this.associatedWindow.close()" class="w96-button btnok">${i}</button>\n                </div>\n            </div>\n        `);var c=this.dlg.wndObject.querySelector(".btnok");c.associatedWindow=this.dlg,this.btnOk=c}show(){var e=window.innerWidth/2-l.Q.uiVars.defaults.mbox.w/2|0,t=window.innerHeight/2-l.Q.uiVars.defaults.mbox.h/2|0;if(this.dlg.show(),this.dlg.wndObject.style.left=e+"px",this.dlg.wndObject.style.top=t+"px","error"===this.icon)l.Q.playSound("error");setTimeout((()=>{this.dlg.activate(),this.btnOk.focus()}),100)}setSize(e,t){return this.dlg.setSize(e,t),this}closeDialog(){this.dlg.close()}}function m(e){let t=new String(e);e instanceof Error&&(t=e.message+"\n"+e.stack);const n=new s.DI({title:"Exception",taskbar:!1,bodyClass:"dlg-except",body:`<div class="top">\n            <div class="std-message">\n                <div class="icon" style="background-image: url(${l.Q.getIconUrl("error")})"></div>\n                <div class="text">\n                    This application has caused an exception and will be closed.<br><br>Contact the maintainer if this problem persists.\n                </div>\n            </div>\n            <div class="buttons">\n                <button class="w96-button">Close</button>\n            </div>\n        </div>\n        <textarea class="ex w96-textbox" readonly>${t}</textarea>`,initialWidth:404,initialHeight:269,animations:{windowOpen:"anim-null",windowClose:"anim-null"},center:!0,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",mobResize:!0});n.getBodyContainer().querySelector(".w96-button").addEventListener("click",(()=>n.close())),n.show()}const _={error:function(e,t,n){var s=new h(e,t,"error",n);return s.show(),s},warning:d,info:c,status:function(e,t){var n={x:window.innerWidth/2-154.5|0,y:window.innerHeight/2-62.5|0},i=new s.Lw;i.initialWidth=310,i.initialHeight=125,i.initialX=n.x,i.initialY=n.y,i.resizable=!1,i.animations.windowOpen="anim-null",i.animations.windowClose="anim-null";var o=new s.DI(i);return o.setControlBoxStyle(s.KZ.WS_CBX_NONE),o.registerWindow(),o.setTitle(e),o.setHtml(`<div class="w96-panel" style="width: 100%; height: 100%; display: flex;">\n        <div id="msg" style="margin: auto;">\n            ${t}\n        </div>\n    </div>`),o.show(),o.wndObject.style.left=n.x+"px",o.wndObject.style.top=n.y+"px",o},prompt:function(e,t,n,i){var o={x:window.innerWidth/2-156|0,y:window.innerHeight/2-62.5|0},a=new s.Lw;a.initialWidth=310,a.initialHeight=125,a.initialX=o.x,a.initialY=o.y,a.resizable=!1;var l=new s.DI(a);l.setControlBoxStyle(s.KZ.WS_CBX_CLOSE),l.registerWindow(),l.setTitle(e),l.setHtml(`<div class="w96-panel prompt-container">\n        <div class="message">\n            ${t}\n        </div>\n        <input class="w96-textbox" value="${r.V.escapeHtml(n)}">\n        <div class="buttons">\n            <button class="w96-button cancel">Cancel</button>\n            <button class="w96-button ok">OK</button>\n        </div>\n    </div>`);var c=!1;l.onclose=function(){c||i(null)};const d=l.wndObject.querySelector(".prompt-container"),p=d.querySelector(".w96-textbox");return l.onshown=function(){p.focus(),""!=n.trim()&&(p.selectionEnd=p.value.length)},l.show(),l.wndObject.style.left=o.x+"px",l.wndObject.style.top=o.y+"px",d.querySelector(".w96-button.ok").onclick=function(){i(p.value),c=!0,l.close()},d.querySelector(".w96-button.cancel").onclick=function(){i(null),c=!0,l.close()},p.onkeyup=function(e){"Enter"==e.key&&(i(p.value),c=!0,l.close(),p.onkeyup=null)},l.onshown(),l},confirm:function(e,t,n="warning"){var s=new h("Confirmation",e,n,"OK");l.Q.playSound("question");const i=s.dlg.wndObject.querySelector(".mbox>.buttons"),o=i.querySelector(".btnok"),r=document.createElement("button");o.setAttribute("onclick",""),r.classList.add("w96-button","btncancel"),r.associatedWindow=s.dlg,r.innerText="Cancel",i.prepend(r);var a=!1;return s.dlg.onclose=function(){a||t(!1)},o.onclick=()=>{a=!0,t(!0),s.dlg.close()},r.onclick=()=>{a=!0,t(!1),s.dlg.close()},s.show(),s},idleProgress:function(e,t){const n=c(e,t+'<div style="margin-top: 10px;" class="w96-progressbar"><div class="progress"></div></div>',"OK");return n.dlg.setControlBoxStyle("WS_CBX_NONE"),n.dlg.wndObject.querySelector(".buttons").remove(),n.dlg.setSize(320,115),n.show(),n.dlg.center(),n}}},674:(e,t,n)=>{"use strict";n.d(t,{u:()=>r});var s=n(9275);n(7366);let i=!1,o=new s.v;const r={callComposite:function(e){if(!i)return!1;o.emit("compose",{wnd:e})},enable:function(e){e&&console.log("wcomp is enabled."),i=e},events:o}},8041:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var s=n(4420),i=n(7366);class o{constructor(e){this.params={title:"Alert",icon:"warning",body:"Sample text",buttons:[{id:"ok",text:"OK",action:"$close"}],sounds:{error:s.Q.getSound("error"),warning:s.Q.getSound("asterisk"),info:s.Q.getSound("asterisk"),question:s.Q.getSound("question")},events:{onclose:null,onshown:null},maxWidth:null,maxHeight:null,...e},this._resolveFn=null,this.wnd=new i.DI({title:this.params.title,controlBoxStyle:i.KZ.WS_CBX_CLOSE,resizable:!1,initialHeight:140,initialWidth:322,body:`<div class="mbox">\n                <div class="content">\n                    ${this.params.icon.includes("/")?`<div class="icon" style="background-image: url(${this.params.icon})"></div>`:`<div class="icon ${this.params.icon}"></div>`}\n                    <div class="text">${this.params.body}</div>\n                </div>\n                <div class="buttons">\n                    \n                </div>\n            </div>`,animations:{windowClose:"anim-null",windowOpen:"anim-null"}}),this.wnd.wndObject.style.height="auto",this.wnd.wndObject.style.width="auto",this.params.maxWidth&&(this.wnd.wndObject.style.maxWidth=this.params.maxWidth+"px"),this.params.maxHeight&&(this.wnd.wndObject.style.maxHeight=this.params.maxHeight+"px"),this.closing=!1,this.wnd.onclose=e=>{this.params.events.onclose&&!this.closing&&this.params.events.onclose({dlg:this,e})};const t=this.wnd.getBodyContainer(),n=t.querySelector(".buttons");t.classList.add("d"),this.params.buttons.forEach((e=>{const t=document.createElement("button");if(t.classList.add("w96-button"),e.id&&t.classList.add(e.id),t.innerText=e.text,"string"==typeof e.action){if("$close"===e.action)t.addEventListener("click",(()=>this.close()))}else e.action&&t.addEventListener("click",(()=>e.action({btn:t,dlg:this})));n.appendChild(t)}))}close(){this.closing=!0,this.wnd.close(),this.params.events.onclose&&this.params.events.onclose({dlg:this}),this._resolveFn&&(this._resolveFn(),this._resolveFn=null),this.wnd=null,this.params=null}wait(){return new Promise((e=>this._resolveFn=e))}show(){this.wnd.show(),this.params.sounds[this.params.icon]&&new Audio(this.params.sounds[this.params.icon]).play(),this.params.events.onshown&&this.params.events.onshown({dlg:this});const e=this.wnd.getBodyContainer().querySelector(".mbox>.content>.text");this.params.maxWidth&&(e.style.maxWidth=`${this.params.maxWidth}px`),-1==this.params.maxHeight&&(e.style.maxHeight="")}center(){const e=this.wnd.getComputedBounds();this.wnd.setPosition(window.innerWidth/2-e.width/2,window.innerHeight/2-e.height/2)}body(){return this.wnd.getBodyContainer()}}const r={alert:function(e,t={}){return r.create({body:e,icon:"warning",...t})},create:function(e){let t=new o(e);return t.show(),t.center(),t},Dialog:o}},4871:(e,t,n)=>{"use strict";n.d(t,{K:()=>s});class s{constructor(e,t){this.onclick=function(){},this.ondblclick=function(){},this.notifyElement=document.createElement("div"),this.notifyElement.id=null!=e?e:Math.floor(1e3*Math.random())+"_ic",this.notifyElement.style.backgroundImage=`url(${t})`,this.notifyElement.classList.add("notify-icon","notify-item"),this.notifyElement._nObject=this,this.notifyElement.setAttribute("onclick","if(this._nObject.onclick != null) this._nObject.onclick();"),this.notifyElement.setAttribute("ondblclick","if(this._nObject.ondblclick != null) this._nObject.ondblclick();")}hide(){this.notifyElement.style.display="none"}show(){this.notifyElement.style.display=""}setIcon(e){this.notifyElement.style.backgroundImage=`url(${e})`}setId(e){this.notifyElement.id=null!=e?e:Math.floor(1e3*Math.random())+"_ic"}destroy(){this.notifyElement._nObject=null,this.notifyElement.remove()}get[Symbol.toStringTag](){return"NotifyIcon"}}},4420:(e,t,n)=>{"use strict";n.d(t,{Q:()=>w});var s=n(5784),i=n(4367);class o{constructor(e){}print(e){return document.createElement("span")}print_styled(e,t){this.print(e).setAttribute("style",null==t?"":t)}println_styled(e,t){this.print_styled(e+"<br>",t)}println(e){this.print(e+"<br>")}error(e){this.print(`<span style="color: red;">[ ! ]: ${e}</span><br>`)}warn(e){this.print(`<span style="color: yellow;">[ ! ]: ${e}</span><br>`)}close(){}}var r={default:{name:"Default Windows 96 Theme",description:"The default theme for Windows 96",themeType:"normal",icons:{normal:"system/resource/themes/default/icons",small:"system/resource/themes/default/icons/small"},sounds:{error:"system/resource/sounds/error.mp3",question:"system/resource/sounds/ding.mp3",asterisk:"system/resource/sounds/ding.mp3",start:"system/resource/sounds/start.mp3",shutdown:"system/resource/sounds/shutdown.mp3"}},utopia:{name:"Utopia (sounds)",description:"Windows 2000 Utopia sounds",themeType:"normal",icons:{normal:"system/resource/themes/default/icons",small:"system/resource/themes/default/icons/small"},sounds:{error:"system/resource/sounds/utopia/error.mp3",question:"system/resource/sounds/utopia/question.mp3",asterisk:"system/resource/sounds/utopia/asterisk.mp3",ctxmenuopen:"system/resource/sounds/utopia/ctxmenuopen.mp3",ctxmenuhover:"system/resource/sounds/utopia/ctxmenuhover.mp3",ctxmenucmd:"system/resource/sounds/utopia/ctxmenucmd.mp3",minimize:"system/resource/sounds/utopia/minimize.mp3",restore:"system/resource/sounds/utopia/restore.mp3",navigate:"system/resource/sounds/utopia/navigate.mp3",maximize:"system/resource/sounds/utopia/maximize.mp3",start:"system/resource/sounds/utopia/start.mp3"}},xp:{name:"WinXP theme",description:"Winxp theme",themeType:"normal",icons:{normal:"system/resource/themes/xp/icons",small:"system/resource/themes/xp/icons/small"},sounds:{error:"system/resource/sounds/error.mp3"}},base:{name:"Base",description:"Base OSS theme for Windows 96",themeType:"normal",icons:{normal:"system/resource/themes/base/icons",small:"system/resource/themes/base/icons/small"},sounds:{error:"system/resource/sounds/error.mp3"}},dev:{name:"Dev",description:"Theme for theme developers",themeType:"normal",icons:{normal:"system/resource/themes/dev/icons",small:"system/resource/themes/dev/icons/small"},sounds:{error:"system/resource/sounds/error.mp3"}}};const a={titlebarIconPadding:"19px",maxWindowSizeFormulaW:"calc(100vw)",maxWindowSizeFormulaH:"calc(100vh - 28px)",defaults:{mbox:{w:322,h:110}},tbOffsetH:0,tbOffsetW:0,superbarEnabled:!1,clearFixEnabled:!0};var l=Object.assign({},a);function c(e,t="normal",n="png"){var i=r[w.currentTheme];if(null==i)return"system/resource/misc/missing.png";if(null==i.icons[t])return"system/resource/misc/missing.png";let o=`${i.icons[t]}/${e}.${n}`;return s.FS.mounts().find((e=>"W:"==e.prefix))&&!s.FS.exists(`W:/${o}`)&&(o=`${r.default.icons[t]}/${e}.${n}`),o}const d={"C:/trash":"trash-full","C:/system":"folder-sys","W:/system":"folder-sys","W:/system/libraries/kernel/sys-base/kernel.js":"misc/skull"},p={".txt":"text",".html":"html",".c":"file_c",".h":"file_h",".css":"css",".obj":"object",".js":"js",".md":"markdown",".bmp":"image",".png":"image2",".jpg":"image3",".mp3":"music",".ogg":"music",".mp4":"video",".lnk":"ms-shortcut",".ttf":"ttf",".otf":"otf",".url":"url",".zip":"zip",".flv":"flash",".img":"hdd",".vhd":"hdd",".json":"objtext",".nes":"nes_rom",".wat":"wat",".wasm":"wat",".wast":"wat",".iso":"iso",".exe":"exec",".wex":"exec",".lnk42":"lnk42",".swf":"flash",".cbg":"cbg",".gif":"empty",".dwp":"dwp",".avif":"avif",".jxl":"jxl",".bin":"binary",".pdf":"pdf",".sh":"code",".perl":"code",".py":"python",".pyc":"python2",".pyo":"python2",".pyd":"python2",vmlinux:"misc/linux",vmlinuz:"misc/linux",bzImage:"misc/linux",zImage:"misc/linux",NTLDR:"misc/skull",bootmgr:"misc/skull",".vhd":"hdd",".qcow2":"hdd",".vdi":"hdd",".wim":"hdd",".sdi":"hdd",".not":"apps/sticky",".ts":"ts",".wmx":"apps/vm",".wms":"ram",".apk":"apk"};var u=[],h=null;async function m(){var e=new o;for(var t in await i.C.initialize(document.getElementById("maingfx"),e,!0),w96.WindowSystem.windows)(t=w96.WindowSystem.windows[t])&&(t.setWindowIcon(t.windowIcon),t.setTitle(t.title));w96.evt.ui.emit("reload-desktop")}function _(e){const{sounds:t}=w.registeredThemes[w.currentTheme];if(t)return t[e]}const w={currentTheme:"default",registeredThemes:r,getIconUrl:c,getFileIconUrl:function(e,t="normal",n="png"){if(d[e])return c(d[e],t,n);if(s.FS.exists(e)&&!s.FS.isFile(e))return c("folder",t,n);var i=s.FSUtil.getExtension(e);return null!=p[i]?c(p[i],t,n):c("empty",t,n)},cssa:function(e){const t=document.querySelector(".csst-common")||function(){const e=document.createElement("style");return e.classList.add("csst-common"),document.body.appendChild(e),e}();h||(h=t.innerText),t.innerText+="\n"+e},cssl:function(e){const t=document.createElement("link");t.rel="stylesheet",t.href=e,document.body.appendChild(t),u.push(t)},uiVars:l,unloadTheme:function(e=!0){w.uiVars=Object.assign({},a),u.forEach((e=>{document.body.removeChild(e)})),u=[],(document.querySelector(".csst-common")||function(){const e=document.createElement("style");return e.classList.add("csst-common"),document.body.appendChild(e),e}()).innerText=h,h=null,w.currentTheme="default",e&&m()},reloadDesktop:m,getSound:_,playSound:function(e){let t=_(e);if(t)return new Promise(((e,n)=>{let s=new Audio(t);s.onended=e;try{return s.play()}catch(e){n(),console.error("playSound(): ",e)}}))}}},3970:(e,t,n)=>{"use strict";n.d(t,{J:()=>o});var s=n(9471),i=n(6993);class o extends i.UIComponent{constructor(e){super(),(e=Object.assign({label:"My Checkbox",checked:!1,onchange:null,displayAsBlock:!1},e)).onchange?this.onchange=e.onchange:this.onchange=()=>{},this.uiComponent=s.K.mkElement("label",["w96-checkbox"]);const t=s.K.mkElement("input",[]);t.type="checkbox",t.addEventListener("click",(()=>{this.onchange({checked:t.checked})})),this.uiComponent.appendChild(t);const n=s.K.mkElement("span",["text"]);n.textContent=e.label,this.uiComponent.appendChild(n),t.checked=e.checked,e.displayAsBlock&&(this.uiComponent.style.display="block")}}},8576:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ContextMenu:()=>i});var s=n(4420);class i{constructor(e){this.items=e,this.menuCounter=0}renderMenu(e,t,n=this.items){const i=document.createElement("div");return i.classList.add("wcontext-menu"),i.style.left=`${e}px`,i.style.top=`${t}px`,i.style.zIndex="10000001",i.menuId=this.menuCounter++,i.id="cxmenu_"+i.menuId,s.Q.playSound("ctxmenuopen"),n.forEach((t=>{if("normal"==t.type){const e=document.createElement("span");let n=!1;if(e.classList.add("item"),e.onmouseenter=function(e){n||s.Q.playSound("ctxmenuhover")},e.onclick=function(e){t.onclick&&!n&&(t.onclick(e,t.tag),s.Q.playSound("ctxmenucmd"))},null!=t.icon&&(e.classList.add("wi"),e.style.backgroundImage="url("+t.icon+")"),e.innerHTML=t.label,t.onopened){const s=t.onopened(e);n="boolean"==typeof s&&!s}n&&e.setAttribute("disabled","true"),i.appendChild(e)}else if("submenu"==t.type){const n=document.createElement("span");n.classList.add("item","hs"),t.removeIconPrespace&&n.classList.add("no-icon"),n.innerHTML=t.label,n.onclick=function(e){t.onclick&&t.onclick(e,t.tag)},null!=t.icon&&(n.classList.add("wi"),n.style.backgroundImage="url("+t.icon+")"),n.iid=Math.floor(1e8*Math.random()),i.appendChild(n),n.onmouseenter=s=>{if(n.classList.add("selected"),document.getElementById("cxmenu_"+t.id))return;const o=i.getBoundingClientRect(),r=n.getBoundingClientRect(),a=this.renderMenu(e+o.width,r.y-1,t.items);a.parentMenu=i,a.id="cxmenu_"+t.id,i.querySelectorAll(".item").forEach((e=>{if(e.iid==n.iid)return;const t=e.onmouseenter;e.onmouseenter=s=>{n.classList.contains("selected")&&n.classList.remove("selected");const o=Array.from(document.querySelectorAll(".wcontext-menu"));o.reverse();for(var r=0;r<o.length;r++){if(o[r].menuId==i.menuId)return e.onmouseenter=t,void(t&&t(s));o[r].remove()}e.onmouseenter=t,t&&t(s)}}))}}else if("separator"==t.type){const e=document.createElement("div");e.classList.add("separator"),i.appendChild(e)}})),document.body.appendChild(i),i}}},1194:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});var s=n(6993);class i extends s.UIComponent{constructor(){super(),this.uiComponent=document.createElement("div"),this.uiComponent.classList.add("container-3d")}addText3d(){console.log("gameing")}}},2589:(e,t,n)=>{"use strict";n.d(t,{E:()=>o});var s=n(9471),i=n(6993);class o extends i.UIComponent{constructor(e){super(),e=Object.assign({title:"Sample Text",body:""},e),this.uiComponent=s.K.mkElement("div",["w96-groupbox"]);const t=s.K.mkElement("div",["title"]);t.innerText=e.title,this.uiComponent.appendChild(t);const n=s.K.mkElement("div",["content"]);n.innerHTML=e.body,this.uiComponent.appendChild(n)}setBody(e){this.uiComponent.querySelector(".content").innerHTML=e}setTitle(e){this.uiComponent.querySelector(".title").innerText=e}}},4779:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var s=n(9471),i=n(6993);class o extends i.UIComponent{constructor(){super(),this.uiComponent=s.K.mkElement("div",["w96-listbox"]),this.onitemselected=e=>{},this.onitemdeselected=e=>{}}addItem(e,t="untitled"){if(void 0===e)throw new DOMError("Invalid label.");const n=s.K.mkElement("div",["item"]);return n.innerText=e,n.setAttribute("ident",t),n.addEventListener("click",(()=>{this.selectItem(n.getAttribute("ident"))})),this.uiComponent.appendChild(n),n}selectItem(e){if(void 0===e)throw new DOMError("Invalid ID.");const t=this.uiComponent.querySelector(`.item[ident="${e}"]`);return null!=t&&(this._deselectAll(),t.classList.add("selected"),this.onitemselected&&this.onitemselected(e),!0)}clear(){for(;this.uiComponent.firstChild;)this.uiComponent.removeChild(this.uiComponent.firstChild)}_deselectAll(){this.uiComponent.querySelectorAll(".item.selected").forEach((e=>{e.classList.contains("selected")&&(e.classList.remove("selected"),this.onitemdeselected&&this.onitemdeselected(e.getAttribute("ident")))}))}}},6999:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});const{ContextMenu:s}=n(8576);class i{constructor(){this.menuElement=document.createElement("div"),this.menuElement.classList.add("w96-menubar"),this._menu=new s([])}addRoot(e,t,n=!0){const s=document.createElement("span");return s.classList.add("root-item"),s.innerText=e,s.onclick=e=>{if(s.classList.contains("selected"))return s.classList.remove("selected"),void document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()));document.body.querySelectorAll(".root-item.selected").forEach((e=>e.classList.remove("selected"))),document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()));const i=s.getBoundingClientRect();n?this._menu.renderMenu(i.x,i.y+i.height,t).classList.add("mbar"):this._menu.renderMenu(i.x,i.y+i.height,t),s.classList.add("selected")},s.onmouseenter=e=>{if(s.classList.contains("selected"))return;const t=s.parentElement.querySelector(".root-item.selected");t&&t!=s&&(t.classList.remove("selected"),s.onclick(e))},this.menuElement.appendChild(s),s}getMenuDiv(){return this.menuElement}}},1717:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});var s=n(9471),i=n(6993);class o extends i.UIComponent{constructor(e){super(),this.uiComponent=s.K.mkElement("div",["w96-radiobox"]),this._addItems(e)}_addItems(e){const t="r_"+Math.floor(1e5*Math.random());let n=0;for(let i of e){if(!i.label)continue;const e=s.K.mkElement("div",["option"]),o=document.createElement("input");o.type="radio",o.checked=i.selected,o.name=t,o.id=`radio-${t}-${n++}`,o.addEventListener("click",(()=>{i.onselect&&i.onselect({element:o,id:i.id})})),e.appendChild(o);const r=document.createElement("label");r.innerText=i.label,r.setAttribute("for",o.id),e.appendChild(r),this.uiComponent.appendChild(e)}}}},5544:(e,t,n)=>{"use strict";n.d(t,{a:()=>i});const{UIComponent:s}=n(6993);class i extends s{constructor(){super(),this.uiComponent=document.createElement("div"),this.uiComponent.classList.add("w96-tab-control"),this.pagesContainer=document.createElement("div"),this.pagesContainer.classList.add("pages"),this.uiComponent.appendChild(this.pagesContainer),this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("content"),this.uiComponent.appendChild(this.contentContainer),this._createdPages=0}_createActivationZone(e,t){const n=document.createElement("div"),s=e.getBoundingClientRect();n.style.background="transparent",n.style.zIndex=10,n.style.position="absolute";const i=(()=>{let e=0;return this.pagesContainer.querySelectorAll("button").forEach((t=>e+=t.getBoundingClientRect().width)),e})();n.style.left=i+"px",n.style.top="0px",n.style.height=s.height+"px",n.style.width=s.width+"px",n.onclick=t,this.pagesContainer.appendChild(n)}openPage(e){for(;this.contentContainer.firstChild;)this.contentContainer.removeChild(this.contentContainer.firstChild);this.contentContainer.innerHTML="";const t=this.pagesContainer.querySelector('button[pid="'+e+'"]');null!=t&&(this.pagesContainer.querySelectorAll("button").forEach((e=>{e.classList.remove("active")})),t.ontabdraw(this.contentContainer),t.classList.add("active"))}addPage(e,t){const n=this._createdPages++,s=document.createElement("button");return s.onclick=e=>{Array.from(e.target.classList).includes("active")||this.openPage(n)},s.setAttribute("pid",n),s.innerText=e,s.ontabdraw=t,this.pagesContainer.appendChild(s),n}getSize(){return{h:this.uiComponent.style.width,w:this.uiComponent.style.height}}setSize(e,t){this.uiComponent.style.width=e,this.uiComponent.style.height=t}getElement(){return this.uiComponent}destroy(){this.uiComponent.remove()}}},5582:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var s=n(9471),i=(n(4420),n(6993));class o extends i.UIComponent{constructor(e){super(),this.uiComponent=s.K.mkElement("div",["w96-tree"]),this._addItems(e)}_addItems(e){for(let t of e)this.uiComponent.appendChild(this.createDetails(t))}createDetails(e){const t=s.K.mkElement("details",[]),n=s.K.mkElement("summary",[]);if(e.icon){const t=s.K.mkElement("div",["icon"]);t.style.backgroundImage=`url(${e.icon})`,n.appendChild(t)}if(e.label){const t=s.K.mkElement("span",["text"]);t.innerText=e.label,n.appendChild(t)}if(e.opened&&t.setAttribute("open",""),t.appendChild(n),!e.items)return t;for(let n of e.items)if(n.items){const e=this.createDetails(n);t.appendChild(e),n.opened&&e.setAttribute("open","")}else{const i=s.K.mkElement("div",["item"]);if(e.icon){const e=s.K.mkElement("div",["icon"]);e.style.backgroundImage=`url(${n.icon})`,i.appendChild(e)}if(n.label){const e=s.K.mkElement("span",["text"]);e.innerText=n.label,i.appendChild(e)}t.appendChild(i)}return t}}},1124:(e,t,n)=>{"use strict";n.d(t,{r:()=>s});const s={create:function(e,t){e.dzone||(e.dzone={accepts:["file","text"],data:t,ondrop:function(e){return!1}},e.classList.add("dropzone"))},get:function(e){return e.dzone}}},797:(e,t,n)=>{"use strict";n.d(t,{P:()=>l});var s=n(7366),i=n(5784),o=n(9338),r=n(8362);async function a(e){if(!i.FS.exists("c:/system/config/SAM.json")){const t=o.jC.error("System Security","The security account manager (SAM) config is missing.","OK");return t.setSize(385,110),t.dlg.center(),void e(!1)}const t=await i.FS.readstr("c:/system/config/SAM.json");var n;try{n=JSON.parse(t)}catch(t){return o.jC.error("System Security","The security account manager (SAM) config is corrupt.","OK"),void e(!1)}const a=new s.Lw;a.resizable=!1,a.title="Log On to Windows",a.initialHeight=236,a.initialWidth=388;const l=new s.DI(a);l.registerWindow(),l.setControlBoxStyle("WS_CBX_NONE"),l.show(),l.center();const c=l.wndObject.querySelector(".window-html-content");c.classList.add("logon-app"),l.setHtml('\n        <div class="logo"></div>\n        <div class="content">\n            <div class="field">\n                <span>Username:</span>\n                <input disabled="true" class="w96-textbox disabled" type="text">\n            </div>\n            <div class="field pwd">\n                <span>Password:</span>\n                <input class="w96-textbox" type="password">\n            </div>\n        </div>\n        <div class="buttons">\n            <button class="w96-button btn-ok">OK</button>\n            &nbsp;\n            <button class="w96-button btn-cancel" disabled>Cancel</button>\n            &nbsp;\n            <button class="w96-button btn-reboot">Reboot</button>\n        </div>\n    ');c.querySelector('input[type="text"]').value=n.name;const d=c.querySelector('input[type="password"]'),p=c.querySelector(".btn-ok");c.querySelector(".btn-reboot").onclick=()=>document.location.reload(),p.onclick=async()=>{if((0,r.P)(d.value)!=n.pwd){new Audio("/system/resource/sounds/misc/access_deny.mp3").play();const e=o.jC.error("System Security","The specified password is incorrect.","OK");setTimeout((()=>{e.dlg.wndObject.querySelector("button").focus()}),1)}else l.close(),e(!0)},d.onkeyup=function(e){"Enter"==e.key&&p.onclick()}}var l={displayLogonUI:a,displayLogonUIAsync:function(){return new Promise((e=>a(e)))}}},6993:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Size:()=>s,UIComponent:()=>i});class s{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}}class i{init(){this.uiComponent=null}getSize(){return{h:this.uiComponent.style.width,w:this.uiComponent.style.height}}setSize(e,t){this.uiComponent.style.width=e,this.uiComponent.style.height=t}getElement(){return this.uiComponent}destroy(){this.uiComponent.remove()}}},7366:(e,t,n)=>{"use strict";n.d(t,{C$:()=>y,DI:()=>C,KZ:()=>b,Lw:()=>x});var s=n(9951),i=n(8423),o=n(6841),r=n(3978),a=n(4420),l=n(8576),c=n(4078),d=n(674);let p={dragging:{hideWindow:!1,simpleDragBox:!1},features:{windowSnap:!0,disableAllAnimations:!1,enableClearFix:!1,use12hTime:!1},animations:{windowOpen:"zoomIn",windowClose:"zoomOut"}};var u=[],h=null,m=null;let _=!1;var w=0;const y={deactivateAllWindows:function(){u.forEach((e=>{if(null!=e){var t=e.wndObject;null!=t&&(t.children[0].classList.add("titlebar-title-disabled"),t.classList.remove("active"),e.darkenElements())}})),document.querySelectorAll(".taskbar-task").forEach((e=>{e.classList.contains("taskbar-task_active")&&e.classList.remove("taskbar-task_active")})),h=null},setWindowContainer:function(e){m=e},findWindow:function(e){var t=null;return u.forEach((n=>{n.id==e&&(t=n)})),t},isWindowActive:function(){return null!=h},closeAllWindows:function(e){u.forEach((t=>{null!=t&&null!=t.wndObject&&t.close(e)}))},getWindowContainer:()=>m,disableAppBar:e=>_=e,setConfig:async function(e){p={...p,...e},p.dragging.simpleDragBox?m.classList.add("f-smdrag"):m.classList.remove("f-smdrag"),p.features.disableAllAnimations?((0,s.E)(!0),p.animations.windowOpen="anim-null",p.animations.windowClose="anim-null"):(0,s.E)(!1)},getConfig:function(){return p},startZIndex:10,windows:u};var b={WS_CBX_MINMAXCLOSE:"WS_CBX_MINMAXCLOSE",WS_CBX_CLOSE:"WS_CBX_CLOSE",WS_CBX_MINCLOSE:"WS_CBX_MINCLOSE",WS_CBX_NONE:"WS_CBX_NONE"};function g(e,t,n){n?$("#"+e).resizable({handles:"n, s, w, e, ne, se, sw, nw",minHeight:t.minHeight,minWidth:t.minWidth,iframeFix:!0,start:function(t,n){const s=document.createElement("style");s.innerText="iframe { pointer-events: none !important; }",s.classList.add("iframe-fix"),document.body.appendChild(s),document.querySelector("#"+e).associatedWindow.activate()},stop:function(e,t){$("iframe").css("pointer-events","auto");const n=document.querySelector(".iframe-fix");n&&n.remove()}}):$("#"+e).resizable("destroy")}var f=null,v={x:11,y:11};function E(e){v.x=e.x,v.y=e.y}function k(e,t){t?$("#"+e).draggable({cancel:".nodrag",iframeFix:!0,start:function(e){S(),p.dragging.hideWindow&&e.target.classList.add("dragging"),p.features.windowSnap&&e.target.associatedWindow.params.resizable&&document.addEventListener("mousemove",E)},stop:function(e){if(p.dragging.hideWindow&&e.target.classList.remove("dragging"),p.features.windowSnap){if(f&&(f.remove(),f=null),!e.target.associatedWindow.params.resizable)return;var t=e.target.associatedWindow;v.x>window.innerWidth-10?(t._ext.windowSnap.snapped=!0,t._ext.windowSnap.originalSize={height:t.wndObject.style.height,width:t.wndObject.style.width},t.setSize(window.innerWidth/2-6,window.innerHeight-34,!0),t.setPosition(window.innerWidth/2,0)):v.x<10?(t._ext.windowSnap.snapped=!0,t._ext.windowSnap.originalSize={height:t.wndObject.style.height,width:t.wndObject.style.width},t.setSize(window.innerWidth/2-6,window.innerHeight-34,!0),t.setPosition(0,0)):v.y<10&&(t.wndObject.style.top="0px",t.toggleMaximize()),document.removeEventListener("mousemove",E),v={x:11,y:11}}},drag:function(e,t){if(h!=e.target.id&&e.target.associatedWindow.activate(),p.features.windowSnap){if(!e.target.associatedWindow.params.resizable)return;if(e.target.associatedWindow._ext.windowSnap.snapped){const t=e.target.associatedWindow._ext.windowSnap.originalSize;e.target.style.height=t.height,e.target.style.width=t.width,e.target.associatedWindow._ext.windowSnap.snapped=!1,e.target.associatedWindow._ext.windowSnap.originalSize=null}f?(0,o.dl)((0,o.dl)(v.x>10,v.x<window.innerWidth-10),v.y>10)&&(f.remove(),f=null):v.x>window.innerWidth-10?((f=document.createElement("div")).classList.add("winsnap-panel"),f.classList.add("right"),document.body.appendChild(f)):v.x<10?((f=document.createElement("div")).classList.add("winsnap-panel"),f.classList.add("left"),document.body.appendChild(f)):v.y<10&&((f=document.createElement("div")).classList.add("winsnap-panel"),f.classList.add("top"),document.body.appendChild(f))}}}):$("#"+e).draggable("destroy")}function S(){document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()))}class x{constructor(){this.initialX=100,this.initialY=100,this.minHeight=22,this.minWidth=72,this.initialHeight=340,this.initialWidth=480,this.title="Untitled Window",this.resizable=!0,this.draggable=!0,this.taskbar=!1,this.icon=null,this.center=!1,this.body=null,this.bodyClass=null,this.windowClass=null,this.controlBoxStyle=null,this.mobResize=!1,this.iframeFix=!0,this.animations={windowOpen:p.animations.windowOpen,windowClose:p.animations.windowClose},this.wndContainer=null}}class C{constructor(e){null==e&&(e=new x),e=Object.assign(new x,e),0!=a.Q.uiVars.tbOffsetH&&(e.initialHeight+=a.Q.uiVars.tbOffsetH),0!=a.Q.uiVars.tbOffsetW&&(e.initialWidth+=a.Q.uiVars.tbOffsetW),this.id="wnd_"+(w++).toString(),this.useIcon=!1,this.wndObject=document.createElement("div"),this.wndObject.associatedWindow=this,this.wndObject.classList.add("window-dlg"),this.wndObject.id=this.id;let t=r.V.escapeHtml(e.title),n=p.features.enableClearFix&&a.Q.uiVars.clearFixEnabled;n&&(t=t.replaceAll(" "," &nbsp;")),this.wndObject.innerHTML=`<div class="titlebar">\n            <div class="titlebar-title ${n?" wordspacing-2":""}">${t}</div>\n            <div class="nodrag titlebar-closebutton"></div>\n            <div class="nodrag titlebar-maxbutton"></div>\n            <div class="nodrag titlebar-minbutton"></div>\n        </div>\n        <div class="window-html">\n            <div class="window-html-content nodrag"></div>\n        </div>`,this.wndObject.querySelector(".titlebar-closebutton").addEventListener("click",(()=>this.close())),this.wndObject.querySelector(".titlebar-maxbutton").addEventListener("click",(e=>{Array.from(e.target.classList).includes("wm-cbx-disabled")||this.toggleMaximize()})),this.wndObject.querySelector(".titlebar-minbutton").addEventListener("click",(e=>{Array.from(e.target.classList).includes("wm-cbx-disabled")||this.toggleMinimize()})),this.wndObject.style.position="absolute",this.wndObject.style.height=`${e.initialHeight}px`,this.wndObject.style.width=`${e.initialWidth}px`,this.wndObject.style.top=`${e.initialX}px`,this.wndObject.style.left=`${e.initialY}px`;let s=this.wndObject;this.wndObject.onclick=function(e){e.target!=s.querySelector(".titlebar-icon")&&this.associatedWindow&&this.associatedWindow.activate()},this.animations=e.animations,this.params=e,this.isRegistered=!1,this.appbarRegistered=!1,this.shown=!1,this._wmStylingAllowed=!0,this._waitResolveFn=null,this.maximized=!1,this.minimized=!1,this.uiUpdating=!1,this.windowIcon=null,this.title=e.title,this.maximizeInfo={x:"0px",y:"0px",h:"0px",w:"0px"},this.onclose=null,this.onfinalclose=null,this.onload=null,this.ondarkenelements=function(){},this.onshown=function(){},this.onlightenelements=function(){},this._ext={windowSnap:{snapped:!1,originalSize:null}};this.wndObject.querySelector(".titlebar").addEventListener("contextmenu",(e=>this.showTitlebarMenu(e))),this.registerWindow(),e.taskbar&&this.registerAppBar(),null!=e.icon&&this.setWindowIcon(e.icon),null!=e.body&&this.setHtml(e.body),null!=e.bodyClass&&this.getBodyContainer().classList.add(e.bodyClass),null!=e.windowClass&&this.wndObject.classList.add(e.windowClass),null!=e.controlBoxStyle&&this.setControlBoxStyle(e.controlBoxStyle),e.iframeFix&&this.wndObject.classList.add("ifr")}wait(){return new Promise((e=>this._waitResolveFn=e))}showTitlebarMenu(e){S();new l.ContextMenu([{type:"normal",label:"Maximize/Restore",onclick:()=>this.toggleMaximize()},{type:"normal",label:"Minimize",onclick:()=>this.toggleMinimize()},{type:"separator"},{type:"normal",label:"Close",onclick:()=>this.close()}]).renderMenu(e.x+1,e.y+1)}registerWindow(){this.isRegistered||(u.push(this),this.params.wndContainer?this.params.wndContainer.appendChild(this.wndObject):m.appendChild(this.wndObject),this.isRegistered=!0,this.randomizePosition())}registerAppBar(){_||this.appbarRegistered||(this.appbarRegistered=!0,i.e.createWindowAppBar(this))}setTitle(e){this.title=e;var t=this.wndObject.querySelector(".titlebar-title");let n=r.V.escapeHtml(e);p.features.enableClearFix&&a.Q.uiVars.clearFixEnabled?(n=n.replaceAll(" "," &nbsp;"),t.classList.contains("wordspacing-2")||t.classList.add("wordspacing-2")):t.classList.contains("wordspacing-2")&&t.classList.remove("wordspacing-2"),t.innerHTML=n,this.appbarRegistered&&(document.getElementById(this.id+"_appbar").querySelector(".taskbar-task-text").innerText=e)}setHtml(e){const t=this.wndObject.querySelector(".window-html-content");for(;t.firstChild;)t.removeChild(t.firstChild);t.innerHTML=e}randomizePosition(){const e=this.getBounds(),t=window.innerWidth-e.width-20,n=window.innerHeight-e.height-20;this.setPosition((0,o.TN)(20,t),(0,o.TN)(54,n))}show(){d.u.callComposite(this),this.shown||(this.wndObject.style.display="flex",this.shown=!0,(0,s.s)(this.wndObject,this.animations.windowOpen,(()=>{this.onshown()})),setTimeout((()=>this.activate()),20),this.wndObject.children[0].ondblclick=()=>{this.params.resizable&&this.toggleMaximize()},this.params.resizable&&g(this.id,this.params,!0),this.params.draggable&&k(this.id,!0),this.params.center&&this.center(),c.f.isMobileModeEnabled()&&(this.params.resizable||this.params.mobResize)&&this.toggleMaximize())}center(e=!1){e||(this.wndObject.style.left=`${Math.round(window.innerWidth/2-this.params.initialWidth/2)}px`,this.wndObject.style.top=`${Math.round(window.innerHeight/2-this.params.initialHeight/2)}px`)}activate(){if(this.wndObject){h=this.id,i.e.activateAppBar(this.id);for(var e=parseInt(this.wndObject.style.zIndex),t=10,n=0;n<u.length;n++){if(null!=u[n])if(null!=(o=u[n].wndObject)&&o.id!=this.id){var s=parseInt(o.style.zIndex);s>t&&(t=s)}}for(n=0;n<u.length;n++){var o;if(null!=u[n])null!=(o=u[n])&&o.id!=this.id&&(o.wndObject.children[0].classList.add("titlebar-title-disabled"),o.wndObject.classList.remove("active"),o.darkenElements())}this.wndObject.children[0].classList.remove("titlebar-title-disabled"),this.lightenElements(),this.wndObject.classList.add("active"),e!=t&&(this.wndObject.style.zIndex=t+1)}}toggleMinimize(e=!1){if(this.minimized){if(a.Q.playSound("restore"),this.minimized=!1,this.uiUpdating=!0,i.e.activateAppBar(this.id),this.appbarRegistered){const e=document.getElementById(this.id+"_appbar").getBoundingClientRect(),t=document.createElement("div");t.classList.add("ui-minimize-tempbox"),t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",m.appendChild(t);const n="wnd-min-temp-"+this.id,i=document.createElement("style");return i.innerText=`\n                    .${n} {\n                        animation: ${n} 200ms linear;\n                        z-index: 1000000;\n                    }\n\n                    @keyframes ${n} {\n                        100% {\n                            left: ${this.wndObject.style.left};\n                            top: ${this.wndObject.style.top};\n                            height: ${this.wndObject.style.height};\n                            width: ${this.wndObject.style.width};\n                        }\n                    }\n                `,document.body.appendChild(i),void(0,s.s)(t,n,(()=>{this.activate(),t.remove(),this.wndObject.style.display="flex",this.uiUpdating=!1}))}this.wndObject.style.display="flex",e?(this.activate(),this.uiUpdating=!1):(0,s.s)(this.wndObject,"bounceInUp",(()=>{this.activate(),this.uiUpdating=!1}))}else{if(a.Q.playSound("minimize"),this.uiUpdating=!0,this.minimized=!0,h=null,setTimeout((()=>i.e.deactivateAppBar(this.id)),50),this.appbarRegistered){const e=document.createElement("div");e.classList.add("ui-minimize-tempbox"),e.style.left=this.wndObject.style.left,e.style.top=this.wndObject.style.top,e.style.width=this.wndObject.style.width,e.style.height=this.wndObject.style.height,m.appendChild(e),this.wndObject.style.display="none";const t="wnd-min-temp-"+this.id,n=document.createElement("style"),i=document.getElementById(this.id+"_appbar").getBoundingClientRect();return n.innerText=`\n                    .${t} {\n                        animation: ${t} 200ms linear;\n                        z-index: 1000000;\n                    }\n\n                    @keyframes ${t} {\n                        100% {\n                            left: ${i.left}px;\n                            top: ${i.top}px;\n                            height: ${i.height}px;\n                            width: ${i.width}px;\n                        }\n                    }\n                `,document.body.appendChild(n),void(0,s.s)(e,t,(()=>{n.remove(),e.remove(),this.uiUpdating=!1}))}(0,s.s)(this.wndObject,"windowMinimize",(()=>{this.wndObject.style.display="none",this.uiUpdating=!1}))}}toggleMaximize(){this.uiUpdating||(this.maximized?(a.Q.playSound("minimize"),this.maximized=!1,this.wndObject.children[0].children[2].classList.remove("titlebar-maxxed"),this.wndObject.classList.remove("nodrag"),g(this.id,this.params,!0),this.wndObject.style.height=this.maximizeInfo.h,this.wndObject.style.width=this.maximizeInfo.w,this.wndObject.style.top=this.maximizeInfo.y,this.wndObject.style.left=this.maximizeInfo.x,this.wndObject.classList.remove("maximized")):(a.Q.playSound("maximize"),this.maximized=!0,this.wndObject.children[0].children[2].classList.add("titlebar-maxxed"),this.wndObject.classList.add("nodrag"),this.maximizeInfo={x:this.wndObject.style.left,y:this.wndObject.style.top,h:this.wndObject.style.height,w:this.wndObject.style.width},this.wndObject.style.height=a.Q.uiVars.maxWindowSizeFormulaH,(0,s.s)(this.wndObject,"winmaximize",(()=>{this.wndObject.style.width=a.Q.uiVars.maxWindowSizeFormulaW,this.wndObject.style.left="0px",this.wndObject.style.top="0px",this.wndObject.classList.add("maximized");try{$("#"+this.id).resizable("destroy")}catch(e){}}))))}close(e){if(this.uiUpdating)return;if(this.uiUpdating=!0,S(),null!=this.onclose&&!e){const e={canceled:!1};if(this.onclose(e),e.canceled)return void(this.uiUpdating=!1)}this.onfinalclose&&this.onfinalclose(),this.wndObject.style.pointerEvents="none";this.wndObject;this.appbarRegistered&&i.e.destroyAppBar(this.id),this.minimized?this._onCloseEnd():(0,s.s)(this.wndObject,this.animations.windowClose,(()=>this._onCloseEnd()))}_onCloseEnd(){const e=this.id;this.wndObject.uiUpdating=!1,h=null,u.forEach(((t,n)=>{if(null!=t&&t.id==e){if(u[n].wndObject.associatedWindow=null,u[n].wndObject.remove(),u[n]._waitResolveFn)return u[n]._waitResolveFn(),void(u[n]._waitResolveFn=null);u[n].wndObject=null,u[n]=null}}))}_destroy(){this.params=null,this.animations=null,this.maximizeInfo=null,this.wndObject=null,this.windowIcon=null}darkenElements(){this._wmStylingAllowed&&(null!=this.ondarkenelements&&this.ondarkenelements(),this.wndObject.querySelectorAll(".w96-listbox>.item.enabled").forEach((e=>{e.style.background="rgb(156,156,156)",e.style.color="black"})))}lightenElements(){this._wmStylingAllowed&&(null!=this.onlightenelements&&this.onlightenelements(),this.wndObject.querySelectorAll(".w96-listbox>.item").forEach((e=>{e.style.background="",e.style.color=""})),this._styleTimeoutComplete=!1,setTimeout((()=>this._styleTimeoutComplete=!0),150))}setWindowIcon(e){var t=this.wndObject.querySelector(".titlebar-title"),n=this.wndObject.querySelector(".titlebar-icon");return null==e?(this.windowIcon=null,null!=n&&n.remove(),!1):(t.style.paddingLeft=a.Q.uiVars.titlebarIconPadding,null==n&&((n=document.createElement("div")).classList.add("titlebar-icon"),n.addEventListener("click",(e=>{e.stopPropagation(),this.showTitlebarMenu(e)})),n.addEventListener("contextmenu",(e=>this.showTitlebarMenu(e))),n.addEventListener("dblclick",(()=>this.close())),this.wndObject.appendChild(n)),n.style.backgroundImage=`url(${e})`,this.windowIcon=e,w96.ui.Theme.uiVars.superbarEnabled&&(e=e.replace("/icons/small/","/icons/")),this.appbarRegistered&&(document.getElementById(this.id+"_appbar").querySelector(".taskbar-task-icon").style.background="url("+e+")"),n)}setControlBoxStyle(e){if(this.wndObject.children[0].children[2].style.width="",w96.ui.Theme.uiVars.classicWMButtonBehavior){switch(e.trim()){case"WS_CBX_MINMAXCLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="visible",this.wndObject.children[0].children[3].style.visibility="visible";break;case"WS_CBX_CLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="hidden",this.wndObject.children[0].children[3].style.visibility="hidden";break;case"WS_CBX_MINCLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="hidden",this.wndObject.children[0].children[2].style.width="0px",this.wndObject.children[0].children[3].style.visibility="visible";break;case"WS_CBX_NONE":this.wndObject.children[0].children[1].style.visibility="hidden",this.wndObject.children[0].children[2].style.visibility="hidden",this.wndObject.children[0].children[3].style.visibility="hidden"}this.wndObject.querySelector(".titlebar").setAttribute("cbxstyle",e)}else switch(e.trim()){case"WS_CBX_MINMAXCLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="visible",this.wndObject.children[0].children[2].classList.remove("wm-cbx-disabled"),this.wndObject.children[0].children[2].disabled=!1,this.wndObject.children[0].children[3].style.visibility="visible",this.wndObject.children[0].children[3].classList.remove("wm-cbx-disabled"),this.wndObject.children[0].children[3].disabled=!1;break;case"WS_CBX_CLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="hidden",this.wndObject.children[0].children[3].style.visibility="hidden";break;case"WS_CBX_MINCLOSE":this.wndObject.children[0].children[1].style.visibility="visible",this.wndObject.children[0].children[2].style.visibility="visible",this.wndObject.children[0].children[2].classList.add("wm-cbx-disabled"),this.wndObject.children[0].children[2].disabled=!0,this.wndObject.children[0].children[3].style.visibility="visible",this.wndObject.children[0].children[3].classList.remove("wm-cbx-disabled"),this.wndObject.children[0].children[3].disabled=!1;break;case"WS_CBX_NONE":this.wndObject.children[0].children[1].style.visibility="hidden",this.wndObject.children[0].children[2].style.visibility="hidden",this.wndObject.children[0].children[3].style.visibility="hidden"}}setSize(e,t,n=!1){n?(this.wndObject.style.height=`${t}px`,this.wndObject.style.width=`${e}px`):(this.wndObject.style.height=`${t+a.Q.uiVars.tbOffsetH}px`,this.wndObject.style.width=`${e+a.Q.uiVars.tbOffsetW}px`)}setPosition(e,t){this.wndObject.style.left=(0|e)+"px",this.wndObject.style.top=(0|t)+"px"}getBounds(){return{x:parseFloat(this.wndObject.style.left.split("px").join("").trim()),y:parseFloat(this.wndObject.style.top.split("px").join("").trim()),height:parseFloat(this.wndObject.style.height.split("px").join("").trim()),width:parseFloat(this.wndObject.style.width.split("px").join("").trim())}}getComputedBounds(){return this.wndObject.getBoundingClientRect()}getBodyContainer(){return this.wndObject.querySelector(".window-html-content")}}},9275:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});class s{constructor(){this.eventQueue=[]}on(e,t){if(null==e)throw new Error("Event name cannot be null.");this.eventQueue.push({name:e,callback:t,type:"recurring"})}once(e,t){if(null==e)throw new Error("Event name cannot be null.");this.eventQueue.push({name:e,callback:t,type:"single"})}emit(e,...t){if(null==e)throw new Error("Event name cannot be null.");this.eventQueue.forEach(((n,s)=>{if(null==n||n.name!=e)return;const i=n.callback;"single"==n.type&&(this.eventQueue[s]=null);try{i.call(window,...t)}catch(e){console.error("Event error: "+String(e))}}))}remove(e,t){this.eventQueue.forEach(((n,s)=>{null!=n&&n.name==e&&n.callback==t&&(this.eventQueue[s]=null)}))}}},5524:function(e,t){!function(e){"use strict";var t={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};function n(e){return e&&DataView.prototype.isPrototypeOf(e)}if(t.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(e){return e&&s.indexOf(Object.prototype.toString.call(e))>-1};function o(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function c(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function p(e){var t=new FileReader,n=d(t);return t.readAsArrayBuffer(e),n}function u(e){var t=new FileReader,n=d(t);return t.readAsText(e),n}function h(e){for(var t=new Uint8Array(e),n=new Array(t.length),s=0;s<t.length;s++)n[s]=String.fromCharCode(t[s]);return n.join("")}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:t.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:t.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():t.arrayBuffer&&t.blob&&n(e)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=o(e),t=r(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},l.prototype.delete=function(e){delete this.map[o(e)]},l.prototype.get=function(e){return e=o(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(o(e))},l.prototype.set=function(e,t){this.map[o(e)]=r(t)},l.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),a(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),a(e)},t.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function b(e,t){var n=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=y(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function g(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),s=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(i))}})),t}function f(e){var t=new l;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),s=n.shift().trim();if(s){var i=n.join(":").trim();t.append(s,i)}})),t}function v(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},_.call(b.prototype),_.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];v.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.DOMException=self.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function k(n,s){return new Promise((function(i,o){var r=new b(n,s);if(r.signal&&r.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:f(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;i(new v(t,e))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new e.DOMException("Aborted","AbortError"))},a.open(r.method,r.url,!0),"include"===r.credentials?a.withCredentials=!0:"omit"===r.credentials&&(a.withCredentials=!1),"responseType"in a&&t.blob&&(a.responseType="blob"),r.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),r.signal&&(r.signal.addEventListener("abort",l),a.onreadystatechange=function(){4===a.readyState&&r.signal.removeEventListener("abort",l)}),a.send(void 0===r._bodyInit?null:r._bodyInit)}))}k.polyfill=!0,self.fetch||(self.fetch=k,self.Headers=l,self.Request=b,self.Response=v),e.Headers=l,e.Request=b,e.Response=v,e.fetch=k,Object.defineProperty(e,"__esModule",{value:!0})}(t),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.insertBefore(t,this.firstChild)}})})),NodeList.prototype.forEach=NodeList.prototype.forEach||function(e){const t=[];for(var n=0;n<this.length;n++)t.push(this[n]);var s;s=this,t.forEach((function(t,n,i){e(t,n,s)}))},"srcElement"in MouseEvent.prototype||MouseEvent.prototype.__defineGetter__("srcElement",(function(){return this.target})),window.w96bld?w96bld.poly=!0:window.w96bld={poly:!0}},4367:(e,t,n)=>{"use strict";n.d(t,{C:()=>R});n(7460);var s=n(5784),i=n(8423),o=n(7366),r=n(9338),a=n(4871);var l={targetBrowser:function(){return window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0?"opera":"undefined"!=typeof InstallTrigger?"firefox":/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString()?"safari":document.documentMode?"ie":!document.documentMode&&window.StyleMedia?"edge":window.chrome&&(window.chrome.webstore||window.chrome.runtime)?"chrome":"unknown"},targetDeviceType:function(){return navigator.userAgent.indexOf("Nintendo Switch")>-1?"nintendo-switch":"regular-unknown"}},c=n(4420),d=n(254),p=n(8576),u=n(797),h=n(7362),m=(n(4247),n(5905));let _=null;var w=n(3697),y=n(120),b=n(5516),g=n(6167),f=(n(1709),n(1124)),v=n(4078),E=n(9807),k=n(3177),S=n(6226),x=0,C={background:{type:"local",bg:"c:/system/wallpapers/default.jpg"},misc:{hookMetaKeys:!1}},O=Object.assign({},C),P={dragbox:null,iconDesktop:document.createElement("div"),desktop:document.createElement("section"),taskbar:document.createElement("footer"),startButton:null},W={desktop:{selectedItems:[],shiftHeld:!1},startMenu:{element:null,isOpen:!1,items:{}}},A=null,D=[];function L(e){return e<10?"0"+e:e}function T(e){if(v.f.isMobileModeEnabled())b.x.wmem.mobStart?(b.x.wmem.mobStart.terminate(),b.x.wmem.mobStart=null):(0,h.lw)("mpmenu",[]);else if(!e||W.startMenu.isOpen)if(W.startMenu.isOpen)W.startMenu.element.remove(),W.startMenu.element=null,W.startMenu.isOpen=!1,P.startButton.classList.remove("sb-active"),g.p.ui.emit("start-close");else{c.Q.playSound("ctxmenuopen");var t=W.startMenu.element=document.createElement("div");t.classList.add("start-menu","oc-event-exempt"),t.innerHTML='<div class="w96_sm_logo"><aside class="container"><div class="text"></div></aside></div>\n        <div class="w96_sm_item_container" onclick=" w96.__sys.desktopShell.toggleStartMenu(true);">\n\n            <div id="item_programs" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/programs.png);">\n                    <div class="w96_sm_item_text">Programs</div>\n                </div>\n            </div>\n\n            <div id="item_documents" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/documents.png);">\n                    <div class="w96_sm_item_text">Documents</div>\n                </div>\n            </div>\n        \n            <div id="item_settings" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/settings.png);">\n                    <div class="w96_sm_item_text">Settings</div>\n                </div>\n            </div>\n\n            <div class="item_separator">&nbsp;</div>\n\n            <div id="item_devcfg" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/devcfg.png);">\n                    <div class="w96_sm_item_text">Device Config</div>\n                </div>\n            </div>\n        \n            <div id="item_help" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/help.png);">\n                    <div class="w96_sm_item_text">Help</div>\n                </div>\n            </div>\n\n            <div id="item_run" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/run.png);">\n                    <div class="w96_sm_item_text">Run</div>\n                </div>\n            </div>    \n\n            <div class="item_separator">&nbsp;</div>\n\n            <div id="item_reboot" onclick="w96.sys.reboot()" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/shutdown.png);">\n                    <div class="w96_sm_item_text">Reboot</div>\n                </div>\n            </div>\n\n            <div id="item_reinstall" onclick="" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/reinstall.png);">\n                    <div class="w96_sm_item_text">Reinstall</div>\n                </div>\n            </div>\n\n            <div class="item_separator">&nbsp;</div>\n\n            <div id="item_about" onclick="w96.sys.reg.executeApp(\'about-ui\', [])" class="w96_sm_item">\n                <div class="w96_sm_item_image" style="background: url(./system/resource/icons/about.png);">\n                    <div class="w96_sm_item_text">About WINDOWS96</div>\n                </div>\n            </div>\n        </div>',P.desktop.appendChild(t),W.startMenu.isOpen=!0,P.startButton.classList.add("sb-active");const n=document.getElementById("item_programs"),i=document.getElementById("item_documents"),o=document.getElementById("item_reinstall"),r=document.getElementById("item_settings"),a=document.getElementById("item_help"),l=document.getElementById("item_run"),u=document.getElementById("item_devcfg"),m=document.querySelector(".w96_sm_item_container");function _(e){var t=[];const n=s.FS.readdir(e),i=n.filter((e=>s.FS.isFile(e))),o=n.filter((e=>!s.FS.isFile(e))),r=function(e,t){return s.FSUtil.fname(e)<s.FSUtil.fname(t)?-1:s.FSUtil.fname(e)>s.FSUtil.fname(t)?1:0};return i.sort(r),o.sort(r),o.forEach((e=>{t.push({type:"submenu",id:Math.floor(1e3*Math.random()).toString(),label:s.FSUtil.fname(e),icon:c.Q.getIconUrl("folder","small"),items:_(e)})})),i.forEach((async e=>{var n=c.Q.getFileIconUrl(e,"small"),i=s.FSUtil.fname(e);if(e.endsWith(".link"))try{i=i.split(".").slice(0,-1).join(".");const t=JSON.parse(await s.FS.readstr(e));n=t.icon_small?`${t.icon_small}`:t.icon.startsWith("data:")?t.icon:`${c.Q.getIconUrl(t.icon,"small",null!=t.iconFmt?t.iconFmt:"png")}`}catch(e){console.log(e),n="system/resource/misc/missing.png"}t.push({type:"normal",icon:n,label:i,onclick:(e,t)=>{d.l.execFile(t),T(!0)},tag:e})})),t}({}).wiki96&&(a.remove(),t.classList.add("no_wiki")),m.querySelectorAll(".w96_sm_item").forEach((e=>{e.addEventListener("mouseenter",(()=>c.Q.playSound("ctxmenuhover"))),e.addEventListener("click",(()=>c.Q.playSound("ctxmenucmd")))})),l.addEventListener("click",(()=>B())),u.addEventListener("click",(()=>b.x.execCmd("ctrl",["--cpl","devcfg"]))),setTimeout((()=>{n.onmouseenter=function(e){n.classList.add("selected"),m.querySelectorAll(".w96_sm_item").forEach((e=>{e.id!=n.id&&(e.onmouseenter=function(){n.classList.contains("selected")&&n.classList.remove("selected"),document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()))})}));const t=new p.ContextMenu(_("c:/system/programs"));document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove()));const s=n.getBoundingClientRect();t.renderMenu(s.right,s.top)}}),250),o.onclick=function(){(0,h.lw)("reinstall",[])},r.onclick=function(){(0,h.lw)("ctrl",[])},a.onclick=function(){(0,h.lw)("wiki96",[])},i.onclick=function(){(0,h.lw)("explorer",["c:/user/documents"])},g.p.ui.emit("start-open",t)}}function I(){for(var e of(P.dragbox&&(P.dragbox.remove(),P.dragbox=null),W.desktop.selectedItems=[],P.desktop.querySelectorAll(".shell-icon")))e.classList.remove("selected")}function M(e){var t="string"!=typeof e?e:P.iconDesktop.querySelector("#"+e);null!=t&&(t.classList.add("selected"),W.desktop.selectedItems.push({path:t.getAttribute("path"),el:t}),W.desktop.selectedItems.length>1&&P.dragbox)}async function F(){if(b.x.bootFlags.includes("no_desktop_icons"))return;W.desktop.selectedItems=[],document.querySelectorAll(".user-desktop>.shell-icon").forEach((e=>e.remove())),s.FS.exists("c:/user/desktop")||s.FS.mkdir("c:/user/desktop");var e=10,t=10;let n=null;for(var i of s.FS.readdir("c:/user/desktop")){var a=document.createElement("div");$(a).draggable({start:function(e){I(),M(e.target),e.target.ozindex=e.target.style.zIndex,e.target.style.zIndex="10000000",e.target.children[0].classList.add("drag-shadow-image"),e.target.children[1].classList.add("drag-shadow"),e.target.style.pointerEvents="none",document.querySelector(".user-desktop>.build-info").style.pointerEvents="none",b.x.wmem.icDragTemp={left:e.target.style.left,top:e.target.style.top}},drag:function(e){const t=document.elementFromPoint(e.clientX,e.clientY);t&&t.classList&&t!=this.uiComponent&&(t.classList.contains("dropzone")&&null==n?(n=t,t.classList.add("hlight")):n!=t&&null!==n&&(n.classList.remove("hlight"),n=null))},stop:function(e){try{n&&(n.classList.remove("hlight"),n=null);const t=e.clientX,i=e.clientY,o=document.elementFromPoint(t,i);if(o&&o.classList.contains("dropzone")&&!o.classList.contains("file-drag-drop-container")){if(f.r.get(o).ondrop(e.target))try{let t=D.find((t=>t.file==s.FSUtil.fname(e.target.getAttribute("path"))));t&&D.splice(D.indexOf(t),1),s.FS.writestr("c:/system/config/icons.json",JSON.stringify(D))}catch(e){}else e.target.style.left=b.x.wmem.icDragTemp.left,e.target.style.top=b.x.wmem.icDragTemp.top}else"drag_drop_desktop"!=o.id&&(e.target.style.left=b.x.wmem.icDragTemp.left,e.target.style.top=b.x.wmem.icDragTemp.top)}catch(e){console.error(e)}if(e.target.style.pointerEvents="",e.target.children[0].classList.remove("drag-shadow-image"),e.target.children[1].classList.remove("drag-shadow"),e.target.style.zIndex=e.target.ozindex,document.querySelector(".user-desktop>.build-info").style.pointerEvents="auto",!b.x.bootFlags.includes("no_icon_positioning")){const t=e.target.children[1].innerText;let n=D.find((e=>e.file==t));n&&D.splice(D.indexOf(n),1),n={file:t,x:e.target.offsetLeft,y:e.target.offsetTop},D.push(n),s.FS.writestr("c:/system/config/icons.json",JSON.stringify(D))}}}),a.classList.add("shell-icon"),a.classList.add("desktop-icon"),a.setAttribute("ent_type",s.FS.filetype(i)),a.setAttribute("path",i),a.style.top="10px",a.style.left="10px",a.style.display="inline-flex",a.style.position="absolute",a.style.flexDirection="column",a.id=`deskicon_${e+t}`,a.onclick=function(){W.desktop.shiftHeld||I(),M(this)},a.ondblclick=function(){M(this);try{d.l.tryExecFile(this.getAttribute("path"))}catch(e){(0,r._5)(e)}},E.a.getProfile().preferences.single_click&&a.addEventListener("click",(()=>a.ondblclick())),a.oncontextmenu=function(e){document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove())),I(),M(this);const t=this.getAttribute("ent_type"),n=this.getAttribute("path"),i=[{type:"normal",label:"Open",onclick:()=>{d.l.tryExecFile(n)}},{type:"separator"},{type:"normal",label:"Download",onclick:()=>{1==t?r.jC.warning("Warning","Directories will be downloadable in the near future.","OK"):s.FSUtil.downloadFile(n)}},{type:"normal",label:"Rename",onclick:()=>{r.jC.prompt("Rename","Enter the new name of the entry.",s.FSUtil.fname(n),(async e=>{null!=e&&(await s.FS.rename(n,e),F())}))}},{type:"normal",label:"Delete",onclick:async()=>{if(1==t)await s.FS.rmdir(n);else{if("C:/user/desktop/Computer.link"==n&&!(0,S.yE)("disable_easter_eggs")){let e,t=document.createElement("video");t.src="/system/resource/app/explorer/agk.mp4",t.autoplay=!0,t.onended=t.onclick=()=>{e.close(),t.pause(),e=null},e=new o.DI({initialWidth:480,initialHeight:360,title:"WTF",taskbar:!1,icon:c.Q.getIconUrl("error","small"),controlBoxStyle:"WS_CBX_CLOSE"},!0),e.setPosition(document.body.clientWidth-480-6,0),e.getBodyContainer().appendChild(t),e.show()}if(/^([cC]:\/user\/desktop\/Trash( \(\d+\))?\.link)$/.test(n)&&!(0,S.yE)("disable_easter_eggs"))return await s.FS.cpfile("C:/user/desktop/Trash.link",`C:/user/desktop/Trash (${++x}).link`),F();await s.FS.rm(n)}F()}}];new p.ContextMenu(i).renderMenu(e.x,e.y)};var l=document.createElement("div");l.classList.add("icon-image"),i.startsWith("data:")?l.style.background=`url(${i})`:l.style.background=`url(${c.Q.getFileIconUrl(i)})`,a.appendChild(l);var u=document.createElement("span");if(u.classList.add("icon-text"),u.innerText=s.FSUtil.fname(i),a.appendChild(u),".link"==s.FSUtil.getExtension(i)&&s.FS.isFile(i))try{if(s.FS.stat(i).length>32768)continue;var h=await s.FS.readstr(i),m=JSON.parse(h);if(null!=m.displayName?u.innerText=m.displayName:u.innerText=s.FSUtil.fname(i).split(".").slice(0,-1).join("."),null!=m.icon&&(m.icon.startsWith("data:")?l.style.background=`url(${m.icon})`:l.style.background=`url(${c.Q.getIconUrl(m.icon,"normal",null!=m.iconFmt?m.iconFmt:"png")})`),!m.hideShortcutEmblem)(_=document.createElement("div")).classList.add("icon-shortcut-emblem"),l.appendChild(_);a.setAttribute("ent_type","2")}catch(e){var _;l.style.background="",l.style.backgroundImage="url(system/resource/misc/missing.png)",l.style.backgroundSize="contain",u.innerText="Corrupted",a.setAttribute("corrupted","true"),(_=document.createElement("div")).classList.add("icon-shortcut-emblem"),l.appendChild(_),a.setAttribute("ent_type","2")}P.desktop.appendChild(a)}function w(n){for(var s of P.desktop.querySelectorAll(n))if(s.style.top=`${t}px`,s.style.left=`${e}px`,t+128>window.innerHeight?(e+=85,t=10):t+=65,!b.x.bootFlags.includes("no_icon_positioning")){const e=D.find((e=>e.file==s.children[1].innerText));e&&(s.style.top=`${e.y}px`,s.style.left=`${e.x}px`)}}w(".shell-icon[ent_type='2']"),w(".shell-icon[ent_type='1']"),w(".shell-icon[ent_type='0']")}async function B(){const e=new o.Lw;e.title="Run",e.initialHeight=163,e.initialWidth=347,e.resizable=!1;const t=new o.DI(e);t.registerWindow(),t.setControlBoxStyle(o.KZ.WS_CBX_CLOSE);const n=t.getBodyContainer();n.classList.add("dlg-run-box"),n.innerHTML='\n    <div class="exp">\n        <div class="icon"></div>\n        <div class="text">\n            Type the name of a program, folder, document, or command, and Windows 96 will open it for you.\n        </div>\n    </div>\n    <div class="pbox">\n        <div class="text">Open: </div>\n        <input type="text" class="w96-textbox cmd">\n    </div>\n    <div class="buttons">\n        <button class="w96-button ok">OK</button>\n        <button class="w96-button cancel">Cancel</button>\n        <button class="w96-button browse">Browse...</button>\n    </div>\n    ';const i=n.querySelector("input");const a=()=>{if(""==i.value.trim())return;const e=i.value,n=["aux","con","nul","com1","com2","com3"];let o=e.trim().toLowerCase().split("/").slice(1);if(n.includes(o[0])&&n.includes(o[1]))(0,k.A)("A fatal exception 0E has occured at 0028:C004D91F in VXD VFAT(01) + 0000B897.The current application will be terminated.");else{if(s.FS.exists(e))return d.l.execFile(e),void t.close();{const n=y.A.parse(e);try{const e=n[0].toString();n.splice(0,1),b.x.execCmd(e,n).catch((e=>{r.jC.error("Exception",new String(e),"OK").dlg.onclose=()=>{t.toggleMinimize(!0),setTimeout((()=>{t.activate(),i.focus()}),10)}})),t.toggleMinimize()}catch(e){console.error(e)}}}};n.querySelector("button.ok").addEventListener("click",(()=>a())),n.querySelector(".w96-textbox").addEventListener("keydown",(e=>{"Enter"==e.key&&a()})),n.querySelector("button.cancel").addEventListener("click",(()=>{t.close()})),n.querySelector("button.browse").addEventListener("click",(()=>{new r.MT("c:/user/desktop",[""],(e=>{e&&(i.value=e)})).show()})),t.show(),n.querySelector(".w96-textbox").focus(),t.wndObject.style.top=innerHeight-201+"px",t.wndObject.style.left="4px"}const R={initialize:async function(e,t,n){if(b.x.bootFlags.includes("force_pixel_render")&&(document.body.style.imageRendering="pixelated"),t.println_styled("[desktop] Initializing desktop shell...","color: orchid"),t.println_styled("[desktop] Reading desktop configuration file at c:/system/config/desktop.json"),s.FS.exists("c:/system/config/desktop.json"))try{O=JSON.parse(await s.FS.readstr("c:/system/config/desktop.json"))}catch(e){t.warn("An invalid configuration file was loaded, sticking with default until user repairs configuration file.")}else t.println_styled(">> No valid desktop configuration found, creating one...","color: yellow"),s.FS.mkdir("c:/system/config"),await s.FS.writestr("c:/system/config/desktop.json",JSON.stringify(O)),t.println("[desktop] Wrote default configuration file successfully.");try{s.FS.exists("c:/system/config/icons.json")&&(D=JSON.parse(await s.FS.readstr("c:/system/config/icons.json")))}catch(e){t.warn("Unable to load icons file.")}var d=O;switch(t.println("[desktop] Applying background styles..."),d.background.type){default:t.warn("Background type '"+d.background.type+"' is not recognized, switching to fallback..."),d.background.type="css",d.background.bg="black",P.desktop.style.background=d.background.bg;break;case"css":P.desktop.style.background=d.background.bg;break;case"url":P.desktop.style.background=`url(${d.background.bg})`;break;case"local":s.FS.exists(d.background.bg)||(t.warn("Cannot find local resource "+d.background.bg+", switching to fallback."),O.background=C.background,await s.FS.writestr("c:/system/config/desktop.json",JSON.stringify(O))),s.FS.exists(d.background.bg)?(P.desktop.style.backgroundImage=`url(${URL.createObjectURL(await s.FS.toBlob(d.background.bg))})`,P.desktop.style.backgroundRepeat="no-repeat",P.desktop.style.backgroundSize="cover"):P.desktop.style.background="black";break;case"iframe":P.desktop.style.background="black";let e=document.querySelector(".ui-bg-iframe");e||(e=function(){const e=document.createElement("iframe");return e.classList.add("ui-bg-iframe"),P.desktop.appendChild(e),e}()),e.src=d.background.bg}if("nintendo-switch"==l.targetDeviceType()){var y=document.createElement("style");y.innerText=".window-dlg .titlebar {\n            padding-bottom: 5px;\n        }",document.body.appendChild(y)}if(await v.f.applyPatches(),!n)try{if(null!=JSON.parse(await s.FS.readstr("c:/system/config/SAM.json")).pwd){t.println("[desktop] Preparing log on system...");const e=document.createElement("div");e.style.backgroundColor="rgb(0, 128, 128)",e.style.width="100vw",e.style.height="100vh",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex="8",e.style.overflow="hidden",e.classList.add("w96-predesk-ui"),document.body.appendChild(e),o.C$.setWindowContainer(e);if(!await u.P.displayLogonUIAsync())return void t.error("Auth error -- refusing to boot.");e.remove()}}catch(e){}n||(P.desktop.classList.add("user-desktop"),P.taskbar.classList.add("user-taskbar","slideInUp"),P.taskbar.innerHTML='<div class="taskbar-notify">\n            <div class="notify-time notify-item" id="time">0:00 AM</div>\n        </div>\n        <div class="taskbar-tasks"></div>\n        <button class="start_button w96-button"></button>',P.iconDesktop.classList.add("file-drag-drop-container"),P.iconDesktop.id="drag_drop_desktop",P.iconDesktop.tabIndex=5,P.iconDesktop.outline=0),t.println("[desktop] Finished applying desktop styles."),t.println("[desktop] Setting up clock..."),function(){if(0!=b.x.wmem.clockInt)return;const e=()=>{var e=new Date,t=P.taskbar.querySelector("#time");if(o.C$.getConfig().features.use12hTime){var n=e.getHours(),s=n>12?n-12:n;t.innerHTML=`${0===s?12:s}:${L(e.getMinutes())} &nbsp;${n>=12?"PM":"AM"}`}else t.innerText=`${L(e.getHours())}:${L(e.getMinutes())}`};b.x.wmem.clockInt=setInterval(e,1e3),b.x.wmem.clockUpdate=e,e()}(),t.println("[desktop] Setting up start menu..."),P.startButton=P.taskbar.querySelector(".start_button"),P.startButton.onclick=function(){T()},w96.ui.Theme.uiVars.superbarEnabled?P.startButton.classList.remove("w96-button"):P.startButton.classList.add("w96-button"),t.println("[desktop] Hooking desktop events..."),P.iconDesktop.onkeydown=function(e){if(!o.C$.isWindowActive()){if(e.ctrlKey&&"a"==e.key)for(var t of(e.preventDefault(),console.log("Debug: KeyEvent Select all"),I(),P.desktop.querySelectorAll(".shell-icon")))M(t);e.ctrlKey&&"r"==e.key&&(e.preventDefault(),e.shiftKey||F()),"Meta"==e.key&&O.misc.hookMetaKeys&&T()}},P.desktop.onclick=function(t){var n=t.target;if(t.target&&n.classList&&!n.classList.contains("oc-event-exempt")){for(var s=t.target;s&&s.id!=e.id;)if((s=s.parentNode)&&s.classList.contains("oc-event-exempt"))return;W.startMenu.isOpen&&T(!0)}},P.iconDesktop.onclick=function(t){o.C$.deactivateAllWindows();for(var n=t.target;n.id!=e.id;)if((n=n.parentNode).classList.contains("shell-icon"))return;I()},P.iconDesktop.oncontextmenu=function(t){for(var n=t.target;n.id!=e.id;)if((n=n.parentNode).classList.contains("shell-icon"))return;document.body.onclick(t),P.desktop.onclick(t),P.iconDesktop.onclick(t),I();const i=new p.ContextMenu([{type:"normal",label:"New File",onclick:()=>{r.jC.prompt("Create File","Enter the name of the file to create.","New File.txt",(e=>{if(null==e)return;const t="c:/user/desktop/"+e;s.FS.exists(t)?r.jC.warning("File Creation Failure","The path specified already exists.","OK"):(s.FS.touch(t),F())}))}},{type:"normal",label:"New Directory",onclick:()=>{r.jC.prompt("Create Directory","Enter the name of the directory to create.","New Folder",(e=>{if(null==e)return;const t="c:/user/desktop/"+e;s.FS.exists(t)?r.jC.warning("Directory Creation Failure","The path specified already exists.","OK"):(s.FS.mkdir(t),F())}))}},{type:"normal",label:"New Shortcut",onclick:()=>{!function(e,t){const n=new o.Lw;n.title="New Shortcut",n.initialHeight=115,n.initialWidth=320,n.resizable=!1;const i=new o.DI(n);i.registerWindow(),i.setControlBoxStyle("WS_CBX_CLOSE"),i.setHtml('\n<div class="p1">\n    <button class="w96-button icon-box"></button>\n</div>\n<div class="p2">\n    <div class="field"><span>Name</span><input class="w96-textbox name"></div>\n    <div class="field"><span>Command</span><input class="w96-textbox cmd"></div>\n    <button class="w96-button cancel">Cancel</button><button class="w96-button create">Create</button>\n</div>');const a=i.getBodyContainer();a.classList.add("dlg-newshortcut");const l=a.querySelector("button.icon-box");l.setAttribute("img","W:/"+c.Q.getIconUrl("empty")),a.querySelector("button.cancel").addEventListener("click",(()=>i.close())),a.querySelector("button.create").addEventListener("click",(async()=>{const t=a.querySelector(".w96-textbox.name").value,n=a.querySelector(".w96-textbox.cmd").value;null!=t&&""!=t.trim()&&null!=n&&""!=n.trim()||r.jC.error("Invalid shortcut","Cannot create shortcut, missing data.","OK"),a.querySelector("button.create").disabled=!0;const o=await(0,m.y)(await s.FS.toBlob(l.getAttribute("img")));await s.FS.writestr(`${e}/${t}.link`,JSON.stringify({icon:o,action:n})),"c:/user/desktop"==e&&R.updateDesktop(),i.close()})),l.addEventListener("click",(()=>{new r.MT("w:/system/resource/themes/default/icons",[".png",".PNG",".gif",".GIF",".jpg",".JPG"],(async e=>{if(null==e)return;const t=await s.FS.toBlob(e);null!=_&&URL.revokeObjectURL(_);const n=URL.createObjectURL(t);l.style.backgroundImage=`url(${n})`,_=n,l.setAttribute("img",e)})).show()})),i.show(),i.center()}("c:/user/desktop")}},{type:"separator"},{type:"normal",label:"Open Settings...",onclick:()=>{(0,h.lw)("ctrl",[])}},{type:"separator"},{type:"normal",label:"Refresh Desktop",onclick:()=>{F()}}]);i.renderMenu(t.x,t.y)},P.iconDesktop.ondragenter=()=>{P.iconDesktop.classList.add("fdrag-box")},P.iconDesktop.ondragleave=()=>{P.iconDesktop.classList.remove("fdrag-box")},P.iconDesktop.ondragover=e=>{e.preventDefault()},P.iconDesktop.ondrop=async e=>{if(e.preventDefault(),P.iconDesktop.classList.remove("fdrag-box"),console.log("Processing file upload..."),console.log(e.dataTransfer.files),e.dataTransfer.files){let n=[];for(let t=0;t<e.dataTransfer.files.length;t++)n.push(e.dataTransfer.files[t]);for(var t of n){console.log("Uploading "+t.name+"...");let e=new Uint8Array(await t.arrayBuffer());await s.FS.writebin("c:/user/desktop/"+t.name,e),e=null}n=[],F()}},f.r.create(P.iconDesktop);const g=f.r.get(P.iconDesktop);if(g.accepts.push("file","shell-icon"),g.data="c:/user/desktop",g.ondrop=async(e,t)=>{if(e.parentElement==P.desktop)return;const n=e.getAttribute("path");if(null==n)return!1;const i=s.FS.filetype(n),o="c:/user/desktop/"+s.FSUtil.fname(n);try{switch(i){case 0:await s.FS.mvfile(n,o);break;case 1:await s.FS.mvdir(n,o)}}catch(e){r.jC.error("Error",new String(e),"OK")}const a=s.FSUtil.fname(n);let l=D.find((e=>e.file==a));return l&&D.splice(D.indexOf(l),1),D.push({file:a,x:t.x,y:t.y}),e.remove(),await s.FS.writestr("c:/system/config/icons.json",JSON.stringify(D)),F(),!0},document.addEventListener("keydown",(e=>{("F5"==e.key||e.ctrlKey&&"r"==e.key)&&(e.preventDefault(),b.x.wmem._refreshConfirm||(b.x.wmem._refreshConfirm=!0,r.jC.confirm("Are you sure you want to reboot? Any unsaved data is lost!",(e=>{e&&w96.sys.reboot(),b.x.wmem._refreshConfirm=!1}),"warning")))})),t.println("[desktop] Initializing Window system..."),n||o.C$.setWindowContainer(P.desktop),!n){const e=document.createElement("div");var E=window.$buildId;E||(E=(await fetch("/system/images/bstr.json",{cache:"no-store"}).then((e=>e.json()))).bstr),e.classList.add("build-info"),e.style.textAlign="right",e.style.fontFamily="monospace";let t=!1,n=null;0,e.innerHTML=`<span class="bright">${t?n:""}Windows 96 main<br>Build ${E}</span>`,b.x.bootFlags.includes("no_build_info")&&(e.style.opacity="0%"),P.desktop.appendChild(e)}t.println("[desktop] Registering desktop elements..."),P.desktop.appendChild(P.iconDesktop),n||e.appendChild(P.desktop),n||e.appendChild(P.taskbar),i.e.assign(P.taskbar),await w.E.init(),window.onerror=function(e){b.x.bootFlags.includes("exclaim_exceptions")&&r.jC.error("JavaScript Runtime Error",`An exception has occured during the current session of Windows 96.<br><br>\n            <div style="border-style: inset; border-width: 1px; height: 30px; overflow: auto;" class="w96-panel">\n            Exception: ${e}\n            </div>`,"OK").setSize(320,156),null==A&&(A=new a.K("js_error","system/resource/themes/default/icons/small/error.png"),i.e.registerNotifyIcon(A)),A.onclick=function(){r.jC.error("JavaScript Runtime Error",`An exception has occured during the current session of Windows 96.<br><br>\n            <div style="border-style: inset; border-width: 1px; height: 30px; overflow: auto;" class="w96-panel">\n            Exception: ${e}\n            </div>`,"OK").setSize(320,156)}},await F(),document.body.onclick=function(e){null!=e.target&&null!=e.target.classList&&e.target.classList.contains("root-item")||(document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove())),document.querySelectorAll(".w96-menubar>.root-item.selected").forEach((e=>e.classList.remove("selected"))))},await new Promise((e=>{if(localStorage.getItem("fastboot")||n)return e(!0);setTimeout((function(){e(!0)}),2e3)}))},toggleStartMenu:T,updateDesktop:F,runBox:B,createCloseMenuHandler:function(){document.body.onclick=function(e){null!=e.target&&null!=e.target.classList&&e.target.classList.contains("root-item")||(document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove())),document.querySelectorAll(".w96-menubar>.root-item.selected").forEach((e=>e.classList.remove("selected"))))}}}},2763:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var s=n(5516);const{FS:i}=n(5784);class o{constructor(e){3==e.length?this.metaPath=e+".meta":this.metaPath=e+"/.meta",this.properties={background:null,icon:null,description:null,displayName:null,generateThumbnails:!1}}async read(){try{if(s.x.wmem.eCachedMetadata[this.metaPath])return this.properties=s.x.wmem.eCachedMetadata[this.metaPath],s.x.wmem.eCachedMetadata[this.metaPath];const e=await i.readstr(this.metaPath);return""==e.trim()?s.x.wmem.eCachedMetadata[this.metaPath]=this.properties:(s.x.wmem.eCachedMetadata[this.metaPath]=Object.assign(this.properties,JSON.parse(e)),s.x.wmem.eCachedMetadata[this.metaPath])}catch(e){return this.properties}}static clearCache(){s.x.wmem.eCachedMetadata={}}}},254:(e,t,n)=>{"use strict";n.d(t,{l:()=>a});var s=n(7362),i=n(5784),o=n(5516),r=n(9338);class a{static async tryExecFile(e){try{return await this.execFile(e)}catch(e){(0,r._5)(e)}}static async execFile(e){if(e.endsWith(".link")&&i.FS.isFile(e)){var t=await i.FS.readstr(e),n=JSON.parse(t),r=n.action.split(" ")[0],a=n.action.split(" ");return a.splice(0,1),await o.x.execCmd(r,a)}if(i.FS.isFile(e)){var l=(0,s.rr)(e);if(l.length<1)return await(0,s.lw)("openwith",[e]);var c=l[0];return await(0,s.lw)(c,[e])}return await(0,s.lw)("explorer",[e])}}},3697:(e,t,n)=>{"use strict";n.d(t,{E:()=>b});var s=n(8223),i=n(5516),o=n(9471);var r=n(4420),a=n(7366);let l=!1,c=null,d=0;function p(e){const t=c.querySelector(".windows"),n=t.children.item(e);if(null!=n){for(let e=0;e<t.children.length;e++)t.children.item(e).classList.remove("selected");n.classList.add("selected")}}function u(e){e.stopPropagation();const t=c.querySelector(".windows");"ArrowDown"==e.key||"K"==e.key?(d>=t.children.length-1?d=0:d++,p(d)):"ArrowUp"==e.key?(d<1?d=t.children.length-1:d--,p(d)):"Enter"==e.key&&m()}function h(e){e.stopPropagation(),!e.ctrlKey&&!e.shiftKey||"Shift"!=e.key&&"Control"!=e.key||_.closeUI()}function m(){if(l){try{c.querySelector(".windows").querySelector(".window.selected").wnd.activate()}catch(e){}c.remove(),c=null,d=0,document.body.removeEventListener("keydown",u),document.body.removeEventListener("keyup",h),b.closeAllPopups(),l=!1}}const _={selectWindowIndex:p,keyDownHandler:function(e){if(l);else{if(function(){let e=0;for(let t of a.C$.windows)null!=t&&e++;return e}()<1)return;l=!0,c=o.K.mkElement("div",["imde-ui-winswitcher","imde-ui-popup"]),c.innerHTML='<div class="windows"></div>';const e=c.querySelector(".windows");for(let t of a.C$.windows){if(null==t)continue;const n=o.K.mkElement("div",["window"]);if(n.setAttribute("wnd",t.id),null!=t.windowIcon&&""!=t.windowIcon.trim()){const e=o.K.mkElement("div",["icon"]);e.style.backgroundImage=`url(${t.windowIcon})`,n.appendChild(e)}else{const e=o.K.mkElement("div",["icon"]);e.style.backgroundImage=`url(${r.Q.getIconUrl("small/exec")})`,n.appendChild(e)}const s=o.K.mkElement("div",["title"]);s.innerText=t.title,n.appendChild(s),n.onclick=e=>{e.stopPropagation(),m()},n.wnd=t,e.appendChild(n)}document.body.appendChild(c),document.body.addEventListener("keydown",u),document.body.addEventListener("keyup",h);const t=function(){const e=document.querySelector(".window-dlg.active");if(null==e)return-1;const t=e.id,n=c.querySelector(".windows");if(!t)return-1;const s=n.querySelector(`.window[wnd="${t}"]`);for(let e=0;e<n.children.length;e++)if(s==n.children[e])return e;return-1}();-1!=t&&(p(t),d=t)}},keyUpHandler:function(e){},closeUI:m};function w(){document.querySelectorAll(".imde-ui-popup").forEach((e=>e.remove()))}function y(){document.body.addEventListener("keydown",(e=>{if(e.ctrlKey&&e.shiftKey)switch(e.key){case"F8":e.preventDefault(),function(){let e=document.querySelector(".imde-ui-popup.shkeys");if(e)return void e.remove();b.closeAllPopups();const t=o.K.mkElement("div",["imde-ui-popup","shkeys"]);t.innerHTML='<div class="title">\n    Keyboard Shortcuts\n</div>\n<div class="popup">\n    <div class="keys-list">\n        <div class="key-item">\n            <span class="key">CTRL</span>+<span class="key">SHIFT</span>+<span class="key">K</span>\n            <span class="explanation">\n            Fast window switching\n            </span>\n        </div>\n        <div class="key-item">\n            <span class="key">CTRL</span>+<span class="key">SHIFT</span>+<span class="key">F8</span>\n            <span class="explanation">\n            Toggles this dialog\n            </span>\n        </div>\n        <div class="key-item">\n            <span class="key">CTRL</span>+<span class="key">SHIFT</span>+<span class="key">T</span>\n            <span class="explanation">Quickly open a terminal window\n            </span>\n        </div>\n        <div class="key-item">\n            <span class="key">CTRL</span>+<span class="key">R</span>\n            <span class="explanation">Reload the desktop</span>\n        </div>\n    </div>\n</div>',document.body.appendChild(t)}();break;case"K":e.preventDefault(),_.keyDownHandler(e);break;case"T":e.preventDefault(),w(),i.x.execCmd("terminal",[])}})),document.body.addEventListener("keyup",(e=>{if(e.ctrlKey&&e.shiftKey&&"K"===e.key)_.keyUpHandler(e)}))}const b={init:async function(){console.group("[ IMDE ]"),console.log("Initializing..."),console.log("Loading data..."),await s.a.loadStyleAsync("/system/resource/stylesheets/imde.css"),console.log("Assigning events..."),y(),console.log("Done initializing."),console.groupEnd()},closeAllPopups:w}},4973:(e,t,n)=>{"use strict";n.d(t,{R:()=>i});var s=n(5784);const i={mkShortcut:function(e,t,n,i=!1){const o={};return o.hideShortcutEmblem=i,o.icon=t,o.action=n,s.FS.writestr(e,JSON.stringify(o))}}},8423:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});n(7366),n(4871),n(4420);var s=null,i=null,o=null;function r(e,t=!1){var n=document.querySelector("#"+e+"_appbar");if(null!=n){var s=n.associatedWindow;if((s.wndObject.classList.contains("active")||s.minimized)&&t&&!s.uiUpdating&&s.toggleMinimize(),s.appbarRegistered){for(var o in Object.keys(i.children)){var r=i.children[o];null!=r&&r.classList.remove("taskbar-task_active")}n.classList.add("taskbar-task_active")}}}const a={assign:function(e){null==s&&(i=(s=e).querySelector(".taskbar-tasks"),o=s.querySelector(".taskbar-notify"))},createWindowAppBar:function(e){var t=e.id,n=e.windowIcon,s=document.createElement("button"),o=document.createElement("div");o.id=t+"_appbar_icon",o.classList.add("taskbar-task-icon"),(null==n||useIcon)&&(n="system/resource/themes/default/icons/small/exec.png"),o.style.background="url("+n+")",s.appendChild(o);var a=document.createElement("div");a.classList.add("taskbar-task-text"),a.innerText=e.title,a.id=t+"_appbar_text",s.appendChild(a),s.classList.add("taskbar-task"),s.setAttribute("id",t+"_appbar"),s.associatedWindow=e,s.onclick=function(){r(e.id,!0),e.activate()},s.oncontextmenu=function(t){e.showTitlebarMenu({x:t.x,y:t.y-65})},i&&i.appendChild(s)},activateAppBar:r,deactivateAppBar:function(e){var t=document.getElementById(e+"_appbar");null!=t&&t.classList.remove("taskbar-task_active")},destroyAppBar:function(e){var t=document.getElementById(e+"_appbar");null!=t&&i.removeChild(t)},registerNotifyIcon:function(e){null!=e&&o&&o.prepend(e.notifyElement)},setVisibility:function(e=!0){s.style.display=e?"":"none"}}},3432:(e,t,n)=>{"use strict";n(5784),n(7362)},1865:(e,t,n)=>{"use strict";n(7460),n(5516);var s=n(5624);s.Z},5624:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});const s={boot_entries:{}};function i(e){e&&localStorage.setItem(JSON.stringify({...s,...e}))}const o={defaultRom:s,get:function(){return{...s,...JSON.parse(localStorage.getItem("rom"))}},loadDefaults:function(){i(s)},save:i,has:function(){return localStorage.getItem("rom")}}},8313:(e,t,n)=>{"use strict";function s(e,t){t?function(e){var t=document.createElement("div");t.style.height="100vh",t.style.width="100vw",t.style.zIndex="3",t.style.pointerEvents="none",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.display="flex",t.style.flexDirection="column",e.style["background-image"]="url(system/resource/boot/logo_no_text.png)";var n=document.createElement("div");n.style.position="absolute",n.style.bottom="0",n.style.left="0",n.style.width="100%",n.style.height="8px",n.style.marginLeft="auto",n.style.marginRight="auto",n.style.marginBottom="auto",n.style.background="rgba(100, 180, 255, .2)",n.style.boxSizing="border-box";var s=document.createElement("div");s.classList.add("progress-indicator"),n.appendChild(s),t.appendChild(n),e.appendChild(t)}(e):function(e){var t=document.createElement("div");t.style.height="100vh",t.style.width="100vw",t.style.zIndex="3",t.style.pointerEvents="none",t.style.opacity="0.8",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.display="flex",t.style.flexDirection="column";var n=document.createElement("div");n.style.backgroundImage="url(system/resource/boot/logo.png)",n.style.height="256px",n.style.width="256px",n.style.marginTop="auto",n.style.marginLeft="auto",n.style.marginRight="auto",n.classList.add("boot-logo"),t.appendChild(n);var s=document.createElement("div");s.style.width="256px",s.style.height="18px",s.style.marginLeft="auto",s.style.marginRight="auto",s.style.marginBottom="auto",s.style.background="rgb(192,192,192)",s.style.boxSizing="border-box",s.style.padding="1px";var i=document.createElement("div");i.style.width="0%",i.classList.add("progress-indicator"),i.style.height="100%",i.style.background="rgb(0, 0, 128)",s.appendChild(i),t.appendChild(s),e.appendChild(t)}(e)}function i(e){document.querySelector(".progress-indicator").style.width=`${e}%`}n.d(t,{H6:()=>i,U6:()=>s})},66:(e,t,n)=>{"use strict";n.d(t,{q:()=>u});var s=n(8041),i=n(4871),o=n(4420),r=n(8423);let a,l=!1,c="unknown";function d(e){c!=e&&(a.notifyElement.classList.forEach((e=>{e.startsWith("icn-")&&a.notifyElement.classList.remove(e)})),a.notifyElement.classList.add(`icn-${e}`),c=e)}function p(e){e.level<=.1?(l||(s.O.create({title:"System",body:"Your battery is critically low (10%). You may want to save any unsaved work.",icon:"error"}),l=!0),d("critical")):e.level>.1&&e.level<.2?d("low"):e.level>.2&&e.level<.55?d("half"):e.level>.55&&d("full"),e.level>.1&&(l=!1)}const u={begin:async function(){a=new i.K("battery",o.Q.getIconUrl("small/exec")),a.hide(),a.notifyElement.classList.add("notify-battery"),a.ondblclick=()=>async function(e){s.O.create({title:"Battery Information",icon:"info",body:`Current Level: ${(100*e.level).toFixed(0)}%`}).body().classList.add("notify-battery-dlg","icn-"+c)}(e),r.e.registerNotifyIcon(a);const e=await navigator.getBattery();e&&(e.charging||a.show(),e.addEventListener("chargingchange",(()=>{e.charging?a.hide():a.show()})),e.addEventListener("levelchange",(()=>p(e))),p(e))}}},4078:(e,t,n)=>{"use strict";n.d(t,{f:()=>o});var s=n(8223);function i(){return"true"==localStorage.getItem("mobile-mode")}const o={isMobileModeEnabled:i,applyPatches:async function(){i()&&(await s.a.loadStyleAsync("/system/resource/stylesheets/mobile.css"),document.body.classList.add("s36-mobile"))},getDeviceType:function(){return localStorage.getItem("mobile-mode-devtype")}}},9807:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});var s=n(5784);const i={preferences:{single_click:!1}};let o={...i};const r={getProfile:()=>o,loadProfile:async function(e){try{const t=JSON.parse(await s.FS.readstr(e));o={...i,...t}}catch(e){console.error(e)}}}},6167:(e,t,n)=>{"use strict";n.d(t,{p:()=>i});var s=n(9275);const i={fs:new s.v,sys:new s.v,wm:new s.v,ui:new s.v}},6226:(e,t,n)=>{"use strict";let s;n.d(t,{RI:()=>r,mB:()=>o,yE:()=>i,zM:()=>a});try{s=null!=localStorage["system-flags"]?JSON.parse(localStorage.getItem("system-flags")):[]||0}catch(e){s=[],console.error("Flags API:",e)}function i(e){return s.includes(e)}function o(e,t){i(e)?s=s.filter((t=>t!==e)):s.push(e),l()}function r(){s=[],l()}function a(){return s}function l(){localStorage["system-flags"]=JSON.stringify(s)}},7619:(e,t,n)=>{"use strict";n.d(t,{H:()=>s,J:()=>i});const s={EPERM:{id:1,message:"Operation not permitted"},ENOENT:{id:2,message:"No such file or directory"},EIO:{id:4,message:"I/O error"},EACCES:{id:13,message:"Permission denied"},EBUSY:{id:16,message:"Device or resource busy"},EEXIST:{id:17,message:"File exists"},ENODEV:{id:19,message:"No such device"},ENOTDIR:{id:20,message:"Not a directory"},EISDIR:{id:21,message:"Is a directory"},EINVAL:{id:22,message:"Invalid argument"},EFBIG:{id:27,message:"File too large"},ENOSPC:{id:28,message:"No space left on device"},ESPIPE:{id:29,message:"Illegal seek"},EROFS:{id:30,message:"Read-only file system"},ENAMETOOLONG:{id:36,message:"File name too long"},ENOSYS:{id:38,message:"Function not implemented"},ENOTEMPTY:{id:39,message:"Directory not empty"}};class i extends Error{constructor(e,t){var n="ERRNO";for(var i of Object.keys(s))if(null!=s[i]&&s[i].id==e.id){n=i;break}super(n+" "+t+": "+e.message),this.name="FSErrno",this.errno=e}}},8279:(e,t,n)=>{"use strict";n.d(t,{f:()=>s});const s={readOnly:"read-only",remote:"remote",hidden:"hidden"}},4799:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});class s{constructor(e){if(null==e)throw new Error("Cannot create file system without prefix.");this.remote=!1,this.readOnly=!1,this.prefix=e.toUpperCase(),this.watchId=null,this.volumeLabel="Disk",this.driverName="null",this.features=[]}async init(){}async uninit(){}isFile(e){}isEmpty(e){}mkdir(e){}rmdir(e){}touch(e){}rm(e){}readdir(e){}cpdir(e,t){}cpfile(e,t){}mvfile(e,t){}mvdir(e,t){}exists(e){}watchFolder(e,t){}updateWatch(e){}_intmkf(e){}readstr(e){}readbin(e){}filetype(e){}writestr(e,t){}writebin(e,t){}createReadStream(e){}createWriteStream(e){}createDuplexStream(e){}readBinChunk(e,t,n){}readStrChunk(e,t,n){}}},6499:(e,t,n)=>{"use strict";n.d(t,{k:()=>a});var s=n(4799),i=n(4876),o=n(7619);function r(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()}class a extends s.N{constructor(e){super(e),this._fileTable={"/":{length:0,dateAccessed:null,dateModified:null,dateCreated:null,readOnly:!1,type:1,recordId:"_null_"}},this._fsSort=!0,this.driverName="idbfs",this.currWrites=0}_getItem(e){return new Promise(((t,n)=>{try{localStorageDB.getItem(e,(function(e){t(e)}))}catch(e){n(e)}}))}_setItem(e,t){localStorageDB.setItem(e,t)}_pushFtableRecord(e,t,n,s){this._fileTable[e]={length:t,type:n,readOnly:s}}_fTableExists(e){return null!=this._fileTable[e]}_pauseSync(){this._syncPaused=!0}_resumeSync(){this._syncPaused=!1}async _sync(){try{if(this._syncPaused)return;for(var e of Object.keys(this._fileTable))null==this._fileTable[e]&&delete this._fileTable[e];this._setItem("$_FileTable_"+this.prefix.toLowerCase(),this._fileTable)}catch(e){}}async init(){var e=await this._getItem("$_FileTable_"+this.prefix.toLowerCase());null!=e&&(this._fileTable=e)}async uninit(){await this._sync(),clearInterval(this._fs_timer),this._fileTable=null}isFile(e){return 0==this.filetype(e)}exists(e){return null!=this._fileTable[e]}filetype(e){return this.exists(e)?this._fileTable[e].type:-1}touch(e){var t=i.R.getParentPath(e);if(!this.exists(t)||this.isFile(t))throw new o.J(o.H.ENOENT,t);return this._pushFtableRecord(e,0,0,!1),this._fileTable[e].recordId=r(),this.updateWatch(e),this._sync(),!0}rm(e){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);if(this._fileTable[e].readOnly)throw new o.J(o.H.EACCES,e);if(this._fileTable[i.R.getParentPath(e)].readOnly)throw new o.J(o.H.EACCES,i.R.getParentPath(e));return localStorageDB.removeItem(this._fileTable[e].recordId),this._fileTable[e]=void 0,this._sync(),!0}mkdir(e){if(this.exists(e))return!0;if(null!=this._fileTable[i.R.getParentPath(e)]&&this._fileTable[i.R.getParentPath(e)].readOnly)throw new o.J(o.H.EACCES,i.R.getParentPath(e));try{var t=i.R.resolvePath("/",e).split("/"),n="/";return t.forEach((e=>{(n+="/"+e).includes("//")&&(n=n.split("//").join("/")),this.exists(n)||this._intmkf(n)})),this._sync(),!0}catch(e){throw e}}_intmkf(e){return!!this.exists(i.R.getParentPath(e))&&(!this.exists(e)&&(this._pushFtableRecord(e,0,1,!1),this.updateWatch(e),!0))}readdir(e){var t=[],n=Object.keys(this._fileTable),s=e;if(!this.exists(e))throw new o.J(o.H.ENOENT,e);var i=s.split("/").length;for(var r in n){var a=n[r];if(a!=s&&null!=this._fileTable[a]){if("/"!=e){if(!a.startsWith(s+"/"))continue;if(!a.startsWith(s))continue}var l=a.split("/").length;"/"==e&&l>i||l>i+1||t.push(a)}}return this._fsSort?t.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})):t}isEmpty(e){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);return 0==this._fileTable[e].length}async cpdir(e,t){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(this.isFile(e))throw new o.J(o.H.ENOTDIR,e);return this.exists(t)||this.mkdir(t),this._pushFtableRecord(t,0,1,!1),Object.keys(this._fileTable).forEach((async n=>{if(null!=this._fileTable[n])if(n.startsWith(e+"/")){var s=n.split(e+"/").join(t+"/");this.isFile(n)?await this.cpfile(n,s):this._pushFtableRecord(s,0,1,!1)}else;})),this.updateWatch(t),await this._sync(),!0}async mvdir(e,t){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(this.isFile(e))throw new o.J(o.H.ENOTDIR,e);return this.exists(t)||this.mkdir(t),this._fileTable[e]=void 0,this._pushFtableRecord(t,0,1,!1),Object.keys(this._fileTable).forEach((async n=>{if(null!=this._fileTable[n]&&n.startsWith(e+"/")){var s=n.split(e+"/").join(t+"/");return this.isFile(n)?(this._pushFtableRecord(s,this._fileTable[n].length,0,!1),this._fileTable[s].recordId=this._fileTable[n].recordId):this._pushFtableRecord(s,0,1,!1),void(this._fileTable[n]=void 0)}})),this.updateWatch(t),await this._sync(),!0}async rmdir(e){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(this.isFile(e))throw new o.J(o.H.ENOTDIR,e);if("/"==e)throw new o.J(o.H.EINVAL,e);return this._fileTable[e]=void 0,Object.keys(this._fileTable).forEach((async t=>{if(null!=this._fileTable[t])return t.startsWith(e+"/")?(this.isFile(t)&&localStorageDB.removeItem(this.prefix+t),void(this._fileTable[t]=void 0)):void 0})),await this._sync(),!0}async mvfile(e,t){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);if(this._fileTable[e].readOnly)throw new o.J(o.H.EACCES,e);var n=i.R.getParentPath(t);return this.exists(n)||this.mkdir(n),this._pushFtableRecord(t,this._fileTable[e].length,0,!1),this._fileTable[t].recordId=this._fileTable[e].recordId,this._fileTable[e]=null,await this._sync(),!0}async cpfile(e,t){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);if(null!=this._fileTable[t]&&this._fileTable[t].readOnly)throw new o.J(o.H.EACCES,t);var n=i.R.getParentPath(t);this.exists(n)||this.mkdir(n),this._pushFtableRecord(t,this._fileTable[e].length,0,!1),this._fileTable[t].recordId=r();var s=await this._getItem(this._fileTable[e].recordId);return this._setItem(this._fileTable[t].recordId,s),await this._sync(),!0}async readbin(e){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);return this._fileTable[e].length<1?new Uint8Array(0):await this._getItem(this._fileTable[e].recordId)}async readstr(e){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);return this._fileTable[e].length<1?"":(new TextDecoder).decode(await this.readbin(e))}async writebin(e,t){var n=i.R.getParentPath(e);if(!this.exists(n)||this.isFile(n))throw new o.J(o.H.ENOENT,n);if(this.exists(e)){if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);if(this._fileTable[e].readOnly)throw new o.J(o.H.EACCES,e)}else this.touch(e);var s=new Uint8Array(0);if(t instanceof Uint8Array)s=t;else if(t instanceof Array){s=new Uint8Array(t.length);var r=0;for(var a of t)"number"==typeof a&&(s[r]=a,r++)}else{s=(new TextEncoder).encode(t.toString())}return await this._setItem(this._fileTable[e].recordId,s),this._fileTable[e].length=s.length,await this._sync(),!0}async writestr(e,t){await this.writebin(e,"string"==typeof t?t:t.toString())}async readBinChunk(e,t,n){if(!this.exists(e))throw new o.J(o.H.ENOENT,e);if(!this.isFile(e))throw new o.J(o.H.EISDIR,e);if(this._fileTable[e].length<1)return new Uint8Array(0);const s=await this._getItem(this._fileTable[e].recordId);if(!s)return new Uint8Array(0);return s.subarray(t,n)}async readStrChunk(e,t,n){return this._fileTable[e].length<1?"":(new TextDecoder).decode(await this.readBinChunk(e,t,n))}stat(e){return this._fileTable[e]}}},6429:(e,t,n)=>{"use strict";n.d(t,{s:()=>o});var s=n(6499);class i{constructor(e){this.data=null!=e?e:{}}getItem(e){return this.data[e]}setItem(e,t){this.data[e]=t.toString()}removeItem(e){this.data[e]=void 0}clear(){this.data={}}}class o extends s.k{constructor(e){super(e),this.driverName="ramfs",this.store=new i}_getItem(e){return new Promise(((t,n)=>{function s(e){t(e)}try{var i,o=this.store.getItem(this.prefix+e);try{i=JSON.parse(o)}catch(e){i=null}null==i?s(null):o.startsWith("[")?s(new Uint8Array(i)):s(i)}catch(e){n(e)}}))}_setItem(e,t){if(t instanceof Uint8Array){var n=[];for(var s of t)n.push(s);n=JSON.stringify(n),this.store.setItem(this.prefix+e,n)}else this.store.setItem(this.prefix+e,JSON.stringify(t))}}},5506:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var s=n(4799),i=(n(4876),n(7619)),o=n(8279);class r extends s.N{constructor(e,t){super(e),this.fileTable={"/":{length:0,type:1}},this.readOnly=!0,this.volumeLabel="Win96",this.driverName="rofs",this.remote=!0,this.schemaPath=t;try{this.origin=new URL(this.schemaPath).origin}catch(e){this.origin=location.origin}this.features.push(o.f.readOnly,o.f.remote)}async _getItem(e){return await fetch(this.origin+"/"+e).then((e=>e.arrayBuffer()))}async init(){this.fileTable=await fetch(this.schemaPath).then((e=>e.json()))}async uninit(){this.fileTable=null}isFile(e){return 0==this.filetype(e)}exists(e){return null!=this.fileTable[e]}filetype(e){return this.exists(e)?this.fileTable[e].type:-1}touch(e){throw new i.J(i.H.EROFS,e)}rm(e){throw new i.J(i.H.EROFS,e)}mkdir(e){throw new i.J(i.H.EROFS,e)}readdir(e){var t=[],n=Object.keys(this.fileTable),s=e;if(!this.exists(e))throw new i.J(i.H.ENOENT,e);var o=s.split("/").length;for(var r in n){var a=n[r];if(a!=s&&null!=this.fileTable[a]){if("/"!=e){if(!a.startsWith(s+"/"))continue;if(!a.startsWith(s))continue}var l=a.split("/").length;"/"==e&&l>o||l>o+1||t.push(a)}}return this._fsSort?t.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})):t}isEmpty(e){if(!this.exists(e))throw new i.J(i.H.ENOENT,e);if(!this.isFile(e))throw new i.J(i.H.EISDIR,e);return 0==this.fileTable[e].length}async cpdir(e,t){throw new i.J(i.H.EROFS,t)}async mvdir(e,t){throw new i.J(i.H.EROFS,t)}async rmdir(e){throw new i.J(i.H.EROFS,e)}async mvfile(e,t){throw new i.J(i.H.EROFS,t)}async cpfile(e,t){throw new i.J(i.H.EROFS,t)}async readbin(e){if(!this.exists(e))throw new i.J(i.H.ENOENT,e);if(!this.isFile(e))throw new i.J(i.H.EISDIR,e);return this.fileTable[e].length<1?new Uint8Array(0):await this._getItem(e)}async readstr(e){if(!this.exists(e))throw new i.J(i.H.ENOENT,e);if(!this.isFile(e))throw new i.J(i.H.EISDIR,e);return this.fileTable[e].length<1?"":(new TextDecoder).decode(await this.readbin(e))}async writebin(e){throw new i.J(i.H.EROFS,e)}async writestr(e){throw new i.J(i.H.EROFS,e)}stat(e){return this.fileTable[e]}}},5685:(e,t,n)=>{"use strict";n.d(t,{i:()=>i});const s={txt:"text/plain",js:"text/javascript",html:"text/html",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",mp4:"video/mp4",webm:"video/webm",exe:"application/octet-stream",zip:"application/zip",css:"text/css",ttf:"font/ttf",woff:"font/woff",woff2:"font/woff2",mp3:"audio/mpeg",svg:"image/svg+xml"};function i(e){return t=e.substring(e.indexOf(".")+1),null!=s[t]?s[t]:"application/octet-stream";var t}},4876:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var s=n(5784);function i(e,t){var n=e;n.endsWith("/")||(n+="/");var s=n.split("/"),i=t.split("/");s.pop();for(var o=0;o<i.length;o++)"."!=i[o]&&(".."==i[o]?s.pop():s.push(i[o]));return s.join("/")}class o{constructor(){}static getParentPath(e){if("/"==e)return"/";var t=e.split("/"),n=t[t.length-1],s=e.substring(0,e.length-n.length-1);const i=""!=s.trim()?s:"/";return/^([a-zA-Z]:)/.test(i)&&2===i.length?i+"/":i}static fname(e){var t=e.split("/");return t[t.length-1]}static resolvePath(e,t){return t.endsWith("/")&&(t=t.substring(0,t.length-1)),""==t||"/"==t?"/":(t.startsWith("/")?t.includes("..")||t.includes("/.")?(n=i(e,t)).includes("//")&&(n=n.split("//").join("/")):n=t:n=i(e,t),""==n&&(n="/"),n);var n}static deconstructFullPath(e){var t=e.trim();/^([a-zA-Z]:)/.test(t)||(t="C:"+t);var n=t.split(/^([a-zA-Z]:)/)[1].toUpperCase();return{prefix:n,path:t.substring(n.length)}}static getExtension(e){let t=e.substring(e.lastIndexOf(".")).trim();return t.includes("/")?this.fname(t):t}static async downloadFile(e){!function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";const s=new Blob([e],{type:"octet/stream"}),i=window.URL.createObjectURL(s);n.href=i,n.download=t,n.click(),window.URL.revokeObjectURL(i),n.remove()}(await s.FS.readbin(e),o.fname(e))}}},5784:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FS:()=>m,FSUtil:()=>a.R,IFileSystem:()=>r.N,IndexedFileSystem:()=>s.k,LocalStorageFileSystem:()=>i,P3FileSystem:()=>d,RemoteReadOnlyFileSystem:()=>o.O});var s=n(6499);class i extends s.k{constructor(e){super(e),this.driverName="localfs"}_getItem(e){return new Promise(((t,n)=>{function s(e){t(e)}try{var i=localStorage.getItem(this.prefix+e),o=JSON.parse(i);null==o?s(null):i.startsWith("[")?s(new Uint8Array(o)):s(o)}catch(e){n(e)}}))}_setItem(e,t){if(t instanceof Uint8Array){var n=[];for(var s of t)n.push(s);n=JSON.stringify(n),localStorage.setItem(this.prefix+e,n)}else localStorage.setItem(this.prefix+e,JSON.stringify(t))}}var o=n(5506),r=n(4799),a=n(4876),l=n(7619),c=n(8279);class d extends r.N{constructor(e,t,n,s){super(e),this.fileTable={"/":{length:0,type:1}},this.readOnly=!0,this._socket=s,this.volumeLabel=n,this.driverName="p3fs",this.remote=!0,this.features.push(c.f.readOnly,c.f.remote)}async _getItem(e){return await fetch(this.origin+"/"+e).then((e=>e.arrayBuffer()))}async init(){this.fileTable=await fetch(this.schemaPath).then((e=>e.json()))}async uninit(){this.fileTable=null}isFile(e){return 0==this.filetype(e)}exists(e){return null!=this.fileTable[e]}filetype(e){return this.exists(e)?this.fileTable[e].type:-1}touch(e){throw new l.J(l.H.EROFS,e)}rm(e){throw new l.J(l.H.EROFS,e)}mkdir(e){throw new l.J(l.H.EROFS,e)}readdir(e){var t=[],n=Object.keys(this.fileTable),s=e;if(!this.exists(e))throw new l.J(l.H.ENOENT,e);var i=s.split("/").length;for(var o in n){var r=n[o];if(r!=s&&null!=this.fileTable[r]){if("/"!=e){if(!r.startsWith(s+"/"))continue;if(!r.startsWith(s))continue}var a=r.split("/").length;"/"==e&&a>i||a>i+1||t.push(r)}}return this._fsSort?t.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})):t}isEmpty(e){if(!this.exists(e))throw new l.J(l.H.ENOENT,e);if(!this.isFile(e))throw new l.J(l.H.EISDIR,e);return 0==this.fileTable[e].length}async cpdir(e,t){throw new l.J(l.H.EROFS,t)}async mvdir(e,t){throw new l.J(l.H.EROFS,t)}async rmdir(e){throw new l.J(l.H.EROFS,e)}async mvfile(e,t){throw new l.J(l.H.EROFS,t)}async cpfile(e,t){throw new l.J(l.H.EROFS,t)}async readbin(e){if(!this.exists(e))throw new l.J(l.H.ENOENT,e);if(!this.isFile(e))throw new l.J(l.H.EISDIR,e);return this.fileTable[e].length<1?new Uint8Array(0):await this._getItem(e)}async readstr(e){if(!this.exists(e))throw new l.J(l.H.ENOENT,e);if(!this.isFile(e))throw new l.J(l.H.EISDIR,e);return this.fileTable[e].length<1?"":(new TextDecoder).decode(await this.readbin(e))}async writebin(e){throw new l.J(l.H.EROFS,e)}async writestr(e){throw new l.J(l.H.EROFS,e)}stat(e){return this.fileTable[e]}}var p=n(5685),u={};let h={};class m{static async mount(e,t=null){const n=null!=t?t:e.prefix;if(!(e instanceof r.N))throw new l.J(l.H.EINVAL,"(unknown)");if(null!=u[n])throw new Error("Filesystem is already mounted!");await e.init(),u[n]=e}static async umount(e){if(null==u[e])throw new l.J(l.H.ENODEV,e);let t=u[e];await t.uninit(),u[e]=null}static mounts(){let e=[];for(let t of Object.keys(u))null!=u[t]&&e.push(u[t]);return e}static list(){var e=[];for(var t in u)u[t]instanceof r.N&&e.push(t);return e}static nextLetter(){let e=null;for(let t of"CDEFGHIJKLMNOPQRSTUVWXYZ")if(!u[t+":"]){e=t+":";break}return e}static async toBlob(e){var t=await this.readbin(e);return new Blob([t],{type:(0,p.i)(e)})}static get(e){return u[e.toUpperCase()]}static _invokeFsFunc(e,t,n){if(null==u[t])throw new l.J(l.H.ENODEV,e);for(var s=u[t],i=[],o=3;o<arguments.length;o++)i.push(arguments[o]);return s[n].call(s,...i)}static isFile(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"isFile",t.path)}static isEmpty(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"isEmpty",t.path)}static mkdir(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"mkdir",t.path)}static rmdir(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"rmdir",t.path)}static touch(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"touch",t.path)}static rm(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"rm",t.path)}static readdir(e){var t=a.R.deconstructFullPath(e),n=this._invokeFsFunc(t.path,t.prefix,"readdir",t.path),s=[];for(var i of n)s.push(t.prefix+i);return s}static cpdir(e,t){var n=a.R.deconstructFullPath(e),s=a.R.deconstructFullPath(t);if(n.prefix==s.prefix)return this._invokeFsFunc(n.path,n.prefix,"cpdir",n.path,s.path);throw new Error("TODO Cross file system functions not implemented")}static cpfile(e,t){var n=a.R.deconstructFullPath(e),s=a.R.deconstructFullPath(t);if(n.prefix==s.prefix)return this._invokeFsFunc(n.path,n.prefix,"cpfile",n.path,s.path);throw new Error("TODO Cross file system functions not implemented")}static mvfile(e,t){var n=a.R.deconstructFullPath(e),s=a.R.deconstructFullPath(t);if(n.prefix==s.prefix)return this._invokeFsFunc(n.path,n.prefix,"mvfile",n.path,s.path);throw new Error("TODO Cross file system functions not implemented")}static mvdir(e,t){var n=a.R.deconstructFullPath(e),s=a.R.deconstructFullPath(t);if(n.prefix==s.prefix)return this._invokeFsFunc(n.path,n.prefix,"mvdir",n.path,s.path);throw new Error("TODO Cross file system functions not implemented")}static exists(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"exists",t.path)}static readstr(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"readstr",t.path)}static readbin(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"readbin",t.path)}static filetype(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"filetype",t.path)}static writestr(e,t){var n=a.R.deconstructFullPath(e);return this._invokeFsFunc(n.path,n.prefix,"writestr",n.path,t)}static writebin(e,t){var n=a.R.deconstructFullPath(e);return this._invokeFsFunc(n.path,n.prefix,"writebin",n.path,t)}static walk(e){const t=this.readdir(e);return t.forEach((e=>{if(!this.isFile(e)){this.walk(e).forEach((e=>t.push(e)))}})),t}static stat(e){var t=a.R.deconstructFullPath(e);return this._invokeFsFunc(t.path,t.prefix,"stat",t.path)}static rename(e,t){if("/"==e)return"/";const n=a.R.getParentPath(e)+"/"+t;return e!=n?0==m.filetype(e)?m.mvfile(e,n):m.mvdir(e,n):void 0}static readBinChunk(e,t,n){var s=a.R.deconstructFullPath(e);return this._invokeFsFunc(s.path,s.prefix,"readBinChunk",s.path,t,n)}static readStrChunk(e,t,n){var s=a.R.deconstructFullPath(e);return this._invokeFsFunc(s.path,s.prefix,"readStrChunk",s.path,t,n)}static async cache(e,t){const n={type:"binary",overwrite:!0,...t};if(!h[e]||n.overwrite)switch(n.type){default:throw new Error("Invalid argument.");case"binary":h[e]=await m.readbin(e);break;case"string":h[e]=await m.readstr(e);break;case"blob":h[e]=await m.toBlob(e)}}static uncache(e){h[e]=void 0}static getFromCache(e){return h[e]}}},3177:(e,t,n)=>{"use strict";async function s(e){await fetch("system/errpages/bsod.html").then((async t=>{var n=await t.text();n=n.split("${message}").join(e),document.write(n)}))}n.d(t,{A:()=>s})},7460:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var s=n(5784);class i{constructor(e){this.el=e,this.buf=""}print(e){const t=document.createElement("span");return t.innerHTML=e,this.el.appendChild(t),this.el.scrollTop=this.el.scrollHeight,this.buf+=e,t}print_styled(e,t){this.print(e).setAttribute("style",null==t?"":t),this.el.scrollTop=this.el.scrollHeight}println_styled(e,t){this.print_styled(e+"<br>",t),this.el.scrollTop=this.el.scrollHeight}println(e){this.print(e+"<br>"),this.el.scrollTop=this.el.scrollHeight}error(e){this.print(`<span style="color: red;">[ ! ]: ${e}</span><br>`),this.el.scrollTop=this.el.scrollHeight}warn(e){this.print(`<span style="color: yellow;">[ ! ]: ${e}</span><br>`),this.el.scrollTop=this.el.scrollHeight}close(){this.el.remove(),s.FS.writestr("b:/lastboot.html",this.buf)}clear(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}},2534:(e,t,n)=>{"use strict";n.d(t,{o:()=>i});class s{constructor(e){this.element=e}group(){}groupEnd(){}error(e){const t=this.log(e);return t.classList.add("error"),t.querySelector(".level").innerText=" ERROR ",t}warn(e){const t=this.log(e);return t.classList.add("warn"),t.querySelector(".level").innerText=" WARN ",t}log(e){const t=document.createElement("div");t.classList.add("line");const n=document.createElement("span");n.classList.add("time"),n.innerText=`[${(new Date).toLocaleTimeString()}]`,t.appendChild(n);const s=document.createElement("span");s.classList.add("level"),s.innerText=" INFO ",t.appendChild(s);const i=document.createElement("span");return i.classList.add("text"),i.innerText=e.replace(/\%c/g,""),t.appendChild(i),this.element.appendChild(t),this.element.scrollTop=this.element.scrollHeight,t}}const i={init:function(){const e=document.createElement("div");e.classList.add("kern-debug-console"),window.console=new s(e),document.body.appendChild(e),window.addEventListener("error",(e=>{const t=console.error(new String(e.error)),n=document.createElement("span");n.classList.add("sub"),n.innerText=" EXC ",t.querySelector(".level").appendChild(n)}))}}},6891:(e,t,n)=>{"use strict";n.d(t,{K:()=>s});const s={early_init:async()=>!0,init:async()=>!0,post_init:async()=>!0}},3249:(e,t,n)=>{"use strict";n.d(t,{T:()=>E});var s=n(6314),i=n(4600),o=n(4016),r=n(3349),a=n(1384),l=n(4186),c=n(9338),d=n(4420),p=n(7366),u=n(6429),h=n(5784),m=n(7362),_=n(6841),w=n(9182),y=n(5516),b=n(9471);class g extends l.WApplication{constructor(){super()}async main(e){if(document.querySelector(".recovery-app"))return;super.main(e);const t=[{title:"File Explorer",description:"Repair files by browsing your file system",icon:d.Q.getIconUrl("folder"),cmd:"explorer"},{title:"Reinstall",description:"Remove everything and start fresh.",icon:d.Q.getIconUrl("apps/reinstall"),cmd:"reinstall"},{title:"System Flags",description:"Modify system behavior/boot flags",icon:d.Q.getIconUrl("objects/tools"),cmd:"flags"},{title:"Terminal",description:"Open a terminal where various commands may be executed",icon:d.Q.getIconUrl("apps/terminal"),cmd:"terminal"}],n=this.createWindow({icon:d.Q.getIconUrl("exec"),title:"System Recovery Tools",controlBoxStyle:"WS_CBX_CLOSE",taskbar:!1,initialHeight:362,initialWidth:485,center:!0,bodyClass:"recovery-app",body:'\n            <span class="bold-noaa">Choose a recovery tool</span>\n            <p>\n            System Drive: (X:/)\n            </p>\n\n            <div class="items">\n                \n            </div>\n            <div class="buttons">            \n                <button class="w96-button reboot">Reboot</button>\n            </div>\n            ',resizable:!1},!0),s=n.getBodyContainer(),i=s.querySelector(".items");s.querySelector(".reboot").addEventListener("click",(()=>y.x.reboot(!0)));for(let e of t){const t=b.K.mkElement("div",["item"]),n=b.K.mkElement("div",["icon"]);n.style.backgroundImage=`url(${e.icon})`;const s=b.K.mkElement("div",["text"]),o=b.K.mkElement("span",["bold-noaa"]),r=b.K.mkElement("span",[]);o.innerText=e.title,r.innerText=e.description,s.appendChild(o),s.appendChild(document.createElement("br")),s.appendChild(r),o.addEventListener("click",(()=>y.x.execCmd(e.cmd,[]))),t.appendChild(n),t.appendChild(s),i.appendChild(t)}n.show()}ontermination(){y.x.reboot(!0)}}const f={init:async function(){const e=document.createElement("div");e.style.backgroundColor="#343434",e.style.width="100vw",e.style.height="100vh",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex="8",e.style.overflow="hidden",document.body.appendChild(e);for(let e of h.FS.list())try{await h.FS.umount(e)}catch(e){console.error(e)}await h.FS.mount(new u.s("c:"));const t=new h.IndexedFileSystem("c:");t.prefix="C:",await h.FS.mount(t,"X:"),h.FS.get("c:").volumeLabel="Recovery",await(0,_.Dc)(300);for(let e of(0,m.V7)())(0,m.N9)(e);document.body.onclick=function(e){null!=e.target&&null!=e.target.classList&&e.target.classList.contains("root-item")||(document.querySelectorAll(".wcontext-menu").forEach((e=>e.remove())),document.querySelectorAll(".w96-menubar>.root-item.selected").forEach((e=>e.classList.remove("selected"))))},document.body.style.height="100vh",p.C$.setWindowContainer(e),p.C$.disableAppBar(!0),d.Q.uiVars.maxWindowSizeFormulaH="100vh",d.Q.uiVars.maxWindowSizeFormulaW="100vw",d.Q.cssa("\n    .titlebar-minbutton {\n        display: none !important;\n    }\n\n    .titlebar-title-disabled {\n        background: gray !important;\n    }\n    \n    .titlebar {\n        background: linear-gradient(45deg, #181818, dimgrey);\n    }");const n=c.jC.idleProgress("Recovery Environment","Loading data, please wait...");await(0,w.N)("/system/images/recovery.zip"),n.closeDialog(),(0,m.VG)("explorer",[],(async function(e){return l.WApplication.execAsync(new s.ExplorerApplication,e)})),(0,m.VG)("openwith",[],(function(e){return l.WApplication.execAsync(new o.OpenWithApplication,e)})),(0,m.VG)("textpad",["txt","log","json"],(function(e){return l.WApplication.execAsync(new r.TextpadApplication,e)})),(0,m.VG)("rcmenu",[],(function(e){return l.WApplication.execAsync(new g,e)})),(0,m.VG)("terminal",[],(function(e){return l.WApplication.execAsync(new a.TerminalApplication,e)})),(0,m.VG)("flags",[],(function(e){return l.WApplication.execAsync(new i.FlagsApplication,e)})),(0,m.VG)("reinstall",[],(function(e){c.jC.confirm("Press OK to reinstall Windows 96. Your data will be gone forever and cannot be recovered!",(e=>{if(e)if(localStorage.clear(),indexedDB){const e=indexedDB.deleteDatabase("W96FS");e.onsuccess=()=>{console.log("DB clear successful!"),document.location.reload()},e.onerror=()=>{console.error("DB clear failed!"),document.location.reload()},e.onblocked=()=>{console.error("Operation blocked - cannot clear DB."),document.location.reload()}}else document.location.reload()}))})),(0,m.lw)("rcmenu",[])}};n(8223);function v(e){e.ctrlKey&&"i"==e.key&&function(){for(;document.body.firstChild;)document.body.removeChild(document.body.firstChild);f.init()}()}const E={registerHandler:()=>document.body.addEventListener("keydown",v),deregisterHandler:()=>document.body.removeEventListener("keydown",v)}},6471:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});const s={branch:"devel",status:"OFFICIAL",name:"wkern",rootfsUrl:"system/images/rootfs.zip"}},9230:(e,t,n)=>{"use strict";n.d(t,{e:()=>s});class s extends Error{constructor(e){super(e),this.name="KernelError"}}},8223:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});var s=n(5784);const i=[],o={};const r={loadTextAsync:async function(e,t=!0){if(o[e])return o[e];const n=await fetch(e);return o[e]=await n.text()},loadlibAsync:function(e){return new Promise(((t,n)=>{try{if(i.includes(e))return t();const n=document.createElement("script");n.onload=()=>{t()},n.src=e,document.head.appendChild(n),i.push(e)}catch(e){n(e)}}))},loadStyleAsync:function(e){return new Promise((t=>{if(i.includes(e))return t();const n=document.createElement("link");n.rel="stylesheet",n.onload=()=>{t()},n.href=e,document.head.appendChild(n),i.push(e)}))},createStyleFromPath:async function(e){const t=await s.FS.readstr(e),n=document.createElement("style");return n.innerText=t,n}}},2690:(e,t,n)=>{"use strict";n.d(t,{l:()=>o});var s=n(6429),i=n(5784);n(7460);const o={loadDefinitions:async function(e,t){const n=e.split("\n");let o=0;for(let e of n){let n=e.trim();if(o++,n.startsWith("#"))continue;if(""==n)continue;const r=n.split(" "),a=r[0];if("+"==a){if(r.length<3)throw new Error(o+": 2 arguments needed, only "+(r.length-1)+" present.");const e=r[1],n=r[2].toLowerCase();if(!/[a-zA-Z]\:/.test(e))throw new Error(o+": Invalid drive letter "+e);let a=null;switch(n){default:throw new Error(o+": File system does not exist.");case"idb":a=new i.IndexedFileSystem(e);break;case"lstor":a=new i.LocalStorageFileSystem(e);break;case"ram":a=new s.s(e);break;case"rofs":throw new Error("Not implemented")}null!=r[3]&&(a.volumeLabel=r[3]),await i.FS.mount(a),t.println_styled(">> Mounted drive "+e+" [fs="+n+", label="+a.volumeLabel+"]","color: cyan")}else{if("-"!=a)throw new Error("Invalid FS definition found - please delete line "+o+", `"+n+"`");{if(r.length<2)throw new Error(o+": 1 argument needed, only "+(r.length-1)+" present.");const e=r[1];if(!/[a-zA-Z]\:/.test(e))throw new Error(o+": Invalid drive letter "+e);await i.FS.umount(e)}}}}}},9150:(e,t,n)=>{"use strict";n.d(t,{f:()=>u});var s=n(4186),i=n(9338),o=n(8041),r=n(9275),a=n(5516);let l=["http://localhost:4096","http://127.0.0.1:4096","https://windows96.net","http://127.0.0.1:8192","http://localhost:8192","https://devel.windows96.net:4096","http://devel.windows96.net:4096","https://etc.windows96.net"],c=[],d=!1,p=new r.v;const u={register:function(){if(d)throw new Error("postMessage() handler already registered.");window.addEventListener("message",(e=>{l.includes(e.origin.trim())?null!=e.data&&null!=e.data.op&&"string"==typeof e.data.op&&null!=e.data.args&&p.emit(e.data.op,{evt:e,args:e.data.args}):c.includes(e.origin)||(console.error("Refusing to accept events from untrusted URL "+e.origin),c.push(e.origin))})),d=!0},registerBasicEvents:function(){p.on("debug",(e=>console.log(e))),p.on("ifr-prompt",(e=>{null==e.args[0]&&null==e.args[1]&&null==e.args[2]&&null==e.args[3]&&null==e.args[4]&&null==e.args[5]||i.jC.prompt(e.args[0],e.args[1],e.args[2],(t=>{const n=e.args[3],i=e.args[4],o=e.args[5];s.processes[o].appFrame.contentWindow.postMessage({op:n,args:{value:t}},i)}))})),p.on("urlopen",(e=>{if(null==e.args[0])return;const t=o.O.create({title:"Open URL",icon:"warning",body:'Are you sure you want to open this URL?<br><br>\nURL: <span class="url"></span><br><br>\nOpening untrusted URLs can put you at risk!',buttons:[{id:"ok",text:"Cancel",action:"$close"},{id:"ok",text:"OK",action:t=>{a.x.execCmd("iexploder",[e.args[0]]),t.dlg.close()}}]});t.body().querySelector(".url").innerText=e.args[0],t.show()}))},trust:function(e){l.includes(e)||l.push(e)},events:p}},4247:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});const s="web";var i={getVersionString:function(){var e=localStorage.getItem("w96ver");return null==e?"unknown":e},getVersion:function(){var e=localStorage.getItem("w96ver");return null==e?-1:parseFloat(e)},getReleaseChannel:function(){return"main"},getType:function(){return s}}},7733:(e,t,n)=>{"use strict";n.d(t,{D:()=>s});class s{constructor(e){const t={id:null,friendlyName:null,autostart:!1,...e};if(null==t.id)throw new Error("Service ID cannot be null");if(null==t.friendlyName)throw new Error("Service must provide friendly name");this.id=t.id,this.friendlyName=t.friendlyName,this.autostart=!0,this.running=!1}async start(){this.running=!0}async stop(){this.running=!1}}},8918:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var s=n(2110),i=n(5784),o=n(7733);class r{constructor(){this.services=[]}find(e){return this.services.find((t=>t.id==e))}async register(e){if(e){if(!(e instanceof o.D))throw new Error("Object must be a service.");if(this.find(e.id))throw new Error("This service is already registered.");this.services.push(e)}}async parse(e){const t=await i.FS.readstr(e);return await s.D.run(`\n            const Service = this.boxedEnv.svc;\n\n            ${t}\n        `,{boxedEnv:{svc:o.D}})}async start(e,t){if(!e)return;let n=null;if("string"==typeof e){if(n=this.find(e),!n)return;await n.start(t),n.running=!0}else await e.start(t),e.running=!0}async stop(e,t){if(!e)return;let n=null;if("string"==typeof e){if(n=this.find(e),!n)return;await n.stop(t),n.running=!1}else await e.stop(t),e.running=!1}getAll(){return this.services}}},4827:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});const s={availableTweaks:[],tweaksEnabled:function(){const e=localStorage.getItem("sys::tweaks");return e?e.split(","):(localStorage.setItem("sys::tweaks",""),[])}()}},6640:(e,t,n)=>{"use strict";let s;function i(){"serviceWorker"in navigator&&(window.addEventListener("load",(function(){navigator.serviceWorker.register("/system/libraries/kernel/workers/fs-http-proxy.js").then((e=>{s=e})).catch((e=>console.log("service worker not registered",e)))})),navigator.serviceWorker.addEventListener("message",(e=>{(e.data||e.data.op)&&e.data.op})))}async function o(){const e=await navigator.serviceWorker.getRegistrations();e.length>0&&(e.forEach((e=>e.unregister())),window.location.reload())}n.d(t,{S:()=>o,i:()=>i})},7362:(e,t,n)=>{"use strict";n.d(t,{Du:()=>d,K2:()=>h,N9:()=>u,V7:()=>_,VG:()=>l,lw:()=>m,nP:()=>i,nt:()=>p,rF:()=>c,rr:()=>w});n(5784);let s={};const i={setEnv:function(e,t){s[e]=t},getEnv:function(e){return s[e]},envKeys:function(){return Object.keys(s)}};let o={},r={},a={};function l(e,t,n,s){if(null!=o[e])throw Error("App already registered!");o[e]={supportedFileTypes:t,launchCallback:n},s&&(r[e]=s)}function c(e,t){a[e]=t}function d(e,t,n){r[e]={icon:t,friendlyName:n}}function p(e){return r[e]}function u(e){o[e]=null}function h(e){return null!=o[e]}function m(e,t,n){if(!h(e))throw new Error(`App \`${e}\` does not exist.`);return o[e].launchCallback(t,n)}function _(){var e=[];for(var t of Object.keys(o))null!=o[t]&&e.push(t);return e}function w(e){var t=[];const n=e.includes(".")?e.substring(e.lastIndexOf(".")+1):"*";for(var s of _()){o[s].supportedFileTypes.includes(n)&&t.push(s)}return t}},5516:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>kmain,x:()=>System});var _gui_wndsystem__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7366),_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__(8313),_kernel_bsod__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(3177),_kernel_console__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7460),_kernel_kerror__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9230),_fs_webfs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5784),_shell_desktop__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4367),_debug_devtools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2677),_registry__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7362),_sys_os_wpa__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9703),_apps_misc_lnk42rt__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(1984),_wasm_wasm__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9110),_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(9338),_app_loader__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3432),_kernel_volmgr__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2690),_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6471),_kernel_events__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(6891),_os_release__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(4247),_apps_mobile_progs_menu__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(6552),_events__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(6167),_apps_util_winspector__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(6005),_shell_executor__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(254),_apps_system_settings_dynamicwp__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(4019),_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(4420),_util_std__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(6841),_fs_features__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(8279),_sys_net_p3_import_w96__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(7839),_net_crossifr__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(9150),_api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(2110),_gui_compositor_wincomp__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(674),_pwa__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(6640),_fs_filesystems_fs_ram__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(6429),_kernel_iip__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(3249),_util_zip__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(9182),_os_svc_servicemgr__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(8918),_kernel_debug_conoverlay__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(2534),_dev_profilemgr__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(9807),_apps_emulators_wmbox_runners_runner_v86__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(1722),_dev_battery__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(66),_bios_bios__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(1865),_bios_rom__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(5624),_flags__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(6226),_gui_shell_notifyicon__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(4871),_shell_taskbar__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(8423),_apps_system_p3_settings__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(4821),_apps_wapp__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(4186);console.group("[ boot ]"),null==localStorage.fastboot&&(localStorage.fastboot=!0);const latestVersion=2.42,kEnv={kmainCalled:!1,usesLocalStorage:!1,localStorageExtractIgnoreExtensions:[".jpg",".png"],customRootfsImage:localStorage.getItem("rootfs-name")||null,useFastBoot:localStorage.getItem("fastboot")||!1,systemType:_os_release__WEBPACK_IMPORTED_MODULE_15__.d.getType(),displayDebugConsole:"true"==localStorage.getItem("debug-console")||null},svcMgr=new _os_svc_servicemgr__WEBPACK_IMPORTED_MODULE_30__.W;let biosConfig;const sleep=e=>new Promise((t=>setTimeout(t,e)));function versionCheck_isOld(){var e=localStorage.getItem("w96ver");return null!=e?parseFloat(e)<latestVersion:(localStorage.setItem("w96ver",latestVersion),!1)}function kpause(e){return new Promise(((t,n)=>{if(kEnv.useFastBoot&&!(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("no_fastboot"))return t();setTimeout((function(){t()}),e)}))}function fetchResourceAsBinary(t){return new Promise(((n,s)=>{try{fetch(t,{cache:"no-cache"}).catch((t=>{n({success:!1,data:null,error:e})})).then((async e=>{200!=e.status?n({success:!1,data:null,error:e.status}):n({success:!0,data:await e.arrayBuffer(),error:null})}))}catch(e){n({success:!1,data:null,error:e})}}))}async function importApp(e,t,n,s){(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)(t,n,(function(t){return _apps_wapp__WEBPACK_IMPORTED_MODULE_41__.WApplication.execAsync(new s[e],t)}))}async function kmain(e){if((kEnv.displayDebugConsole||new URLSearchParams(window.location.search).has("debug"))&&_kernel_debug_conoverlay__WEBPACK_IMPORTED_MODULE_31__.o.init(),e=null==e?{boot_type:"normal"}:e,kEnv.kmainCalled)throw new _kernel_kerror__WEBPACK_IMPORTED_MODULE_2__.e("kmain() has already been called.");switch(kEnv.kmainCalled=!0,_kernel_iip__WEBPACK_IMPORTED_MODULE_28__.T.registerHandler(),e.boot_type){default:console.error("Invalid boot type! Defaulting to normal..."),e.boot_type="normal";break;case"normal":break;case"mini":return void kinitGui(t,!1)}if(!window.localStorage)return void await(0,_kernel_bsod__WEBPACK_IMPORTED_MODULE_42__.A)("Your browser does not support localStorage, a required feature for storing data.");if(!await _kernel_events__WEBPACK_IMPORTED_MODULE_14__.K.early_init(e,{versionInfo:{latestVer:latestVersion}}))return;(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("disable_sw")?(0,_pwa__WEBPACK_IMPORTED_MODULE_43__.S)():(0,_pwa__WEBPACK_IMPORTED_MODULE_43__.i)(),(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("simulate_missing_idb")&&Object.defineProperty(window,"indexedDB",{get:function(){}}),(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("simulate_no_wasm")&&Object.defineProperty(window,"WebAssembly",{get:function(){}}),showIntro();var t=new _kernel_console__WEBPACK_IMPORTED_MODULE_1__.E(document.getElementById("convga"));const n=!(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("disable_new_bootscreen");n?(t.el.classList.add("boot-new"),t.println_styled(`<span class="con-bold con-sysinfo-wrap"><div class="con-line"></div><br><div class="con-sysinfo">MIKESOFT Windows 96 Kernel version ${latestVersion} (${_os_release__WEBPACK_IMPORTED_MODULE_15__.d.getReleaseChannel()}/${kEnv.systemType}).<br>Copyright (C) Windows 96 Team 2021.<br></div><div class="con-line"></div></span><br>`,"color: cyan;")):t.println_styled(`<span class="con-bold">▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀<br>MIKESOFT Windows 96 Kernel version ${latestVersion} (${_os_release__WEBPACK_IMPORTED_MODULE_15__.d.getReleaseChannel()}/${kEnv.systemType}).<br>Copyright (C) Windows 96 Team 2021.<br>▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀</span><br>`,"color: crimson;"),versionCheck_isOld(),window.onerror=function(e){t.error(e)},t.println_styled("User-Agent: "+navigator.userAgent,"color: yellow"),t.println_styled("Hash: "+(""==window.location.hash?"None":window.location.hash),"color: yellow"),t.println_styled("Server: "+window.location.href,"color: yellow"),t.println_styled("Kernel: "+_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.name+" ("+_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.branch+"-"+_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.status+")<br>","color: yellow");var s="";null!=window.indexedDB&&(s+="IndexedDB, "),null!=window.localStorage&&(s+="LocalStorage, "),"undefined"!=typeof WebAssembly&&(s+="WebAssembly, "),"undefined"!=typeof WebGLProgram&&(s+="WebGL, "),t.println_styled("Detected Features: "+s.substring(0,s.length-2)+"<br>","color: dodgerblue"),t.println_styled('Press <span class="con-bold">[CTRL + I]</span> to start recovery mode.<br>',"color: lime;"),await(0,_util_std__WEBPACK_IMPORTED_MODULE_44__.Dc)(1200),await kpause(500),t.println("[kmain] Mounting C:/ system drive...");try{window.indexedDB?(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(new _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.IndexedFileSystem("c:")),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(new _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.IndexedFileSystem("b:"))):(t.warn("WARNING: Your browser does not support IndexedDB\n     --\x3e This may have negative implications during your session and will not let you install complex applications.\n     --\x3e LocalStorage will be used as a fallback, which only holds up to 10 megabytes per origin (aka website).\n     --\x3e Please upgrade your browser for a better experience."),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(new _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.LocalStorageFileSystem("c:")),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(new _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.LocalStorageFileSystem("b:")),kEnv.usesLocalStorage=!0)}catch(e){return void t.error("[kmain] Could not mount C:/, system halted.")}let i=new _fs_filesystems_fs_ram__WEBPACK_IMPORTED_MODULE_27__.s("z:");if(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(i),i.features.push(_fs_features__WEBPACK_IMPORTED_MODULE_22__.f.hidden),_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.get("b:").features.push(_fs_features__WEBPACK_IMPORTED_MODULE_22__.f.hidden),"true"==localStorage.getItem("backup_mode_reboot")){localStorage.setItem("backup_mode_reboot",""),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.U6)(t.el,n),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(0),t.println_styled("[ i ]: System backup mode has been engaged. It is recommended to let the backup finish cleanly.","color: cyan"),t.println_styled("       -> The backup result log will be stored in B:/backprg.log","color: cyan"),t.println_styled("       -> The generated ZIP file will be available upon completion.","color: cyan"),t.println_styled("       -> Backup will proceed in 5 seconds.\n","color: cyan"),await(0,_util_std__WEBPACK_IMPORTED_MODULE_44__.Dc)(5e3),t.println("Backing up C:/...\n");const e=new JSZip,s=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.walk("c:/").map((e=>e.substring(3,e.length)));let i=s.length,r=0;for(let n of s){const s="c:/"+n;if(r++,_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.isFile(s))try{await e.file(n,await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readbin(s)),t.println_styled(`+ [ ${r} / ${i} ]: Added ${s}`,"color: lime"),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(r/i*100*.9)}catch(e){console.log("Error zipping contents.")}}t.println_styled("+ [ storing local storage ]","color: lime");try{const t=JSON.stringify(localStorage);await e.file("local-storage",t)}catch(e){t.error(new String(e))}t.println_styled("\nGenerating ZIP file - this may take a long time! Do NOT close this window during generation and download of backup ZIP.");const a=await e.generateAsync({type:"blob"}),l=URL.createObjectURL(a),c=document.createElement("a");c.href=l,c.click(),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(100);for(var o=0;o<600;o++)100==o&&t.println_styled("\n\nBackup complete! Please allow your download to finish or you will experience corruption! Continuing boot in 5 seconds..."),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(100-o/6),await sleep(10);(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(0)}else if(null!=localStorage.getItem("restore_image")){const e=URL.createObjectURL(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.toBlob(localStorage.getItem("restore_image")));try{for(let e of _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readdir("c:/"))if(_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.isFile(e))await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.rm(e);else{if(e.toLowerCase()==localStorage.getItem("restore_image").toLowerCase())continue;await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.rmdir(e)}}catch(e){console.error(e)}localStorage.clear(),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.U6)(t.el,n),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(0),t.println_styled("[ i ]: System restore mode has been engaged. Do NOT restart, you WILL lose your data!","color: cyan"),t.println_styled("       -> Restore will proceed in 5 seconds.\n","color: cyan"),await(0,_util_std__WEBPACK_IMPORTED_MODULE_44__.Dc)(5e3),t.println("Restoring, this may take a while...\n");try{await(0,_util_zip__WEBPACK_IMPORTED_MODULE_29__.N)(e)}catch(e){return t.error("Error reading ZIP file. Restore aborted."),void localStorage.removeItem("restore_image")}localStorage.removeItem("restore_image");const s=JSON.parse(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr("c:/local-storage"));for(let e of Reflect.ownKeys(s))localStorage[e]=s[e];t.println_styled("\n\nRestore finished! Rebooting in 5 seconds...");for(o=0;o<500;o++)(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(100-o/5),await sleep(10);(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(0),document.location.reload()}t.println("[kmain] Mounting W:/ root drive...");try{(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("sys_ignore_mount")||await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mount(new _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.RemoteReadOnlyFileSystem("w:","/system/images/rofs.json"))}catch(e){t.warn("Could not mount W:/, continuing anyway...")}var r=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.get("c:");if(await _kernel_events__WEBPACK_IMPORTED_MODULE_14__.K.init(t,r))if(r.exists("/system/etc/volmgr.cfg")&&"true"!=localStorage.getItem("volmgr_bypass")&&(t.println("[kmain] Initializing volumes..."),await _kernel_volmgr__WEBPACK_IMPORTED_MODULE_12__.l.loadDefinitions(await r.readstr("/system/etc/volmgr.cfg"),t),null==(r=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.get("c:"))))t.error("[!] System root is not mounted. Please set `volmgr_bypass` to `true` in local storage to disable the volume manager.");else{if(r.exists("/system/sys_dl.lock"))t.println("[kmain] Rootfs already unpacked, no need to unpack it again.");else{null!=kEnv.customRootfsImage&&(_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.rootfsUrl="system/images/"+kEnv.customRootfsImage+".zip"),t.println(`[kmain] Downloading latest rootfs from ${_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.rootfsUrl} (this could take a while)`);var a=await fetchResourceAsBinary(_kernel_kerninfo__WEBPACK_IMPORTED_MODULE_13__.v.rootfsUrl);if(!a.success)return void t.error("Could not fetch rootfs from remote, system halted.");t.println("[kmain] Rootfs downloaded, unpacking to C:/...<br>")}if(r.exists("/system/temp")?(await r.rmdir("/system/temp"),await r.mkdir("/system/temp")):await r.mkdir("/system/temp"),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.U6)(t.el,n),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(0),!r.exists("/system/sys_dl.lock")){try{if(null!=localStorage.getItem("break_boot"))throw new Error;await async function(){for(var e=await JSZip.loadAsync(a.data),n=Object.keys(e.files),s=0;s<n.length;s++){var i=n[s],o=e.files[i],l=o.name;if(l.startsWith("/")||(l="/"+l),l.endsWith("/")&&(l=l.substring(0,l.length-1)),!kEnv.usesLocalStorage||!kEnv.localStorageExtractIgnoreExtensions.includes(l.substring(l.indexOf(".")))){if(o.dir)r.mkdir(l),t.println_styled("[kmain:rootfs] Mkdir C:"+l,"color: #0fa");else{var c=await o.async("uint8array"),d=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FSUtil.getParentPath(l);r.exists(d)||r.mkdir(d),await r.writebin(l,c);let e=c.length;e>=1024?e=~~(e/1024)+"KB":e+="B",t.println_styled("[kmain:rootfs] Extracted C:"+l+" ("+e+")","color: #0fa")}(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(.8*Math.floor(s/n.length*100))}}}()}catch(e){return t.el.classList.remove("logo-shown"),void t.println_styled(" --&gt; An error occured whilst trying to extract the root file system layout to C:/. <br> --&gt; Please try to clear site data or check your internet connection to see if it fixes the problem.<br> --&gt; If that does not work, please tell a developer at <a href='https://discord.gg/KCTaM75'>https://discord.gg/KCTaM75</a><br> --&gt; Have a good day!<br><br>System halted.","color: red")}t.println("<br><br>&gt;&gt; File system successfully extracted.")}(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(80),await kpause(1500),await kmain_stage2(t,r)}}async function showCover(){var e=document.createElement("div");e.style.background="#000",e.style.opacity="0%",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.zIndex="15000000000",e.style.transition=".3s opacity",document.body.appendChild(e),await sleep(10),e.style.opacity="100%",await sleep(500),e.style.opacity="0%",await sleep(300),document.body.removeChild(e)}async function kinitGui(e,t){const n=document.getElementById("maingfx");n.style.display="none",showCover(),await sleep(280),_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/config/session.json")||(_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/config")||await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mkdir("c:/system/config"),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.writestr("c:/system/config/session.json",JSON.stringify({shell:"default"},null,4)));try{e.println("[gui] Reading session config...");const s={shell:"default",...JSON.parse(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr("c:/system/config/session.json"))};if("default"==s.shell)e.println("[gui] Init default shell..."),!1!==t&&await _shell_desktop__WEBPACK_IMPORTED_MODULE_4__.C.initialize(n,e);else{const t=`c:/system/local/share/sessions/${s.shell}.json`,i=JSON.parse(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr(t));if(!i.command)throw new Error("No command");e.println(`[gui] Exec ${i.command}`),await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__.D.runFile(i.command,{boxedEnv:{mainGfx:n,argv:i.args,kernel:{klog:e,systemFlags:(0,_flags__WEBPACK_IMPORTED_MODULE_37__.zM)(),env:kEnv}}})}window.w96.shell.config=s}catch(s){e.error("Failed to load shell, falling back..."),console.error(s),!1!==t&&await _shell_desktop__WEBPACK_IMPORTED_MODULE_4__.C.initialize(n,e)}e.println("[gui] Reading Window Manager config...");try{_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/config/wm.json")||await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.writestr("c:/system/config/wm.json",JSON.stringify(_gui_wndsystem__WEBPACK_IMPORTED_MODULE_0__.C$.getConfig(),null,4)),_gui_wndsystem__WEBPACK_IMPORTED_MODULE_0__.C$.setConfig(JSON.parse(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr("c:/system/config/wm.json")))}catch(t){e.error(":: [ ! ] Unable to read window system configuration!")}(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("disable_wcomp")||_gui_compositor_wincomp__WEBPACK_IMPORTED_MODULE_26__.u.enable(!0),document.body.style.overflow="hidden",e.close(),n.classList.add("mgfx-main"),n.style.display="block",window.w96.wmem.clockUpdate(),_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.playSound("start"),versionCheck_isOld()&&!(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("no_update_notifs")&&_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.confirm("A system update is available. Would you like to update? <br><br>By pressing 'OK', your system will reboot.",(async e=>{e&&(localStorage.removeItem("w96ver"),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.rm("c:/system/sys_dl.lock"),reboot())})).setSize(320,140)}function showIntro(){console.log(`\n                ########      \n              ################  \n##          ######..####..######\n##  ##  ########....####....####        Windows 96 v${latestVersion} main\n    ############....####....####        --------------------\n..          ####..########..####        http://windows96.net\n..  ..  ....####################\n    ........######..####..######\n..          ####....####....####        Discord: https://discord.gg/KCTaM75\n..  ..  ....####....####....####\n    ........####..########..####        %c[!] Do not paste random code from other users,\n%c##          ####################            %c99/100 times you will be executing something\n%c##  ##  ##########        ######            %cmalicious!\n%c    ##########                ##`,"color: red;","","color: red;","","color: red;","")}async function kmain_stage2(klog,fs_root){_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("path","C:/system/local/bin;C:/user/bin;C:/local/bin"),_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("username","user"),_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("hostname","computer"),_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("os_ver",latestVersion),_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("boot_kernEnv",JSON.stringify(kEnv)),_registry__WEBPACK_IMPORTED_MODULE_6__.nP.setEnv("boot_sysFlags",JSON.stringify((0,_flags__WEBPACK_IMPORTED_MODULE_37__.zM)()));let p3_config={autoconnect:!1};try{_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists(_apps_system_p3_settings__WEBPACK_IMPORTED_MODULE_40__.p)&&(p3_config=JSON.parse(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr(_apps_system_p3_settings__WEBPACK_IMPORTED_MODULE_40__.p)))}catch(e){console.error("P3 config parse error",e)}if(w96.net.p3=new _sys_net_p3_import_w96__WEBPACK_IMPORTED_MODULE_23__.d8(p3_config),svcMgr){_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/etc/services")||await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mkdir("c:/system/etc/services");for(let e of _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readdir("c:/system/etc/services"))if(e.endsWith(".js"))try{const t=await svcMgr.parse(e);klog.println_styled("[stage2] Registering service "+t.id+"...","color: orchid"),await svcMgr.register(t),t.autostart&&await svcMgr.start(t,{kernel:{log:klog,env:kEnv}})}catch(t){console.error("Error whilst loading service: "+String(t)),klog.println_styled("[stage2 error] Script Error in ["+e+"] --\x3e "+String(t),"color: red")}}if(!(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("no_boot_scripts")){if(klog.println("[stage2] Reading boot scripts from /system/boot..."),!fs_root.exists("/system/boot")||fs_root.isFile("/system/boot"))klog.warn("/system/boot is either missing or corrupted, ignoring...");else{fs_root.exists("/system/boot/sys-auto.js")&&(klog.println_styled("[stage2] Reading sys auto script...","color: orchid"),await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__.D.runFile("c:/system/boot/sys-auto.js"));const e=[".js",".wasm",".css"];for(var file of fs_root.readdir("/system/boot"))try{if(!fs_root.isFile(file))continue;if("/system/boot/sys-auto.js"==file)continue;const t=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FSUtil.getExtension(file);if(!e.includes(t))continue;klog.println_styled("[stage2] Reading script "+file+"...","color: orchid");var scriptContents="";switch(t){case".js":await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__.D.runFile(file,{envType:"kernel",boxedEnv:{log:klog}});break;case".css":scriptContents=await fs_root.readstr(file);const e=document.createElement("style");e.innerText=scriptContents,e.setAttribute("script",file),document.body.appendChild(e);break;case".wasm":_wasm_wasm__WEBPACK_IMPORTED_MODULE_9__.K.execPrgm(file)}}catch(e){klog.println_styled("[stage2 error] Script Error in ["+file+"] --\x3e "+String(e),"color: red")}if(fs_root.exists("/system/boot/apps"))for(var file of fs_root.readdir("/system/boot/apps")){if(!fs_root.isFile(file))continue;const e=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FSUtil.getExtension(file);".js"==e&&(klog.println_styled("[stage2] Loading app "+file+"...","color: orchid"),await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__.D.runFile(file,{envType:"kernel",boxedEnv:{log:klog}}))}else klog.warn("/system/boot/apps is either missing or corrupted, ignoring...")}klog.println("[stage2] Finished reading scripts.")}if("undefined"!=typeof FontFace){fs_root.exists("/system/local/share/fonts")||fs_root.mkdir("/system/local/share/fonts");const e=[".ttf",".woff",".woff2"];for(let t of _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readdir("c:/system/local/share/fonts"))if(e.includes(_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FSUtil.getExtension(t).toLowerCase()))try{const e=_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FSUtil.fname(t),n=e.substring(0,e.indexOf("."));klog.println_styled("[stage2] Loading font "+t+" as "+n+"...","color: orchid");const s=new FontFace(n,`url(${URL.createObjectURL(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.toBlob(t))})`);s.load().then((()=>document.fonts.add(s)))}catch(e){klog.error(new String(e))}}else klog.warn("Environment does not support FontFace, will not load fonts.");if("true"!==localStorage.getItem("no_apps")&&(importApp("OpenWithApplication","openwith",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,4016))),importApp("ExplorerApplication","explorer",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,6314))),importApp("TextpadApplication","textpad",["txt","log"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3349))),importApp("AboutUIApplication","about-ui",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,386))),importApp("TerminalApplication","terminal",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1384))),importApp("FlagsApplication","flags",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,4600))),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("mpmenu",[],(function(e){return _apps_wapp__WEBPACK_IMPORTED_MODULE_41__.WApplication.execAsync(new _apps_mobile_progs_menu__WEBPACK_IMPORTED_MODULE_16__.f,e)})),importApp("WMSMApp","wmsm",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,8662))),{}.vidplayer||importApp("VideoPlayerApplication","vidplayer",["mp4","webm"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,4082))),{}.mdview||importApp("MDViewApplication","mdview",["md"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7398))),{}.effects||importApp("FXApplication","effects",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2446))),{}.imgviewer||importApp("ImgViewerApplication","imgviewer",["jpg","png","gif","webp","avif","jxl"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5515))),{}.nes||importApp("NESEmulatorApplication","nes",["NES","nes"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5235))),{}.uploader||importApp("UploaderApplication","uploader",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,619))),{}.dosbox||importApp("DOSBOXApplication","dosbox",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2666))),{}.wasm_tools||importApp("WASMToolsApplication","wasm-tools",["wasm","WASM"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3327))),{}.jslinux||importApp("JSLinuxApplication","jslinux",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5567))),{}.settings||importApp("SettingsApplication","settings",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,8239))),{}.wiki96||importApp("Wiki96Application","wiki96",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3356))),{}.meme_man||importApp("MemeManApplication","meme-man",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3017))),{}.dyk||importApp("DYKApplication","dyk",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9041))),{}.win96_chat||importApp("Win96ChatApplication","win96-chat",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1969))),{}.blocks||importApp("BlocksApplication","blocks",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,8754))),{}.gltest||importApp("GLTestApplication","gltest",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1729))),{}.winmp96||importApp("Multiplayer96Application","winmp96",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7477))),{}.credits||importApp("CreditsUIApplication","credits",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9690))),{}.wpa||importApp("WPA_Application","wpa",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,112))),{}.matrix||importApp("MatrixApplication","matrix",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2062))),{}.vm||importApp("VMApplication","vm",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7883))),{}.base64||importApp("Base64Application","base64",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3761))),{}.server_stat||importApp("ServerStatApplication","server-stat",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,382))),{}.iexploder||importApp("IntExploderApplication","iexploder",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,7960))),{}.shareboard||importApp("BoardApplication","shareboard",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,4465))),{}.notron||importApp("NoTronApplication","notron",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2434))),{}.hterm||importApp("HTermApplication","hterm",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1872))),{}.gameing||importApp("GameingApplication","gameing",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2290))),{}.__support_us||importApp("DonationUIApplication","__support-us",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,6355))),{}.youare||importApp("YouAreApplication","youare",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9704))),{}.dd||importApp("DesktopDestroyerApplication","dd",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3837))),{}.eyeframe||importApp("iFrameApplication","eyeframe",["html","htm","HTML","HTM"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2758))),{}.pumkin||importApp("PumkinGameApplication","pumkin",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3903))),{}.super_player||importApp("SuperPlayerApplication","super-player",["swf","SWF"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,969))),{}.winspector||(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("winspector",[],(function(e){return _apps_wapp__WEBPACK_IMPORTED_MODULE_41__.WApplication.execAsync(new _apps_util_winspector__WEBPACK_IMPORTED_MODULE_18__.K,e)})),{}.monaco||importApp("MonacoApplication","monaco",["js","JS","CSS","css","json","JSON","wat","WAT","cfg","CFG"],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,8966))),{}.tutorial||importApp("TutorialApplication","tutorial",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,612))),{}.superterm||importApp("SuperTermApplication","superterm",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,2430))),{}.bassoon||importApp("BassoonTrackerApplication","bassoon",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1066))),importApp("KeyManagementApplication","keymgr",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3872))),{}.troll||importApp("TrollApplication","troll",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9593))),{}.bsod||(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("bsod",[],(function(e){null!=e[0]?(0,_kernel_bsod__WEBPACK_IMPORTED_MODULE_42__.A)(e[0]):_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.prompt("BSOD","Enter your message below","",(e=>{null!=e&&""!=e.trim()&&(0,_kernel_bsod__WEBPACK_IMPORTED_MODULE_42__.A)(e)}))})),{}.jsguirepl||importApp("JSGUIRepl","jsguirepl",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,9005))),{}.dtool||importApp("DToolApp","dtool",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,849))),{}.pchc||importApp("HealthCheckApp","pchc",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,335))),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("__lnk",["lnk","LNK"],(function(){_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.error("Bro","Your copy of Windows isn't real enough to open this type of file.","wat").setSize(350,110).dlg.center()})),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("__exe",["exe","EXE"],(function(){_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.error("File Not Supported","Win32 Executables are not supported.","Got damn!!").setSize(350,110).dlg.center()})),{}.pkmgr||importApp("PackageManagerApplication","pkmgr",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,3361))),{}.ctrl||importApp("CtrlApplication","ctrl",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5545))),{}.p3||(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("p3",[],(function(e){return _apps_wapp__WEBPACK_IMPORTED_MODULE_41__.WApplication.execAsync(new _apps_system_p3_settings__WEBPACK_IMPORTED_MODULE_40__.h,e)})),{}.dynwp_prefs||(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("dynwp-prefs",[],(function(e){return _apps_wapp__WEBPACK_IMPORTED_MODULE_41__.WApplication.execAsync(new _apps_system_settings_dynamicwp__WEBPACK_IMPORTED_MODULE_20__.T,e)})),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("reinstall",[],(function(e){_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.confirm("Press OK to reinstall Windows 96. Your data will be gone forever and cannot be recovered!",(e=>{if(e)if(localStorage.clear(),indexedDB){const e=indexedDB.deleteDatabase("W96FS");e.onsuccess=()=>{console.log("DB clear successful!"),document.location.reload()},e.onerror=()=>{console.error("DB clear failed!"),document.location.reload()},e.onblocked=()=>{console.error("Operation blocked - cannot clear DB."),document.location.reload()}}else document.location.reload()}))})),{}.wasmrt||(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("wasmrt",["wasm","WASM"],(function(e){console.warn("TODO")})),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("js",[],(async function(args){null!=args[0]&&eval(await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr(args[0]))})),{}.devmgr||importApp("DevMgrApplication","devmgr",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,5559))),{}.backupmgr||importApp("BackupManagerApp","backupmgr",[],await Promise.resolve().then(__webpack_require__.bind(__webpack_require__,8735))),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.VG)("run",[],(function(){_shell_desktop__WEBPACK_IMPORTED_MODULE_4__.C.runBox()}))),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(90),await kpause(500),(0,_boot_gfxboot__WEBPACK_IMPORTED_MODULE_45__.H6)(95),await _kernel_events__WEBPACK_IMPORTED_MODULE_14__.K.post_init(klog)){if(await kinitGui(klog),localStorage["product-key"]){let e=await(0,_sys_os_wpa__WEBPACK_IMPORTED_MODULE_7__.Tn)(localStorage["product-key"]);e.valid?console.log("%c[wpa]%c Product key is valid.","color:#0f0;font-weight:bold",""):(localStorage.removeItem("product-key"),console.log("%c[wpa]%c Key activation failed. WPA reported: %s","color:#fa0;font-weight:bold","",e.reason))}else console.log("%c[wpa]%c No product key is installed.","color:#0f0;font-weight:bold","");_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/boot/runonce")||_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mkdir("c:/system/boot/runonce");for(let e of _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readdir("c:/system/boot/runonce"))try{_shell_executor__WEBPACK_IMPORTED_MODULE_19__.l.execFile(e)}catch(e){console.error("RunOnce error: "+String(e))}setTimeout((async function(){await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.rmdir("c:/system/boot/runonce"),await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.mkdir("c:/system/boot/runonce")}),2e3),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("textpad",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/textpad"),"Textpad"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("openwith",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("empty"),"Open With"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("explorer",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/explorer"),"Explorer"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("vidplayer",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("video"),"Video Player"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("mdview",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/mdview"),"Markdown Viewer"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("imgviewer",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("image2"),"Image Viewer"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("nes",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/nes"),"NES"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("dosbox",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/dosbox"),"DOSBox"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("wasm-tools",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/wasm-tools"),"WASM Tools"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("iexploder",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/iexploder"),"Internet Exploder"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("eyeframe",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/eyeframe"),"EyeFrame"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("super-player",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/super-player"),"Super Player"),(0,_registry__WEBPACK_IMPORTED_MODULE_6__.Du)("monaco",_gui_shell_theme_theme__WEBPACK_IMPORTED_MODULE_21__.Q.getIconUrl("apps/monaco"),"Monaco"),console.groupEnd(),_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists("c:/system/etc/devprofiles/current.json")&&await _dev_profilemgr__WEBPACK_IMPORTED_MODULE_32__.a.loadProfile("c:/system/etc/devprofiles/current.json"),_events__WEBPACK_IMPORTED_MODULE_17__.p.sys.emit("init-complete");try{_net_crossifr__WEBPACK_IMPORTED_MODULE_24__.f.register(),_net_crossifr__WEBPACK_IMPORTED_MODULE_24__.f.registerBasicEvents()}catch(e){console.error("Failed to register cross iframe communication bridge."),console.error(e)}"true"!=localStorage["ignore-post-sys-checks"]&&(indexedDB||"true"==localStorage["idb-ignore"]||(_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.warning("Storage Error",'<span class="bold-noaa">IndexedDB storage is not available!</span><br><br>\n            This will have negative implications on your Windows 96 experience.<br>\n            <br>\n            Please upgrade to a browser that supports IndexedDB or manually enable it yourself to ensure you get the best experience possible.<br>\n            <br>\n            If you choose to continue, expect performance to suffer greatly and the amount of file storage to be limited.',"I acknowledge").setSize(400,240).dlg.center(),localStorage.setItem("idb-ignore","true")),window.WebAssembly||"true"==localStorage["wasm-ignore"]||(_gui_commdlg__WEBPACK_IMPORTED_MODULE_10__.jC.warning("WebAssembly Error",'<span class="bold-noaa">WebAssembly is not available.</span><br><br>\n            Certain apps such as Monaco will refuse to run, due to their dependence of WebAssembly.<br><br>\n            Other apps may fall back to asm.js, which is <span class="bold-noaa">significantly slower</span> than WASM.<br><br>\n            Please consider upgrading your browser to allow you to use all available apps.',"I acknowledge").setSize(400,220).dlg.center(),localStorage.setItem("wasm-ignore","true"))),"undefined"==typeof BatteryManager||(0,_flags__WEBPACK_IMPORTED_MODULE_37__.yE)("disable_battery_api")||(console.log("Battery API present, will report battery information."),_dev_battery__WEBPACK_IMPORTED_MODULE_34__.q.begin()),_kernel_iip__WEBPACK_IMPORTED_MODULE_28__.T.deregisterHandler(),execCmd("p3",["--tray"])}}async function reboot(e){if(e)return document.location.reload();_gui_wndsystem__WEBPACK_IMPORTED_MODULE_0__.C$.closeAllWindows(!1);try{document.querySelector(".user-taskbar").remove();const e=document.querySelector(".user-desktop");for(;e.firstChild;)e.removeChild(e.firstChild);const t=w96.ui.MsgBoxSimple.status("Windows 96","Please wait.."),n=t.wndObject.querySelector("#msg");w96.net.p3&&w96.net.p3.connected&&(n.textContent="Closing open ports and connections..",await w96.net.p3.disconnect()),n.textContent="Windows 96 is shutting down...",t.close()}catch(e){}document.location.reload()}async function execCmd(e,t=[],n=null){if(!(t instanceof Array))throw new Error("argv must be an array.");if((0,_registry__WEBPACK_IMPORTED_MODULE_6__.K2)(e))return await(0,_registry__WEBPACK_IMPORTED_MODULE_6__.lw)(e,t);const s=_registry__WEBPACK_IMPORTED_MODULE_6__.nP.getEnv("path").split(";");for(let i of s){if(!_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists(i))continue;const s=i+"/"+e;if(_fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.exists(s))return await _api_wrt_wrt__WEBPACK_IMPORTED_MODULE_25__.D.runFile(s,{boxedEnv:{args:[e,...t],...n||{}}})}throw new Error("Cannot find required command executable.")}async function setKernImage(e){if(null===e)return void localStorage.removeItem("kernel-image");const t=await _fs_webfs__WEBPACK_IMPORTED_MODULE_3__.FS.readstr(e);localStorage.setItem("kernel-image",t)}window.addEventListener("beforeunload",(()=>{w96.net.p3&&w96.net.p3.connected&&w96.net.p3.disconnect()}));const System={execCmd,reboot,setKernImage,updateRequired:versionCheck_isOld,latestVersion:()=>latestVersion,wmem:{eCachedMetadata:{},clockInt:0},bootFlags:(0,_flags__WEBPACK_IMPORTED_MODULE_37__.zM)(),services:svcMgr}},120:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});const s={parse:function(e){for(var t=[],n="",s=0,i=0;i<e.length;i++){var o=e[i];switch(s){case 0:if(" "==o){if(""==n)continue;t.push(n),n="";continue}if('"'==o){s=1;continue}n+=o;break;case 1:if('"'==o&&i>0&&"\\"!=e[i-1]){t.push(n),s=0,n="";continue}n+=o}}return""!=n&&t.push(n),t},stripOptions:function(e,t,n){return!!t&&(t.forEach(((s,i)=>{i<e||n.includes(s)&&t.splice(i,1)})),!0)}}},5905:(e,t,n)=>{"use strict";function s(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(t.length),i=new Uint8Array(s),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([s],{type:n})}function i(e){return new Promise((t=>{var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){var e=n.result;t(e)}}))}n.d(t,{O:()=>s,y:()=>i})},8362:(e,t,n)=>{"use strict";n.d(t,{P:()=>s});var s=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,s,i,o,r;return i=2147483648&e,o=2147483648&t,r=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(s=1073741824&t)?2147483648^r^i^o:n|s?1073741824&r?3221225472^r^i^o:1073741824^r^i^o:r^i^o}function s(e,s,i,o,r,a,l){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(s,i,o),r),l)),n(t(e,a),s)}function i(e,s,i,o,r,a,l){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(s,i,o),r),l)),n(t(e,a),s)}function o(e,s,i,o,r,a,l){return e=n(e,n(n(function(e,t,n){return e^t^n}(s,i,o),r),l)),n(t(e,a),s)}function r(e,s,i,o,r,a,l){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(s,i,o),r),l)),n(t(e,a),s)}function a(e){var t,n="",s="";for(t=0;t<=3;t++)n+=(s="0"+(e>>>8*t&255).toString(16)).substr(s.length-2,2);return n}var l,c,d,p,u,h,m,_,w,y=Array();for(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var s=e.charCodeAt(n);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}(e),y=function(e){for(var t,n=e.length,s=n+8,i=16*((s-s%64)/64+1),o=Array(i-1),r=0,a=0;a<n;)r=a%4*8,o[t=(a-a%4)/4]=o[t]|e.charCodeAt(a)<<r,a++;return r=a%4*8,o[t=(a-a%4)/4]=o[t]|128<<r,o[i-2]=n<<3,o[i-1]=n>>>29,o}(e),h=1732584193,m=4023233417,_=2562383102,w=271733878,l=0;l<y.length;l+=16)c=h,d=m,p=_,u=w,h=s(h,m,_,w,y[l+0],7,3614090360),w=s(w,h,m,_,y[l+1],12,3905402710),_=s(_,w,h,m,y[l+2],17,606105819),m=s(m,_,w,h,y[l+3],22,3250441966),h=s(h,m,_,w,y[l+4],7,4118548399),w=s(w,h,m,_,y[l+5],12,1200080426),_=s(_,w,h,m,y[l+6],17,2821735955),m=s(m,_,w,h,y[l+7],22,4249261313),h=s(h,m,_,w,y[l+8],7,1770035416),w=s(w,h,m,_,y[l+9],12,2336552879),_=s(_,w,h,m,y[l+10],17,4294925233),m=s(m,_,w,h,y[l+11],22,2304563134),h=s(h,m,_,w,y[l+12],7,1804603682),w=s(w,h,m,_,y[l+13],12,4254626195),_=s(_,w,h,m,y[l+14],17,2792965006),h=i(h,m=s(m,_,w,h,y[l+15],22,1236535329),_,w,y[l+1],5,4129170786),w=i(w,h,m,_,y[l+6],9,3225465664),_=i(_,w,h,m,y[l+11],14,643717713),m=i(m,_,w,h,y[l+0],20,3921069994),h=i(h,m,_,w,y[l+5],5,3593408605),w=i(w,h,m,_,y[l+10],9,38016083),_=i(_,w,h,m,y[l+15],14,3634488961),m=i(m,_,w,h,y[l+4],20,3889429448),h=i(h,m,_,w,y[l+9],5,568446438),w=i(w,h,m,_,y[l+14],9,3275163606),_=i(_,w,h,m,y[l+3],14,4107603335),m=i(m,_,w,h,y[l+8],20,1163531501),h=i(h,m,_,w,y[l+13],5,2850285829),w=i(w,h,m,_,y[l+2],9,4243563512),_=i(_,w,h,m,y[l+7],14,1735328473),h=o(h,m=i(m,_,w,h,y[l+12],20,2368359562),_,w,y[l+5],4,4294588738),w=o(w,h,m,_,y[l+8],11,2272392833),_=o(_,w,h,m,y[l+11],16,1839030562),m=o(m,_,w,h,y[l+14],23,4259657740),h=o(h,m,_,w,y[l+1],4,2763975236),w=o(w,h,m,_,y[l+4],11,1272893353),_=o(_,w,h,m,y[l+7],16,4139469664),m=o(m,_,w,h,y[l+10],23,3200236656),h=o(h,m,_,w,y[l+13],4,681279174),w=o(w,h,m,_,y[l+0],11,3936430074),_=o(_,w,h,m,y[l+3],16,3572445317),m=o(m,_,w,h,y[l+6],23,76029189),h=o(h,m,_,w,y[l+9],4,3654602809),w=o(w,h,m,_,y[l+12],11,3873151461),_=o(_,w,h,m,y[l+15],16,530742520),h=r(h,m=o(m,_,w,h,y[l+2],23,3299628645),_,w,y[l+0],6,4096336452),w=r(w,h,m,_,y[l+7],10,1126891415),_=r(_,w,h,m,y[l+14],15,2878612391),m=r(m,_,w,h,y[l+5],21,4237533241),h=r(h,m,_,w,y[l+12],6,1700485571),w=r(w,h,m,_,y[l+3],10,2399980690),_=r(_,w,h,m,y[l+10],15,4293915773),m=r(m,_,w,h,y[l+1],21,2240044497),h=r(h,m,_,w,y[l+8],6,1873313359),w=r(w,h,m,_,y[l+15],10,4264355552),_=r(_,w,h,m,y[l+6],15,2734768916),m=r(m,_,w,h,y[l+13],21,1309151649),h=r(h,m,_,w,y[l+4],6,4149444226),w=r(w,h,m,_,y[l+11],10,3174756917),_=r(_,w,h,m,y[l+2],15,718787259),m=r(m,_,w,h,y[l+9],21,3951481745),h=n(h,c),m=n(m,d),_=n(_,p),w=n(w,u);return(a(h)+a(m)+a(_)+a(w)).toLowerCase()}},9471:(e,t,n)=>{"use strict";n.d(t,{K:()=>s});const s={mkElement:function(e,t=[]){const n=document.createElement(e);for(let e of t)n.classList.add(e);return n}}},3978:(e,t,n)=>{"use strict";n.d(t,{V:()=>s});const s={escapeHtml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}},6841:(e,t,n)=>{"use strict";function s(e,t){return(e||t)&&!(e&&t)}function i(e,t){return Math.floor(Math.random()*t)+e}function o(e){return new Promise((t=>{setTimeout((()=>t()),e)}))}function r(e){return e.startsWith("data:")}function a(e,t,n){return n>t?t:n<e?e:n}function l(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}n.d(t,{Dc:()=>o,N5:()=>a,PX:()=>l,TN:()=>i,b2:()=>r,dl:()=>s})},3078:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var s=n(7366),i=n(8041),o=n(3978);let r=!1;const a={cfxRound:(e,t=10,n=8)=>(e/t-e%t/t)*t+n,async p3Connect(){const{p3:e}=w96.net;let t;if(e.connected)return!0;if(!r){t=new s.DI({resizable:!1,center:!0,initialWidth:320,initialHeight:140,title:"Dialing..",taskbar:!1,bodyClass:"p3-dialing",controlBoxStyle:"WS_CBX_NONE"});t.getBodyContainer().innerHTML=`\n                <div class="p3-dialing-header">\n                    <img src="/system/resource/misc/dialing.gif" width="227" height="55">\n                </div>\n                <span>Connecting to ${o.V.escapeHtml(e.server)}..</span>\n            `,t.show(),r=!0;let n=!1;try{await w96.net.p3.connect(),n=!0}catch(e){i.O.alert(e.message,{title:"P3 Connection error",icon:"error"})}return t.close(),r=!1,n}try{return await w96.net.p3.connect(),!0}catch(e){return!1}}}},9182:(t,n,s)=>{"use strict";s.d(n,{N:()=>o});var i=s(5784);async function o(t){const n=await function(t){return new Promise(((n,s)=>{try{fetch(t).catch((t=>{n({success:!1,data:null,error:e})})).then((async e=>{200!=e.status?n({success:!1,data:null,error:e.status}):n({success:!0,data:await e.arrayBuffer(),error:null})}))}catch(e){n({success:!1,data:null,error:e})}}))}(t),s=i.FS.get("c:");var o=await JSZip.loadAsync(n.data);const r=Object.keys(o.files);for(var a=0;a<r.length;a++){var l=r[a],c=o.files[l],d=c.name;if(d.startsWith("/")||(d="/"+d),d.endsWith("/")&&(d=d.substring(0,d.length-1)),console.log("Write c:"+d),c.dir)s.mkdir(d);else{var p=await c.async("uint8array"),u=i.FSUtil.getParentPath(d);s.exists(u)||s.mkdir(u),await s.writebin(d,p)}}}},1709:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>W96_WASM_IMPORTS_STD});var buf_str=[];function reboot(){document.location.reload()}const strtools={s_reset:function(){buf_str=[]},s_putc:function(e){buf_str.push(String.fromCharCode(e))},s_len:function(){return buf_str.length},buf2str:function(){return buf_str.join("")}},conio={print:function(){console.log(strtools.buf2str())},cls:function(){console.clear()}},misc=function(){return{js_eval:function(){eval(strtools.buf2str())}}}(),W96_WASM_IMPORTS_STD={imports:{reboot,print:conio.print,cls:conio.cls,js_eval:misc.js_eval,s_reset:strtools.s_reset,s_putc:strtools.s_putc,s_len:strtools.s_len}}},9110:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var s=n(5784),i=n(1709);async function o(e,t=!0){const n=await s.FS.readbin(e);return t?await WebAssembly.instantiate(n,i.S):await WebAssembly.instantiate(n)}const r={loadLocal:o,execPrgm:async function(e,t=!1){const n=await o(e);if(null==n.instance.exports.main){if(t)return;throw new Error("No valid entry point was found!")}return await n.instance.exports.main()},util:{strconst2wat:function(e,t=!1){var n="call $s_reset\n";for(let t=0;t<e.length;t++)n+="i32.const "+e.charCodeAt(t)+"\ncall $s_putc\n";return t?n:";; == Original String = ["+e+"] ==\n"+n+"\n;; ====================================="}}}},7517:()=>{},7839:(e,t,n)=>{"use strict";n.d(t,{d8:()=>u});var s=n(8041),i=n(3978);const o=400,r=100,a=101;class l{constructor(){this._cb={}}on(e,t){this._cb.hasOwnProperty(e)||(this._cb[e]=[]),this._cb[e].push(t)}removeEventListener(e,t){this._cb.hasOwnProperty(e)&&(this._cb[e]=this._cb[e].filter((e=>e!=t)))}emit(e,t){this._cb.hasOwnProperty(e)&&this._cb[e].forEach((e=>e(t)))}}class c extends l{constructor(e,t=null,n=!1){super(),this.connected=n,this.closed=!0,this.remoteAddress=e,this._server=t,this._isServerClient=n,this._heartbeatInterval=null,this.peerID=null,this.responsePort=null,this.nonce=0}async connect(){if(!this._isServerClient&&!this.connected){this.responsePort=this._server.getRandomPort(),this._server.listen(this.responsePort,((...e)=>this.emit("_clMessage",...e)));const e=await this._sendWithAck("connect",{responsePort:this.responsePort});this.connected=!0,this.peerID=e.peerID,this.heartbeat=e.heartbeat,this._heartbeatInterval=setInterval((()=>{this._sendHeartbeat().catch((e=>{this.disconnect(!1,{message:e})}))}),e.heartbeat),this._sendHeartbeat(),this.on("_clMessage",(e=>{if("message"==e.data.type&&this.emit("message",e.data.data),"disconnect"==e.data.type){const{code:t,message:n}=e.data;this.disconnect(!1,{code:t,message:n})}})),this.emit("connect")}}async disconnect(e=!0,t={message:"Client disconnect"}){if(this.connected){if(e)try{await this._connSend("disconnect")}catch(e){}this.connected=!1,this._isServerClient?delete this._server.connections[this.peerID]:(clearInterval(this._heartbeatInterval),this._server.closeCL(this.responsePort),this._server.connections=this._server.connections.filter((e=>e!=this))),this.emit("disconnect",t)}}async _sendHeartbeat(){await this._connSend("heartbeat",{})}_sendWithAck(e,t){const n=this.nonce++;return new Promise((async(s,i)=>{let o;this._isServerClient||(o=setTimeout((()=>i(new Error("Timed out"))),15e3));const r=e=>{e.source==this.remoteAddress.split(":")[0]&&"ack"==e.data.type&&e.data.nonce===n&&(this.removeEventListener("_clMessage",r),e.data.success?(s(e.data),clearTimeout(o)):i(e.data))};this.on("_clMessage",r);try{await this._connSend(e,{...t,nonce:n})}catch(e){this._isServerClient||this._server.closeCL(this.responsePort),i(e)}}))}async _connSend(e,t={}){await this._server.send(this.remoteAddress,{type:e,peerID:this.peerID,...t})}async send(e){await this._sendWithAck("message",{data:e})}}class d extends l{constructor(e,t){super(),this.config={heartbeat:15e3,port:e,...t},this.connections={},this._timeoutInterval=setInterval((()=>{for(const e in this.connections){const t=this.connections[e];Date.now()>t.timeout&&t.socket.disconnect(!0,{message:"Timed out",code:o})}}),this.config.heartbeat)}peerExists(e){return this.connections.hasOwnProperty(e)}_onRawMessage(e){const t=e.data;if("object"!=typeof t)return;const{type:n,args:s,nonce:i}=t;if("string"!=typeof n)return;if("connect"==n){const n=parseInt(t.responsePort,10),s=`${e.source}:${n}`;if(!isNaN(n)){if(Object.values(this.connections).find((e=>e.address===s)))return;const e=u.randomSecret(32),t=new c(s,this,!0);this.connections[e]={address:s,opened:Date.now(),timeout:Date.now()+this.config.heartbeat,receivedFirstHeartbeat:!1,socket:t},this._p3.send(s,{type:"ack",success:!0,code:r,message:"Connection accepted",peerID:e,heartbeat:this.config.heartbeat,nonce:i})}}const{peerID:o}=t;if(this.peerExists(o)){const e=this.connections[o];"heartbeat"==n&&(e.receivedFirstHeartbeat||(e.receivedFirstHeartbeat=!0,super.emit("connection",e.socket)),e.timeout=Date.now()+this.config.heartbeat),"message"==n&&(e.socket.emit("message",t.data),this.send(e.address,{type:"ack",success:!0,nonce:i})),"disconnect"==n&&e.socket.disconnect()}}async send(){await this._p3.send(...arguments)}bind(e){this._p3&&this.unbind(),this._p3=e,this.open()}open(){this._p3.listen(this.config.port,((...e)=>this._onRawMessage(...e)))}close(){if(this._p3){for(const e in this.connections)this.connections[e].socket.disconnect(!0,{message:"Server shutting down",code:a}),delete this.connections[e];this._p3.closeCL(this.config.port)}}unbind(){this._p3&&(this.close(),this._p3=null)}}let p={alert:function(e){console.log("[p3]",e)},io:null,getRandomValues:null};class u extends l{constructor(e){super(),e={relayServer:u.RELAY_SERVER,autoconnect:!0,secret:u.randomSecret(),...e},this._params=e;let t=null;"undefined"!=typeof localStorage&&(t=localStorage.getItem("product-key")),e.productKey&&(t=e.productKey);let n=p.io(e.relayServer,{autoConnect:e.autoconnect,reconnection:!0,reconnectionAttempts:4,transportOptions:{polling:{extraHeaders:{Authorization:"Bearer "+JSON.stringify(t)}}}});if(n.on("hello",(e=>{if(!this.connected){if(e.message&&e.success&&p.alert(e.message),!e.success)return this.connecting=!1,this.connected=!1,this.error=!0,void super.emit("error",e);this.error=!1,this._userDisconnect=!1,this.connecting=!1,this.connected=!0,this.address=e.address;for(const e in this.ports){const t=this.ports[e];t.public&&!t._published&&this.socket.emit("port.publish",parseInt(e),t.flags)}super.emit("connect",e)}})),n.on("packet",(e=>{const{port:t,data:n,source:s}=e;this.ports.hasOwnProperty(t)&&this.ports[t].listener({data:n,source:s}),super.emit("_receive")})),n.on("connect",(()=>{n.emit("hello",this.secret)})),n.on("reconnect_error",(()=>{this.attempts++,4===this.attempts&&(this.connecting=!1,this.error=!0,super.emit("error",{success:!1,message:`Connection failed (tried reconnecting ${this.attempts} times)`}))})),n.on("disconnect",(e=>{this.connected=!1,this.address=null,"io client disconnect"!=e&&"io server disconnect"!=e&&(this.connecting=!0);for(const e in this.ports)this.ports[e]._published=!1;super.emit("disconnect")})),"undefined"!=typeof process&&process.on){let e=!1;const t=()=>{e||(e=!0,n.on("disconnect",(()=>{process.exit(0)})),this.disconnect())};process.stdin.resume(),process.on("exit",t),process.on("SIGINT",t),process.on("SIGUSR1",t),process.on("SIGUSR2",t)}this.nonce=0,this.server=e.relayServer,this.socket=n,this.secret=e.secret,this.connected=!1,this.error=!1,this.attempts=0,this.ports={},this.address=null,this.connections=[],e.autoconnect&&(this.connecting=!0)}connect(){return new Promise(((e,t)=>{if(this.connected&&this.disconnect(),!this.connecting){this.socket.io.uri=this.server,this.connecting=!0,this.attempts=0;let{extraHeaders:e}=this.socket.io.opts.transportOptions.polling,t=null;this._params.productKey||"undefined"==typeof localStorage||(t=localStorage.getItem("product-key")),e.Authorization="Bearer "+JSON.stringify(t),this.socket.connect()}super.on("connect",e),super.on("error",t)}))}disconnect(){this._userDisconnect=!0,this.address=null;for(const e of this.connections)e.disconnect(!0,{reason:"System shutting down"});this.connections=[],this.socket.disconnect()}getRandomPort(){const e=Math.floor(65536*Math.random());return this.ports.hasOwnProperty(e)?this.getRandomPort():e}send(e,t){const n=this.nonce++;return super.emit("_send"),new Promise(((s,i)=>{let o=Date.now();const r=()=>{this.socket.off("packet.ok",a),this.socket.off("packet.err",l)},a=e=>{e.nonce===n&&(r(),s({time:Date.now()-o}))},l=e=>{e.nonce===n&&(r(),i(e.message))};this.socket.emit("packet",{dest:e,nonce:n,data:t}),this.socket.on("packet.ok",a),this.socket.on("packet.err",l)}))}listen(e,t){if("number"!=typeof e)throw new Error("port must be a number");if(this.ports.hasOwnProperty(e))throw new Error("Port already in use");this.ports[e]={listener:t,public:!1,flags:[],_published:!1}}publish(e,t){if(!(t instanceof Array))throw new Error("flags must be a string array");if(!this.ports.hasOwnProperty(e))throw new Error("port doesn't exist");this.socket.emit("port.publish",e,t),this.ports[e]._published=!0,this.ports[e].public=!0,this.ports[e].flags=t}unpublish(e){if(!this.ports.hasOwnProperty(e))throw new Error("port doesn't exist");this.socket.emit("port.remove",e)}closeCL(e){if(!this.ports.hasOwnProperty(e))throw new Error("Port not open");this.ports[e].public&&this.unpublish(e),delete this.ports[e]}discover(e,t=10){const n=this.nonce++;return new Promise(((s,i)=>{const o=()=>{this.socket.off("discover",r),this.socket.off("discover.err",a)},r=(e,t)=>{t===n&&(o(),s(e))},a=(e,t)=>{t===n&&(o(),i(e))};this.socket.on("discover",r),this.socket.on("discover.err",a),this.socket.emit("discover",e,t,n)}))}createServer(e,t){const n=new d(e);return n.on("connection",(e=>{this.connections.push(e),e.on("disconnect",(()=>{this.connections=this.connections.filter((t=>t!==e))})),t(e)})),n.bind(this),n}createConnection(e){const t=new c(e,this,!1);return this.connections.push(t),t.on("disconnect",(()=>{this.connections=this.connections.filter((e=>e!==t))})),t}}u.RELAY_SERVER="wss://p3.windows96.net",u.randomSecret=(e=8)=>{const t=p.getRandomValues(e);return p.base64(Array.from(t).map((e=>String.fromCharCode(e))).join(""))},function(e){p={...p,...e}}({alert:function(e){s.O.alert(i.V.escapeHtml(e),{title:"P3 Server Message"}).wnd.wndObject.classList.add("p3-message")},io:window.io,getRandomValues:e=>window.crypto.getRandomValues(new Uint8Array(e)),base64:e=>btoa(e)})},9703:(e,t,n)=>{"use strict";n.d(t,{Tn:()=>b,_M:()=>g});const s={crv:"P-384",ext:!0,key_ops:["verify"],kty:"EC",x:"9vXP9fOYwmxMrHRHXP2t72z5jz3CDLMsnuVCgCcsmYROEkMvMTTXwax4HVXnlV8M",y:"vuSn6b7pMV_kbigT21K0YAOZmyB8QpGokySVf5EHdPkDkB52p2jbuQn78hDSwDCv"},i=[1628087717008,1635066075997],o={},r=Number.MAX_SAFE_INTEGER||7378697629483821e4,a=function(e){const t=this,n=e||{};if(n.max&&n.length)throw new Error("cannot specify both max and length");for(const e in o)n.hasOwnProperty(e)||(n[e]=o[e]);let s;if(!Array.isArray(n.characters))throw new Error("`characters` option must be an array of string");if(0===n.characters.length)throw new Error("`characters` option cannot be empty");if(s=n.characters[0].length,n.characters.forEach((function(e){if("string"!=typeof e)throw new Error("`characters` option must be an array of string");if(e.length!==s)throw new Error("`characters` options are of inconsistent length: `"+e+"` is not "+s+" characters long")})),n.length&&!Number.isInteger(n.length))throw new Error("`length` option must be an integer");if(n.base&&!Number.isInteger(n.base))throw new Error("`base` option must be an integer");t.characters=n.characters,t.base=n.base||n.characters.length,t.length=n.length||t._findLength(n.max),t.dictStringLength=s};a.prototype._findLength=function(e){const t=this;let n=t.base,s=1;if(!e)return null;for(;n<=e;)s++,n*=t.base;return s},a.prototype._pad=function(e){const t=this;let n=e;for(;t.length&&n.length<t.length;)n=t.characters[0]+n;return n},a.prototype.encode=function(e){const t=this;if("number"!=typeof e)throw new TypeError("value to be encoded must be a number");if(0>e)throw new RangeError("value to be encoded must be positive");let n,s,i=0,o="";do{n=Math.floor(e/Math.pow(t.base,i)),s=n%t.base,o=t.characters[s]+o,i++}while(n!==s);if(null!==t.length&&(o=t._pad(o),o.length>t.length))throw new RangeError("base10 value of "+e+" (encoded: "+o+") exceeds maximum length of "+t.length);return o},a.prototype.decode=function(e){const t=this;let n=e.length,s=0,i=0;for(;0<n;){const o=e.substring(n-t.dictStringLength,n),r=t.characters.indexOf(o);let a;if(a=0<i?Math.pow(t.base,i)*r:r,-1===a)throw new Error("unknown "+o+" encoding string encountered");s+=a,i++,n-=t.dictStringLength}if(s>=r)throw new RangeError("decoded value exceeds Number.MAX_SAFE_INTEGER");return s};const l="----- BEGIN PRODUCT KEY -----",c="------ END PRODUCT KEY ------",d={name:"ECDSA",hash:{name:"SHA-384"}},p="ABCDEFGHJKLMNPRSTUXYZ2345689";let u,h,m=new a({characters:p.split("")});const _=1628071686414;async function w(e=!1){h||(h="undefined"==typeof window?(await Promise.resolve().then(n.t.bind(n,7517,19))).webcrypto.subtle:window.crypto.subtle),e&&!u&&(u=await async function(e,t){return await w(),h.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-384"},!1,[t])}(s,"verify"))}function y(e,t=!1){let n=[];e=(e=e.replace(/[\s-]/g,"")).match(new RegExp(".{1,2}","g"));for(let s of e){let e;try{e=m.decode(s)}catch(e){return null}t?n.push(String.fromCharCode(e)):n.push(e)}return t?n.join(""):new Uint8Array(n)}async function b(e){let t;await w(!0),e=e.replace(l,"").replace(c,"");let[n,s]=e.split(".");if(!n||!n.trim())return{valid:!1,reason:"Key data missing",data:null};if(!s||!s.trim())return{valid:!1,reason:"Key signature missing",data:null};let o=y(n.trim(),!0);try{t=JSON.parse("{"+o+"}")}catch(e){return{valid:!1,reason:`Key JSON parse failed (${e})`,data:null}}s=y(s.trim());let r=(new TextEncoder).encode(o);if(!s||!await h.verify(d,u,s,r))return{valid:!1,reason:"Invalid signature",data:null};if(t.v<1)return{valid:!1,reason:`V${t.v} keys are no longer supported.`};if(!t.createdOn)return{valid:!1,reason:"Missing key creation date",data:t};if(!t.owner)return{valid:!1,reason:"Missing key owner",data:t};if(t.createdOn+=_,i.includes(t.createdOn))return{valid:!1,reason:"Key has been revoked",data:t};switch(t.type){case"timer":if(t.validUntil+=_,Date.now()>t.validUntil)return{valid:!1,reason:"Key has expired",data:t};break;case"local":if("undefined"==typeof window)return{valid:!1,reason:"This key cannot be used on servers",data:t};break;case"infinite":break;default:return{valid:!1,reason:`Unknown key type '${t.type}'`,data:t}}return{valid:!0,data:t}}async function g(){return"undefined"!=typeof window&&localStorage.getItem("product-key")?await b(localStorage.getItem("product-key")):null}}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpack_require__.r(n);var s={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,__webpack_require__.d(n,s),n},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";__webpack_require__(5524);var e=__webpack_require__(5516),t=__webpack_require__(5784),n=__webpack_require__(7366),s=__webpack_require__(9338),i=__webpack_require__(4186),o=__webpack_require__(386),r=__webpack_require__(6314),a=__webpack_require__(4082),l=__webpack_require__(3349),c=__webpack_require__(7398),d=__webpack_require__(8239),p=__webpack_require__(5567),u=__webpack_require__(5235),h=__webpack_require__(2666),m=__webpack_require__(1384),_=__webpack_require__(112),w=__webpack_require__(4821),y=__webpack_require__(3872),b={AboutUIApplication:o.AboutUIApplication,ExplorerApplication:r.ExplorerApplication,VideoPlayerApplication:a.VideoPlayerApplication,TextpadApplication:l.TextpadApplication,MDViewApplication:c.MDViewApplication,SettingsApplication:d.SettingsApplication,JSLinuxApplication:p.JSLinuxApplication,NESEmulatorApplication:u.NESEmulatorApplication,DOSBOXApplication:h.DOSBOXApplication,TerminalApplication:m.TerminalApplication,WPA_Application:_.WPA_Application,P3SettingsApplication:w.h,KeyManagementApplication:y.KeyManagementApplication},g=__webpack_require__(4367),f=__webpack_require__(4247),v=__webpack_require__(7362),E=__webpack_require__(4420),k=__webpack_require__(9182),S=__webpack_require__(8576),x=__webpack_require__(8223),C=__webpack_require__(6429),O=__webpack_require__(3177),P=__webpack_require__(5506),W=__webpack_require__(9110),A=__webpack_require__(797),D=__webpack_require__(9951),L=__webpack_require__(4973),T=__webpack_require__(3978),I=__webpack_require__(6841);const M={wnd:function(e){let t={initialX:100,initialY:100,minHeight:22,minWidth:72,initialHeight:340,initialWidth:480,title:"Untitled Window",resizable:!0,draggable:!0,icon:null,html:"",displayInTaskbar:!0,animations:{windowOpen:"zoomIn",windowClose:"zoomOut"}};Object.assign(t,e);const s=new n.DI(t);return s.registerWindow(),t.displayInTaskbar&&s.registerAppBar(),null!=t.icon&&s.setWindowIcon(t.icon),s.setHtml(t.html),s}},F={ui:M,shell:__webpack_require__(8516).b,fs:t.FS,fsUtil:t.FSUtil,sys:{reboot:e.x.reboot},util:{xor:I.dl,htmlSafe:T.V.escapeHtml,loadScriptAsync:x.a.loadlibAsync,clamp:I.N5,rand:I.TN,sideloadZip:k.N,waitAsync:I.Dc},exec:e.x.execCmd};var B=__webpack_require__(4799),R=(__webpack_require__(4876),__webpack_require__(7619)),U=__webpack_require__(8279);class q extends B.N{constructor(e,t,n){super(e),this.fileTable={"/":{length:0,type:1}},this.readOnly=!0,this.volumeLabel="Shared",this.driverName="rofs",this.remote=!0,this.features.push(U.f.readOnly,U.f.remote),this.socket=null}async _getItem(e){return await fetch(e).then((e=>e.arrayBuffer()))}async init(){}async uninit(){this.fileTable=null}isFile(e){return 0==this.filetype(e)}exists(e){return null!=this.fileTable[e]}filetype(e){return this.exists(e)?this.fileTable[e].type:-1}touch(e){throw new R.J(R.H.EROFS,e)}rm(e){throw new R.J(R.H.EROFS,e)}mkdir(e){throw new R.J(R.H.EROFS,e)}readdir(e){var t=[],n=Object.keys(this.fileTable),s=e;if(!this.exists(e))throw new R.J(R.H.ENOENT,e);var i=s.split("/").length;for(var o in n){var r=n[o];if(r!=s&&null!=this.fileTable[r]){if("/"!=e){if(!r.startsWith(s+"/"))continue;if(!r.startsWith(s))continue}var a=r.split("/").length;"/"==e&&a>i||a>i+1||t.push(r)}}return this._fsSort?t.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})):t}isEmpty(e){if(!this.exists(e))throw new R.J(R.H.ENOENT,e);if(!this.isFile(e))throw new R.J(R.H.EISDIR,e);return 0==this.fileTable[e].length}async cpdir(e,t){throw new R.J(R.H.EROFS,t)}async mvdir(e,t){throw new R.J(R.H.EROFS,t)}async rmdir(e){throw new R.J(R.H.EROFS,e)}async mvfile(e,t){throw new R.J(R.H.EROFS,t)}async cpfile(e,t){throw new R.J(R.H.EROFS,t)}async readbin(e){if(!this.exists(e))throw new R.J(R.H.ENOENT,e);if(!this.isFile(e))throw new R.J(R.H.EISDIR,e);return this.fileTable[e].length<1?new Uint8Array(0):await this._getItem(e)}async readstr(e){if(!this.exists(e))throw new R.J(R.H.ENOENT,e);if(!this.isFile(e))throw new R.J(R.H.EISDIR,e);return this.fileTable[e].length<1?"":(new TextDecoder).decode(await this.readbin(e))}async writebin(e){throw new R.J(R.H.EROFS,e)}async writestr(e){throw new R.J(R.H.EROFS,e)}stat(e){return this.fileTable[e]}}var j=__webpack_require__(5544),K=__webpack_require__(1194),H=__webpack_require__(3697);const{UIComponent:N}=__webpack_require__(6993);var $=__webpack_require__(6999),z=__webpack_require__(4779),J=__webpack_require__(8423),Q=[];function V(){Q=[]}const G={queue:{get:function(){return Q},clear:V},enqueue:function(e){Q.push(e)},enqueueMany:function(e){for(let t of e)Q.push(t)},setOperation:function(e){switch(e){default:throw new Error("Invalid queue operation");case"move":case"copy":}e},sanitize:function(){Q.forEach(((e,n)=>{t.FS.exists(e)||Q.splice(n,1)}))},reset:function(){V(),"copy"}};var X=__webpack_require__(2763),Y=__webpack_require__(9275),Z=__webpack_require__(6167),ee=__webpack_require__(254),te=__webpack_require__(2589),ne=__webpack_require__(9266),se=__webpack_require__(8041),ie=__webpack_require__(3078),oe=__webpack_require__(2110),re=__webpack_require__(5905),ae=__webpack_require__(7839),le=__webpack_require__(9150),ce=__webpack_require__(674),de=__webpack_require__(5582);const pe={makeBackup:async function(){const e=new JSZip,n=t.FS.walk("c:/").map((e=>e.substring(3,e.length)));for(let s of n){const n="c:/"+s;if(t.FS.isFile(n))try{await e.file(s,await t.FS.readbin(n))}catch(e){console.log("Error zipping contents.")}}return e}};var ue=__webpack_require__(1717),he=__webpack_require__(4871),me=__webpack_require__(7733),_e=__webpack_require__(8918);const we={register:function(e){const t={command:null,type:"gui",filters:[],meta:null,cls:null,clsType:"class",...e};if(!t.command)throw new Error("Command was not specified in app registration!");if(!t.cls)throw new Error("No app class specified in app registration!");let n=t.cls;"function"!=typeof t.clsType&&(n=function(e,n){return i.WApplication.execAsync(new t.cls,e,n)}),(0,v.VG)(t.command,t.filters,n),t.meta&&(0,v.Du)(t.command,t.meta.icon,t.meta.friendlyName),(0,v.rF)(t.command,{type:t.type})}};var ye=__webpack_require__(51),be=__webpack_require__(9807),ge=__webpack_require__(9471),fe=__webpack_require__(3970),ve=__webpack_require__(5624);function Ee(){const e=[];return null!=window.indexedDB&&e.push("IndexedDB"),null!=window.localStorage&&e.push("LocalStorage"),"undefined"!=typeof WebAssembly&&e.push("WebAssembly"),"undefined"!=typeof WebGLProgram&&e.push("WebGL"),e}const ke={has:function(...e){const t=Ee();for(let n of e)if(!t.includes(n))return!1;return!0},getAll:Ee};var Se=__webpack_require__(6226);const xe={main:e.e,FS:t.FS,FSUtil:t.FSUtil,app:we,fstype:{IndexedFileSystem:t.IndexedFileSystem,LocalStorageFileSystem:t.LocalStorageFileSystem,RemoteReadOnlyFileSystem:P.O,SharedDriveFileSystem:q,RamFileSystem:C.s,FileSystemBase:t.IFileSystem},WindowSystem:n.C$,BuiltInApps:b,WindowParams:n.Lw,StandardWindow:n.DI,ui:{comp:ce.u,MsgBoxSimple:s.jC,Theme:E.Q,ContextMenu:S.ContextMenu,MessageBox:s._p,MenuBar:$.j,OpenFileDialog:s.MT,SaveFileDialog:s.pp,DialogCreator:se.O,animateElement:D.s,components:{TabControl:j.a,CSS3dContainer:K.k,Panel:class extends N{constructor(){super(),this.uiComponent=document.createElement("div"),this.uiComponent.classList.add("w96-panel")}},ListBox:z.w,GroupBox:te.E,TreeView:de.L,RadioBox:ue.X,CheckBox:fe.J},util:ie.e},WApplication:i.WApplication,__debug:{processes:i.processes,WinLogon:A.P,ImmersiveDesktopEnvironment:H.E},sys:{execFile:ee.l.execFile,execCmd:e.x.execCmd,rel:f.d,env:v.nP,reboot:e.x.reboot,reg:{registerApp:v.VG,appExists:v.K2,getInstalledApps:v.V7,deregisterApp:v.N9,executeApp:v.lw,getFileHandlers:v.rr},loader:x.a,renderBSOD:O.A,wasm:W.K,setKernImage:e.x.setKernImage,updateNeeded:e.x.updateRequired,DirMetadataReader:X.p,PkMgr:ne.j,BackupManager:pe,Service:me.D,ServiceManager:_e.W,services:e.x.services,DevProfileManager:be.a,biosConfig:ve.Z,features:ke,flags:{has:Se.yE,set:Se.mB,clear:Se.RI,getAll:Se.zM}},shell:{mkShortcut:L.R.mkShortcut,fileQueue:G,Taskbar:J.e,NotifyIcon:he.K,desktop:g.C},util:{sideloadZip:k.N,blobToDataURI:re.y,dataURItoBlob:re.O,rand:I.TN,wait:I.Dc,escapeHtml:T.V.escapeHtml,DomUtils:ge.K},net:{P3Connection:ae.d8,p3:null,crossifr:le.f},__sys:{desktopShell:g.C},debug:{perf:ye.z},wmem:e.x.wmem,evt:Z.p,WRT:oe.D,urlopen:t=>e.x.execCmd("iexploder",[t]),toString:()=>"Windows 96\n\nCopyright (C) windows96.net 2021.\n\nYou can view the dev docs at https://devdocs.windows96.net/"};window.w96=xe,window.u96=F,window.EventEmitter=Y.v,window.alert=se.O.alert})()})();